//////////////////////////////////////////////////////////////////////////////////////////
//                                                                                      //
//		                          Bordeaux Métropole                             		//
//                Direction des Systèmes d'Information - Centre SIG                     //
//                         Sébastien Cart-Lamy - 23/03/2011                             //
//                   API CUB © version 1.1.8 - Tous droits réservés                     //
//          Se référer aux conditions d'utilisations sur http://data.bordeaux-metropole.fr           //
//////////////////////////////////////////////////////////////////////////////////////////
var CUB=function(){var N=(typeof B=="object"&&B.singleFile);var u=(!N)?"lib/OpenLayers.js":"OpenLayers.js";var P=window.OpenLayers;var B={_scriptName:(!N)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){var aa=new RegExp("(^|(.*?\\/))("+u+")(\\?|$)"),Z=document.getElementsByTagName("script"),ab,W,X="";for(var Y=0,V=Z.length;Y<V;Y++){ab=Z[Y].getAttribute("src");if(ab){var W=ab.match(aa);if(W){X=W[1];break}}}return(function(){return X})}};B.CUB={};B.bases={};var p={};if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}(function(){p.checkEnum=function(W,V){for(i in V){if(V[i]==W){return true}}return false};p.errorLevel={INFO:0,WARNING:1,ERROR:2};p.errorLog=function(V,W){W=W||p.errorLevel.INFO;if(typeof console!=="undefined"){switch(W){case p.errorLevel.INFO:console.info("[API CUB] "+V);break;case p.errorLevel.WARNING:console.warn("[API CUB] "+V);break;case p.errorLevel.ERROR:console.error("[API CUB] "+V);break}}else{switch(W){case p.errorLevel.INFO:break;case p.errorLevel.WARNING:alert("[API CUB ALERTE] : "+V);break;case p.errorLevel.ERROR:alert("[API CUB ERREUR] : "+V);break}}return false};p.boundsToExtent=function(W,V,X){return new M.Extent(W.left,W.bottom,W.right,W.top,V||M.realProjection(),X||M.projection())};p.lonLatToPosition=function(V,W,X){return new M.Position(V.lon,V.lat,W||M.realProjection(),X||M.projection())};p.OLPointToPosition=function(V,W,X){return new M.Position(V.x,V.y,W||M.realProjection(),X||M.projection())};p.CUBProjToOLProj=function(V){return new B.Projection("EPSG:"+V)};p.OLProjToCUBProj=function(W){for(var V in M.projections){if(M.projections[V]==W.proj.srsProjNumber){return M.projections[V]}}return M.projections.UNKNOWN};p.viewportPixelToMapPixel=function(W,Z,Y){Y=typeof Y!="undefined"?Y:true;W=W-Math.round(parseFloat(D.div.style.left));Z=Z-Math.round(parseFloat(D.div.style.top));if(Y){var X=-M.rotate()*0.0174532925;var V={x:D.getSize().w/2,y:D.getSize().h/2};W=Math.cos(X)*(W-V.x)-Math.sin(X)*(Z-V.y)+V.x;Z=Math.sin(X)*(W-V.x)+Math.cos(X)*(Z-V.y)+V.y}return{x:W,y:Z}};p.mapPixelToViewportPixel=function(X,aa){X=X+Math.round(parseFloat(D.div.style.left));aa=aa+Math.round(parseFloat(D.div.style.top));var Z=M.rotate()*0.0174532925;var W={x:M.getWidth()/2,y:M.getHeight()/2};var Y=Math.cos(Z)*(X-W.x)-Math.sin(Z)*(aa-W.y)+W.x;var V=Math.sin(Z)*(X-W.x)+Math.cos(Z)*(aa-W.y)+W.y;return{x:Y,y:V}};p.viewportToRealExtent=function(Z){if(!Z){Z=M.maxExtent()}var ab=D.size.w/M.jQuery(w).width();var Y=D.size.h/M.jQuery(w).height();var X=Z.xmax-Z.xmin;var V=Z.ymax-Z.ymin;var aa=ab*X;var W=Y*V;return new M.Extent(Z.xmin+(X-aa)/2,Z.ymin+(V-W)/2,Z.xmax+(-X+aa)/2,Z.ymax+(-V+W)/2)};p.realExtentToViewport=function(Z){if(!Z){Z=G}var ab=D.size.w/M.jQuery(w).width();var Y=D.size.h/M.jQuery(w).height();var X=Z.xmax-Z.xmin;var V=Z.ymax-Z.ymin;var aa=X/ab;var W=V/Y;return new M.Extent(Z.xmin+(X-aa)/2,Z.ymin+(V-W)/2,Z.xmax+(-X+aa)/2,Z.ymax+(-V+W)/2)};p.addParametersToUrl=function(V,W){return V.replace(/(.*?)(?:\?(.*?)?&?)?$/,"$1?"+W.replace(/^&?(.*?)&?$/,"$1")+"&$2")};p.assert=function(Y,V,W){try{if(typeof(Y)==="undefined"){throw new Error()}if(!M.jQuery.isArray(Y)){Y=[Y]}for(i in Y){if(typeof(Y[i])=="undefined"||Y[i]==null){throw new Error()}if(V&&typeof(V)==="function"){if(!Y[i].namespace||Y[i].namespace!==V){throw new Error()}}else{if(M.jQuery.isArray(V)&&M.jQuery.inArray(Y[i].namespace,V)==-1){throw new Error()}else{if(typeof(V)==="string"&&(typeof(Y[i])!==V)){throw new Error()}}}}}catch(X){if(W){throw new Error("[API CUB] "+W)}else{return false}}return true};p.createUniqueVariable=function(V){if(typeof V=="undefined"){V=false}var W;var X=new Date();while(typeof(window[W="cb"+X.getTime()+Math.round(Math.random()*10000)])!="undefined"){}if(!V){window[W]=null}return W};p.formatURL=function(V){return V.replace(new RegExp("^(?:http://)?(?:www.)?(.*?)/?$","i"),"http://$1")};p.getExtension=function(W){var V=W.match(/\.([a-z]{2,4})(?:\?.*)?$/i);return V&&V[1]?V[1]:null};p.getBasename=function(W){var V=W.match(/(.*?)\.[a-z]{2,4}(?:\?.*)?$/i);return V&&V[1]?V[1]:null};p.getDomain=function(W){var V=W.match(/^https?:\/\/(?:www.)?([^\/]+)/i);return V&&V[1]?V[1]:null};p.getScriptLocation=(function(){var aa=new RegExp("(^|(.*?\\/))(cub.xjs)(\\?|$)"),Z=document.getElementsByTagName("script"),ab,W,X="";for(var Y=0,V=Z.length;Y<V;Y++){ab=Z[Y].getAttribute("src");if(ab){var W=ab.match(aa);if(W){X=W[1];break}}}if(/^\/\//.test(X)){X=window.location.protocol+X}return(function(){return X})})();p.createDelegate=function(W,V){return function(){return W.apply(V,arguments)}};p.reproject=function(X,V,Y){if(V==Y){return X}V=p.CUBProjToOLProj(V);Y=p.CUBProjToOLProj(Y);for(var W in X){X[W]=Proj4js.transform(V.proj,Y.proj,X[W])}return X};p.inheritsStatic=function(V,W){for(i in V){if(!W[i]&&V.hasOwnProperty(i)){W[i]=V[i]}}};p.createShared=function(){return{v:{},f:{},secret:k}};p.findByAttribute=function(X,V,W){for(i in X){if(typeof X[i][V]!="undefined"&&X[i][V]==W){return X[i]}}return null};p.precision=function(W,V){V=Math.pow(10,V);return Math.round(W*V)/V};p.removeElementFromArray=function(X,W){for(var V=0;V<X.length;++V){if(X[V]==W){X.splice(V,1);return V}}return -1};p.isScopeValid=function(V){if(V==M){p.errorLog("Veuillez utiliser l'opérateur \"new\" pour instancier une classe de l'API",p.errorLevel.WARNING);return false}return true};p.stringToBytes=function(X){var W=[];for(var V=0;V<X.length;V++){W.push(X.charCodeAt(V)&255)}return W};p.bytesToInt32BE=function(V,W){return(V[W]<<24)+(V[W+1]<<16)+(V[W+2]<<8)+V[W+3]};p.intToStringBE=function(W){var V="";V+=parseInt(W&255);V+=String.fromCharCode(W&65280);V+=String.fromCharCode(W&16711680);V+=String.fromCharCode(W&4278190080);return V};p.bytesToInt32LE=function(V,W){return(V[W+3]<<24)+(V[W+2]<<16)+(V[W+1]<<8)+V[W]};p.bytesToInt16LE=function(V,W){return(V[W+1]<<8)+V[W]};p.bytesToDouble=function(V,aa){var W=V[aa+7]&128?-1:1;var ab=((V[aa+7]&127)<<4)+((V[aa+6]&240)>>4);var Y=1;var ac=2;var X=8;for(var Z=6;Z>2;--Z){for(;X>=1;X>>=1){if(V[aa+Z]&X){Y+=1/ac}ac<<=1}X=128}return W*Math.pow(2,ab-1023)*Y};p.getRenderer=function(){var W=["SVG","VML","Canvas"];for(var V in W){if(B.Renderer[W[V]].prototype.supported()){return W[V]}}return null}})();var L={};(function(){var V=false;var X=false;var W=[];L.load=function(aa){if(!V){W.push(aa);if(!X){X=true;var Z=p.createUniqueVariable();window[Z]=Y;T.loadJavaScript("//maps.googleapis.com/maps/api/js?v=3.7&sensor=false&callback="+Z,null)}}else{aa.apply()}};function Y(){V=true;X=false;for(var Z in W){W[Z].apply()}}})();Proj4js={defaultDatum:"WGS84",transform:function(Y,W,V){if(!Y.readyToUse){this.reportError("Proj4js initialization for:"+Y.srsCode+" not yet complete");return V}if(!W.readyToUse){this.reportError("Proj4js initialization for:"+W.srsCode+" not yet complete");return V}if((Y.srsProjNumber=="900913"&&W.datumCode!="WGS84"&&!W.datum_params)||(W.srsProjNumber=="900913"&&Y.datumCode!="WGS84"&&!Y.datum_params)){var X=Proj4js.WGS84;this.transform(Y,X,V);Y=X}if(Y.axis!="enu"){this.adjust_axis(Y,false,V)}if(Y.projName=="longlat"){V.x*=Proj4js.common.D2R;V.y*=Proj4js.common.D2R}else{if(Y.to_meter){V.x*=Y.to_meter;V.y*=Y.to_meter}Y.inverse(V)}if(Y.from_greenwich){V.x+=Y.from_greenwich}V=this.datum_transform(Y.datum,W.datum,V);if(W.from_greenwich){V.x-=W.from_greenwich}if(W.projName=="longlat"){V.x*=Proj4js.common.R2D;V.y*=Proj4js.common.R2D}else{W.forward(V);if(W.to_meter){V.x/=W.to_meter;V.y/=W.to_meter}}if(W.axis!="enu"){this.adjust_axis(W,true,V)}return V},datum_transform:function(X,W,V){if(X.compare_datums(W)){return V}if(X.datum_type==Proj4js.common.PJD_NODATUM||W.datum_type==Proj4js.common.PJD_NODATUM){return V}if(X.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}if(W.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}if(X.es!=W.es||X.a!=W.a||X.datum_type==Proj4js.common.PJD_3PARAM||X.datum_type==Proj4js.common.PJD_7PARAM||W.datum_type==Proj4js.common.PJD_3PARAM||W.datum_type==Proj4js.common.PJD_7PARAM){X.geodetic_to_geocentric(V);if(X.datum_type==Proj4js.common.PJD_3PARAM||X.datum_type==Proj4js.common.PJD_7PARAM){X.geocentric_to_wgs84(V)}if(W.datum_type==Proj4js.common.PJD_3PARAM||W.datum_type==Proj4js.common.PJD_7PARAM){W.geocentric_from_wgs84(V)}W.geocentric_to_geodetic(V)}if(W.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")}return V},adjust_axis:function(Z,ab,Y){var X=Y.x,ad=Y.y,V=Y.z||0;var aa,ac;for(var W=0;W<3;W++){if(ab&&W==2&&Y.z===undefined){continue}if(W==0){aa=X;ac="x"}else{if(W==1){aa=ad;ac="y"}else{aa=V;ac="z"}}switch(Z.axis[W]){case"e":Y[ac]=aa;break;case"w":Y[ac]=-aa;break;case"n":Y[ac]=aa;break;case"s":Y[ac]=-aa;break;case"u":if(Y[ac]!==undefined){Y.z=aa}break;case"d":if(Y[ac]!==undefined){Y.z=-aa}break;default:alert("ERROR: unknow axis ("+Z.axis[W]+") - check definition of "+src.projName);return null}}return Y},reportError:function(V){},extend:function(V,Y){V=V||{};if(Y){for(var X in Y){var W=Y[X];if(W!==undefined){V[X]=W}}}return V},Class:function(){var W=function(){this.initialize.apply(this,arguments)};var V={};var Y;for(var X=0;X<arguments.length;++X){if(typeof arguments[X]=="function"){Y=arguments[X].prototype}else{Y=arguments[X]}Proj4js.extend(V,Y)}W.prototype=V;return W},bind:function(X,W){var V=Array.prototype.slice.apply(arguments,[2]);return function(){var Y=V.concat(Array.prototype.slice.apply(arguments,[0]));return X.apply(W,Y)}},scriptName:"proj4js.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath}var Z=this.scriptName;var Y=Z.length;var V=document.getElementsByTagName("script");for(var X=0;X<V.length;X++){var aa=V[X].getAttribute("src");if(aa){var W=aa.lastIndexOf(Z);if((W>-1)&&(W+Y==aa.length)){this.libPath=aa.slice(0,-Y);break}}}return this.libPath||""},loadScript:function(Y,Z,X,V){var W=document.createElement("script");W.defer=false;W.type="text/javascript";W.id=Y;W.src="proj4js/"+Y;W.onload=Z;W.onerror=X;W.loadCheck=V;if(/MSIE/.test(navigator.userAgent)){W.onreadystatechange=this.checkReadyState}document.getElementsByTagName("head")[0].appendChild(W)},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror()}else{this.onload()}}}};Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:false,queue:null,initialize:function(X,Y){this.srsCodeInput=X;this.queue=[];if(Y){this.queue.push(Y)}if((X.indexOf("GEOGCS")>=0)||(X.indexOf("GEOCCS")>=0)||(X.indexOf("PROJCS")>=0)||(X.indexOf("LOCAL_CS")>=0)){this.parseWKT(X);this.deriveConstants();this.loadProjCode(this.projName);return}if(X.indexOf("urn:")==0){var V=X.split(":");if((V[1]=="ogc"||V[1]=="x-ogc")&&(V[2]=="def")&&(V[3]=="crs")){X=V[4]+":"+V[V.length-1]}}else{if(X.indexOf("http://")==0){var W=X.split("#");if(W[0].match(/epsg.org/)){X="EPSG:"+W[1]}else{if(W[0].match(/RIG.xml/)){X="IGNF:"+W[1]}}}}this.srsCode=X.toUpperCase();if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5)}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5)}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4)}else{this.srsAuth="";this.srsProjNumber=this.srsCode}}}this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();return}var V=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(V,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var V=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(V,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true}else{return false}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84;this.defsLoaded()},loadProjCode:function(W){if(Proj4js.Proj[W]){this.initTransforms();return}var V=Proj4js.getScriptLocation()+"projCode/"+W+".js";Proj4js.loadScript(V,Proj4js.bind(this.loadProjCodeSuccess,this,W),Proj4js.bind(this.loadProjCodeFailure,this,W),Proj4js.bind(this.checkCodeLoaded,this,W))},loadProjCodeSuccess:function(V){if(Proj4js.Proj[V].dependsOn){this.loadProjCode(Proj4js.Proj[V].dependsOn)}else{this.initTransforms()}},loadProjCodeFailure:function(V){Proj4js.reportError("failed to find projection file for: "+V)},checkCodeLoaded:function(V){if(Proj4js.Proj[V]){return true}else{return false}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=true;if(this.queue){var V;while((V=this.queue.shift())){V.call(this,this)}}},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(ad){var ac=ad.match(this.wktRE);if(!ac){return}var af=ac[1];var ae=ac[2];var ab=ae.split(",");var ah;if(af.toUpperCase()=="TOWGS84"){ah=af}else{ah=ab.shift()}ah=ah.replace(/^\"/,"");ah=ah.replace(/\"$/,"");var ag=new Array();var W=0;var aa="";for(var Z=0;Z<ab.length;++Z){var X=ab[Z];for(var Y=0;Y<X.length;++Y){if(X.charAt(Y)=="["){++W}if(X.charAt(Y)=="]"){--W}}aa+=X;if(W===0){ag.push(aa);aa=""}else{aa+=","}}switch(af){case"LOCAL_CS":this.projName="identity";this.localCS=true;this.srsCode=ah;break;case"GEOGCS":this.projName="longlat";this.geocsCode=ah;if(!this.srsCode){this.srsCode=ah}break;case"PROJCS":this.srsCode=ah;break;case"GEOCCS":break;case"PROJECTION":this.projName=Proj4js.wktProjections[ah];break;case"DATUM":this.datumName=ah;break;case"LOCAL_DATUM":this.datumCode="none";break;case"SPHEROID":this.ellps=ah;this.a=parseFloat(ag.shift());this.rf=parseFloat(ag.shift());break;case"PRIMEM":this.from_greenwich=parseFloat(ag.shift());break;case"UNIT":this.units=ah;this.unitsPerMeter=parseFloat(ag.shift());break;case"PARAMETER":var V=ah.toLowerCase();var ai=parseFloat(ag.shift());switch(V){case"false_easting":this.x0=ai;break;case"false_northing":this.y0=ai;break;case"scale_factor":this.k0=ai;break;case"central_meridian":this.long0=ai*Proj4js.common.D2R;break;case"latitude_of_origin":this.lat0=ai*Proj4js.common.D2R;break;case"more_here":break;default:break}break;case"TOWGS84":this.datum_params=ag;break;case"AXIS":var V=ah.toLowerCase();var ai=ag.shift();switch(ai){case"EAST":ai="e";break;case"WEST":ai="w";break;case"NORTH":ai="n";break;case"SOUTH":ai="s";break;case"UP":ai="u";break;case"DOWN":ai="d";break;case"OTHER":default:ai=" ";break}if(!this.axis){this.axis="enu"}switch(V){case"X":this.axis=ai+this.axis.substr(1,2);break;case"Y":this.axis=this.axis.substr(0,1)+ai+this.axis.substr(2,1);break;case"Z":this.axis=this.axis.substr(0,2)+ai;break;default:break}case"MORE_HERE":break;default:break}for(var Z=0;Z<ag.length;++Z){this.parseWKT(ag[Z])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var Z,W;if(!this.defData){return}var V=this.defData.split("+");for(var aa=0;aa<V.length;aa++){var Y=V[aa].split("=");Z=Y[0].toLowerCase();W=Y[1];switch(Z.replace(/\s/gi,"")){case"":break;case"title":this.title=W;break;case"proj":this.projName=W.replace(/\s/gi,"");break;case"units":this.units=W.replace(/\s/gi,"");break;case"datum":this.datumCode=W.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=W.replace(/\s/gi,"");break;case"ellps":this.ellps=W.replace(/\s/gi,"");break;case"a":this.a=parseFloat(W);break;case"b":this.b=parseFloat(W);break;case"rf":this.rf=parseFloat(W);break;case"lat_0":this.lat0=W*Proj4js.common.D2R;break;case"lat_1":this.lat1=W*Proj4js.common.D2R;break;case"lat_2":this.lat2=W*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=W*Proj4js.common.D2R;break;case"lon_0":this.long0=W*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(W)*Proj4js.common.D2R;break;case"lonc":this.longc=W*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(W);break;case"y_0":this.y0=parseFloat(W);break;case"k_0":this.k0=parseFloat(W);break;case"k":this.k0=parseFloat(W);break;case"r_a":this.R_A=true;break;case"zone":this.zone=parseInt(W);break;case"south":this.utmSouth=true;break;case"towgs84":this.datum_params=W.split(",");break;case"to_meter":this.to_meter=parseFloat(W);break;case"from_greenwich":this.from_greenwich=W*Proj4js.common.D2R;break;case"pm":W=W.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[W]?Proj4js.PrimeMeridian[W]:parseFloat(W);this.from_greenwich*=Proj4js.common.D2R;break;case"axis":W=W.replace(/\s/gi,"");var X="ewnsud";if(W.length==3&&X.indexOf(W.substr(0,1))!=-1&&X.indexOf(W.substr(1,1))!=-1&&X.indexOf(W.substr(2,1))!=-1){this.axis=W}break;case"no_defs":break;default:}}this.deriveConstants()},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none"}if(this.datumCode&&this.datumCode!="none"){var V=Proj4js.Datum[this.datumCode];if(V){this.datum_params=V.towgs84?V.towgs84.split(","):null;this.ellps=V.ellipse;this.datumName=V.datumName?V.datumName:this.datumCode}}if(!this.a){var W=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,W)}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;this.b=this.a}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0}this.ep2=(this.a2-this.b2)/this.b2;if(!this.k0){this.k0=1}if(!this.axis){this.axis="enu"}this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(V){return V},inverse:function(V){return V}};Proj4js.Proj.identity=Proj4js.Proj.longlat;Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"];Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(X,W,Y){var V=X*W;return Y/(Math.sqrt(1-V*V))},tsfnz:function(Z,Y,X){var V=Z*X;var W=0.5*Z;V=Math.pow(((1-V)/(1+V)),W);return(Math.tan(0.5*(this.HALF_PI-Y))/V)},phi2z:function(ab,aa){var Z=0.5*ab;var V,W;var Y=this.HALF_PI-2*Math.atan(aa);for(var X=0;X<=15;X++){V=ab*Math.sin(Y);W=this.HALF_PI-2*Math.atan(aa*(Math.pow(((1-V)/(1+V)),Z)))-Y;Y+=W;if(Math.abs(W)<=1e-10){return Y}}alert("phi2z has NoConvergence");return(-9999)},qsfnz:function(X,W){var V;if(X>1e-7){V=X*W;return((1-X*X)*(W/(1-V*V)-(0.5/X)*Math.log((1-V)/(1+V))))}else{return(2*W)}},asinz:function(V){if(Math.abs(V)>1){V=(V>1)?1:-1}return Math.asin(V)},e0fn:function(V){return(1-0.25*V*(1+V/16*(3+1.25*V)))},e1fn:function(V){return(0.375*V*(1+0.25*V*(1+0.46875*V)))},e2fn:function(V){return(0.05859375*V*V*(1+0.75*V))},e3fn:function(V){return(V*V*V*(35/3072))},mlfn:function(Z,Y,X,W,V){return(Z*V-Y*Math.sin(2*V)+X*Math.sin(4*V)-W*Math.sin(6*V))},srat:function(V,W){return(Math.pow((1-V)/(1+V),W))},sign:function(V){if(V<0){return(-1)}else{return(1)}},adjust_lon:function(V){V=(Math.abs(V)<this.PI)?V:(V-(this.sign(V)*this.TWO_PI));return V},adjust_lat:function(V){V=(Math.abs(V)<this.HALF_PI)?V:(V-(this.sign(V)*this.PI));return V},latiso:function(Y,X,W){if(Math.abs(X)>this.HALF_PI){return +Number.NaN}if(X==this.HALF_PI){return Number.POSITIVE_INFINITY}if(X==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY}var V=Y*W;return Math.log(Math.tan((this.HALF_PI+X)/2))+Y*Math.log((1-V)/(1+V))/2},fL:function(W,V){return 2*Math.atan(W*Math.exp(V))-this.HALF_PI},invlatiso:function(Z,X){var W=this.fL(1,X);var Y=0;var V=0;do{Y=W;V=Z*Math.sin(Y);W=this.fL(Math.exp(Z*Math.log((1+V)/(1-V))/2),X)}while(Math.abs(W-Y)>1e-12);return W},sinh:function(V){var W=Math.exp(V);W=(W-1/W)/2;return W},cosh:function(V){var W=Math.exp(V);W=(W+1/W)/2;return W},tanh:function(V){var W=Math.exp(V);W=(W-1/W)/(W+1/W);return W},asinh:function(V){var W=(V>=0?1:-1);return W*(Math.log(Math.abs(V)+Math.sqrt(V*V+1)))},acosh:function(V){return 2*Math.log(Math.sqrt((V+1)/2)+Math.sqrt((V-1)/2))},atanh:function(V){return Math.log((V-1)/(V+1))/2},gN:function(V,Y,X){var W=Y*X;return V/Math.sqrt(1-W*W)}};Proj4js.datum=Proj4js.Class({initialize:function(W){this.datum_type=Proj4js.common.PJD_WGS84;if(W.datumCode&&W.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM}if(W&&W.datum_params){for(var V=0;V<W.datum_params.length;V++){W.datum_params[V]=parseFloat(W.datum_params[V])}if(W.datum_params[0]!=0||W.datum_params[1]!=0||W.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM}if(W.datum_params.length>3){if(W.datum_params[3]!=0||W.datum_params[4]!=0||W.datum_params[5]!=0||W.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;W.datum_params[3]*=Proj4js.common.SEC_TO_RAD;W.datum_params[4]*=Proj4js.common.SEC_TO_RAD;W.datum_params[5]*=Proj4js.common.SEC_TO_RAD;W.datum_params[6]=(W.datum_params[6]/1000000)+1}}}if(W){this.a=W.a;this.b=W.b;this.es=W.es;this.ep2=W.ep2;this.datum_params=W.datum_params}},compare_datums:function(V){if(this.datum_type!=V.datum_type){return false}else{if(this.a!=V.a||Math.abs(this.es-V.es)>5e-11){return false}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==V.datum_params[0]&&this.datum_params[1]==V.datum_params[1]&&this.datum_params[2]==V.datum_params[2])}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==V.datum_params[0]&&this.datum_params[1]==V.datum_params[1]&&this.datum_params[2]==V.datum_params[2]&&this.datum_params[3]==V.datum_params[3]&&this.datum_params[4]==V.datum_params[4]&&this.datum_params[5]==V.datum_params[5]&&this.datum_params[6]==V.datum_params[6])}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(V.params,"snadgrids").s)==0}else{return true}}}}}},geodetic_to_geocentric:function(aa){var aj=aa.x;var af=aa.y;var ab=aa.z?aa.z:0;var ac;var W;var V;var ah=0;var ai;var ag;var ae;var ad;if(af<-Proj4js.common.HALF_PI&&af>-1.001*Proj4js.common.HALF_PI){af=-Proj4js.common.HALF_PI}else{if(af>Proj4js.common.HALF_PI&&af<1.001*Proj4js.common.HALF_PI){af=Proj4js.common.HALF_PI}else{if((af<-Proj4js.common.HALF_PI)||(af>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+af);return null}}}if(aj>Proj4js.common.PI){aj-=(2*Proj4js.common.PI)}ag=Math.sin(af);ad=Math.cos(af);ae=ag*ag;ai=this.a/(Math.sqrt(1-this.es*ae));ac=(ai+ab)*ad*Math.cos(aj);W=(ai+ab)*ad*Math.sin(aj);V=((ai*(1-this.es))+ab)*ag;aa.x=ac;aa.y=W;aa.z=V;return ah},geocentric_to_geodetic:function(aq){var aw=1e-12;var ar=(aw*aw);var ad=30;var aj;var af;var V;var al;var W;var ak;var ai;var av;var au;var ah;var ao;var an;var ac;var at;var ae=aq.x;var ab=aq.y;var aa=aq.z?aq.z:0;var ag;var ap;var am;ac=false;aj=Math.sqrt(ae*ae+ab*ab);af=Math.sqrt(ae*ae+ab*ab+aa*aa);if(aj/this.a<aw){ac=true;ag=0;if(af/this.a<aw){ap=Proj4js.common.HALF_PI;am=-this.b;return}}else{ag=Math.atan2(ab,ae)}V=aa/af;al=aj/af;W=1/Math.sqrt(1-this.es*(2-this.es)*al*al);av=al*(1-this.es)*W;au=V*W;at=0;do{at++;ai=this.a/Math.sqrt(1-this.es*au*au);am=aj*av+aa*au-ai*(1-this.es*au*au);ak=this.es*ai/(ai+am);W=1/Math.sqrt(1-ak*(2-ak)*al*al);ah=al*(1-ak)*W;ao=V*W;an=ao*av-ah*au;av=ah;au=ao}while(an*an>ar&&at<ad);ap=Math.atan(ao/Math.abs(ah));aq.x=ag;aq.y=ap;aq.z=am;return aq},geocentric_to_geodetic_noniter:function(aq){var ac=aq.x;var ab=aq.y;var V=aq.z?aq.z:0;var af;var ap;var ak;var ad;var am;var ao;var al;var ai;var ag;var ah;var au;var ae;var at;var ar;var an;var aj;var aa;ac=parseFloat(ac);ab=parseFloat(ab);V=parseFloat(V);aa=false;if(ac!=0){af=Math.atan2(ab,ac)}else{if(ab>0){af=Proj4js.common.HALF_PI}else{if(ab<0){af=-Proj4js.common.HALF_PI}else{aa=true;af=0;if(V>0){ap=Proj4js.common.HALF_PI}else{if(V<0){ap=-Proj4js.common.HALF_PI}else{ap=Proj4js.common.HALF_PI;ak=-this.b;return}}}}}am=ac*ac+ab*ab;ad=Math.sqrt(am);ao=V*Proj4js.common.AD_C;ai=Math.sqrt(ao*ao+am);ah=ao/ai;ae=ad/ai;au=ah*ah*ah;al=V+this.b*this.ep2*au;aj=ad-this.a*this.es*ae*ae*ae;ag=Math.sqrt(al*al+aj*aj);at=al/ag;ar=aj/ag;an=this.a/Math.sqrt(1-this.es*at*at);if(ar>=Proj4js.common.COS_67P5){ak=ad/ar-an}else{if(ar<=-Proj4js.common.COS_67P5){ak=ad/-ar-an}else{ak=V/at+an*(this.es-1)}}if(aa==false){ap=Math.atan(at/ar)}aq.x=af;aq.y=ap;aq.z=ak;return aq},geocentric_to_wgs84:function(W){if(this.datum_type==Proj4js.common.PJD_3PARAM){W.x+=this.datum_params[0];W.y+=this.datum_params[1];W.z+=this.datum_params[2]}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var aa=this.datum_params[0];var Y=this.datum_params[1];var ad=this.datum_params[2];var Z=this.datum_params[3];var ae=this.datum_params[4];var ac=this.datum_params[5];var ab=this.datum_params[6];var X=ab*(W.x-ac*W.y+ae*W.z)+aa;var V=ab*(ac*W.x+W.y-Z*W.z)+Y;var af=ab*(-ae*W.x+Z*W.y+W.z)+ad;W.x=X;W.y=V;W.z=af}}},geocentric_from_wgs84:function(X){if(this.datum_type==Proj4js.common.PJD_3PARAM){X.x-=this.datum_params[0];X.y-=this.datum_params[1];X.z-=this.datum_params[2]}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var ab=this.datum_params[0];var Y=this.datum_params[1];var ae=this.datum_params[2];var aa=this.datum_params[3];var af=this.datum_params[4];var ad=this.datum_params[5];var ac=this.datum_params[6];var Z=(X.x-ab)/ac;var W=(X.y-Y)/ac;var V=(X.z-ae)/ac;X.x=Z+ad*W-af*V;X.y=-ad*Z+W+aa*V;X.z=af*Z-aa*W+V}}}});Proj4js.Point=Proj4js.Class({initialize:function(V,Y,X){if(typeof V=="object"){this.x=V[0];this.y=V[1];this.z=V[2]||0}else{if(typeof V=="string"&&typeof Y=="undefined"){var W=V.split(",");this.x=parseFloat(W[0]);this.y=parseFloat(W[1]);this.z=parseFloat(W[2])||0}else{this.x=V;this.y=Y;this.z=X||0}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return("x="+this.x+",y="+this.y)},toShortString:function(){return(this.x+", "+this.y)}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"};Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0}if(!this.k0){this.k0=1}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return}var ae=this.b/this.a;this.e=Math.sqrt(1-ae*ae);var ab=Math.sin(this.lat1);var Z=Math.cos(this.lat1);var ad=Proj4js.common.msfnz(this.e,ab,Z);var W=Proj4js.common.tsfnz(this.e,this.lat1,ab);var aa=Math.sin(this.lat2);var Y=Math.cos(this.lat2);var ac=Proj4js.common.msfnz(this.e,aa,Y);var V=Proj4js.common.tsfnz(this.e,this.lat2,aa);var X=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(ad/ac)/Math.log(W/V)}else{this.ns=ab}this.f0=ad/(this.ns*Math.pow(W,this.ns));this.rh=this.a*this.f0*Math.pow(X,this.ns);if(!this.title){this.title="Lambert Conformal Conic"}},forward:function(Z){var aa=Z.x;var Y=Z.y;if(Y<=90&&Y>=-90&&aa<=180&&aa>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+aa+" : "+Y);return null}var V=Math.abs(Math.abs(Y)-Proj4js.common.HALF_PI);var X,ab;if(V>Proj4js.common.EPSLN){X=Proj4js.common.tsfnz(this.e,Y,Math.sin(Y));ab=this.a*this.f0*Math.pow(X,this.ns)}else{V=Y*this.ns;if(V<=0){Proj4js.reportError("lcc:forward: No Projection");return null}ab=0}var W=this.ns*Proj4js.common.adjust_lon(aa-this.long0);Z.x=this.k0*(ab*Math.sin(W))+this.x0;Z.y=this.k0*(this.rh-ab*Math.cos(W))+this.y0;return Z},inverse:function(Z){var ab,V,X;var Y,aa;x=(Z.x-this.x0)/this.k0;y=(this.rh-(Z.y-this.y0)/this.k0);if(this.ns>0){ab=Math.sqrt(x*x+y*y);V=1}else{ab=-Math.sqrt(x*x+y*y);V=-1}var W=0;if(ab!=0){W=Math.atan2((V*x),(V*y))}if((ab!=0)||(this.ns>0)){V=1/this.ns;X=Math.pow((ab/(this.a*this.f0)),V);Y=Proj4js.common.phi2z(this.e,X);if(Y==-9999){return null}}else{Y=-Proj4js.common.HALF_PI}aa=Proj4js.common.adjust_lon(W/this.ns+this.long0);Z.x=aa;Z.y=Y;return Z}};Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts)}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts))}}},forward:function(Z){var aa=Z.x;var Y=Z.y;if(Y*Proj4js.common.R2D>90&&Y*Proj4js.common.R2D<-90&&aa*Proj4js.common.R2D>180&&aa*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+aa+" : "+Y);return null}var V,ab;if(Math.abs(Math.abs(Y)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");return null}else{if(this.sphere){V=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(aa-this.long0);ab=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*Y))}else{var X=Math.sin(Y);var W=Proj4js.common.tsfnz(this.e,Y,X);V=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(aa-this.long0);ab=this.y0-this.a*this.k0*Math.log(W)}Z.x=V;Z.y=ab;return Z}},inverse:function(Y){var V=Y.x-this.x0;var aa=Y.y-this.y0;var Z,X;if(this.sphere){X=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-aa/this.a*this.k0))}else{var W=Math.exp(-aa/(this.a*this.k0));X=Proj4js.common.phi2z(this.e,W);if(X==-9999){Proj4js.reportError("merc:inverse: lat = -9999");return null}}Z=Proj4js.common.adjust_lon(this.long0+V/(this.a*this.k0));Y.x=Z;Y.y=X;return Y}};Proj4js.defs["EPSG:3942"]="+title=RGF93 / CC42 +proj=lcc +lat_1=41.25 +lat_2=42.75 +lat_0=42 +lon_0=3 +x_0=1700000 +y_0=1200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3943"]="+title=RGF93 / CC43 +proj=lcc +lat_1=42.25 +lat_2=43.75 +lat_0=43 +lon_0=3 +x_0=1700000 +y_0=2200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3944"]="+title=RGF93 / CC44 +proj=lcc +lat_1=43.25 +lat_2=44.75 +lat_0=44 +lon_0=3 +x_0=1700000 +y_0=3200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3945"]="+title=RGF93 / CC45 +proj=lcc +lat_1=44.25 +lat_2=45.75 +lat_0=45 +lon_0=3 +x_0=1700000 +y_0=4200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3946"]="+title=RGF93 / CC46 +proj=lcc +lat_1=45.25 +lat_2=46.75 +lat_0=46 +lon_0=3 +x_0=1700000 +y_0=5200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3947"]="+title=RGF93 / CC47 +proj=lcc +lat_1=46.25 +lat_2=47.75 +lat_0=47 +lon_0=3 +x_0=1700000 +y_0=6200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3948"]="+title=RGF93 / CC48 +proj=lcc +lat_1=47.25 +lat_2=48.75 +lat_0=48 +lon_0=3 +x_0=1700000 +y_0=7200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3949"]="+title=RGF93 / CC49 +proj=lcc +lat_1=48.25 +lat_2=49.75 +lat_0=49 +lon_0=3 +x_0=1700000 +y_0=8200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:3950"]="+title=RGF93 / CC50 +proj=lcc +lat_1=49.25 +lat_2=50.75 +lat_0=50 +lon_0=3 +x_0=1700000 +y_0=9200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs  ";Proj4js.defs["EPSG:4171"]="title=RGF93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs  ";Proj4js.defs["EPSG:2154"]="+title=Lambert93 +proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs ";Proj4js.defs["EPSG:4171"]="+title=RGF93 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs  <>";Proj4js.defs["EPSG:27572"]="+proj=lcc +lat_1=46.8 +lat_0=46.8 +lon_0=0 +k_0=0.99987742 +x_0=600000 +y_0=2200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs";Proj4js.defs["EPSG:27563"]="+proj=lcc +lat_1=44.10000000000001 +lat_0=44.10000000000001 +lon_0=0 +k_0=0.999877499 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs";new Proj4js.Proj("EPSG:3942");new Proj4js.Proj("EPSG:3943");new Proj4js.Proj("EPSG:3944");new Proj4js.Proj("EPSG:3945");new Proj4js.Proj("EPSG:3946");new Proj4js.Proj("EPSG:3947");new Proj4js.Proj("EPSG:3948");new Proj4js.Proj("EPSG:3949");new Proj4js.Proj("EPSG:3950");new Proj4js.Proj("EPSG:4171");new Proj4js.Proj("EPSG:900913");new Proj4js.Proj("EPSG:27572");new Proj4js.Proj("EPSG:27563");B.Class=function(){var V=arguments.length;var Y=arguments[0];var X=arguments[V-1];var Z=typeof X.initialize=="function"?X.initialize:function(){Y.prototype.initialize.apply(this,arguments)};if(V>1){var W=[Z,Y].concat(Array.prototype.slice.call(arguments).slice(1,V-1),X);B.inherit.apply(null,W)}else{Z.prototype=X}return Z};B.inherit=function(aa,Y){var X=function(){};X.prototype=Y.prototype;aa.prototype=new X;var W,V,Z;for(W=2,V=arguments.length;W<V;W++){Z=arguments[W];if(typeof Z==="function"){Z=Z.prototype}B.Util.extend(aa.prototype,Z)}};B.Util=B.Util||{};B.Util.extend=function(V,Z){V=V||{};if(Z){for(var Y in Z){var X=Z[Y];if(X!==undefined){V[Y]=X}}var W=typeof window.Event=="function"&&Z instanceof window.Event;if(!W&&Z.hasOwnProperty&&Z.hasOwnProperty("toString")){V.toString=Z.toString}}return V};B.Util=B.Util||{};B.Util.getElement=function(){var Y=[];for(var X=0,V=arguments.length;X<V;X++){var W=arguments[X];if(typeof W=="string"){W=document.getElementById(W)}if(arguments.length==1){return W}Y.push(W)}return Y};B.Util.isElement=function(V){return !!(V&&V.nodeType===1)};B.Util.isArray=function(V){return(Object.prototype.toString.call(V)==="[object Array]")};if(typeof window.$==="undefined"){window.$=B.Util.getElement}B.Util.removeItem=function(X,W){for(var V=X.length-1;V>=0;V--){if(X[V]==W){X.splice(V,1)}}return X};B.Util.indexOf=function(Y,X){if(typeof Y.indexOf=="function"){return Y.indexOf(X)}else{for(var W=0,V=Y.length;W<V;W++){if(Y[W]==X){return W}}return -1}};B.Util.modifyDOMElement=function(Z,ac,Y,aa,V,X,ab,W){if(ac){Z.id=ac}if(Y){Z.style.left=Y.x+"px";Z.style.top=Y.y+"px"}if(aa){Z.style.width=aa.w+"px";Z.style.height=aa.h+"px"}if(V){Z.style.position=V}if(X){Z.style.border=X}if(ab){Z.style.overflow=ab}if(parseFloat(W)>=0&&parseFloat(W)<1){Z.style.filter="alpha(opacity="+(W*100)+")";Z.style.opacity=W}else{if(parseFloat(W)==1){Z.style.filter="";Z.style.opacity=""}}};B.Util.createDiv=function(V,ad,ac,aa,Z,X,W,ab){var Y=document.createElement("div");if(aa){Y.style.backgroundImage="url("+aa+")"}if(!V){V=B.Util.createUniqueID("OpenLayersDiv")}if(!Z){Z="absolute"}B.Util.modifyDOMElement(Y,V,ad,ac,Z,X,W,ab);return Y};B.Util.createImage=function(V,ad,ac,Z,Y,X,aa,ae){var W=document.createElement("img");if(!V){V=B.Util.createUniqueID("OpenLayersDiv")}if(!Y){Y="relative"}B.Util.modifyDOMElement(W,V,ad,ac,Y,X,null,aa);if(ae){W.style.display="none";function ab(){W.style.display="";B.Event.stopObservingElement(W)}B.Event.observe(W,"load",ab);B.Event.observe(W,"error",ab)}W.style.alt=V;W.galleryImg="no";if(Z){W.src=Z}return W};B.IMAGE_RELOAD_ATTEMPTS=0;B.Util.alphaHackNeeded=null;B.Util.alphaHack=function(){if(B.Util.alphaHackNeeded==null){var Y=navigator.appVersion.split("MSIE");var V=parseFloat(Y[1]);var W=false;try{W=!!(document.body.filters)}catch(X){}B.Util.alphaHackNeeded=(W&&(V>=5.5)&&(V<7))}return B.Util.alphaHackNeeded};B.Util.modifyAlphaImageDiv=function(V,W,ae,ad,ab,aa,X,Y,ac){B.Util.modifyDOMElement(V,W,ae,ad,aa,null,null,ac);var Z=V.childNodes[0];if(ab){Z.src=ab}B.Util.modifyDOMElement(Z,V.id+"_innerImage",null,ad,"relative",X);if(B.Util.alphaHack()){if(V.style.display!="none"){V.style.display="inline-block"}if(Y==null){Y="scale"}V.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+Z.src+"', sizingMethod='"+Y+"')";if(parseFloat(V.style.opacity)>=0&&parseFloat(V.style.opacity)<1){V.style.filter+=" alpha(opacity="+V.style.opacity*100+")"}Z.style.filter="alpha(opacity=0)"}};B.Util.createAlphaImageDiv=function(W,ae,ad,ab,aa,X,Y,ac,af){var V=B.Util.createDiv();var Z=B.Util.createImage(null,null,null,null,null,null,null,af);Z.className="olAlphaImg";V.appendChild(Z);B.Util.modifyAlphaImageDiv(V,W,ae,ad,ab,aa,X,Y,ac);return V};B.Util.upperCaseObject=function(W){var V={};for(var X in W){V[X.toUpperCase()]=W[X]}return V};B.Util.applyDefaults=function(Y,X){Y=Y||{};var W=typeof window.Event=="function"&&X instanceof window.Event;for(var V in X){if(Y[V]===undefined||(!W&&X.hasOwnProperty&&X.hasOwnProperty(V)&&!Y.hasOwnProperty(V))){Y[V]=X[V]}}if(!W&&X&&X.hasOwnProperty&&X.hasOwnProperty("toString")&&!Y.hasOwnProperty("toString")){Y.toString=X.toString}return Y};B.Util.getParameterString=function(X){var W=[];for(var ac in X){var ab=X[ac];if((ab!=null)&&(typeof ab!="function")){var Y;if(typeof ab=="object"&&ab.constructor==Array){var Z=[];var ad;for(var V=0,aa=ab.length;V<aa;V++){ad=ab[V];Z.push(encodeURIComponent((ad===null||ad===undefined)?"":ad))}Y=Z.join(",")}else{Y=encodeURIComponent(ab)}W.push(encodeURIComponent(ac)+"="+Y)}}return W.join("&")};B.Util.urlAppend=function(V,W){var Y=V;if(W){var X=(V+" ").split(/[?&]/);Y+=(X.pop()===" "?W:X.length?"&"+W:"?"+W)}return Y};B.Util.getImagesLocation=function(){return B.ImgPath||(B._getScriptLocation()+"img/")};B.Util.getImageLocation=function(V){return B.Util.getImagesLocation()+V};B.Util.Try=function(){var Y=null;for(var X=0,V=arguments.length;X<V;X++){var W=arguments[X];try{Y=W();break}catch(Z){}}return Y};B.Util.getXmlNodeValue=function(V){var W=null;B.Util.Try(function(){W=V.text;if(!W){W=V.textContent}if(!W){W=V.firstChild.nodeValue}},function(){W=V.textContent});return W};B.Util.mouseLeft=function(V,X){var W=(V.relatedTarget)?V.relatedTarget:V.toElement;while(W!=X&&W!=null){W=W.parentNode}return(W!=X)};B.Util.DEFAULT_PRECISION=14;B.Util.toFloat=function(W,V){if(V==null){V=B.Util.DEFAULT_PRECISION}if(typeof W!=="number"){W=parseFloat(W)}return V===0?W:parseFloat(W.toPrecision(V))};B.Util.rad=function(V){return V*Math.PI/180};B.Util.deg=function(V){return V*180/Math.PI};B.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};B.Util.distVincenty=function(X,W){var ab=B.Util.VincentyConstants;var az=ab.a,ay=ab.b,au=ab.f;var ae=B.Util.rad(W.lon-X.lon);var ax=Math.atan((1-au)*Math.tan(B.Util.rad(X.lat)));var aw=Math.atan((1-au)*Math.tan(B.Util.rad(W.lat)));var ad=Math.sin(ax),Z=Math.cos(ax);var ac=Math.sin(aw),Y=Math.cos(aw);var ai=ae,af=2*Math.PI;var ah=20;while(Math.abs(ai-af)>1e-12&&--ah>0){var ap=Math.sin(ai),V=Math.cos(ai);var aA=Math.sqrt((Y*ap)*(Y*ap)+(Z*ac-ad*Y*V)*(Z*ac-ad*Y*V));if(aA==0){return 0}var ar=ad*ac+Z*Y*V;var ao=Math.atan2(aA,ar);var aa=Math.asin(Z*Y*ap/aA);var at=Math.cos(aa)*Math.cos(aa);var ag=ar-2*ad*ac/at;var al=au/16*at*(4+au*(4-3*at));af=ai;ai=ae+(1-al)*au*Math.sin(aa)*(ao+al*aA*(ag+al*ar*(-1+2*ag*ag)))}if(ah==0){return NaN}var ak=at*(az*az-ay*ay)/(ay*ay);var an=1+ak/16384*(4096+ak*(-768+ak*(320-175*ak)));var am=ak/1024*(256+ak*(-128+ak*(74-47*ak)));var aq=am*aA*(ag+am/4*(ar*(-1+2*ag*ag)-am/6*ag*(-3+4*aA*aA)*(-3+4*ag*ag)));var aj=ay*an*(ao-aq);var av=aj.toFixed(3)/1000;return av};B.Util.destinationVincenty=function(ad,aC,ar){var ag=B.Util;var aa=ag.VincentyConstants;var aD=aa.a,aB=aa.b,ax=aa.f;var aA=ad.lon;var Y=ad.lat;var ai=ar;var aq=ag.rad(aC);var au=Math.sin(aq);var Z=Math.cos(aq);var at=(1-ax)*Math.tan(ag.rad(Y));var V=1/Math.sqrt((1+at*at)),ab=at*V;var ah=Math.atan2(at,Z);var ao=V*au;var aw=1-ao*ao;var ak=aw*(aD*aD-aB*aB)/(aB*aB);var an=1+ak/16384*(4096+ak*(-768+ak*(320-175*ak)));var al=ak/1024*(256+ak*(-128+ak*(74-47*ak)));var am=ai/(aB*an),ay=2*Math.PI;while(Math.abs(am-ay)>1e-12){var ae=Math.cos(2*ah+am);var aE=Math.sin(am);var av=Math.cos(am);var ap=al*aE*(ae+al/4*(av*(-1+2*ae*ae)-al/6*ae*(-3+4*aE*aE)*(-3+4*ae*ae)));ay=am;am=ai/(aB*an)+ap}var az=ab*aE-V*av*Z;var W=Math.atan2(ab*av+V*aE*Z,(1-ax)*Math.sqrt(ao*ao+az*az));var af=Math.atan2(aE*au,V*av-ab*aE*Z);var aj=ax/16*aw*(4+ax*(4-3*aw));var ac=af-(1-aj)*ax*ao*(am+aj*aE*(ae+aj*av*(-1+2*ae*ae)));var X=Math.atan2(ao,-az);return new B.LonLat(aA+ag.deg(ac),ag.deg(W))};B.Util.getParameters=function(W){W=(W===null||W===undefined)?window.location.href:W;var V="";if(B.String.contains(W,"?")){var X=W.indexOf("?")+1;var aa=B.String.contains(W,"#")?W.indexOf("#"):W.length;V=W.substring(X,aa)}var ag={};var Y=V.split(/[&;]/);for(var ac=0,ad=Y.length;ac<ad;++ac){var ab=Y[ac].split("=");if(ab[0]){var af=ab[0];try{af=decodeURIComponent(af)}catch(Z){af=unescape(af)}var ae=(ab[1]||"").replace(/\+/g," ");try{ae=decodeURIComponent(ae)}catch(Z){ae=unescape(ae)}ae=ae.split(",");if(ae.length==1){ae=ae[0]}ag[af]=ae}}return ag};B.Util.lastSeqID=0;B.Util.createUniqueID=function(V){if(V==null){V="id_"}B.Util.lastSeqID+=1;return V+B.Util.lastSeqID};B.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};B.INCHES_PER_UNIT["in"]=B.INCHES_PER_UNIT.inches;B.INCHES_PER_UNIT.degrees=B.INCHES_PER_UNIT.dd;B.INCHES_PER_UNIT.nmi=1852*B.INCHES_PER_UNIT.m;B.METERS_PER_INCH=0.0254000508001016;B.Util.extend(B.INCHES_PER_UNIT,{Inch:B.INCHES_PER_UNIT.inches,Meter:1/B.METERS_PER_INCH,Foot:0.3048006096012192/B.METERS_PER_INCH,IFoot:0.3048/B.METERS_PER_INCH,ClarkeFoot:0.3047972651151/B.METERS_PER_INCH,SearsFoot:0.30479947153867626/B.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/B.METERS_PER_INCH,IInch:0.0254/B.METERS_PER_INCH,MicroInch:0.0000254/B.METERS_PER_INCH,Mil:2.54e-8/B.METERS_PER_INCH,Centimeter:0.01/B.METERS_PER_INCH,Kilometer:1000/B.METERS_PER_INCH,Yard:0.9144018288036576/B.METERS_PER_INCH,SearsYard:0.914398414616029/B.METERS_PER_INCH,IndianYard:0.9143985307444408/B.METERS_PER_INCH,IndianYd37:0.91439523/B.METERS_PER_INCH,IndianYd62:0.9143988/B.METERS_PER_INCH,IndianYd75:0.9143985/B.METERS_PER_INCH,IndianFoot:0.30479951/B.METERS_PER_INCH,IndianFt37:0.30479841/B.METERS_PER_INCH,IndianFt62:0.3047996/B.METERS_PER_INCH,IndianFt75:0.3047995/B.METERS_PER_INCH,Mile:1609.3472186944373/B.METERS_PER_INCH,IYard:0.9144/B.METERS_PER_INCH,IMile:1609.344/B.METERS_PER_INCH,NautM:1852/B.METERS_PER_INCH,"Lat-66":110943.31648893273/B.METERS_PER_INCH,"Lat-83":110946.25736872235/B.METERS_PER_INCH,Decimeter:0.1/B.METERS_PER_INCH,Millimeter:0.001/B.METERS_PER_INCH,Dekameter:10/B.METERS_PER_INCH,Decameter:10/B.METERS_PER_INCH,Hectometer:100/B.METERS_PER_INCH,GermanMeter:1.0000135965/B.METERS_PER_INCH,CaGrid:0.999738/B.METERS_PER_INCH,ClarkeChain:20.1166194976/B.METERS_PER_INCH,GunterChain:20.11684023368047/B.METERS_PER_INCH,BenoitChain:20.116782494375872/B.METERS_PER_INCH,SearsChain:20.11676512155/B.METERS_PER_INCH,ClarkeLink:0.201166194976/B.METERS_PER_INCH,GunterLink:0.2011684023368047/B.METERS_PER_INCH,BenoitLink:0.20116782494375873/B.METERS_PER_INCH,SearsLink:0.2011676512155/B.METERS_PER_INCH,Rod:5.02921005842012/B.METERS_PER_INCH,IntnlChain:20.1168/B.METERS_PER_INCH,IntnlLink:0.201168/B.METERS_PER_INCH,Perch:5.02921005842012/B.METERS_PER_INCH,Pole:5.02921005842012/B.METERS_PER_INCH,Furlong:201.1684023368046/B.METERS_PER_INCH,Rood:3.778266898/B.METERS_PER_INCH,CapeFoot:0.3047972615/B.METERS_PER_INCH,Brealey:375/B.METERS_PER_INCH,ModAmFt:0.304812252984506/B.METERS_PER_INCH,Fathom:1.8288/B.METERS_PER_INCH,"NautM-UK":1853.184/B.METERS_PER_INCH,"50kilometers":50000/B.METERS_PER_INCH,"150kilometers":150000/B.METERS_PER_INCH});B.Util.extend(B.INCHES_PER_UNIT,{mm:B.INCHES_PER_UNIT.Meter/1000,cm:B.INCHES_PER_UNIT.Meter/100,dm:B.INCHES_PER_UNIT.Meter*100,km:B.INCHES_PER_UNIT.Meter*1000,kmi:B.INCHES_PER_UNIT.nmi,fath:B.INCHES_PER_UNIT.Fathom,ch:B.INCHES_PER_UNIT.IntnlChain,link:B.INCHES_PER_UNIT.IntnlLink,"us-in":B.INCHES_PER_UNIT.inches,"us-ft":B.INCHES_PER_UNIT.Foot,"us-yd":B.INCHES_PER_UNIT.Yard,"us-ch":B.INCHES_PER_UNIT.GunterChain,"us-mi":B.INCHES_PER_UNIT.Mile,"ind-yd":B.INCHES_PER_UNIT.IndianYd37,"ind-ft":B.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/B.METERS_PER_INCH});B.DOTS_PER_INCH=72;B.Util.normalizeScale=function(W){var V=(W>1)?(1/W):W;return V};B.Util.getResolutionFromScale=function(Y,V){var W;if(Y){if(V==null){V="degrees"}var X=B.Util.normalizeScale(Y);W=1/(X*B.INCHES_PER_UNIT[V]*B.DOTS_PER_INCH)}return W};B.Util.getScaleFromResolution=function(W,V){if(V==null){V="degrees"}var X=W*B.INCHES_PER_UNIT[V]*B.DOTS_PER_INCH;return X};B.Util.pagePosition=function(Y){var ad=[0,0];var ac=B.Util.getViewportElement();if(!Y||Y==window||Y==ac){return ad}var aa=B.IS_GECKO&&document.getBoxObjectFor&&B.Element.getStyle(Y,"position")=="absolute"&&(Y.style.top==""||Y.style.left=="");var ae=null;var ab;if(Y.getBoundingClientRect){ab=Y.getBoundingClientRect();var W=ac.scrollTop;var X=ac.scrollLeft;ad[0]=ab.left+X;ad[1]=ab.top+W}else{if(document.getBoxObjectFor&&!aa){ab=document.getBoxObjectFor(Y);var V=document.getBoxObjectFor(ac);ad[0]=ab.screenX-V.screenX;ad[1]=ab.screenY-V.screenY}else{ad[0]=Y.offsetLeft;ad[1]=Y.offsetTop;ae=Y.offsetParent;if(ae!=Y){while(ae){ad[0]+=ae.offsetLeft;ad[1]+=ae.offsetTop;ae=ae.offsetParent}}var Z=B.BROWSER_NAME;if(Z=="opera"||(Z=="safari"&&B.Element.getStyle(Y,"position")=="absolute")){ad[1]-=document.body.offsetTop}ae=Y.offsetParent;while(ae&&ae!=document.body){ad[0]-=ae.scrollLeft;if(Z!="opera"||ae.tagName!="TR"){ad[1]-=ae.scrollTop}ae=ae.offsetParent}}}return ad};B.Util.getViewportElement=function(){var V=arguments.callee.viewportElement;if(V==undefined){V=(B.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat")?document.body:document.documentElement;arguments.callee.viewportElement=V}return V};B.Util.isEquivalentUrl=function(aa,Z,X){X=X||{};B.Util.applyDefaults(X,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var W=B.Util.createUrlObject(aa,X);var V=B.Util.createUrlObject(Z,X);for(var Y in W){if(Y!=="args"){if(W[Y]!=V[Y]){return false}}}for(var Y in W.args){if(W.args[Y]!=V.args[Y]){return false}delete V.args[Y]}for(var Y in V.args){return false}return true};B.Util.createUrlObject=function(W,ae){ae=ae||{};if(!(/^\w+:\/\//).test(W)){var aa=window.location;var Y=aa.port?":"+aa.port:"";var ab=aa.protocol+"//"+aa.host.split(":").shift()+Y;if(W.indexOf("/")===0){W=ab+W}else{var Z=aa.pathname.split("/");Z.pop();W=ab+Z.join("/")+"/"+W}}if(ae.ignoreCase){W=W.toLowerCase()}var ac=document.createElement("a");ac.href=W;var X={};X.host=ac.host.split(":").shift();X.protocol=ac.protocol;if(ae.ignorePort80){X.port=(ac.port=="80"||ac.port=="0")?"":ac.port}else{X.port=(ac.port==""||ac.port=="0")?"80":ac.port}X.hash=(ae.ignoreHash||ac.hash==="#")?"":ac.hash;var V=ac.search;if(!V){var ad=W.indexOf("?");V=(ad!=-1)?W.substr(ad):""}X.args=B.Util.getParameters(V);X.pathname=(ac.pathname.charAt(0)=="/")?ac.pathname:"/"+ac.pathname;return X};B.Util.removeTail=function(W){var X=null;var V=W.indexOf("?");var Y=W.indexOf("#");if(V==-1){X=(Y!=-1)?W.substr(0,Y):W}else{X=(Y!=-1)?W.substr(0,Math.min(V,Y)):W.substr(0,V)}return X};B.IS_GECKO=(function(){var V=navigator.userAgent.toLowerCase();return V.indexOf("webkit")==-1&&V.indexOf("gecko")!=-1})();B.CANVAS_SUPPORTED=(function(){var V=document.createElement("canvas");return !!(V.getContext&&V.getContext("2d"))})();B.BROWSER_NAME=(function(){var V="";var W=navigator.userAgent.toLowerCase();if(W.indexOf("opera")!=-1){V="opera"}else{if(W.indexOf("msie")!=-1){V="msie"}else{if(W.indexOf("safari")!=-1){V="safari"}else{if(W.indexOf("mozilla")!=-1){if(W.indexOf("firefox")!=-1){V="firefox"}else{V="mozilla"}}}}}return V})();B.Util.getBrowserName=function(){return B.BROWSER_NAME};B.Util.getRenderedDimensions=function(W,ag,ah){var ae,Z;var V=document.createElement("div");V.style.visibility="hidden";var af=(ah&&ah.containerElement)?ah.containerElement:document.body;var ai=false;var ab=null;var ad=af;while(ad&&ad.tagName.toLowerCase()!="body"){var ac=B.Element.getStyle(ad,"position");if(ac=="absolute"){ai=true;break}else{if(ac&&ac!="static"){break}}ad=ad.parentNode}if(ai&&(af.clientHeight===0||af.clientWidth===0)){ab=document.createElement("div");ab.style.visibility="hidden";ab.style.position="absolute";ab.style.overflow="visible";ab.style.width=document.body.clientWidth+"px";ab.style.height=document.body.clientHeight+"px";ab.appendChild(V)}V.style.position="absolute";if(ag){if(ag.w){ae=ag.w;V.style.width=ae+"px"}else{if(ag.h){Z=ag.h;V.style.height=Z+"px"}}}if(ah&&ah.displayClass){V.className=ah.displayClass}var aa=document.createElement("div");aa.innerHTML=W;aa.style.overflow="visible";if(aa.childNodes){for(var Y=0,X=aa.childNodes.length;Y<X;Y++){if(!aa.childNodes[Y].style){continue}aa.childNodes[Y].style.overflow="visible"}}V.appendChild(aa);if(ab){af.appendChild(ab)}else{af.appendChild(V)}if(!ae){ae=parseInt(aa.scrollWidth);V.style.width=ae+"px"}if(!Z){Z=parseInt(aa.scrollHeight)}V.removeChild(aa);if(ab){ab.removeChild(V);af.removeChild(ab)}else{af.removeChild(V)}return new B.Size(ae,Z)};B.Util.getScrollbarWidth=function(){var X=B.Util._scrollbarWidth;if(X==null){var Z=null;var Y=null;var V=0;var W=0;Z=document.createElement("div");Z.style.position="absolute";Z.style.top="-1000px";Z.style.left="-1000px";Z.style.width="100px";Z.style.height="50px";Z.style.overflow="hidden";Y=document.createElement("div");Y.style.width="100%";Y.style.height="200px";Z.appendChild(Y);document.body.appendChild(Z);V=Y.offsetWidth;Z.style.overflow="scroll";W=Y.offsetWidth;document.body.removeChild(document.body.lastChild);B.Util._scrollbarWidth=(V-W);X=B.Util._scrollbarWidth}return X};B.Util.getFormattedLonLat=function(ac,W,Z){if(!Z){Z="dms"}ac=(ac+540)%360-180;var Y=Math.abs(ac);var ad=Math.floor(Y);var V=(Y-ad)/(1/60);var X=V;V=Math.floor(V);var ab=(X-V)/(1/60);ab=Math.round(ab*10);ab/=10;if(ab>=60){ab-=60;V+=1;if(V>=60){V-=60;ad+=1}}if(ad<10){ad="0"+ad}var aa=ad+"\u00B0";if(Z.indexOf("dm")>=0){if(V<10){V="0"+V}aa+=V+"'";if(Z.indexOf("dms")>=0){if(ab<10){ab="0"+ab}aa+=ab+'"'}}if(W=="lon"){aa+=ac<0?B.i18n("W"):B.i18n("E")}else{aa+=ac<0?B.i18n("S"):B.i18n("N")}return aa};B.Animation=(function(aa){var X=!!(aa.requestAnimationFrame||aa.webkitRequestAnimationFrame||aa.mozRequestAnimationFrame||aa.oRequestAnimationFrame||aa.msRequestAnimationFrame);var Z=(function(){var ac=aa.requestAnimationFrame||aa.webkitRequestAnimationFrame||aa.mozRequestAnimationFrame||aa.oRequestAnimationFrame||aa.msRequestAnimationFrame||function(ae,ad){aa.setTimeout(ae,16)};return function(ae,ad){ac.apply(aa,[ae,ad])}})();var W=0;var V={};function ab(ag,ad,ac){ad=ad>0?ad:Number.POSITIVE_INFINITY;var af=++W;var ae=+new Date;V[af]=function(){if(V[af]&&+new Date-ae<=ad){ag();if(V[af]){Z(V[af],ac)}}else{delete V[af]}};Z(V[af],ac);return af}function Y(ac){delete V[ac]}return{isNative:X,requestFrame:Z,start:ab,stop:Y}})(window);B.String={startsWith:function(W,V){return(W.indexOf(V)==0)},contains:function(W,V){return(W.indexOf(V)!=-1)},trim:function(V){return V.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(aa){var Y=aa.split("-");var W=Y[0];for(var X=1,V=Y.length;X<V;X++){var Z=Y[X];W+=Z.charAt(0).toUpperCase()+Z.substring(1)}return W},format:function(Y,X,V){if(!X){X=window}var W=function(ad,Z){var ac;var ab=Z.split(/\.+/);for(var aa=0;aa<ab.length;aa++){if(aa==0){ac=X}ac=ac[ab[aa]]}if(typeof ac=="function"){ac=V?ac.apply(null,V):ac()}if(typeof ac=="undefined"){return"undefined"}else{return ac}};return Y.replace(B.String.tokenRegEx,W)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(V){return B.String.numberRegEx.test(V)},numericIf:function(V){return B.String.isNumeric(V)?parseFloat(V):V}};B.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(V,X){var W=0;if(X>0){W=parseFloat(V.toPrecision(X))}return W},format:function(X,V,ab,ad){V=(typeof V!="undefined")?V:0;ab=(typeof ab!="undefined")?ab:B.Number.thousandsSeparator;ad=(typeof ad!="undefined")?ad:B.Number.decimalSeparator;if(V!=null){X=parseFloat(X.toFixed(V))}var W=X.toString().split(".");if(W.length==1&&V==null){V=0}var Y=W[0];if(ab){var Z=/(-?[0-9]+)([0-9]{3})/;while(Z.test(Y)){Y=Y.replace(Z,"$1"+ab+"$2")}}var aa;if(V==0){aa=Y}else{var ac=W.length>1?W[1]:"0";if(V!=null){ac=ac+new Array(V-ac.length+1).join("0")}aa=Y+ad+ac}return aa}};B.Function={bind:function(X,W){var V=Array.prototype.slice.apply(arguments,[2]);return function(){var Y=V.concat(Array.prototype.slice.apply(arguments,[0]));return X.apply(W,Y)}},bindAsEventListener:function(W,V){return function(X){return W.call(V,X||window.event)}},False:function(){return false},True:function(){return true},Void:function(){}};B.Array={filter:function(ab,aa,W){var Y=[];if(Array.prototype.filter){Y=ab.filter(aa,W)}else{var V=ab.length;if(typeof aa!="function"){throw new TypeError()}for(var X=0;X<V;X++){if(X in ab){var Z=ab[X];if(aa.call(W,Z,X,ab)){Y.push(Z)}}}}return Y}};B.Bounds=B.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(Y,V,W,X){if(B.Util.isArray(Y)){X=Y[3];W=Y[2];V=Y[1];Y=Y[0]}if(Y!=null){this.left=B.Util.toFloat(Y)}if(V!=null){this.bottom=B.Util.toFloat(V)}if(W!=null){this.right=B.Util.toFloat(W)}if(X!=null){this.top=B.Util.toFloat(X)}},clone:function(){return new B.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(W){var V=false;if(W!=null){V=((this.left==W.left)&&(this.right==W.right)&&(this.top==W.top)&&(this.bottom==W.bottom))}return V},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(V){if(V===true){return[this.bottom,this.left,this.top,this.right]}else{return[this.left,this.bottom,this.right,this.top]}},toBBOX:function(W,Z){if(W==null){W=6}var ab=Math.pow(10,W);var aa=Math.round(this.left*ab)/ab;var Y=Math.round(this.bottom*ab)/ab;var X=Math.round(this.right*ab)/ab;var V=Math.round(this.top*ab)/ab;if(Z===true){return Y+","+aa+","+V+","+X}else{return aa+","+Y+","+X+","+V}},toGeometry:function(){return new B.Geometry.Polygon([new B.Geometry.LinearRing([new B.Geometry.Point(this.left,this.bottom),new B.Geometry.Point(this.right,this.bottom),new B.Geometry.Point(this.right,this.top),new B.Geometry.Point(this.left,this.top)])])},getWidth:function(){return(this.right-this.left)},getHeight:function(){return(this.top-this.bottom)},getSize:function(){return new B.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new B.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new B.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(Z,X){if(X==null){X=this.getCenterLonLat()}var V,ac;if(X.CLASS_NAME=="OpenLayers.LonLat"){V=X.lon;ac=X.lat}else{V=X.x;ac=X.y}var ab=(this.left-V)*Z+V;var W=(this.bottom-ac)*Z+ac;var Y=(this.right-V)*Z+V;var aa=(this.top-ac)*Z+ac;return new B.Bounds(ab,W,Y,aa)},add:function(V,W){if((V==null)||(W==null)){throw new TypeError("Bounds.add cannot receive null values")}return new B.Bounds(this.left+V,this.bottom+W,this.right+V,this.top+W)},extend:function(V){var W=null;if(V){switch(V.CLASS_NAME){case"OpenLayers.LonLat":W=new B.Bounds(V.lon,V.lat,V.lon,V.lat);break;case"OpenLayers.Geometry.Point":W=new B.Bounds(V.x,V.y,V.x,V.y);break;case"OpenLayers.Bounds":W=V;break}if(W){this.centerLonLat=null;if((this.left==null)||(W.left<this.left)){this.left=W.left}if((this.bottom==null)||(W.bottom<this.bottom)){this.bottom=W.bottom}if((this.right==null)||(W.right>this.right)){this.right=W.right}if((this.top==null)||(W.top>this.top)){this.top=W.top}}}},containsLonLat:function(aa,X){if(typeof X==="boolean"){X={inclusive:X}}X=X||{};var Y=this.contains(aa.lon,aa.lat,X.inclusive),Z=X.worldBounds;if(Z&&!Y){var ab=Z.getWidth();var V=(Z.left+Z.right)/2;var W=Math.round((aa.lon-V)/ab);Y=this.containsLonLat({lon:aa.lon-W*ab,lat:aa.lat},{inclusive:X.inclusive})}return Y},containsPixel:function(W,V){return this.contains(W.x,W.y,V)},contains:function(W,Y,V){if(V==null){V=true}if(W==null||Y==null){return false}W=B.Util.toFloat(W);Y=B.Util.toFloat(Y);var X=false;if(V){X=((W>=this.left)&&(W<=this.right)&&(Y>=this.bottom)&&(Y<=this.top))}else{X=((W>this.left)&&(W<this.right)&&(Y>this.bottom)&&(Y<this.top))}return X},intersectsBounds:function(V,ah){if(typeof ah==="boolean"){ah={inclusive:ah}}ah=ah||{};if(ah.worldBounds){var ag=this.wrapDateLine(ah.worldBounds);V=V.wrapDateLine(ah.worldBounds)}else{ag=this}if(ah.inclusive==null){ah.inclusive=true}var ac=false;var ad=(ag.left==V.right||ag.right==V.left||ag.top==V.bottom||ag.bottom==V.top);if(ah.inclusive||!ad){var ae=(((V.bottom>=ag.bottom)&&(V.bottom<=ag.top))||((ag.bottom>=V.bottom)&&(ag.bottom<=V.top)));var af=(((V.top>=ag.bottom)&&(V.top<=ag.top))||((ag.top>V.bottom)&&(ag.top<V.top)));var Y=(((V.left>=ag.left)&&(V.left<=ag.right))||((ag.left>=V.left)&&(ag.left<=V.right)));var X=(((V.right>=ag.left)&&(V.right<=ag.right))||((ag.right>=V.left)&&(ag.right<=V.right)));ac=((ae||af)&&(Y||X))}if(ah.worldBounds&&!ac){var ab=ah.worldBounds;var W=ab.getWidth();var aa=!ab.containsBounds(ag);var Z=!ab.containsBounds(V);if(aa&&!Z){V=V.add(-W,0);ac=ag.intersectsBounds(V,{inclusive:ah.inclusive})}else{if(Z&&!aa){ag=ag.add(-W,0);ac=V.intersectsBounds(ag,{inclusive:ah.inclusive})}}}return ac},containsBounds:function(ab,W,V){if(W==null){W=false}if(V==null){V=true}var X=this.contains(ab.left,ab.bottom,V);var Y=this.contains(ab.right,ab.bottom,V);var aa=this.contains(ab.left,ab.top,V);var Z=this.contains(ab.right,ab.top,V);return(W)?(X||Y||aa||Z):(X&&Y&&aa&&Z)},determineQuadrant:function(X){var W="";var V=this.getCenterLonLat();W+=(X.lat<V.lat)?"b":"t";W+=(X.lon<V.lon)?"l":"r";return W},transform:function(Y,W){this.centerLonLat=null;var Z=B.Projection.transform({x:this.left,y:this.bottom},Y,W);var V=B.Projection.transform({x:this.right,y:this.bottom},Y,W);var X=B.Projection.transform({x:this.left,y:this.top},Y,W);var aa=B.Projection.transform({x:this.right,y:this.top},Y,W);this.left=Math.min(Z.x,X.x);this.bottom=Math.min(Z.y,V.y);this.right=Math.max(V.x,aa.x);this.top=Math.max(X.y,aa.y);return this},wrapDateLine:function(V,X){X=X||{};var Z=X.leftTolerance||0;var W=X.rightTolerance||0;var ab=this.clone();if(V){var Y=V.getWidth();while(ab.left<V.left&&ab.right-W<=V.left){ab=ab.add(Y,0)}while(ab.left+Z>=V.right&&ab.right>V.right){ab=ab.add(-Y,0)}var aa=ab.left+Z;if(aa<V.right&&aa>V.left&&ab.right-W>V.right){ab=ab.add(-Y,0)}}return ab},CLASS_NAME:"OpenLayers.Bounds"});B.Bounds.fromString=function(X,W){var V=X.split(",");return B.Bounds.fromArray(V,W)};B.Bounds.fromArray=function(W,V){return V===true?new B.Bounds(W[1],W[0],W[3],W[2]):new B.Bounds(W[0],W[1],W[2],W[3])};B.Bounds.fromSize=function(V){return new B.Bounds(0,V.h,V.w,0)};B.Bounds.oppositeQuadrant=function(V){var W="";W+=(V.charAt(0)=="t")?"b":"t";W+=(V.charAt(1)=="l")?"r":"l";return W};B.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(W){return W.toISOString()}}else{function V(X,W){var Y=X+"";while(Y.length<W){Y="0"+Y}return Y}return function(W){var X;if(isNaN(W.getTime())){X="Invalid Date"}else{X=W.getUTCFullYear()+"-"+V(W.getUTCMonth()+1,2)+"-"+V(W.getUTCDate(),2)+"T"+V(W.getUTCHours(),2)+":"+V(W.getUTCMinutes(),2)+":"+V(W.getUTCSeconds(),2)+"."+V(W.getUTCMilliseconds(),3)+"Z"}return X}}})(),parse:function(ae){var W;var ac=ae.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/);if(ac&&(ac[1]||ac[7])){var af=parseInt(ac[1],10)||0;var ad=(parseInt(ac[2],10)-1)||0;var ah=parseInt(ac[3],10)||1;W=new Date(Date.UTC(af,ad,ah));var ag=ac[7];if(ag){var ai=parseInt(ac[4],10);var Y=parseInt(ac[5],10);var V=parseFloat(ac[6]);var aj=V|0;var X=Math.round(1000*(V-aj));W.setUTCHours(ai,Y,aj,X);if(ag!=="Z"){var ab=parseInt(ag,10);var aa=parseInt(ac[8],10)||0;var Z=-1000*(60*(ab*60)+aa*60);W=new Date(W.getTime()+Z)}}}else{W=new Date("invalid")}return W}};B.Element={visible:function(V){return B.Util.getElement(V).style.display!="none"},toggle:function(){for(var X=0,V=arguments.length;X<V;X++){var W=B.Util.getElement(arguments[X]);var Y=B.Element.visible(W)?"none":"";W.style.display=Y}},remove:function(V){V=B.Util.getElement(V);V.parentNode.removeChild(V)},getHeight:function(V){V=B.Util.getElement(V);return V.offsetHeight},hasClass:function(W,V){var X=W.className;return(!!X&&new RegExp("(^|\\s)"+V+"(\\s|$)").test(X))},addClass:function(W,V){if(!B.Element.hasClass(W,V)){W.className+=(W.className?" ":"")+V}return W},removeClass:function(W,V){var X=W.className;if(X){W.className=B.String.trim(X.replace(new RegExp("(^|\\s+)"+V+"(\\s+|$)")," "))}return W},toggleClass:function(W,V){if(B.Element.hasClass(W,V)){B.Element.removeClass(W,V)}else{B.Element.addClass(W,V)}return W},getStyle:function(X,Y){X=B.Util.getElement(X);var Z=null;if(X&&X.style){Z=X.style[B.String.camelize(Y)];if(!Z){if(document.defaultView&&document.defaultView.getComputedStyle){var W=document.defaultView.getComputedStyle(X,null);Z=W?W.getPropertyValue(Y):null}else{if(X.currentStyle){Z=X.currentStyle[B.String.camelize(Y)]}}}var V=["left","top","right","bottom"];if(window.opera&&(B.Util.indexOf(V,Y)!=-1)&&(B.Element.getStyle(X,"position")=="static")){Z="auto"}}return Z=="auto"?null:Z}};B.LonLat=B.Class({lon:0,lat:0,initialize:function(W,V){if(B.Util.isArray(W)){V=W[1];W=W[0]}this.lon=B.Util.toFloat(W);this.lat=B.Util.toFloat(V)},toString:function(){return("lon="+this.lon+",lat="+this.lat)},toShortString:function(){return(this.lon+", "+this.lat)},clone:function(){return new B.LonLat(this.lon,this.lat)},add:function(W,V){if((W==null)||(V==null)){throw new TypeError("LonLat.add cannot receive null values")}return new B.LonLat(this.lon+B.Util.toFloat(W),this.lat+B.Util.toFloat(V))},equals:function(W){var V=false;if(W!=null){V=((this.lon==W.lon&&this.lat==W.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(W.lon)&&isNaN(W.lat)))}return V},transform:function(X,W){var V=B.Projection.transform({x:this.lon,y:this.lat},X,W);this.lon=V.x;this.lat=V.y;return this},wrapDateLine:function(V){var W=this.clone();if(V){while(W.lon<V.left){W.lon+=V.getWidth()}while(W.lon>V.right){W.lon-=V.getWidth()}}return W},CLASS_NAME:"OpenLayers.LonLat"});B.LonLat.fromString=function(W){var V=W.split(",");return new B.LonLat(V[0],V[1])};B.LonLat.fromArray=function(V){var W=B.Util.isArray(V),Y=W&&V[0],X=W&&V[1];return new B.LonLat(Y,X)};B.Pixel=B.Class({x:0,y:0,initialize:function(V,W){this.x=parseFloat(V);this.y=parseFloat(W)},toString:function(){return("x="+this.x+",y="+this.y)},clone:function(){return new B.Pixel(this.x,this.y)},equals:function(V){var W=false;if(V!=null){W=((this.x==V.x&&this.y==V.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(V.x)&&isNaN(V.y)))}return W},distanceTo:function(V){return Math.sqrt(Math.pow(this.x-V.x,2)+Math.pow(this.y-V.y,2))},add:function(V,W){if((V==null)||(W==null)){throw new TypeError("Pixel.add cannot receive null values")}return new B.Pixel(this.x+V,this.y+W)},offset:function(V){var W=this.clone();if(V){W=this.add(V.x,V.y)}return W},CLASS_NAME:"OpenLayers.Pixel"});B.Size=B.Class({w:0,h:0,initialize:function(V,W){this.w=parseFloat(V);this.h=parseFloat(W)},toString:function(){return("w="+this.w+",h="+this.h)},clone:function(){return new B.Size(this.w,this.h)},equals:function(W){var V=false;if(W!=null){V=((this.w==W.w&&this.h==W.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(W.w)&&isNaN(W.h)))}return V},CLASS_NAME:"OpenLayers.Size"});B.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(V){alert(V)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var W=document.getElementsByTagName("script");for(var X=0,V=W.length;X<V;++X){if(W[X].src.indexOf("firebug.js")!=-1){if(console){B.Util.extend(B.Console,console);break}}}})();B.Tween=B.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:false,initialize:function(V){this.easing=(V)?V:B.Easing.Expo.easeOut},start:function(X,W,Y,V){this.playing=true;this.begin=X;this.finish=W;this.duration=Y;this.callbacks=V.callbacks;this.time=0;B.Animation.stop(this.animationId);this.animationId=null;if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.animationId=B.Animation.start(B.Function.bind(this.play,this))},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}B.Animation.stop(this.animationId);this.animationId=null;this.playing=false},play:function(){var Y={};for(var W in this.begin){var V=this.begin[W];var X=this.finish[W];if(V==null||X==null||isNaN(V)||isNaN(X)){throw new TypeError("invalid value for Tween")}var Z=X-V;Y[W]=this.easing.apply(this,[this.time,V,Z,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,Y)}if(this.time>this.duration){this.stop()}},CLASS_NAME:"OpenLayers.Tween"});B.Easing={CLASS_NAME:"OpenLayers.Easing"};B.Easing.Linear={easeIn:function(W,V,Y,X){return Y*W/X+V},easeOut:function(W,V,Y,X){return Y*W/X+V},easeInOut:function(W,V,Y,X){return Y*W/X+V},CLASS_NAME:"OpenLayers.Easing.Linear"};B.Easing.Expo={easeIn:function(W,V,Y,X){return(W==0)?V:Y*Math.pow(2,10*(W/X-1))+V},easeOut:function(W,V,Y,X){return(W==X)?V+Y:Y*(-Math.pow(2,-10*W/X)+1)+V},easeInOut:function(W,V,Y,X){if(W==0){return V}if(W==X){return V+Y}if((W/=X/2)<1){return Y/2*Math.pow(2,10*(W-1))+V}return Y/2*(-Math.pow(2,-10*--W)+2)+V},CLASS_NAME:"OpenLayers.Easing.Expo"};B.Easing.Quad={easeIn:function(W,V,Y,X){return Y*(W/=X)*W+V},easeOut:function(W,V,Y,X){return -Y*(W/=X)*(W-2)+V},easeInOut:function(W,V,Y,X){if((W/=X/2)<1){return Y/2*W*W+V}return -Y/2*((--W)*(W-2)-1)+V},CLASS_NAME:"OpenLayers.Easing.Quad"};B.Kinetic=B.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:undefined,timerId:undefined,initialize:function(V){B.Util.extend(this,V)},begin:function(){B.Animation.stop(this.timerId);this.timerId=undefined;this.points=[]},update:function(V){this.points.unshift({xy:V,tick:new Date().getTime()});if(this.points.length>this.nbPoints){this.points.pop()}},end:function(ae){var ad,V=new Date().getTime();for(var aa=0,Z=this.points.length,ac;aa<Z;aa++){ac=this.points[aa];if(V-ac.tick>this.delay){break}ad=ac}if(!ad){return}var Y=new Date().getTime()-ad.tick;var ab=Math.sqrt(Math.pow(ae.x-ad.xy.x,2)+Math.pow(ae.y-ad.xy.y,2));var X=ab/Y;if(X==0||X<this.threshold){return}var W=Math.asin((ae.y-ad.xy.y)/ab);if(ad.xy.x<=ae.x){W=Math.PI-W}return{speed:X,theta:W}},move:function(X,ad){var ac=X.speed;var aa=Math.cos(X.theta);var Z=-Math.sin(X.theta);var Y=new Date().getTime();var W=0;var V=0;var ab=function(){if(this.timerId==null){return}var ah=new Date().getTime()-Y;var ai=(-this.deceleration*Math.pow(ah,2))/2+ac*ah;var ae=ai*aa;var aj=ai*Z;var ag={};ag.end=false;var af=-this.deceleration*ah+ac;if(af<=0){B.Animation.stop(this.timerId);this.timerId=null;ag.end=true}ag.x=ae-W;ag.y=aj-V;W=ae;V=aj;ad(ag.x,ag.y,ag.end)};this.timerId=B.Animation.start(B.Function.bind(ab,this))},CLASS_NAME:"OpenLayers.Kinetic"});B.Console.warn("OpenLayers.Rico is deprecated");B.Rico=B.Rico||{};B.Rico.Corner={round:function(Y,W){Y=B.Util.getElement(Y);this._setOptions(W);var V=this.options.color;if(this.options.color=="fromElement"){V=this._background(Y)}var X=this.options.bgColor;if(this.options.bgColor=="fromParent"){X=this._background(Y.offsetParent)}this._roundCornersImpl(Y,V,X)},changeColor:function(X,W){X.style.backgroundColor=W;var V=X.parentNode.getElementsByTagName("span");for(var Y=0;Y<V.length;Y++){V[Y].style.backgroundColor=W}},changeOpacity:function(X,aa){var Y=aa;var V="alpha(opacity="+aa*100+")";X.style.opacity=Y;X.style.filter=V;var W=X.parentNode.getElementsByTagName("span");for(var Z=0;Z<W.length;Z++){W[Z].style.opacity=Y;W[Z].style.filter=V}},reRound:function(Y,X){var W=Y.parentNode.childNodes[0];var V=Y.parentNode.childNodes[2];Y.parentNode.removeChild(W);Y.parentNode.removeChild(V);this.round(Y.parentNode,X)},_roundCornersImpl:function(X,V,W){if(this.options.border){this._renderBorder(X,W)}if(this._isTopRounded()){this._roundTopCorners(X,V,W)}if(this._isBottomRounded()){this._roundBottomCorners(X,V,W)}},_renderBorder:function(Y,Z){var W="1px solid "+this._borderColor(Z);var V="border-left: "+W;var aa="border-right: "+W;var X="style='"+V+";"+aa+"'";Y.innerHTML="<div "+X+">"+Y.innerHTML+"</div>"},_roundTopCorners:function(X,V,Z){var Y=this._createCorner(Z);for(var W=0;W<this.options.numSlices;W++){Y.appendChild(this._createCornerSlice(V,Z,W,"top"))}X.style.paddingTop=0;X.insertBefore(Y,X.firstChild)},_roundBottomCorners:function(X,V,Z){var Y=this._createCorner(Z);for(var W=(this.options.numSlices-1);W>=0;W--){Y.appendChild(this._createCornerSlice(V,Z,W,"bottom"))}X.style.paddingBottom=0;X.appendChild(Y)},_createCorner:function(W){var V=document.createElement("div");V.style.backgroundColor=(this._isTransparent()?"transparent":W);return V},_createCornerSlice:function(X,Y,ab,V){var Z=document.createElement("span");var W=Z.style;W.backgroundColor=X;W.display="block";W.height="1px";W.overflow="hidden";W.fontSize="1px";var aa=this._borderColor(X,Y);if(this.options.border&&ab==0){W.borderTopStyle="solid";W.borderTopWidth="1px";W.borderLeftWidth="0px";W.borderRightWidth="0px";W.borderBottomWidth="0px";W.height="0px";W.borderColor=aa}else{if(aa){W.borderColor=aa;W.borderStyle="solid";W.borderWidth="0px 1px"}}if(!this.options.compact&&(ab==(this.options.numSlices-1))){W.height="2px"}this._setMargin(Z,ab,V);this._setBorder(Z,ab,V);return Z},_setOptions:function(V){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};B.Util.extend(this.options,V||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""}if(this.options.corners.indexOf("tl")>=0){return"left"}else{if(this.options.corners.indexOf("tr")>=0){return"right"}}return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""}if(this.options.corners.indexOf("bl")>=0){return"left"}else{if(this.options.corners.indexOf("br")>=0){return"right"}}return""},_borderColor:function(V,W){if(V=="transparent"){return W}else{if(this.options.border){return this.options.border}else{if(this.options.blend){return this._blend(W,V)}else{return""}}}},_setMargin:function(Y,Z,W){var X=this._marginSize(Z);var V=W=="top"?this._whichSideTop():this._whichSideBottom();if(V=="left"){Y.style.marginLeft=X+"px";Y.style.marginRight="0px"}else{if(V=="right"){Y.style.marginRight=X+"px";Y.style.marginLeft="0px"}else{Y.style.marginLeft=X+"px";Y.style.marginRight=X+"px"}}},_setBorder:function(Y,Z,W){var X=this._borderSize(Z);var V=W=="top"?this._whichSideTop():this._whichSideBottom();if(V=="left"){Y.style.borderLeftWidth=X+"px";Y.style.borderRightWidth="0px"}else{if(V=="right"){Y.style.borderRightWidth=X+"px";Y.style.borderLeftWidth="0px"}else{Y.style.borderLeftWidth=X+"px";Y.style.borderRightWidth=X+"px"}}if(this.options.border!=false){Y.style.borderLeftWidth=X+"px";Y.style.borderRightWidth=X+"px"}},_marginSize:function(Z){if(this._isTransparent()){return 0}var Y=[5,3,2,1];var V=[3,2,1,0];var X=[2,1];var W=[1,0];if(this.options.compact&&this.options.blend){return W[Z]}else{if(this.options.compact){return X[Z]}else{if(this.options.blend){return V[Z]}else{return Y[Z]}}}},_borderSize:function(Z){var Y=[5,3,2,1];var W=[2,1,1,1];var V=[1,0];var X=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1}else{if(this.options.compact){return V[Z]}else{if(this.options.blend){return W[Z]}else{if(this.options.border){return X[Z]}else{if(this._isTransparent()){return Y[Z]}}}}}return 0},_hasString:function(W){for(var V=1;V<arguments.length;V++){if(W.indexOf(arguments[V])>=0){return true}}return false},_blend:function(X,V){var W=B.Rico.Color.createFromHex(X);W.blend(B.Rico.Color.createFromHex(V));return W},_background:function(V){try{return B.Rico.Color.createColorFromBackground(V).asHex()}catch(W){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(V){return V.childNodes.length==1&&V.childNodes[0].nodeType==3}};B.Event={observers:false,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(V){return V.target||V.srcElement},isSingleTouch:function(V){return V.touches&&V.touches.length==1},isMultiTouch:function(V){return V.touches&&V.touches.length>1},isLeftClick:function(V){return(((V.which)&&(V.which==1))||((V.button)&&(V.button==1)))},isRightClick:function(V){return(((V.which)&&(V.which==3))||((V.button)&&(V.button==2)))},stop:function(W,V){if(!V){if(W.preventDefault){W.preventDefault()}else{W.returnValue=false}}if(W.stopPropagation){W.stopPropagation()}else{W.cancelBubble=true}},findElement:function(X,W){var V=B.Event.element(X);while(V.parentNode&&(!V.tagName||(V.tagName.toUpperCase()!=W.toUpperCase()))){V=V.parentNode}return V},observe:function(W,Y,X,V){var Z=B.Util.getElement(W);V=V||false;if(Y=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||Z.attachEvent)){Y="keydown"}if(!this.observers){this.observers={}}if(!Z._eventCacheID){var aa="eventCacheID_";if(Z.id){aa=Z.id+"_"+aa}Z._eventCacheID=B.Util.createUniqueID(aa)}var ab=Z._eventCacheID;if(!this.observers[ab]){this.observers[ab]=[]}this.observers[ab].push({element:Z,name:Y,observer:X,useCapture:V});if(Z.addEventListener){Z.addEventListener(Y,X,V)}else{if(Z.attachEvent){Z.attachEvent("on"+Y,X)}}},stopObservingElement:function(V){var W=B.Util.getElement(V);var X=W._eventCacheID;this._removeElementObservers(B.Event.observers[X])},_removeElementObservers:function(Z){if(Z){for(var W=Z.length-1;W>=0;W--){var X=Z[W];var V=new Array(X.element,X.name,X.observer,X.useCapture);var Y=B.Event.stopObserving.apply(this,V)}}},stopObserving:function(ac,V,ab,W){W=W||false;var aa=B.Util.getElement(ac);var Y=aa._eventCacheID;if(V=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||aa.detachEvent){V="keydown"}}var ae=false;var X=B.Event.observers[Y];if(X){var Z=0;while(!ae&&Z<X.length){var ad=X[Z];if((ad.name==V)&&(ad.observer==ab)&&(ad.useCapture==W)){X.splice(Z,1);if(X.length==0){delete B.Event.observers[Y]}ae=true;break}Z++}}if(ae){if(aa.removeEventListener){aa.removeEventListener(V,ab,W)}else{if(aa&&aa.detachEvent){aa.detachEvent("on"+V,ab)}}}return ae},unloadCache:function(){if(B.Event&&B.Event.observers){for(var V in B.Event.observers){var W=B.Event.observers[V];B.Event._removeElementObservers.apply(this,[W])}B.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};B.Event.observe(window,"unload",B.Event.unloadCache,false);B.Events=B.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:false,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(W,X,Z,Y,V){B.Util.extend(this,V);this.object=W;this.fallThrough=Y;this.listeners={};this.extensions={};this.extensionCount={};if(X!=null){this.attachToElement(X)}},destroy:function(){for(var V in this.extensions){if(typeof this.extensions[V]!=="boolean"){this.extensions[V].destroy()}}this.extensions=null;if(this.element){B.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){B.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(V){},attachToElement:function(X){if(this.element){B.Event.stopObservingElement(this.element)}else{this.eventHandler=B.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=B.Function.bind(this.clearMouseCache,this)}this.element=X;for(var W=0,V=this.BROWSER_EVENTS.length;W<V;W++){B.Event.observe(X,this.BROWSER_EVENTS[W],this.eventHandler)}B.Event.observe(X,"dragstart",B.Event.stop)},on:function(V){for(var W in V){if(W!="scope"&&V.hasOwnProperty(W)){this.register(W,V.scope,V[W])}}},register:function(X,aa,Y,V){if(X in B.Events&&!this.extensions[X]){this.extensions[X]=new B.Events[X](this)}if(Y!=null){if(aa==null){aa=this.object}var W=this.listeners[X];if(!W){W=[];this.listeners[X]=W;this.extensionCount[X]=0}var Z={obj:aa,func:Y};if(V){W.splice(this.extensionCount[X],0,Z);if(typeof V==="object"&&V.extension){this.extensionCount[X]++}}else{W.push(Z)}}},registerPriority:function(V,X,W){this.register(V,X,W,true)},un:function(V){for(var W in V){if(W!="scope"&&V.hasOwnProperty(W)){this.unregister(W,V.scope,V[W])}}},unregister:function(Y,aa,Z){if(aa==null){aa=this.object}var X=this.listeners[Y];if(X!=null){for(var W=0,V=X.length;W<V;W++){if(X[W].obj==aa&&X[W].func==Z){X.splice(W,1);break}}}},remove:function(V){if(this.listeners[V]!=null){this.listeners[V]=[]}},triggerEvent:function(Z,W){var Y=this.listeners[Z];if(!Y||Y.length==0){return undefined}if(W==null){W={}}W.object=this.object;W.element=this.element;if(!W.type){W.type=Z}Y=Y.slice();var aa;for(var X=0,V=Y.length;X<V;X++){var ab=Y[X];aa=ab.func.apply(ab.obj,[W]);if((aa!=undefined)&&(aa==false)){break}}if(!this.fallThrough){B.Event.stop(W,true)}return aa},handleBrowserEvent:function(ad){var Z=ad.type,aa=this.listeners[Z];if(!aa||aa.length==0){return}var X=ad.touches;if(X&&X[0]){var ac=0;var ab=0;var Y=X.length;var W;for(var V=0;V<Y;++V){W=X[V];ac+=W.clientX;ab+=W.clientY}ad.clientX=ac/Y;ad.clientY=ab/Y}if(this.includeXY){ad.xy=this.getMousePosition(ad)}this.triggerEvent(Z,ad)},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;var V=document.body;if(V&&!((V.scrollTop!=0||V.scrollLeft!=0)&&navigator.userAgent.match(/iPhone/i))){this.element.offsets=null}},getMousePosition:function(V){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){B.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}if(!this.element.scrolls){var W=B.Util.getViewportElement();this.element.scrolls=[W.scrollLeft,W.scrollTop]}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]}if(!this.element.offsets){this.element.offsets=B.Util.pagePosition(this.element)}return new B.Pixel((V.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(V.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});B.Events.buttonclick=B.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(W){this.target=W;for(var V=this.events.length-1;V>=0;--V){this.target.register(this.events[V],this,this.buttonClick,{extension:true})}},destroy:function(){for(var V=this.events.length-1;V>=0;--V){this.target.unregister(this.events[V],this,this.buttonClick)}delete this.target},getPressedButton:function(W){var X=3,V;do{if(B.Element.hasClass(W,"olButton")){V=W;break}W=W.parentNode}while(--X>0&&W);return V},buttonClick:function(W){var V=true,Y=B.Event.element(W);if(Y&&(B.Event.isLeftClick(W)||!~W.type.indexOf("mouse"))){var X=this.getPressedButton(Y);if(X){if(W.type==="keydown"){switch(W.keyCode){case B.Event.KEY_RETURN:case B.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:X});B.Event.stop(W);V=false;break}}else{if(this.startEvt){if(this.completeRegEx.test(W.type)){var Z=B.Util.pagePosition(X);this.target.triggerEvent("buttonclick",{buttonElement:X,buttonXY:{x:this.startEvt.clientX-Z[0],y:this.startEvt.clientY-Z[1]}})}if(this.cancelRegEx.test(W.type)){delete this.startEvt}B.Event.stop(W);V=false}}if(this.startRegEx.test(W.type)){this.startEvt=W;B.Event.stop(W);V=false}}else{delete this.startEvt}}return V}});B.ProxyHost="";B.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:B.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new B.Events(this),makeSameOrigin:function(W,X){var aa=W.indexOf("http")!==0;var ab=!aa&&W.match(this.URL_SPLIT_REGEX);if(ab){var V=window.location;aa=ab[1]==V.protocol&&ab[3]==V.hostname;var Y=ab[4],Z=V.port;if(Y!=80&&Y!=""||Z!="80"&&Z!=""){aa=aa&&Y==Z}}if(!aa){if(X){if(typeof X=="function"){W=X(W)}else{W=X+encodeURIComponent(W)}}else{B.Console.warn(B.i18n("proxyNeeded"),{url:W})}}return W},issue:function(W){var Y=B.Util.extend(this.DEFAULT_CONFIG,{proxy:B.ProxyHost});W=B.Util.applyDefaults(W,Y);var ab=false,Z;for(Z in W.headers){if(W.headers.hasOwnProperty(Z)){if(Z.toLowerCase()==="x-requested-with"){ab=true}}}if(ab===false){W.headers["X-Requested-With"]="XMLHttpRequest"}var X=new B.Request.XMLHttpRequest();var V=B.Util.urlAppend(W.url,B.Util.getParameterString(W.params||{}));V=B.Request.makeSameOrigin(V,W.proxy);X.open(W.method,V,W.async,W.user,W.password);for(var aa in W.headers){X.setRequestHeader(aa,W.headers[aa])}var ad=this.events;var ac=this;X.onreadystatechange=function(){if(X.readyState==B.Request.XMLHttpRequest.DONE){var ae=ad.triggerEvent("complete",{request:X,config:W,requestUrl:V});if(ae!==false){ac.runCallbacks({request:X,config:W,requestUrl:V})}}};if(W.async===false){X.send(W.data)}else{window.setTimeout(function(){if(X.readyState!==0){X.send(W.data)}},0)}return X},runCallbacks:function(Y){var Z=Y.request;var X=Y.config;var V=(X.scope)?B.Function.bind(X.callback,X.scope):X.callback;var aa;if(X.success){aa=(X.scope)?B.Function.bind(X.success,X.scope):X.success}var W;if(X.failure){W=(X.scope)?B.Function.bind(X.failure,X.scope):X.failure}if(B.Util.createUrlObject(X.url).protocol=="file:"&&Z.responseText){Z.status=200}V(Z);if(!Z.status||(Z.status>=200&&Z.status<300)){this.events.triggerEvent("success",Y);if(aa){aa(Z)}}if(Z.status&&(Z.status<200||Z.status>=300)){this.events.triggerEvent("failure",Y);if(W){W(Z)}}},GET:function(V){V=B.Util.extend(V,{method:"GET"});return B.Request.issue(V)},POST:function(V){V=B.Util.extend(V,{method:"POST"});V.headers=V.headers?V.headers:{};if(!("CONTENT-TYPE" in B.Util.upperCaseObject(V.headers))){V.headers["Content-Type"]="application/xml"}return B.Request.issue(V)},PUT:function(V){V=B.Util.extend(V,{method:"PUT"});V.headers=V.headers?V.headers:{};if(!("CONTENT-TYPE" in B.Util.upperCaseObject(V.headers))){V.headers["Content-Type"]="application/xml"}return B.Request.issue(V)},DELETE:function(V){V=B.Util.extend(V,{method:"DELETE"});return B.Request.issue(V)},HEAD:function(V){V=B.Util.extend(V,{method:"HEAD"});return B.Request.issue(V)},OPTIONS:function(V){V=B.Util.extend(V,{method:"OPTIONS"});return B.Request.issue(V)}};B.Request.issue=function(Y){var ab=B.Util.extend(this.DEFAULT_CONFIG,{proxy:B.ProxyHost});Y=B.Util.applyDefaults(Y,ab);var af=false,ac;for(ac in Y.headers){if(Y.headers.hasOwnProperty(ac)){if(ac.toLowerCase()==="x-requested-with"){af=true}}}if(af===false){Y.headers["X-Requested-With"]="XMLHttpRequest"}var aa=new B.Request.XMLHttpRequest();var V=B.Util.urlAppend(Y.url,B.Util.getParameterString(Y.params||{}));var ae=!(V.indexOf("http")==0);var W=!ae&&V.match(this.URL_SPLIT_REGEX);if(W){var ag=window.location;ae=W[1]==ag.protocol&&W[3]==ag.hostname;var Z=W[4],X=ag.port;if(Z!=80&&Z!=""||X!="80"&&X!=""){ae=ae&&Z==X}}if(!ae){if(Y.proxy){var ai=this;T.load(V,function(aj){aa.responseText=aj;aa.status=200;ai.runCallbacks({request:aa,config:Y,requestUrl:V})},function(aj){aa.status=1;aa.error=aj;ai.runCallbacks({request:aa,config:Y,requestUrl:V})});return aa}else{B.Console.warn(B.i18n("proxyNeeded"),{url:V})}}aa.open(Y.method,V,Y.async,Y.user,Y.password);for(var ad in Y.headers){aa.setRequestHeader(ad,Y.headers[ad])}var ah=this.events;var ai=this;aa.onreadystatechange=function(){if(aa.readyState==B.Request.XMLHttpRequest.DONE){var aj=ah.triggerEvent("complete",{request:aa,config:Y,requestUrl:V});if(aj!==false){ai.runCallbacks({request:aa,config:Y,requestUrl:V})}}};if(Y.async===false){aa.send(Y.data)}else{window.setTimeout(function(){if(aa.readyState!==0){aa.send(Y.data)}},0)}return aa};(function(){var ab=window.XMLHttpRequest;var V=!!window.controllers,ae=window.document.all&&!window.opera,af=ae&&window.navigator.userAgent.match(/MSIE 7.0/);function Y(){this._object=ab&&!af?new ab:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function X(){return new Y}X.prototype=Y.prototype;if(V&&ab.wrapped){X.wrapped=ab.wrapped}X.UNSENT=0;X.OPENED=1;X.HEADERS_RECEIVED=2;X.LOADING=3;X.DONE=4;X.prototype.readyState=X.UNSENT;X.prototype.responseText="";X.prototype.responseXML=null;X.prototype.status=0;X.prototype.statusText="";X.prototype.priority="NORMAL";X.prototype.onreadystatechange=null;X.onreadystatechange=null;X.onopen=null;X.onsend=null;X.onabort=null;X.prototype.open=function(aj,am,ai,an,ah){delete this._headers;if(arguments.length<3){ai=true}this._async=ai;var al=this,ak=this.readyState,ag;if(ae&&ai){ag=function(){if(ak!=X.DONE){Z(al);al.abort()}};window.attachEvent("onunload",ag)}if(X.onopen){X.onopen.apply(this,arguments)}if(arguments.length>4){this._object.open(aj,am,ai,an,ah)}else{if(arguments.length>3){this._object.open(aj,am,ai,an)}else{this._object.open(aj,am,ai)}}this.readyState=X.OPENED;W(this);this._object.onreadystatechange=function(){if(V&&!ai){return}al.readyState=al._object.readyState;ac(al);if(al._aborted){al.readyState=X.UNSENT;return}if(al.readyState==X.DONE){delete al._data;Z(al);if(ae&&ai){window.detachEvent("onunload",ag)}}if(ak!=al.readyState){W(al)}ak=al.readyState}};function aa(ag){ag._object.send(ag._data);if(V&&!ag._async){ag.readyState=X.OPENED;ac(ag);while(ag.readyState<X.DONE){ag.readyState++;W(ag);if(ag._aborted){return}}}}X.prototype.send=function(ag){if(X.onsend){X.onsend.apply(this,arguments)}if(!arguments.length){ag=null}if(ag&&ag.nodeType){ag=window.XMLSerializer?new window.XMLSerializer().serializeToString(ag):ag.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml")}}this._data=ag;aa(this)};X.prototype.abort=function(){if(X.onabort){X.onabort.apply(this,arguments)}if(this.readyState>X.UNSENT){this._aborted=true}this._object.abort();Z(this);this.readyState=X.UNSENT;delete this._data};X.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};X.prototype.getResponseHeader=function(ag){return this._object.getResponseHeader(ag)};X.prototype.setRequestHeader=function(ag,ah){if(!this._headers){this._headers={}}this._headers[ag]=ah;return this._object.setRequestHeader(ag,ah)};X.prototype.addEventListener=function(aj,ai,ah){for(var ag=0,ak;ak=this._listeners[ag];ag++){if(ak[0]==aj&&ak[1]==ai&&ak[2]==ah){return}}this._listeners.push([aj,ai,ah])};X.prototype.removeEventListener=function(aj,ai,ah){for(var ag=0,ak;ak=this._listeners[ag];ag++){if(ak[0]==aj&&ak[1]==ai&&ak[2]==ah){break}}if(ak){this._listeners.splice(ag,1)}};X.prototype.dispatchEvent=function(ah){var ai={type:ah.type,target:this,currentTarget:this,eventPhase:2,bubbles:ah.bubbles,cancelable:ah.cancelable,timeStamp:ah.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(ai.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[ai])}for(var ag=0,aj;aj=this._listeners[ag];ag++){if(aj[0]==ai.type&&!aj[2]){(aj[1].handleEvent||aj[1]).apply(this,[ai])}}};X.prototype.toString=function(){return"[object XMLHttpRequest]"};X.toString=function(){return"[XMLHttpRequest]"};function W(ag){if(X.onreadystatechange){X.onreadystatechange.apply(ag)}ag.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0})}function ad(ai){var ah=ai.responseXML,ag=ai.responseText;if(ae&&ag&&ah&&!ah.documentElement&&ai.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){ah=new window.ActiveXObject("Microsoft.XMLDOM");ah.async=false;ah.validateOnParse=false;ah.loadXML(ag)}if(ah){if((ae&&ah.parseError!=0)||!ah.documentElement||(ah.documentElement&&ah.documentElement.tagName=="parsererror")){return null}}return ah}function ac(ag){try{ag.responseText=ag._object.responseText}catch(ah){}try{ag.responseXML=ad(ag._object)}catch(ah){}try{ag.status=ag._object.status}catch(ah){}try{ag.statusText=ag._object.statusText}catch(ah){}}function Z(ag){ag._object.onreadystatechange=new window.Function}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(ag,ah){if(!ah){ah=[]}ag.__func=this;ag.__func(ah[0],ah[1],ah[2],ah[3],ah[4]);delete ag.__func}}B.Request.XMLHttpRequest=X})();B.Projection=B.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(W,V){B.Util.extend(this,V);this.projCode=W;if(window.Proj4js){this.proj=new Proj4js.Proj(W)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(V){var Z=V,W=false;if(Z){if(!(Z instanceof B.Projection)){Z=new B.Projection(Z)}if(window.Proj4js&&this.proj.defData&&Z.proj.defData){W=this.proj.defData.replace(this.titleRegEx,"")==Z.proj.defData.replace(this.titleRegEx,"")}else{if(Z.getCode){var X=this.getCode(),Y=Z.getCode();W=X==Y||!!B.Projection.transforms[X]&&B.Projection.transforms[X][Y]===B.Projection.nullTransform}}}return W},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});B.Projection.transforms={};B.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:true},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};B.Projection.addTransform=function(Y,X,W){if(W===B.Projection.nullTransform){var V=B.Projection.defaults[Y];if(V&&!B.Projection.defaults[X]){B.Projection.defaults[X]=V}}if(!B.Projection.transforms[Y]){B.Projection.transforms[Y]={}}B.Projection.transforms[Y][X]=W};B.Projection.transform=function(V,Z,W){if(Z&&W){if(!(Z instanceof B.Projection)){Z=new B.Projection(Z)}if(!(W instanceof B.Projection)){W=new B.Projection(W)}if(Z.proj&&W.proj){V=Proj4js.transform(Z.proj,W.proj,V)}else{var Y=Z.getCode();var aa=W.getCode();var X=B.Projection.transforms;if(X[Y]&&X[Y][aa]){X[Y][aa](V)}}}return V};B.Projection.nullTransform=function(V){return V};(function(){var Z=20037508.34;function ab(ac){ac.x=180*ac.x/Z;ac.y=180/Math.PI*(2*Math.atan(Math.exp((ac.y/Z)*Math.PI))-Math.PI/2);return ac}function W(ac){ac.x=ac.x*Z/180;ac.y=Math.log(Math.tan((90+ac.y)*Math.PI/360))/Math.PI*Z;return ac}function aa(ad,ac){var ak=B.Projection.addTransform;var aj=B.Projection.nullTransform;var ag,ah,ae,ai,af;for(ag=0,ah=ac.length;ag<ah;++ag){ae=ac[ag];ak(ad,ae,W);ak(ae,ad,ab);for(af=ag+1;af<ah;++af){ai=ac[af];ak(ae,ai,aj);ak(ai,ae,aj)}}}var V=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],Y=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],X;for(X=V.length-1;X>=0;--X){aa(V[X],Y)}for(X=Y.length-1;X>=0;--X){aa(Y[X],V)}})();B.Map=B.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:B.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(W,ad){if(arguments.length===1&&typeof W==="object"){ad=W;W=ad&&ad.div}this.tileSize=new B.Size(B.Map.TILE_WIDTH,B.Map.TILE_HEIGHT);this.paddingForPopups=new B.Bounds(15,15,15,15);this.theme=B._getScriptLocation()+"theme/default/style.css";this.options=B.Util.extend({},ad);B.Util.extend(this,ad);var V=this.projection instanceof B.Projection?this.projection.projCode:this.projection;B.Util.applyDefaults(this,B.Projection.defaults[V]);if(this.maxExtent&&!(this.maxExtent instanceof B.Bounds)){this.maxExtent=new B.Bounds(this.maxExtent)}if(this.minExtent&&!(this.minExtent instanceof B.Bounds)){this.minExtent=new B.Bounds(this.minExtent)}if(this.restrictedExtent&&!(this.restrictedExtent instanceof B.Bounds)){this.restrictedExtent=new B.Bounds(this.restrictedExtent)}if(this.center&&!(this.center instanceof B.LonLat)){this.center=new B.LonLat(this.center)}this.layers=[];this.id=B.Util.createUniqueID("OpenLayers.Map_");this.div=B.Util.getElement(W);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}B.Element.addClass(this.div,"olMap");var Y=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=B.Util.createDiv(Y,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new B.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:true});Y=this.id+"_OpenLayers_Container";this.layerContainerDiv=B.Util.createDiv(Y);this.layerContainerDiv.style.width="100px";this.layerContainerDiv.style.height="100px";this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(parseFloat(navigator.appVersion.split("MSIE")[1])<9){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=B.Function.bind(this.updateSize,this);B.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var Z=true;var X=document.getElementsByTagName("link");for(var aa=0,ab=X.length;aa<ab;++aa){if(B.Util.isEquivalentUrl(X.item(aa).href,this.theme)){Z=false;break}}if(Z){var ac=document.createElement("link");ac.setAttribute("rel","stylesheet");ac.setAttribute("type","text/css");ac.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(ac)}}if(this.controls==null){this.controls=[];if(B.Control!=null){if(B.Control.Navigation){this.controls.push(new B.Control.Navigation())}else{if(B.Control.TouchNavigation){this.controls.push(new B.Control.TouchNavigation())}}if(B.Control.Zoom){this.controls.push(new B.Control.Zoom())}else{if(B.Control.PanZoom){this.controls.push(new B.Control.PanZoom())}}if(B.Control.ArgParser){this.controls.push(new B.Control.ArgParser())}if(B.Control.Attribution){this.controls.push(new B.Control.Attribution())}}}for(var aa=0,ab=this.controls.length;aa<ab;aa++){this.addControlToMap(this.controls[aa])}this.popups=[];this.unloadDestroy=B.Function.bind(this.destroy,this);B.Event.observe(window,"unload",this.unloadDestroy);if(ad&&ad.layers){delete this.center;this.addLayers(ad.layers);if(ad.center&&!this.getCenter()){this.setCenter(ad.center,ad.zoom)}}},getViewport:function(){return this.viewPortDiv},render:function(V){this.div=B.Util.getElement(V);B.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}if(this.panTween){this.panTween.stop();this.panTween=null}B.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){B.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;if(this.controls!=null){for(var V=this.controls.length-1;V>=0;--V){this.controls[V].destroy()}this.controls=null}if(this.layers!=null){for(var V=this.layers.length-1;V>=0;--V){this.layers[V].destroy(false)}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null;this.options=null},setOptions:function(V){var W=this.minPx&&V.restrictedExtent!=this.restrictedExtent;B.Util.extend(this,V);W&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:true})},getTileSize:function(){return this.tileSize},getBy:function(Z,X,V){var Y=(typeof V.test=="function");var W=B.Array.filter(this[Z],function(aa){return aa[X]==V||(Y&&V.test(aa[X]))});return W},getLayersBy:function(W,V){return this.getBy("layers",W,V)},getLayersByName:function(V){return this.getLayersBy("name",V)},getLayersByClass:function(V){return this.getLayersBy("CLASS_NAME",V)},getControlsBy:function(W,V){return this.getBy("controls",W,V)},getControlsByClass:function(V){return this.getControlsBy("CLASS_NAME",V)},getLayer:function(Z){var W=null;for(var Y=0,V=this.layers.length;Y<V;Y++){var X=this.layers[Y];if(X.id==Z){W=X;break}}return W},setLayerZIndex:function(W,V){W.setZIndex(this.Z_INDEX_BASE[W.isBaseLayer?"BaseLayer":"Overlay"]+V*5)},resetLayersZIndex:function(){for(var X=0,V=this.layers.length;X<V;X++){var W=this.layers[X];this.setLayerZIndex(W,X)}},addLayer:function(X){for(var W=0,V=this.layers.length;W<V;W++){if(this.layers[W]==X){return false}}if(this.events.triggerEvent("preaddlayer",{layer:X})===false){return false}if(this.allOverlays){X.isBaseLayer=false}X.div.className="olLayerDiv";X.div.style.overflow="";this.setLayerZIndex(X,this.layers.length);if(X.isFixed){this.viewPortDiv.appendChild(X.div)}else{this.layerContainerDiv.appendChild(X.div)}this.layers.push(X);X.setMap(this);if(X.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(X)}else{X.setVisibility(false)}}else{X.redraw()}this.events.triggerEvent("addlayer",{layer:X});X.events.triggerEvent("added",{map:this,layer:X});X.afterAdd();return true},addLayers:function(X){for(var W=0,V=X.length;W<V;W++){this.addLayer(X[W])}},removeLayer:function(X,Z){if(this.events.triggerEvent("preremovelayer",{layer:X})===false){return}if(Z==null){Z=true}if(X.isFixed){this.viewPortDiv.removeChild(X.div)}else{this.layerContainerDiv.removeChild(X.div)}B.Util.removeItem(this.layers,X);X.removeMap(this);X.map=null;if(this.baseLayer==X){this.baseLayer=null;if(Z){for(var W=0,V=this.layers.length;W<V;W++){var Y=this.layers[W];if(Y.isBaseLayer||this.allOverlays){this.setBaseLayer(Y);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:X});X.events.triggerEvent("removed",{map:this,layer:X})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(V){return B.Util.indexOf(this.layers,V)},setLayerIndex:function(Y,W){var Z=this.getLayerIndex(Y);if(W<0){W=0}else{if(W>this.layers.length){W=this.layers.length}}if(Z!=W){this.layers.splice(Z,1);this.layers.splice(W,0,Y);for(var X=0,V=this.layers.length;X<V;X++){this.setLayerZIndex(this.layers[X],X)}this.events.triggerEvent("changelayer",{layer:Y,property:"order"});if(this.allOverlays){if(W===0){this.setBaseLayer(Y)}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}}},raiseLayer:function(W,X){var V=this.getLayerIndex(W)+X;this.setLayerIndex(W,V)},setBaseLayer:function(X){if(X!=this.baseLayer){if(B.Util.indexOf(this.layers,X)!=-1){var V=this.getCachedCenter();var Y=B.Util.getResolutionFromScale(this.getScale(),X.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=X;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true);if(this.baseLayer.inRange===false){this.baseLayer.redraw()}}if(V!=null){var W=this.getZoomForResolution(Y||this.resolution,true);this.setCenter(V,W,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(W,V){this.controls.push(W);this.addControlToMap(W,V)},addControls:function(W,ab){var Z=(arguments.length===1)?[]:ab;for(var Y=0,V=W.length;Y<V;Y++){var aa=W[Y];var X=(Z[Y])?Z[Y]:null;this.addControl(aa,X)}},addControlToMap:function(W,V){W.outsideViewport=(W.div!=null);if(this.displayProjection&&!W.displayProjection){W.displayProjection=this.displayProjection}W.setMap(this);var X=W.draw(V);if(X){if(!W.outsideViewport){X.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(X)}}if(W.autoActivate){W.activate()}},getControl:function(Z){var W=null;for(var X=0,V=this.controls.length;X<V;X++){var Y=this.controls[X];if(Y.id==Z){W=Y;break}}return W},removeControl:function(V){if((V)&&(V==this.getControl(V.id))){if(V.div&&(V.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(V.div)}B.Util.removeItem(this.controls,V)}},addPopup:function(V,Y){if(Y){for(var W=this.popups.length-1;W>=0;--W){this.removePopup(this.popups[W])}}V.map=this;this.popups.push(V);var X=V.draw();if(X){X.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(X)}},removePopup:function(V){B.Util.removeItem(this.popups,V);if(V.div){try{this.layerContainerDiv.removeChild(V.div)}catch(W){}}V.map=null},getSize:function(){var V=null;if(this.size!=null){V=this.size.clone()}return V},updateSize:function(){var X=this.getCurrentSize();if(X&&!isNaN(X.h)&&!isNaN(X.w)){this.events.clearMouseCache();var aa=this.getSize();if(aa==null){this.size=aa=X}if(!X.equals(aa)){this.size=X;for(var Y=0,W=this.layers.length;Y<W;Y++){this.layers[Y].onMapResize()}var V=this.getCachedCenter();if(this.baseLayer!=null&&V!=null){var Z=this.getZoom();this.zoom=null;this.setCenter(V,Z)}}}},getCurrentSize:function(){var V=new B.Size(this.div.clientWidth,this.div.clientHeight);if(V.w==0&&V.h==0||isNaN(V.w)&&isNaN(V.h)){V.w=this.div.offsetWidth;V.h=this.div.offsetHeight}if(V.w==0&&V.h==0||isNaN(V.w)&&isNaN(V.h)){V.w=parseInt(this.div.style.width);V.h=parseInt(this.div.style.height)}return V},calculateBounds:function(V,W){var X=null;if(V==null){V=this.getCachedCenter()}if(W==null){W=this.getResolution()}if((V!=null)&&(W!=null)){var Y=(this.size.w*W)/2;var Z=(this.size.h*W)/2;X=new B.Bounds(V.lon-Y,V.lat-Z,V.lon+Y,V.lat+Z)}return X},getCenter:function(){var V=null;var W=this.getCachedCenter();if(W){V=W.clone()}return V},getCachedCenter:function(){if(!this.center&&this.size){this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})}return this.center},getZoom:function(){return this.zoom},pan:function(Y,X,Z){Z=B.Util.applyDefaults(Z,{animate:true,dragging:false});if(Z.dragging){if(Y!=0||X!=0){this.moveByPx(Y,X)}}else{var aa=this.getViewPortPxFromLonLat(this.getCachedCenter());var W=aa.add(Y,X);if(this.dragging||!W.equals(aa)){var V=this.getLonLatFromViewPortPx(W);if(Z.animate){this.panTo(V)}else{this.moveTo(V);if(this.dragging){this.dragging=false;this.events.triggerEvent("moveend")}}}}},panTo:function(Y){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(Y)){if(!this.panTween){this.panTween=new B.Tween(this.panMethod)}var V=this.getCachedCenter();if(Y.equals(V)){return}var aa=this.getPixelFromLonLat(V);var Z=this.getPixelFromLonLat(Y);var W={x:Z.x-aa.x,y:Z.y-aa.y};var X={x:0,y:0};this.panTween.start({x:0,y:0},W,this.panDuration,{callbacks:{eachStep:B.Function.bind(function(ac){var ab=ac.x-X.x,ad=ac.y-X.y;this.moveByPx(ab,ad);X.x=Math.round(ac.x);X.y=Math.round(ac.y)},this),done:B.Function.bind(function(ab){this.moveTo(Y);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(Y)}},setCenter:function(X,V,W,Y){this.panTween&&this.panTween.stop();this.moveTo(X,V,{dragging:W,forceZoomChange:Y})},moveByPx:function(ag,af){var aa=this.size.w/2;var V=this.size.h/2;var ad=aa+ag;var ac=V+af;var W=this.baseLayer.wrapDateLine;var ae=0;var ab=0;if(this.restrictedExtent){ae=aa;ab=V;W=false}ag=W||ad<=this.maxPx.x-ae&&ad>=this.minPx.x+ae?Math.round(ag):0;af=ac<=this.maxPx.y-ab&&ac>=this.minPx.y+ab?Math.round(af):0;if(ag||af){if(!this.dragging){this.dragging=true;this.events.triggerEvent("movestart")}this.center=null;if(ag){this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-ag+"px";this.minPx.x-=ag;this.maxPx.x-=ag}if(af){this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-af+"px";this.minPx.y-=af;this.maxPx.y-=af}var Y,X,Z;for(X=0,Z=this.layers.length;X<Z;++X){Y=this.layers[X];if(Y.visibility&&(Y===this.baseLayer||Y.inRange)){Y.moveByPx(ag,af);Y.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(aa){var X,V=this.baseLayer.resolutions,W=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(aa)>W){for(var Y=aa|0,Z=V.length;Y<Z;++Y){if(V[Y]<=W){aa=Y;break}}}return aa},moveTo:function(ac,W,Z){if(ac!=null&&!(ac instanceof B.LonLat)){ac=new B.LonLat(ac)}if(!Z){Z={}}if(W!=null){W=parseFloat(W);if(!this.fractionalZoom){W=Math.round(W)}}if(this.baseLayer.wrapDateLine){var ag=W;W=this.adjustZoom(W);if(W!==ag){ac=this.getCenter()}}var aj=Z.dragging||this.dragging;var ae=Z.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(ac)){ac=this.maxExtent.getCenterLonLat();this.center=ac.clone()}if(this.restrictedExtent!=null){if(ac==null){ac=this.center}if(W==null){W=this.getZoom()}var ak=this.getResolutionForZoom(W);var ah=this.calculateBounds(ac,ak);if(!this.restrictedExtent.containsBounds(ah)){var aq=this.restrictedExtent.getCenterLonLat();if(ah.getWidth()>this.restrictedExtent.getWidth()){ac=new B.LonLat(aq.lon,ac.lat)}else{if(ah.left<this.restrictedExtent.left){ac=ac.add(this.restrictedExtent.left-ah.left,0)}else{if(ah.right>this.restrictedExtent.right){ac=ac.add(this.restrictedExtent.right-ah.right,0)}}}if(ah.getHeight()>this.restrictedExtent.getHeight()){ac=new B.LonLat(ac.lon,aq.lat)}else{if(ah.bottom<this.restrictedExtent.bottom){ac=ac.add(0,this.restrictedExtent.bottom-ah.bottom)}else{if(ah.top>this.restrictedExtent.top){ac=ac.add(0,this.restrictedExtent.top-ah.top)}}}}}var af=ae||((this.isValidZoomLevel(W))&&(W!=this.getZoom()));var ab=(this.isValidLonLat(ac))&&(!ac.equals(this.center));if(af||ab||aj){aj||this.events.triggerEvent("movestart");if(ab){if(!af&&this.center){this.centerLayerContainer(ac)}this.center=ac.clone()}var ar=af?this.getResolutionForZoom(W):this.getResolution();if(af||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";var ai=this.getMaxExtent({restricted:true});var Y=ai.getCenterLonLat();var ad=this.center.lon-Y.lon;var X=Y.lat-this.center.lat;var ao=Math.round(ai.getWidth()/ar);var an=Math.round(ai.getHeight()/ar);this.minPx={x:(this.size.w-ao)/2-ad/ar,y:(this.size.h-an)/2-X/ar};this.maxPx={x:this.minPx.x+Math.round(ai.getWidth()/ar),y:this.minPx.y+Math.round(ai.getHeight()/ar)}}if(af){this.zoom=W;this.resolution=ar}var aa=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(aa,af,Z.dragging);Z.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:af})}aa=this.baseLayer.getExtent();for(var al=this.layers.length-1;al>=0;--al){var ap=this.layers[al];if(ap!==this.baseLayer&&!ap.isBaseLayer){var V=ap.calculateInRange();if(ap.inRange!=V){ap.inRange=V;if(!V){ap.display(false)}this.events.triggerEvent("changelayer",{layer:ap,property:"visibility"})}if(V&&ap.visibility){ap.moveTo(aa,af,Z.dragging);Z.dragging||ap.events.triggerEvent("moveend",{zoomChanged:af})}}}this.events.triggerEvent("move");aj||this.events.triggerEvent("moveend");if(af){for(var al=0,am=this.popups.length;al<am;al++){this.popups[al].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(X){var Y=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var ab=this.getViewPortPxFromLonLat(X);if((Y!=null)&&(ab!=null)){var V=parseInt(this.layerContainerDiv.style.left);var W=parseInt(this.layerContainerDiv.style.top);var aa=Math.round(Y.x-ab.x);var Z=Math.round(Y.y-ab.y);this.layerContainerDiv.style.left=aa+"px";this.layerContainerDiv.style.top=Z+"px";var ad=V-aa;var ac=W-Z;this.minPx.x-=ad;this.maxPx.x-=ad;this.minPx.y-=ac;this.maxPx.y-=ac}},isValidZoomLevel:function(V){return((V!=null)&&(V>=0)&&(V<this.getNumZoomLevels()))},isValidLonLat:function(Y){var X=false;if(Y!=null){var V=this.getMaxExtent();var W=this.baseLayer.wrapDateLine&&V;X=V.containsLonLat(Y,{worldBounds:W})}return X},getProjection:function(){var V=this.getProjectionObject();return V?V.getCode():null},getProjectionObject:function(){var V=null;if(this.baseLayer!=null){V=this.baseLayer.projection}return V},getMaxResolution:function(){var V=null;if(this.baseLayer!=null){V=this.baseLayer.maxResolution}return V},getMaxExtent:function(W){var V=null;if(W&&W.restricted&&this.restrictedExtent){V=this.restrictedExtent}else{if(this.baseLayer!=null){V=this.baseLayer.maxExtent}}return V},getNumZoomLevels:function(){var V=null;if(this.baseLayer!=null){V=this.baseLayer.numZoomLevels}return V},getExtent:function(){var V=null;if(this.baseLayer!=null){V=this.baseLayer.getExtent()}return V},getResolution:function(){var V=null;if(this.baseLayer!=null){V=this.baseLayer.getResolution()}else{if(this.allOverlays===true&&this.layers.length>0){V=this.layers[0].getResolution()}}return V},getUnits:function(){var V=null;if(this.baseLayer!=null){V=this.baseLayer.units}return V},getScale:function(){var X=null;if(this.baseLayer!=null){var W=this.getResolution();var V=this.baseLayer.units;X=B.Util.getScaleFromResolution(W,V)}return X},getZoomForExtent:function(X,W){var V=null;if(this.baseLayer!=null){V=this.baseLayer.getZoomForExtent(X,W)}return V},getResolutionForZoom:function(W){var V=null;if(this.baseLayer){V=this.baseLayer.getResolutionForZoom(W)}return V},getZoomForResolution:function(V,X){var W=null;if(this.baseLayer!=null){W=this.baseLayer.getZoomForResolution(V,X)}return W},zoomTo:function(V){if(this.isValidZoomLevel(V)){this.setCenter(null,V)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(Y,X){if(!(Y instanceof B.Bounds)){Y=new B.Bounds(Y)}var W=Y.getCenterLonLat();if(this.baseLayer.wrapDateLine){var V=this.getMaxExtent();Y=Y.clone();while(Y.right<Y.left){Y.right+=V.getWidth()}W=Y.getCenterLonLat().wrapDateLine(V)}this.setCenter(W,this.getZoomForExtent(Y,X))},zoomToMaxExtent:function(X){var W=(X)?X.restricted:true;var V=this.getMaxExtent({restricted:W});this.zoomToExtent(V)},zoomToScale:function(ab,Y){var W=B.Util.getResolutionFromScale(ab,this.baseLayer.units);var Z=(this.size.w*W)/2;var aa=(this.size.h*W)/2;var V=this.getCachedCenter();var X=new B.Bounds(V.lon-Z,V.lat-aa,V.lon+Z,V.lat+aa);this.zoomToExtent(X,Y)},getLonLatFromViewPortPx:function(V){var W=null;if(this.baseLayer!=null){W=this.baseLayer.getLonLatFromViewPortPx(V)}return W},getViewPortPxFromLonLat:function(W){var V=null;if(this.baseLayer!=null){V=this.baseLayer.getViewPortPxFromLonLat(W)}return V},getLonLatFromPixel:function(V){return this.getLonLatFromViewPortPx(V)},getPixelFromLonLat:function(W){var V=this.getViewPortPxFromLonLat(W);V.x=Math.round(V.x);V.y=Math.round(V.y);return V},getGeodesicPixelSize:function(ab){var Y=ab?this.getLonLatFromPixel(ab):(this.getCachedCenter()||new B.LonLat(0,0));var Z=this.getResolution();var X=Y.add(-Z/2,0);var ad=Y.add(Z/2,0);var W=Y.add(0,-Z/2);var aa=Y.add(0,Z/2);var ac=new B.Projection("EPSG:4326");var V=this.getProjectionObject()||ac;if(!V.equals(ac)){X.transform(V,ac);ad.transform(V,ac);W.transform(V,ac);aa.transform(V,ac)}return new B.Size(B.Util.distVincenty(X,ad),B.Util.distVincenty(W,aa))},getViewPortPxFromLayerPx:function(Y){var X=null;if(Y!=null){var W=parseInt(this.layerContainerDiv.style.left);var V=parseInt(this.layerContainerDiv.style.top);X=Y.add(W,V)}return X},getLayerPxFromViewPortPx:function(X){var Y=null;if(X!=null){var W=-parseInt(this.layerContainerDiv.style.left);var V=-parseInt(this.layerContainerDiv.style.top);Y=X.add(W,V);if(isNaN(Y.x)||isNaN(Y.y)){Y=null}}return Y},getLonLatFromLayerPx:function(V){V=this.getViewPortPxFromLayerPx(V);return this.getLonLatFromViewPortPx(V)},getLayerPxFromLonLat:function(W){var V=this.getPixelFromLonLat(W);return this.getLayerPxFromViewPortPx(V)},CLASS_NAME:"OpenLayers.Map"});B.Map.TILE_WIDTH=256;B.Map.TILE_HEIGHT=256;B.bases.Map=B.Map;B.Map=B.Class(B.Map,{resetLayersZIndex:function(){}});p.inheritsStatic(B.bases.Map,B.Map);B.Layer=B.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,metadata:null,initialize:function(W,V){this.metadata={};this.addOptions(V);this.name=W;if(this.id==null){this.id=B.Util.createUniqueID(this.CLASS_NAME+"_");this.div=B.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new B.Events(this,this.div);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}},destroy:function(V){if(V==null){V=true}if(this.map!=null){this.map.removeLayer(this,V)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(V){if(V==null){V=new B.Layer(this.name,this.getOptions())}B.Util.applyDefaults(V,this);V.map=null;return V},getOptions:function(){var V={};for(var W in this.options){V[W]=this[W]}return V},setName:function(V){if(V!=this.name){this.name=V;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(Z,V){if(this.options==null){this.options={}}if(Z){if(typeof Z.projection=="string"){Z.projection=new B.Projection(Z.projection)}if(Z.projection){B.Util.applyDefaults(Z,B.Projection.defaults[Z.projection.getCode()])}if(Z.maxExtent&&!(Z.maxExtent instanceof B.Bounds)){Z.maxExtent=new B.Bounds(Z.maxExtent)}if(Z.minExtent&&!(Z.minExtent instanceof B.Bounds)){Z.minExtent=new B.Bounds(Z.minExtent)}}B.Util.extend(this.options,Z);B.Util.extend(this,Z);if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()}if(this.map){var W=this.map.getResolution();var X=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var Y in Z){if(Z.hasOwnProperty(Y)&&B.Util.indexOf(X,Y)>=0){this.initResolutions();if(V&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(W),false,true);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}}},onMapResize:function(){},redraw:function(){var W=false;if(this.map){this.inRange=this.calculateInRange();var X=this.getExtent();if(X&&this.inRange&&this.visibility){var V=true;this.moveTo(X,V,false);this.events.triggerEvent("moveend",{zoomChanged:V});W=true}}return W},moveTo:function(W,V,X){var Y=this.visibility;if(!this.isBaseLayer){Y=Y&&this.inRange}this.display(Y)},moveByPx:function(W,V){},setMap:function(W){if(this.map==null){this.map=W;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new B.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var V=((this.visibility)&&(this.inRange));this.div.style.display=V?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(V){},getImageSize:function(V){return(this.imageSize||this.tileSize)},setTileSize:function(V){var W=(V)?V:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=W;if(this.gutter){this.imageSize=new B.Size(W.w+(2*this.gutter),W.h+(2*this.gutter))}},getVisibility:function(){return this.visibility},setVisibility:function(V){if(V!=this.visibility){this.visibility=V;this.display(V);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(V){if(V!=(this.div.style.display!="none")){this.div.style.display=(V&&this.calculateInRange())?"block":"none"}},calculateInRange:function(){var W=false;if(this.alwaysInRange){W=true}else{if(this.map){var V=this.map.getResolution();W=((V>=this.minResolution)&&(V<=this.maxResolution))}}return W},setIsBaseLayer:function(V){if(V!=this.isBaseLayer){this.isBaseLayer=V;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var Z,V,ac;var aa={},Y=true;for(Z=0,V=this.RESOLUTION_PROPERTIES.length;Z<V;Z++){ac=this.RESOLUTION_PROPERTIES[Z];aa[ac]=this.options[ac];if(Y&&this.options[ac]){Y=false}}if(this.alwaysInRange==null){this.alwaysInRange=Y}if(aa.resolutions==null){aa.resolutions=this.resolutionsFromScales(aa.scales)}if(aa.resolutions==null){aa.resolutions=this.calculateResolutions(aa)}if(aa.resolutions==null){for(Z=0,V=this.RESOLUTION_PROPERTIES.length;Z<V;Z++){ac=this.RESOLUTION_PROPERTIES[Z];aa[ac]=this.options[ac]!=null?this.options[ac]:this.map[ac]}if(aa.resolutions==null){aa.resolutions=this.resolutionsFromScales(aa.scales)}if(aa.resolutions==null){aa.resolutions=this.calculateResolutions(aa)}}var X;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){X=this.options.maxResolution}if(this.options.minScale){X=B.Util.getResolutionFromScale(this.options.minScale,this.units)}var W;if(this.options.minResolution&&this.options.minResolution!=="auto"){W=this.options.minResolution}if(this.options.maxScale){W=B.Util.getResolutionFromScale(this.options.maxScale,this.units)}if(aa.resolutions){aa.resolutions.sort(function(ae,ad){return(ad-ae)});if(!X){X=aa.resolutions[0]}if(!W){var ab=aa.resolutions.length-1;W=aa.resolutions[ab]}}this.resolutions=aa.resolutions;if(this.resolutions){V=this.resolutions.length;this.scales=new Array(V);for(Z=0;Z<V;Z++){this.scales[Z]=B.Util.getScaleFromResolution(this.resolutions[Z],this.units)}this.numZoomLevels=V}this.minResolution=W;if(W){this.maxScale=B.Util.getScaleFromResolution(W,this.units)}this.maxResolution=X;if(X){this.minScale=B.Util.getScaleFromResolution(X,this.units)}},resolutionsFromScales:function(Y){if(Y==null){return}var W,X,V;V=Y.length;W=new Array(V);for(X=0;X<V;X++){W[X]=B.Util.getResolutionFromScale(Y[X],this.units)}return W},calculateResolutions:function(ae){var af,ad,ab;var ag=ae.maxResolution;if(ae.minScale!=null){ag=B.Util.getResolutionFromScale(ae.minScale,this.units)}else{if(ag=="auto"&&this.maxExtent!=null){af=this.map.getSize();ad=this.maxExtent.getWidth()/af.w;ab=this.maxExtent.getHeight()/af.h;ag=Math.max(ad,ab)}}var aa=ae.minResolution;if(ae.maxScale!=null){aa=B.Util.getResolutionFromScale(ae.maxScale,this.units)}else{if(ae.minResolution=="auto"&&this.minExtent!=null){af=this.map.getSize();ad=this.minExtent.getWidth()/af.w;ab=this.minExtent.getHeight()/af.h;aa=Math.max(ad,ab)}}if(typeof ag!=="number"&&typeof aa!=="number"&&this.maxExtent!=null){var ah=this.map.getTileSize();ag=Math.max(this.maxExtent.getWidth()/ah.w,this.maxExtent.getHeight()/ah.h)}var V=ae.maxZoomLevel;var W=ae.numZoomLevels;if(typeof aa==="number"&&typeof ag==="number"&&W===undefined){var ac=ag/aa;W=Math.floor(Math.log(ac)/Math.log(2))+1}else{if(W===undefined&&V!=null){W=V+1}}if(typeof W!=="number"||W<=0||(typeof ag!=="number"&&typeof aa!=="number")){return}var Y=new Array(W);var X=2;if(typeof aa=="number"&&typeof ag=="number"){X=Math.pow((ag/aa),(1/(W-1)))}var Z;if(typeof ag==="number"){for(Z=0;Z<W;Z++){Y[Z]=ag/Math.pow(X,Z)}}else{for(Z=0;Z<W;Z++){Y[W-1-Z]=aa*Math.pow(X,Z)}}return Y},getResolution:function(){var V=this.map.getZoom();return this.getResolutionForZoom(V)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(W,X){var Y=this.map.getSize();var V=Math.max(W.getWidth()/Y.w,W.getHeight()/Y.h);return this.getZoomForResolution(V,X)},getDataExtent:function(){},getResolutionForZoom:function(X){X=Math.max(0,Math.min(X,this.resolutions.length-1));var W;if(this.map.fractionalZoom){var V=Math.floor(X);var Y=Math.ceil(X);W=this.resolutions[V]-((X-V)*(this.resolutions[V]-this.resolutions[Y]))}else{W=this.resolutions[Math.round(X)]}return W},getZoomForResolution:function(Z,W){var ah,aa,ab;if(this.map.fractionalZoom){var ae=0;var X=this.resolutions.length-1;var Y=this.resolutions[ae];var V=this.resolutions[X];var ad;for(aa=0,ab=this.resolutions.length;aa<ab;++aa){ad=this.resolutions[aa];if(ad>=Z){Y=ad;ae=aa}if(ad<=Z){V=ad;X=aa;break}}var ac=Y-V;if(ac>0){ah=ae+((Y-Z)/ac)}else{ah=ae}}else{var af;var ag=Number.POSITIVE_INFINITY;for(aa=0,ab=this.resolutions.length;aa<ab;aa++){if(W){af=Math.abs(this.resolutions[aa]-Z);if(af>ag){break}ag=af}else{if(this.resolutions[aa]<Z){break}}}ah=Math.max(0,aa-1)}return ah},getLonLatFromViewPortPx:function(W){var Y=null;var aa=this.map;if(W!=null&&aa.minPx){var X=aa.getResolution();var V=aa.getMaxExtent({restricted:true});var ab=(W.x-aa.minPx.x)*X+V.left;var Z=(aa.minPx.y-W.y)*X+V.top;Y=new B.LonLat(ab,Z);if(this.wrapDateLine){Y=Y.wrapDateLine(this.maxExtent)}}return Y},getViewPortPxFromLonLat:function(Y,V){var W=null;if(Y!=null){V=V||this.map.getResolution();var X=this.map.calculateBounds(null,V);W=new B.Pixel((1/V*(Y.lon-X.left)),(1/V*(X.top-Y.lat)))}return W},setOpacity:function(W){if(W!=this.opacity){this.opacity=W;var aa=this.div.childNodes;for(var Y=0,V=aa.length;Y<V;++Y){var X=aa[Y].firstChild||aa[Y];var Z=aa[Y].lastChild;if(Z&&Z.nodeName.toLowerCase()==="iframe"){X=Z.parentNode}B.Util.modifyDOMElement(X,null,null,null,null,null,null,W)}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(V){this.div.style.zIndex=V},adjustBounds:function(W){if(this.gutter){var V=this.gutter*this.map.getResolution();W=new B.Bounds(W.left-V,W.bottom-V,W.right+V,W.top+V)}if(this.wrapDateLine){var X={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};W=W.wrapDateLine(this.maxExtent,X)}return W},CLASS_NAME:"OpenLayers.Layer"});B.bases.Layer=B.Layer;B.Layer=B.Class(B.Layer,{initialize:function(W,V){B.bases.Layer.prototype.initialize.apply(this,arguments)},moveTo:function(W,V,X){B.bases.Layer.prototype.moveTo.apply(this,arguments)},reprojectFeatures:function(V){for(var W in this.features){if(this.features[W].geometry){this.features[W].geometry.transform(this.projection,V)}}for(W in this.markers){if(this.markers[W].lonlat){this.markers[W].lonlat.transform(this.projection,V)}}this.projection=V}});p.inheritsStatic(B.bases.Layer,B.Layer);B.Icon=B.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(V,W,Y,X){this.url=V;this.size=W||{w:20,h:20};this.offset=Y||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=X;var Z=B.Util.createUniqueID("OL_Icon_");this.imageDiv=B.Util.createAlphaImageDiv(Z)},destroy:function(){this.erase();B.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new B.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(V){if(V!=null){this.size=V}this.draw()},setUrl:function(V){if(V!=null){this.url=V}this.draw()},draw:function(V){B.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(V);return this.imageDiv},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){B.Element.remove(this.imageDiv)}},setOpacity:function(V){B.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,V)},moveTo:function(V){if(V!=null){this.px=V}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}B.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})}}},display:function(V){this.imageDiv.style.display=(V)?"":"none"},isDrawn:function(){var V=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return V},CLASS_NAME:"OpenLayers.Icon"});B.Marker=B.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(X,W){this.lonlat=X;var V=(W)?W:B.Marker.defaultIcon();if(this.icon==null){this.icon=V}else{this.icon.url=V.url;this.icon.size=V.size;this.icon.offset=V.offset;this.icon.calculateOffset=V.calculateOffset}this.events=new B.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(V){return this.icon.draw(V)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveTo:function(V){if((V!=null)&&(this.icon!=null)){this.icon.moveTo(V)}this.lonlat=this.map.getLonLatFromLayerPx(V)},isDrawn:function(){var V=(this.icon&&this.icon.isDrawn());return V},onScreen:function(){var W=false;if(this.map){var V=this.map.getExtent();W=V.containsLonLat(this.lonlat)}return W},inflate:function(V){if(this.icon){this.icon.setSize({w:this.icon.size.w*V,h:this.icon.size.h*V})}},setOpacity:function(V){this.icon.setOpacity(V)},setUrl:function(V){this.icon.setUrl(V)},display:function(V){this.icon.display(V)},CLASS_NAME:"OpenLayers.Marker"});B.Marker.defaultIcon=function(){return new B.Icon(B.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};B.Marker.Box=B.Class(B.Marker,{bounds:null,div:null,initialize:function(W,X,V){this.bounds=W;this.div=B.Util.createDiv();this.div.style.overflow="hidden";this.events=new B.Events(this,this.div);this.setBorder(X,V)},destroy:function(){this.bounds=null;this.div=null;B.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(V,W){if(!V){V="red"}if(!W){W=2}this.div.style.border=W+"px solid "+V},draw:function(V,W){B.Util.modifyDOMElement(this.div,null,V,W);return this.div},onScreen:function(){var W=false;if(this.map){var V=this.map.getExtent();W=V.containsBounds(this.bounds,true,true)}return W},display:function(V){this.div.style.display=(V)?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});B.Tile=B.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(Z,V,aa,X,Y,W){this.layer=Z;this.position=V.clone();this.setBounds(aa);this.url=X;if(Y){this.size=Y.clone()}this.id=B.Util.createUniqueID("Tile_");B.Util.extend(this,W);this.events=new B.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.eventListeners=null;this.events=null},draw:function(W){if(!W){this.clear()}var V=this.shouldDraw();if(V&&!W){V=this.events.triggerEvent("beforedraw")!==false}return V},shouldDraw:function(){var W=false,V=this.layer.maxExtent;if(V){var Y=this.layer.map;var X=Y.baseLayer.wrapDateLine&&Y.getMaxExtent();if(this.bounds.intersectsBounds(V,{inclusive:false,worldBounds:X})){W=true}}return W||this.layer.displayOutsideMaxExtent},setBounds:function(X){X=X.clone();if(this.layer.map.baseLayer.wrapDateLine){var W=this.layer.map.getMaxExtent(),V=this.layer.map.getResolution();X=X.wrapDateLine(W,{leftTolerance:V,rightTolerance:V})}this.bounds=X},moveTo:function(W,V,X){if(X==null){X=true}this.setBounds(W);this.position=V.clone();if(X){this.draw()}},clear:function(V){},CLASS_NAME:"OpenLayers.Tile"});B.Tile.Image=B.Class(B.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(Z,V,aa,X,Y,W){B.Tile.prototype.initialize.apply(this,arguments);this.url=X;this.layerAlphaHack=this.layer.alpha&&B.Util.alphaHack();if(this.maxGetUrlLength!=null||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div");this.frame.style.position="absolute";this.frame.style.overflow="hidden"}if(this.maxGetUrlLength!=null){B.Util.extend(this,B.Tile.Image.IFrame)}},destroy:function(){if(this.imgDiv){this.clear();this.imgDiv=null;this.frame=null}this.asyncRequestId=null;B.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var V=B.Tile.prototype.draw.apply(this,arguments);if(V){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}if(this.isLoading){this._loadEvent="reload"}else{this.isLoading=true;this._loadEvent="loadstart"}this.positionTile();this.renderTile()}else{this.unload()}return V},renderTile:function(){this.layer.div.appendChild(this.getTile());if(this.layer.async){var V=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(W){if(V==this.asyncRequestId){this.url=W;this.initImage()}},this)}else{this.url=this.layer.getURL(this.bounds);this.initImage()}},positionTile:function(){var W=this.getTile().style,V=this.frame?this.size:this.layer.getImageSize(this.bounds);W.left=this.position.x+"%";W.top=this.position.y+"%";W.width=V.w+"%";W.height=V.h+"%"},clear:function(){B.Tile.prototype.clear.apply(this,arguments);var V=this.imgDiv;if(V){B.Event.stopObservingElement(V);var W=this.getTile();if(W.parentNode===this.layer.div){this.layer.div.removeChild(W)}this.setImgSrc();if(this.layerAlphaHack===true){V.style.filter=""}B.Element.removeClass(V,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img");this.imgDiv.className="olTileImage";this.imgDiv.galleryImg="no";var V=this.imgDiv.style;if(this.frame){var X=0,W=0;if(this.layer.gutter){X=this.layer.gutter/this.layer.tileSize.w*100;W=this.layer.gutter/this.layer.tileSize.h*100}V.left=-X+"%";V.top=-W+"%";V.width=(2*X+100)+"%";V.height=(2*W+100)+"%"}V.visibility="hidden";V.opacity=0;if(this.layer.opacity<1){V.filter="alpha(opacity="+(this.layer.opacity*100)+")"}V.position="absolute";if(this.layerAlphaHack){V.paddingTop=V.height;V.height="0";V.width="100%"}if(this.frame){this.frame.appendChild(this.imgDiv)}}return this.imgDiv},initImage:function(){this.events.triggerEvent(this._loadEvent);var V=this.getImage();if(this.url&&V.getAttribute("src")==this.url){this.onImageLoad()}else{var W=B.Function.bind(function(){B.Event.stopObservingElement(V);B.Event.observe(V,"load",B.Function.bind(this.onImageLoad,this));B.Event.observe(V,"error",B.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)},this);if(V.getAttribute("src")==this.blankImageUrl){W()}else{B.Event.observe(V,"load",W);B.Event.observe(V,"error",W);if(this.crossOriginKeyword){V.removeAttribute("crossorigin")}V.src=this.blankImageUrl}}},setImgSrc:function(W){var V=this.imgDiv;V.style.visibility="hidden";V.style.opacity=0;if(W){if(this.crossOriginKeyword){if(W.substr(0,5)!=="data:"){V.setAttribute("crossorigin",this.crossOriginKeyword)}else{V.removeAttribute("crossorigin")}}V.src=W}},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(!this.imgDiv||this.isLoading){return}var V;if(this.frame){V=this.frame.cloneNode(false);V.appendChild(this.imgDiv)}else{V=this.imgDiv}this.imgDiv=null;return V},onImageLoad:function(){var W=this.imgDiv;B.Event.stopObservingElement(W);W.style.visibility="inherit";W.style.opacity=this.layer.opacity;this.isLoading=false;this.canvasContext=null;this.events.triggerEvent("loadend");if(parseFloat(navigator.appVersion.split("MSIE")[1])<7&&this.layer&&this.layer.div){var X=document.createElement("span");X.style.display="none";var V=this.layer.div;V.appendChild(X);window.setTimeout(function(){X.parentNode===V&&X.parentNode.removeChild(X)},0)}if(this.layerAlphaHack===true){W.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+W.src+"', sizingMethod='scale')"}},onImageError:function(){var V=this.imgDiv;if(V.src!=null){this.imageReloadAttempts++;if(this.imageReloadAttempts<=B.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))}else{B.Element.addClass(V,"olImageLoadError");this.events.triggerEvent("loaderror");this.onImageLoad()}}},getCanvasContext:function(){if(B.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var V=document.createElement("canvas");V.width=this.size.w;V.height=this.size.h;this.canvasContext=V.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});B.Tile.Image.IFrame={useIFrame:null,draw:function(){var V=B.Tile.Image.prototype.shouldDraw.call(this);if(V){var W=this.layer.getURL(this.bounds);var Z=this.useIFrame;this.useIFrame=this.maxGetUrlLength!==null&&!this.layer.async&&W.length>this.maxGetUrlLength;var Y=Z&&!this.useIFrame;var X=!Z&&this.useIFrame;if(Y||X){if(this.imgDiv&&this.imgDiv.parentNode===this.frame){this.frame.removeChild(this.imgDiv)}this.imgDiv=null;if(Y){this.blankImageUrl=this._blankImageUrl;this.frame.removeChild(this.frame.firstChild)}else{this._blankImageUrl=this.blankImageUrl;this.blankImageUrl="about:blank"}}}return B.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===true){if(!this.frame.childNodes.length){var X=document.createElement("div"),W=X.style;W.position="absolute";W.width="100%";W.height="100%";W.zIndex=1;W.backgroundImage="url("+this._blankImageUrl+")";this.frame.appendChild(X)}var Y=this.id+"_iFrame",V;if(parseFloat(navigator.appVersion.split("MSIE")[1])<9){V=document.createElement('<iframe name="'+Y+'">');V.style.backgroundColor="#FFFFFF";V.style.filter="chroma(color=#FFFFFF)"}else{V=document.createElement("iframe");V.style.backgroundColor="transparent";V.name=Y}V.scrolling="no";V.marginWidth="0px";V.marginHeight="0px";V.frameBorder="0";V.style.position="absolute";V.style.width="100%";V.style.height="100%";if(this.layer.opacity<1){B.Util.modifyDOMElement(V,null,null,null,null,null,null,this.layer.opacity)}this.frame.appendChild(V);this.imgDiv=V;return V}else{return B.Tile.Image.prototype.getImage.apply(this,arguments)}},createRequestForm:function(){var W=document.createElement("form");W.method="POST";var aa=this.layer.params._OLSALT;aa=(aa?aa+"_":"")+this.bounds.toBBOX();W.action=B.Util.urlAppend(this.layer.url,aa);W.target=this.id+"_iFrame";var X=this.layer.getImageSize(),Z=B.Util.getParameters(this.url),Y;for(var V in Z){Y=document.createElement("input");Y.type="hidden";Y.name=V;Y.value=Z[V];W.appendChild(Y)}return W},setImgSrc:function(V){if(this.useIFrame===true){if(V){var W=this.createRequestForm();this.frame.appendChild(W);W.submit();this.frame.removeChild(W)}else{if(this.imgDiv.parentNode===this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv=null}}}else{B.Tile.Image.prototype.setImgSrc.apply(this,arguments)}},onImageLoad:function(){B.Tile.Image.prototype.onImageLoad.apply(this,arguments);if(this.useIFrame===true){this.imgDiv.style.opacity=1;this.frame.style.opacity=this.layer.opacity}},createBackBuffer:function(){var V;if(this.useIFrame===false){V=B.Tile.Image.prototype.createBackBuffer.call(this)}return V}};B.Tile.UTFGrid=B.Class(B.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();B.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var W=B.Tile.prototype.draw.apply(this,arguments);if(W){if(this.isLoading){this.abortLoading();this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}this.url=this.layer.getURL(this.bounds);if(this.layer.useJSONP){var V=new B.Protocol.Script({url:this.url,callback:function(X){this.isLoading=false;this.events.triggerEvent("loadend");this.json=X.data},scope:this});V.read();this.request=V}else{this.request=B.Request.GET({url:this.url,callback:function(X){this.isLoading=false;this.events.triggerEvent("loadend");if(X.status===200){this.parseData(X.responseText)}},scope:this})}}else{this.unload()}return W},abortLoading:function(){if(this.request){this.request.abort();delete this.request}this.isLoading=false},getFeatureInfo:function(W,V){var X=null;if(this.json){var Y=this.getFeatureId(W,V);if(Y!==null){X={id:Y,data:this.json.data[Y]}}}return X},getFeatureId:function(Z,Y){var V=null;if(this.json){var X=this.utfgridResolution;var ad=Math.floor(Y/X);var W=Math.floor(Z/X);var ab=this.json.grid[ad].charCodeAt(W);var aa=this.indexFromCharCode(ab);var ac=this.json.keys;if(!isNaN(aa)&&(aa in ac)){V=ac[aa]}}return V},indexFromCharCode:function(V){if(V>=93){V--}if(V>=35){V--}return V-32},parseData:function(V){if(!this.format){this.format=new B.Format.JSON()}this.json=this.format.read(V)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});B.Layer.Image=B.Class(B.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(X,W,Z,Y,V){this.url=W;this.extent=Z;this.maxExtent=Z;this.size=Y;B.Layer.prototype.initialize.apply(this,[X,V]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null}B.Layer.prototype.destroy.apply(this,arguments)},clone:function(V){if(V==null){V=new B.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())}V=B.Layer.prototype.clone.apply(this,[V]);return V},setMap:function(V){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w}B.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(Y,V,Z){B.Layer.prototype.moveTo.apply(this,arguments);var W=(this.tile==null);if(V||W){this.setTileSize();var X=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});if(W){this.tile=new B.Tile.Image(this,X,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile)}else{this.tile.size=this.tileSize.clone();this.tile.position=X.clone()}this.tile.draw()}},setTileSize:function(){var W=this.extent.getWidth()/this.map.getResolution();var V=this.extent.getHeight()/this.map.getResolution();this.tileSize=new B.Size(W,V)},addTileMonitoringHooks:function(V){V.onLoadStart=function(){this.events.triggerEvent("loadstart")};V.events.register("loadstart",this,V.onLoadStart);V.onLoadEnd=function(){this.events.triggerEvent("loadend")};V.events.register("loadend",this,V.onLoadEnd);V.events.register("unload",this,V.onLoadEnd)},removeTileMonitoringHooks:function(V){V.unload();V.events.un({loadstart:V.onLoadStart,loadend:V.onLoadEnd,unload:V.onLoadEnd,scope:this})},setUrl:function(V){this.url=V;this.tile.draw()},getURL:function(V){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});B.Layer.SphericalMercator={getExtent:function(){var V=null;if(this.sphericalMercator){V=this.map.calculateBounds()}else{V=B.Layer.FixedZoomLevels.prototype.getExtent.apply(this)}return V},getLonLatFromViewPortPx:function(V){return B.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(V){return B.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];var V=156543.03390625;for(var W=0;W<=this.MAX_ZOOM_LEVEL;++W){this.RESOLUTIONS[W]=V/Math.pow(2,W)}this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:(function(){var V=new B.Projection("EPSG:4326");var W=new B.Projection("EPSG:900913");return function(Z,Y){var X=B.Projection.transform({x:Z,y:Y},V,W);return new B.LonLat(X.x,X.y)}})(),inverseMercator:(function(){var V=new B.Projection("EPSG:4326");var W=new B.Projection("EPSG:900913");return function(Y,Z){var X=B.Projection.transform({x:Y,y:Z},W,V);return new B.LonLat(X.x,X.y)}})()};B.Layer.EventPane=B.Class(B.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(W,V){B.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=B.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;this.pane=null;B.Layer.prototype.destroy.apply(this,arguments)},setMap:function(V){B.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(B.BROWSER_NAME=="msie"){this.pane.style.background="url("+B.Util.getImageLocation("blank.gif")+")"}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(V){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane)}B.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var ab=this.map.getSize();var V=Math.min(ab.w,300);var Z=Math.min(ab.h,200);var W=new B.Size(V,Z);var Y=new B.Pixel(ab.w/2,ab.h/2);var X=Y.add(-W.w/2,-W.h/2);var aa=B.Util.createDiv(this.name+"_warning",X,W,null,null,null,"auto");aa.style.padding="7px";aa.style.backgroundColor="yellow";aa.innerHTML=this.getWarningHTML();this.div.appendChild(aa)},getWarningHTML:function(){return""},display:function(V){B.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(V){B.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(W,V){B.Layer.prototype.moveByPx.apply(this,arguments);if(this.dragPanMapObject){this.dragPanMapObject(W,-V)}else{this.moveTo(this.map.getCachedCenter())}},moveTo:function(X,Y,ae){B.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var Z=this.map.getCenter();var ab=this.map.getZoom();if(Z!=null){var aa=this.getMapObjectCenter();var W=this.getOLLonLatFromMapObjectLonLat(aa);var ac=this.getMapObjectZoom();var ah=this.getOLZoomFromMapObjectZoom(ac);if(!(Z.equals(W))||ab!=ah){if(!Y&&W&&this.dragPanMapObject&&this.smoothDragPan){var ad=this.map.getViewPortPxFromLonLat(W);var af=this.map.getViewPortPxFromLonLat(Z);this.dragPanMapObject(af.x-ad.x,ad.y-af.y)}else{var V=this.getMapObjectLonLatFromOLLonLat(Z);var ag=this.getMapObjectZoomFromOLZoom(ab);this.setMapObjectCenter(V,ag,ae)}}}}},getLonLatFromViewPortPx:function(V){var W=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var Y=this.getMapObjectPixelFromOLPixel(V);var X=this.getMapObjectLonLatFromMapObjectPixel(Y);W=this.getOLLonLatFromMapObjectLonLat(X)}return W},getViewPortPxFromLonLat:function(W){var V=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var Y=this.getMapObjectLonLatFromOLLonLat(W);var X=this.getMapObjectPixelFromMapObjectLonLat(Y);V=this.getOLPixelFromMapObjectPixel(X)}return V},getOLLonLatFromMapObjectLonLat:function(Y){var V=null;if(Y!=null){var X=this.getLongitudeFromMapObjectLonLat(Y);var W=this.getLatitudeFromMapObjectLonLat(Y);V=new B.LonLat(X,W)}return V},getMapObjectLonLatFromOLLonLat:function(V){var W=null;if(V!=null){W=this.getMapObjectLonLatFromLonLat(V.lon,V.lat)}return W},getOLPixelFromMapObjectPixel:function(Y){var W=null;if(Y!=null){var V=this.getXFromMapObjectPixel(Y);var X=this.getYFromMapObjectPixel(Y);W=new B.Pixel(V,X)}return W},getMapObjectPixelFromOLPixel:function(V){var W=null;if(V!=null){W=this.getMapObjectPixelFromXY(V.x,V.y)}return W},CLASS_NAME:"OpenLayers.Layer.EventPane"});B.Layer.FixedZoomLevels=B.Class({initialize:function(){},initResolutions:function(){var X=["minZoomLevel","maxZoomLevel","numZoomLevels"];for(var W=0,V=X.length;W<V;W++){var aa=X[W];this[aa]=(this.options[aa]!=null)?this.options[aa]:this.map[aa]}if((this.minZoomLevel==null)||(this.minZoomLevel<this.MIN_ZOOM_LEVEL)){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var ab;var Z=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(((this.options.numZoomLevels==null)&&(this.options.maxZoomLevel!=null))||((this.numZoomLevels==null)&&(this.maxZoomLevel!=null))){ab=this.maxZoomLevel-this.minZoomLevel+1}else{ab=this.numZoomLevels}if(ab!=null){this.numZoomLevels=Math.min(ab,Z)}else{this.numZoomLevels=Z}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var Y=0;this.resolutions=[];for(var W=this.minZoomLevel;W<=this.maxZoomLevel;W++){this.resolutions[Y++]=this.RESOLUTIONS[W]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return B.Layer.prototype.getResolution.apply(this,arguments)}else{var V=null;var X=this.map.getSize();var W=this.getExtent();if((X!=null)&&(W!=null)){V=Math.max(W.getWidth()/X.w,W.getHeight()/X.h)}return V}},getExtent:function(){var X=this.map.getSize();var V=this.getLonLatFromViewPortPx({x:0,y:0});var W=this.getLonLatFromViewPortPx({x:X.w,y:X.h});if((V!=null)&&(W!=null)){return new B.Bounds(V.lon,W.lat,W.lon,V.lat)}else{return null}},getZoomForResolution:function(V){if(this.resolutions!=null){return B.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var W=B.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(W)}},getOLZoomFromMapObjectZoom:function(V){var W=null;if(V!=null){W=V-this.minZoomLevel;if(this.map.baseLayer!==this){W=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(W))}}return W},getMapObjectZoomFromOLZoom:function(V){var W=null;if(V!=null){W=V+this.minZoomLevel;if(this.map.baseLayer!==this){W=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(W))}}return W},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});B.Layer.Google=B.Class(B.Layer.EventPane,B.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515,0.00000268220901489257,0.000001341104507446289,6.705522537231445e-7],type:null,wrapDateLine:true,sphericalMercator:false,version:null,initialize:function(X,W){W=W||{};if(!W.version){W.version=typeof GMap2==="function"?"2":"3"}var V=B.Layer.Google["v"+W.version.replace(/\./g,"_")];if(V){B.Util.applyDefaults(W,V)}else{throw"Unsupported Google Maps API version: "+W.version}B.Util.applyDefaults(W,V.DEFAULTS);if(W.maxExtent){W.maxExtent=W.maxExtent.clone()}B.Layer.EventPane.prototype.initialize.apply(this,[X,W]);B.Layer.FixedZoomLevels.prototype.initialize.apply(this,[X,W]);if(this.sphericalMercator){B.Util.extend(this,B.Layer.SphericalMercator);this.initMercatorParameters()}},clone:function(){return new B.Layer.Google(this.name,this.getOptions())},setVisibility:function(W){var V=this.opacity==null?1:this.opacity;B.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(V)},display:function(V){if(!this._dragging){this.setGMapVisibility(V)}B.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(W,V,X){this._dragging=X;B.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(W){if(W!==this.opacity){if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}this.opacity=W}if(this.getVisibility()){var V=this.getMapContainer();B.Util.modifyDOMElement(V,null,null,null,null,null,null,W)}},destroy:function(){if(this.map){this.setGMapVisibility(false);var V=B.Layer.Google.cache[this.map.id];if(V&&V.count<=1){this.removeGMapElements()}}B.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var Y=B.Layer.Google.cache[this.map.id];if(Y){var W=this.mapObject&&this.getMapContainer();if(W&&W.parentNode){W.parentNode.removeChild(W)}var X=Y.termsOfUse;if(X&&X.parentNode){X.parentNode.removeChild(X)}var V=Y.poweredBy;if(V&&V.parentNode){V.parentNode.removeChild(V)}if(this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners){google.maps.event.clearListeners(this.mapObject,"tilesloaded")}}},removeMap:function(W){if(this.visibility&&this.mapObject){this.setGMapVisibility(false)}var V=B.Layer.Google.cache[W.id];if(V){if(V.count<=1){this.removeGMapElements();delete B.Layer.Google.cache[W.id]}else{--V.count}}delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;B.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(W){var X=null;if(W!=null){var V=W.getSouthWest();var Y=W.getNorthEast();if(this.sphericalMercator){V=this.forwardMercator(V.lng(),V.lat());Y=this.forwardMercator(Y.lng(),Y.lat())}else{V=new B.LonLat(V.lng(),V.lat());Y=new B.LonLat(Y.lng(),Y.lat())}X=new B.Bounds(V.lon,V.lat,Y.lon,Y.lat)}return X},getWarningHTML:function(){return B.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(V){return this.sphericalMercator?this.forwardMercator(V.lng(),V.lat()).lon:V.lng()},getLatitudeFromMapObjectLonLat:function(W){var V=this.sphericalMercator?this.forwardMercator(W.lng(),W.lat()).lat:W.lat();return V},getXFromMapObjectPixel:function(V){return V.x},getYFromMapObjectPixel:function(V){return V.y},CLASS_NAME:"OpenLayers.Layer.Google"});B.Layer.Google.cache={};B.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){if(!this.type){this.type=G_NORMAL_MAP}var aa,Y,V;var X=B.Layer.Google.cache[this.map.id];if(X){aa=X.mapObject;Y=X.termsOfUse;V=X.poweredBy;++X.count}else{var W=this.map.viewPortDiv;var ab=document.createElement("div");ab.id=this.map.id+"_GMap2Container";ab.style.position="absolute";ab.style.width="100%";ab.style.height="100%";W.appendChild(ab);try{aa=new GMap2(ab);Y=ab.lastChild;W.appendChild(Y);Y.style.zIndex="1100";Y.style.right="";Y.style.bottom="";Y.className="olLayerGoogleCopyright";V=ab.lastChild;W.appendChild(V);V.style.zIndex="1100";V.style.right="";V.style.bottom="";V.className="olLayerGooglePoweredBy gmnoprint"}catch(Z){throw (Z)}B.Layer.Google.cache[this.map.id]={mapObject:aa,termsOfUse:Y,poweredBy:V,count:1}}this.mapObject=aa;this.termsOfUse=Y;this.poweredBy=V;if(B.Util.indexOf(this.mapObject.getMapTypes(),this.type)===-1){this.mapObject.addMapType(this.type)}if(typeof aa.getDragObject=="function"){this.dragObject=aa.getDragObject()}else{this.dragPanMapObject=null}if(this.isBaseLayer===false){this.setGMapVisibility(this.div.style.display!=="none")}},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var V=this;var W=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(W);delete V._resized;V.mapObject.checkResize();V.moveTo(V.map.getCenter(),V.map.getZoom())})}this._resized=true}},setGMapVisibility:function(X){var W=B.Layer.Google.cache[this.map.id];if(W){var V=this.mapObject.getContainer();if(X===true){this.mapObject.setMapType(this.type);V.style.display="";this.termsOfUse.style.left="";this.termsOfUse.style.display="";this.poweredBy.style.display="";W.displayed=this.id}else{if(W.displayed===this.id){delete W.displayed}if(!W.displayed){V.style.display="none";this.termsOfUse.style.display="none";this.termsOfUse.style.left="-9999px";this.poweredBy.style.display="none"}}}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(X){var W=null;if(X!=null){var V=this.sphericalMercator?this.inverseMercator(X.bottom,X.left):new B.LonLat(X.bottom,X.left);var Y=this.sphericalMercator?this.inverseMercator(X.top,X.right):new B.LonLat(X.top,X.right);W=new GLatLngBounds(new GLatLng(V.lat,V.lon),new GLatLng(Y.lat,Y.lon))}return W},setMapObjectCenter:function(V,W){this.mapObject.setCenter(V,W)},dragPanMapObject:function(W,V){this.dragObject.moveBy(new GSize(-W,V))},getMapObjectLonLatFromMapObjectPixel:function(V){return this.mapObject.fromContainerPixelToLatLng(V)},getMapObjectPixelFromMapObjectLonLat:function(V){return this.mapObject.fromLatLngToContainerPixel(V)},getMapObjectZoomFromMapObjectBounds:function(V){return this.mapObject.getBoundsZoomLevel(V)},getMapObjectLonLatFromLonLat:function(Y,W){var X;if(this.sphericalMercator){var V=this.inverseMercator(Y,W);X=new GLatLng(V.lat,V.lon)}else{X=new GLatLng(W,Y)}return X},getMapObjectPixelFromXY:function(V,W){return new GPoint(V,W)}};B.Layer.Google.v3={DEFAULTS:{sphericalMercator:true,projection:"EPSG:900913"},animationEnabled:true,loadMapObject:function(){if(!this.type){this.type=google.maps.MapTypeId.ROADMAP}var Z;var Y=B.Layer.Google.cache[this.map.id];if(Y){Z=Y.mapObject;++Y.count}else{var V=this.map.getCenter();var X=document.createElement("div");X.className="olForeignContainer";X.style.width="100%";X.style.height="100%";Z=new google.maps.Map(X,{center:V?new google.maps.LatLng(V.lat,V.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false});var W=document.createElement("div");W.style.width="100%";W.style.height="100%";Z.controls[google.maps.ControlPosition.TOP_LEFT].push(W);Y={googleControl:W,mapObject:Z,count:1};B.Layer.Google.cache[this.map.id]=Y}this.mapObject=Z;this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility){google.maps.event.trigger(this.mapObject,"resize")}},setGMapVisibility:function(Y){var V=B.Layer.Google.cache[this.map.id];var W=this.map;if(V){var ad=this.type;var Z=W.layers;var ab;for(var aa=Z.length-1;aa>=0;--aa){ab=Z[aa];if(ab instanceof B.Layer.Google&&ab.visibility===true&&ab.inRange===true){ad=ab.type;Y=true;break}}var X=this.mapObject.getDiv();if(Y===true){if(X.parentNode!==W.div){if(!V.rendered){var ac=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){V.rendered=true;ac.setGMapVisibility(ac.getVisibility());ac.moveTo(ac.map.getCenter())})}else{W.div.appendChild(X);V.googleControl.appendChild(W.viewPortDiv);google.maps.event.trigger(this.mapObject,"resize")}}this.mapObject.setMapTypeId(ad)}else{if(V.googleControl.hasChildNodes()){W.div.appendChild(W.viewPortDiv);W.div.removeChild(X)}}}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(X){var W=null;if(X!=null){var V=this.sphericalMercator?this.inverseMercator(X.bottom,X.left):new B.LonLat(X.bottom,X.left);var Y=this.sphericalMercator?this.inverseMercator(X.top,X.right):new B.LonLat(X.top,X.right);W=new google.maps.LatLngBounds(new google.maps.LatLng(V.lat,V.lon),new google.maps.LatLng(Y.lat,Y.lon))}return W},getMapObjectLonLatFromMapObjectPixel:function(ac){var W=this.map.getSize();var aa=this.getLongitudeFromMapObjectLonLat(this.mapObject.center);var Y=this.getLatitudeFromMapObjectLonLat(this.mapObject.center);var V=this.map.getResolution();var ab=ac.x-(W.w/2);var Z=ac.y-(W.h/2);var X=new B.LonLat(aa+ab*V,Y-Z*V);if(this.wrapDateLine){X=X.wrapDateLine(this.maxExtent)}return this.getMapObjectLonLatFromLonLat(X.lon,X.lat)},getMapObjectPixelFromMapObjectLonLat:function(Z){var Y=this.getLongitudeFromMapObjectLonLat(Z);var X=this.getLatitudeFromMapObjectLonLat(Z);var V=this.map.getResolution();var W=this.map.getExtent();return this.getMapObjectPixelFromXY((1/V*(Y-W.left)),(1/V*(W.top-X)))},setMapObjectCenter:function(V,X){if(this.animationEnabled===false&&X!=this.mapObject.zoom){var W=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){W.style.visibility=""});W.style.visibility="hidden"}this.mapObject.setOptions({center:V,zoom:X})},getMapObjectZoomFromMapObjectBounds:function(V){return this.mapObject.getBoundsZoomLevel(V)},getMapObjectLonLatFromLonLat:function(Y,W){var X;if(this.sphericalMercator){var V=this.inverseMercator(Y,W);X=new google.maps.LatLng(V.lat,V.lon)}else{X=new google.maps.LatLng(W,Y)}return X},getMapObjectPixelFromXY:function(V,W){return new google.maps.Point(V,W)}};B.Layer.HTTPRequest=B.Class(B.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(X,W,Y,V){B.Layer.prototype.initialize.apply(this,[X,V]);this.url=W;if(!this.params){this.params=B.Util.extend({},Y)}},destroy:function(){this.url=null;this.params=null;B.Layer.prototype.destroy.apply(this,arguments)},clone:function(V){if(V==null){V=new B.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())}V=B.Layer.prototype.clone.apply(this,[V]);return V},setUrl:function(V){this.url=V},mergeNewParams:function(W){this.params=B.Util.extend(this.params,W);var V=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})}return V},redraw:function(V){if(V){return this.mergeNewParams({_olSalt:Math.random()})}else{return B.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(Z,Y){var X=1;for(var W=0,V=Z.length;W<V;W++){X*=Z.charCodeAt(W)*this.URL_HASH_FACTOR;X-=Math.floor(X)}return Y[Math.floor(X*Y.length)]},getFullRequestString:function(ab,Y){var W=Y||this.url;var aa=B.Util.extend({},this.params);aa=B.Util.extend(aa,ab);var Z=B.Util.getParameterString(aa);if(B.Util.isArray(W)){W=this.selectUrl(Z,W)}var V=B.Util.upperCaseObject(B.Util.getParameters(W));for(var X in aa){if(X.toUpperCase() in V){delete aa[X]}}Z=B.Util.getParameterString(aa);return B.Util.urlAppend(W,Z)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});B.Layer.Grid=B.Class(B.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:B.Tile.Image,grid:null,singleTile:false,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:false,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,initialize:function(X,W,Y,V){B.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this.tileQueue=[];if(this.removeBackBufferDelay===null){this.removeBackBufferDelay=this.singleTile?0:2500}if(this.className===null){this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid"}if(!B.Animation.isNative){this.deferMoveGriddedTiles=B.Function.bind(function(){this.moveGriddedTiles(true);this.moveTimerId=null},this)}},setMap:function(V){B.Layer.HTTPRequest.prototype.setMap.call(this,V);B.Element.addClass(this.div,this.className)},removeMap:function(V){if(this.moveTimerId!==null){window.clearTimeout(this.moveTimerId);this.moveTimerId=null}this.clearTileQueue();if(this.backBufferTimerId!==null){window.clearTimeout(this.backBufferTimerId);this.backBufferTimerId=null}},destroy:function(){this.removeBackBuffer();this.clearGrid();this.grid=null;this.tileSize=null;B.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){this.clearTileQueue();if(this.grid){for(var aa=0,W=this.grid.length;aa<W;aa++){var Z=this.grid[aa];for(var X=0,V=Z.length;X<V;X++){var Y=Z[X];this.destroyTile(Y)}}this.grid=[];this.gridResolution=null}},clone:function(V){if(V==null){V=new B.Layer.Grid(this.name,this.url,this.params,this.getOptions())}V=B.Layer.HTTPRequest.prototype.clone.apply(this,[V]);if(this.tileSize!=null){V.tileSize=this.tileSize.clone()}V.grid=[];V.gridResolution=null;V.backBuffer=null;V.backBufferTimerId=null;V.tileQueue=[];V.tileQueueId=null;V.loading=false;V.moveTimerId=null;return V},moveTo:function(aa,W,ab){B.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);aa=aa||this.map.getExtent();if(aa!=null){var Z=!this.grid.length||W;var Y=this.getTilesBounds();var X=this.map.getResolution();var V=this.getServerResolution(X);if(this.singleTile){if(Z||(!ab&&!Y.containsBounds(aa))){if(W&&this.transitionEffect!=="resize"){this.removeBackBuffer()}if(!W||this.transitionEffect==="resize"){this.applyBackBuffer(V)}this.initSingleTile(aa)}}else{Z=Z||!Y.intersectsBounds(aa,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()});if(X!==V){aa=this.map.calculateBounds(null,V);if(Z){var ac=V/X;this.transformDiv(ac)}}else{this.div.style.width="100%";this.div.style.height="100%";this.div.style.left="0%";this.div.style.top="0%"}if(Z){if(W&&this.transitionEffect==="resize"){this.applyBackBuffer(V)}this.initGriddedTiles(aa)}else{this.moveGriddedTiles()}}}},getTileData:function(ah){var al=null,ai=ah.lon,ag=ah.lat,Y=this.grid.length;if(this.map&&Y){var am=this.map.getResolution(),V=this.tileSize.w,af=this.tileSize.h,ae=this.grid[0][0].bounds,Z=ae.left,aj=ae.top;if(ai<Z){if(this.map.baseLayer.wrapDateLine){var W=this.map.getMaxExtent().getWidth();var X=Math.ceil((Z-ai)/W);ai+=W*X}}var ac=(ai-Z)/(am*V);var aa=(aj-ag)/(am*af);var ab=Math.floor(ac);var ad=Math.floor(aa);if(ad>=0&&ad<Y){var ak=this.grid[ad][ab];if(ak){al={tile:ak,i:Math.floor((ac-ab)*V),j:Math.floor((aa-ad)*af)}}}}return al},queueTileDraw:function(V){var W=V.object;if(!~B.Util.indexOf(this.tileQueue,W)){this.tileQueue.push(W)}if(!this.tileQueueId){this.tileQueueId=B.Animation.start(B.Function.bind(this.drawTileFromQueue,this),null,this.div)}return false},drawTileFromQueue:function(){if(this.tileQueue.length===0){this.clearTileQueue()}else{this.tileQueue.shift().draw(true)}},clearTileQueue:function(){B.Animation.stop(this.tileQueueId);this.tileQueueId=null;this.tileQueue=[]},destroyTile:function(V){this.removeTileMonitoringHooks(V);V.destroy()},getServerResolution:function(W){W=W||this.map.getResolution();if(this.serverResolutions&&B.Util.indexOf(this.serverResolutions,W)===-1){var X,V;for(X=this.serverResolutions.length-1;X>=0;X--){V=this.serverResolutions[X];if(V>W){W=V;break}}if(X===-1){throw"no appropriate resolution in serverResolutions"}}return W},getServerZoom:function(){var V=this.getServerResolution();return this.serverResolutions?B.Util.indexOf(this.serverResolutions,V):this.map.getZoomForResolution(V)+(this.zoomOffset||0)},transformDiv:function(Z){this.div.style.width=100*Z+"%";this.div.style.height=100*Z+"%";var W=this.map.getSize();var Y=parseInt(this.map.layerContainerDiv.style.left,10);var X=parseInt(this.map.layerContainerDiv.style.top,10);var V=(Y-(W.w/2))*(Z-1);var aa=(X-(W.h/2))*(Z-1);this.div.style.left=V+"%";this.div.style.top=aa+"%"},getResolutionScale:function(){return parseInt(this.div.style.width,10)/100},applyBackBuffer:function(Y){if(this.backBufferTimerId!==null){this.removeBackBuffer()}var X=this.backBuffer;if(!X){X=this.createBackBuffer();if(!X){return}this.div.insertBefore(X,this.div.firstChild);this.backBuffer=X;var W=this.grid[0][0].bounds;this.backBufferLonLat={lon:W.left,lat:W.top};this.backBufferResolution=this.gridResolution}var ab=X.style;var aa=this.backBufferResolution/Y;ab.width=100*aa+"%";ab.height=100*aa+"%";var V=this.getViewPortPxFromLonLat(this.backBufferLonLat,Y);var ac=parseInt(this.map.layerContainerDiv.style.left,10);var Z=parseInt(this.map.layerContainerDiv.style.top,10);X.style.left=Math.round(V.x-ac)+"%";X.style.top=Math.round(V.y-Z)+"%"},createBackBuffer:function(){var X;if(this.grid.length>0){X=document.createElement("div");X.id=this.div.id+"_bb";X.className="olBackBuffer";X.style.position="absolute";X.style.width="100%";X.style.height="100%";for(var Z=0,W=this.grid.length;Z<W;Z++){for(var Y=0,V=this.grid[Z].length;Y<V;Y++){var aa=this.grid[Z][Y].createBackBuffer();if(!aa){continue}aa.style.top=(Z*this.tileSize.h)+"%";aa.style.left=(Y*this.tileSize.w)+"%";X.appendChild(aa)}}}return X},removeBackBuffer:function(){if(this.backBuffer){this.div.removeChild(this.backBuffer);this.backBuffer=null;this.backBufferResolution=null;if(this.backBufferTimerId!==null){window.clearTimeout(this.backBufferTimerId);this.backBufferTimerId=null}}},moveByPx:function(W,V){if(!this.singleTile){this.moveGriddedTiles()}},setTileSize:function(V){if(this.singleTile){V=this.map.getSize();V.h=parseInt(V.h*this.ratio);V.w=parseInt(V.w*this.ratio)}B.Layer.HTTPRequest.prototype.setTileSize.apply(this,[V])},getTilesBounds:function(){var Y=null;var X=this.grid.length;if(X){var Z=this.grid[X-1][0].bounds,W=this.grid[0].length*Z.getWidth(),V=this.grid.length*Z.getHeight();Y=new B.Bounds(Z.left,Z.bottom,Z.left+W,Z.bottom+V)}return Y},initSingleTile:function(Z){this.clearTileQueue();var V=Z.getCenterLonLat();var ab=Z.getWidth()*this.ratio;var W=Z.getHeight()*this.ratio;var aa=new B.Bounds(V.lon-(ab/2),V.lat-(W/2),V.lon+(ab/2),V.lat+(W/2));var X=this.map.getLayerPxFromLonLat({lon:aa.left,lat:aa.top});if(!this.grid.length){this.grid[0]=[]}var Y=this.grid[0][0];if(!Y){Y=this.addTile(aa,X);this.addTileMonitoringHooks(Y);Y.draw();this.grid[0][0]=Y}else{Y.moveTo(aa,X)}this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(V,ai,Z){var af=Z*this.tileSize.w;var X=Z*this.tileSize.h;var ad=V.left-ai.lon;var ag=Math.floor(ad/af)-this.buffer;var ae=ad/af-ag;var aa=-ae*this.tileSize.w;var ah=ai.lon+ag*af;var W=V.top-(ai.lat+X);var ac=Math.ceil(W/X)+this.buffer;var aj=ac-W/X;var Y=-aj*this.tileSize.h;var ab=ai.lat+ac*X;return{tilelon:af,tilelat:X,tileoffsetlon:ah,tileoffsetlat:ab,tileoffsetx:aa,tileoffsety:Y}},getTileOrigin:function(){var W=this.tileOrigin;if(!W){var X=this.getMaxExtent();var V=({tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]})[this.tileOriginCorner];W=new B.LonLat(X[V[0]],X[V[1]])}return W},initGriddedTiles:function(ad){this.clearTileQueue();var ab=this.map.getSize();var at=Math.ceil(ab.h/this.tileSize.h)+Math.max(1,2*this.buffer);var aw=Math.ceil(ab.w/this.tileSize.w)+Math.max(1,2*this.buffer);var az=this.getTileOrigin();var am=this.getServerResolution();var al=this.calculateGridLayout(ad,az,am);var aa=Math.round(al.tileoffsetx);var X=Math.round(al.tileoffsety);var af=al.tileoffsetlon;var ai=al.tileoffsetlat;var Z=al.tilelon;var ae=al.tilelat;var ar=aa;var av=af;var aq=0;var V=parseInt(this.map.layerContainerDiv.style.left);var ao=parseInt(this.map.layerContainerDiv.style.top);var au=[],ax=this.map.getCenter();do{var ac=this.grid[aq++];if(!ac){ac=[];this.grid.push(ac)}af=av;aa=ar;var Y=0;do{var W=new B.Bounds(af,ai,af+Z,ai+ae);var ah=aa;ah-=V;var ag=X;ag-=ao;var ak=new B.Pixel(ah,ag);var ay=ac[Y++];if(!ay){ay=this.addTile(W,ak);this.addTileMonitoringHooks(ay);ac.push(ay)}else{ay.moveTo(W,ak,false)}var an=W.getCenterLonLat();au.push({tile:ay,distance:Math.pow(an.lon-ax.lon,2)+Math.pow(an.lat-ax.lat,2)});af+=Z;aa+=this.tileSize.w}while((af<=ad.right+Z*this.buffer)||Y<aw);ai-=ae;X+=this.tileSize.h}while((ai>=ad.bottom-ae*this.buffer)||aq<at);this.removeExcessTiles(aq,Y);this.gridResolution=this.getServerResolution();au.sort(function(aB,aA){return aB.distance-aA.distance});for(var ap=0,aj=au.length;ap<aj;++ap){au[ap].tile.draw()}},getMaxExtent:function(){return this.maxExtent},addTile:function(X,V){var W=new this.tileClass(this,V,X,null,this.tileSize,this.tileOptions);W.events.register("beforedraw",this,this.queueTileDraw);return W},addTileMonitoringHooks:function(V){V.onLoadStart=function(){if(this.loading===false){this.loading=true;this.events.triggerEvent("loadstart")}this.events.triggerEvent("tileloadstart",{tile:V});this.numLoadingTiles++};V.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded",{tile:V});if(this.tileQueue.length===0&&this.numLoadingTiles===0){this.loading=false;this.events.triggerEvent("loadend");if(this.backBuffer){this.backBufferTimerId=window.setTimeout(B.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)}}};V.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:V})};V.events.on({loadstart:V.onLoadStart,loadend:V.onLoadEnd,unload:V.onLoadEnd,loaderror:V.onLoadError,scope:this})},removeTileMonitoringHooks:function(V){V.unload();V.events.un({loadstart:V.onLoadStart,loadend:V.onLoadEnd,unload:V.onLoadEnd,loaderror:V.onLoadError,scope:this})},moveGriddedTiles:function(W){if(!W&&!B.Animation.isNative){if(this.moveTimerId!=null){window.clearTimeout(this.moveTimerId)}this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay);return}var V=this.buffer||1;var Z=this.getResolutionScale();while(true){var Y={x:(this.grid[0][0].position.x*Z)+parseInt(this.div.style.left,10)+parseInt(this.map.layerContainerDiv.style.left),y:(this.grid[0][0].position.y*Z)+parseInt(this.div.style.top,10)+parseInt(this.map.layerContainerDiv.style.top)};var X={w:this.tileSize.w*Z,h:this.tileSize.h*Z};if(Y.x>-X.w*(V-1)){this.shiftColumn(true)}else{if(Y.x<-X.w*V){this.shiftColumn(false)}else{if(Y.y>-X.h*(V-1)){this.shiftRow(true)}else{if(Y.y<-X.h*V){this.shiftRow(false)}else{break}}}}}},shiftRow:function(ah){var X=(ah)?0:(this.grid.length-1);var W=this.grid;var aa=W[X];var Z=this.getServerResolution();var ac=(ah)?-this.tileSize.h:this.tileSize.h;var ab=Z*-ac;var ag=(ah)?W.pop():W.shift();for(var ad=0,af=aa.length;ad<af;ad++){var Y=aa[ad];var V=Y.bounds.clone();var ae=Y.position.clone();V.bottom=V.bottom+ab;V.top=V.top+ab;ae.y=ae.y+ac;ag[ad].moveTo(V,ae)}if(ah){W.unshift(ag)}else{W.push(ag)}},shiftColumn:function(ag){var Y=(ag)?-this.tileSize.w:this.tileSize.w;var X=this.getServerResolution();var ae=X*Y;for(var Z=0,ab=this.grid.length;Z<ab;Z++){var af=this.grid[Z];var ad=(ag)?0:(af.length-1);var W=af[ad];var V=W.bounds.clone();var aa=W.position.clone();V.left=V.left+ae;V.right=V.right+ae;aa.x=aa.x+Y;var ac=ag?this.grid[Z].pop():this.grid[Z].shift();ac.moveTo(V,aa);if(ag){af.unshift(ac)}else{af.push(ac)}}},removeExcessTiles:function(Z,X){var W,V;while(this.grid.length>Z){var aa=this.grid.pop();for(W=0,V=aa.length;W<V;W++){var Y=aa[W];this.destroyTile(Y)}}for(W=0,V=this.grid.length;W<V;W++){while(this.grid[W].length>X){var aa=this.grid[W];var Y=aa.pop();this.destroyTile(Y)}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(Y){var X=this.maxExtent;var aa=this.getResolution();var Z=aa*this.tileSize.w;var W=aa*this.tileSize.h;var ac=this.getLonLatFromViewPortPx(Y);var V=X.left+(Z*Math.floor((ac.lon-X.left)/Z));var ab=X.bottom+(W*Math.floor((ac.lat-X.bottom)/W));return new B.Bounds(V,ab,V+Z,ab+W)},CLASS_NAME:"OpenLayers.Layer.Grid"});B.bases.LayerGrid=B.Layer.Grid;B.Layer.Grid=B.Class(B.Layer.Grid,{queueTileDraw:function(V){var W=V.object;if(!~B.Util.indexOf(this.tileQueue,W)){this.tileQueue.push(W)}if(!this.tileQueueId){if(M.caps.isIE7||M.caps.isIE8){setTimeout(B.Function.bind(this.drawTileFromQueue,this),0)}else{this.tileQueueId=B.Animation.start(B.Function.bind(this.drawTileFromQueue,this),null,this.div)}}return false}});B.Layer.Markers=B.Class(B.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(W,V){B.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;B.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(W){if(W!=this.opacity){this.opacity=W;for(var X=0,V=this.markers.length;X<V;X++){this.markers[X].setOpacity(this.opacity)}}},moveTo:function(Y,W,Z){B.Layer.prototype.moveTo.apply(this,arguments);if(W||!this.drawn){for(var X=0,V=this.markers.length;X<V;X++){this.drawMarker(this.markers[X])}this.drawn=true}},addMarker:function(V){this.markers.push(V);if(this.opacity<1){V.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){V.map=this.map;this.drawMarker(V)}},removeMarker:function(V){if(this.markers&&this.markers.length){B.Util.removeItem(this.markers,V);V.erase()}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(V){var W=this.map.getLayerPxFromLonLat(V.lonlat);if(W==null){V.display(false)}else{if(!V.isDrawn()){var X=V.draw(W);this.div.appendChild(X)}else{if(V.icon){V.icon.moveTo(W)}}}},getDataExtent:function(){var W=null;if(this.markers&&(this.markers.length>0)){var W=new B.Bounds();for(var Y=0,V=this.markers.length;Y<V;Y++){var X=this.markers[Y];W.extend(X.lonlat)}}return W},CLASS_NAME:"OpenLayers.Layer.Markers"});B.Layer.WMS=B.Class(B.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{},initialize:function(Y,X,Z,W){var V=[];Z=B.Util.upperCaseObject(Z);if(parseFloat(Z.VERSION)>=1.3&&!Z.EXCEPTIONS){Z.EXCEPTIONS="INIMAGE"}V.push(Y,X,Z,W);B.Layer.Grid.prototype.initialize.apply(this,V);B.Util.applyDefaults(this.params,B.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((W==null)||(!W.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=B.Util.alphaHack()?"image/gif":"image/png"}}},clone:function(V){if(V==null){V=new B.Layer.WMS(this.name,this.url,this.params,this.getOptions())}V=B.Layer.Grid.prototype.clone.apply(this,[V]);return V},reverseAxisOrder:function(){var V=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[V]||B.Projection.defaults[V].yx)},getURL:function(X){X=this.adjustBounds(X);var Y=this.getImageSize();var Z={};var W=this.reverseAxisOrder();Z.BBOX=this.encodeBBOX?X.toBBOX(null,W):X.toArray(W);Z.WIDTH=Y.w;Z.HEIGHT=Y.h;var V=this.getFullRequestString(Z);return V},mergeNewParams:function(X){var W=B.Util.upperCaseObject(X);var V=[W];return B.Layer.Grid.prototype.mergeNewParams.apply(this,V)},getFullRequestString:function(Z,X){var W=this.map.getProjectionObject();var V=this.projection&&this.projection.equals(W)?this.projection.getCode():W.getCode();var Y=(V=="none")?null:V;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=Y}else{this.params.SRS=Y}if(typeof this.params.TRANSPARENT=="boolean"){Z.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return B.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});B.Layer.WMTS=B.Class(B.Layer.Grid,{isBaseLayer:true,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(X){var aa={url:true,layer:true,style:true,matrixSet:true};for(var ab in aa){if(!(ab in X)){throw new Error("Missing property '"+ab+"' in layer configuration.")}}X.params=B.Util.upperCaseObject(X.params);var W=[X.name,X.url,X.params,X];B.Layer.Grid.prototype.initialize.apply(this,W);if(!this.formatSuffix){this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()}if(this.matrixIds){var V=this.matrixIds.length;if(V&&typeof this.matrixIds[0]==="string"){var Z=this.matrixIds;this.matrixIds=new Array(V);for(var Y=0;Y<V;++Y){this.matrixIds[Y]={identifier:Z[Y]}}}}},setMap:function(){B.Layer.Grid.prototype.setMap.apply(this,arguments);this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){if(this.matrix.topLeftCorner){this.tileOrigin=this.matrix.topLeftCorner}if(this.matrix.tileWidth&&this.matrix.tileHeight){this.tileSize=new B.Size(this.matrix.tileWidth,this.matrix.tileHeight)}if(!this.tileOrigin){this.tileOrigin=new B.LonLat(this.maxExtent.left,this.maxExtent.top)}if(!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(W,V,X){if(V||!this.matrix){this.updateMatrixProperties()}return B.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(V){if(V==null){V=new B.Layer.WMTS(this.options)}V=B.Layer.Grid.prototype.clone.apply(this,[V]);return V},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var W;if(!this.matrixIds||this.matrixIds.length===0){W={identifier:this.getIdentifier()}}else{if("scaleDenominator" in this.matrixIds[0]){var V=B.METERS_PER_INCH*B.INCHES_PER_UNIT[this.units]*this.getServerResolution()/0.00028;var Z=Number.POSITIVE_INFINITY;var aa;for(var X=0,Y=this.matrixIds.length;X<Y;++X){aa=Math.abs(1-(this.matrixIds[X].scaleDenominator/V));if(aa<Z){Z=aa;W=this.matrixIds[X]}}}else{W=this.matrixIds[this.getIdentifier()]}}return W},getTileInfo:function(aa){var W=this.getServerResolution();var Y=(aa.lon-this.tileOrigin.lon)/(W*this.tileSize.w);var X=(this.tileOrigin.lat-aa.lat)/(W*this.tileSize.h);var V=Math.floor(Y);var Z=Math.floor(X);return{col:V,row:Z,i:Math.floor((Y-V)*this.tileSize.w),j:Math.floor((X-Z)*this.tileSize.h)}},getURL:function(V){V=this.adjustBounds(V);var Y="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(V)){var X=V.getCenterLonLat();var aa=this.getTileInfo(X);var ae=this.matrix.identifier;var W=this.dimensions,ab;if(this.requestEncoding.toUpperCase()==="REST"){ab=this.params;if(typeof this.url==="string"&&this.url.indexOf("{")!==-1){var af=this.url.replace(/\{/g,"${");var Z={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:aa.row,TileCol:aa.col};if(W){var ac,ad;for(ad=W.length-1;ad>=0;--ad){ac=W[ad];Z[ac]=ab[ac.toUpperCase()]}}Y=B.String.format(af,Z)}else{var ag=this.version+"/"+this.layer+"/"+this.style+"/";if(W){for(var ad=0;ad<W.length;ad++){if(ab[W[ad]]){ag=ag+ab[W[ad]]+"/"}}}ag=ag+this.matrixSet+"/"+this.matrix.identifier+"/"+aa.row+"/"+aa.col+"."+this.formatSuffix;if(B.Util.isArray(this.url)){Y=this.selectUrl(ag,this.url)}else{Y=this.url}if(!Y.match(/\/$/)){Y=Y+"/"}Y=Y+ag}}else{if(this.requestEncoding.toUpperCase()==="KVP"){ab={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:aa.row,TILECOL:aa.col,FORMAT:this.format};Y=B.Layer.Grid.prototype.getFullRequestString.apply(this,[ab])}}}return Y},mergeNewParams:function(V){if(this.requestEncoding.toUpperCase()==="KVP"){return B.Layer.Grid.prototype.mergeNewParams.apply(this,[B.Util.upperCaseObject(V)])}},CLASS_NAME:"OpenLayers.Layer.WMTS"});B.Layer.Boxes=B.Class(B.Layer.Markers,{drawMarker:function(V){var Y=this.map.getLayerPxFromLonLat({lon:V.bounds.left,lat:V.bounds.top});var X=this.map.getLayerPxFromLonLat({lon:V.bounds.right,lat:V.bounds.bottom});if(X==null||Y==null){V.display(false)}else{var W=V.draw(Y,{w:Math.max(1,X.x-Y.x),h:Math.max(1,X.y-Y.y)});if(!V.drawn){this.div.appendChild(W);V.drawn=true}}},removeMarker:function(V){B.Util.removeItem(this.markers,V);if((V.div!=null)&&(V.div.parentNode==this.div)){this.div.removeChild(V.div)}},CLASS_NAME:"OpenLayers.Layer.Boxes"});B.Layer.XYZ=B.Class(B.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,serverResolutions:null,initialize:function(X,W,V){if(V&&V.sphericalMercator||this.sphericalMercator){V=B.Util.extend({projection:"EPSG:900913",numZoomLevels:19},V)}B.Layer.Grid.prototype.initialize.apply(this,[X||this.name,W||this.url,{},V])},clone:function(V){if(V==null){V=new B.Layer.XYZ(this.name,this.url,this.getOptions())}V=B.Layer.Grid.prototype.clone.apply(this,[V]);return V},getURL:function(Y){var V=this.getXYZ(Y);var W=this.url;if(B.Util.isArray(W)){var X=""+V.x+V.y+V.z;W=this.selectUrl(X,W)}return B.String.format(W,V)},getXYZ:function(Y){var X=this.getServerResolution();var V=Math.round((Y.left-this.maxExtent.left)/(X*this.tileSize.w));var aa=Math.round((this.maxExtent.top-Y.top)/(X*this.tileSize.h));var Z=this.getServerZoom();if(this.wrapDateLine){var W=Math.pow(2,Z);V=((V%W)+W)%W}return{x:V,y:aa,z:Z}},setMap:function(V){B.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new B.LonLat(this.maxExtent.left,this.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.XYZ"});B.Layer.UTFGrid=B.Class(B.Layer.XYZ,{isBaseLayer:false,projection:new B.Projection("EPSG:900913"),useJSONP:false,tileClass:B.Tile.UTFGrid,initialize:function(V){B.Layer.Grid.prototype.initialize.apply(this,[V.name,V.url,{},V]);this.tileOptions=B.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},clone:function(V){if(V==null){V=new B.Layer.UTFGrid(this.getOptions())}V=B.Layer.Grid.prototype.clone.apply(this,[V]);return V},getFeatureInfo:function(W){var X=null;var V=this.getTileData(W);if(V.tile){X=V.tile.getFeatureInfo(V.i,V.j)}return X},getFeatureId:function(V){var X=null;var W=this.getTileData(V);if(W.tile){X=W.tile.getFeatureId(W.i,W.j)}return X},CLASS_NAME:"OpenLayers.Layer.UTFGrid"});B.Layer.OSM=B.Class(B.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,wrapDateLine:true,tileOptions:null,initialize:function(X,W,V){B.Layer.XYZ.prototype.initialize.apply(this,arguments);this.tileOptions=B.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(V){if(V==null){V=new B.Layer.OSM(this.name,this.url,this.getOptions())}V=B.Layer.XYZ.prototype.clone.apply(this,[V]);return V},CLASS_NAME:"OpenLayers.Layer.OSM"});B.Layer.Bing=B.Class(B.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(X){X=B.Util.applyDefaults({sphericalMercator:true},X);var W=X.name||"Bing "+(X.type||this.type);var V=[W,null,X];B.Layer.XYZ.prototype.initialize.apply(this,V);this.tileOptions=B.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");window[this._callbackId]=B.Function.bind(B.Layer.Bing.processMetadata,this);var X=B.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams);var W="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+B.Util.getParameterString(X);var V=document.createElement("script");V.type="text/javascript";V.src=W;V.id=this._callbackId;document.getElementsByTagName("head")[0].appendChild(V)},initLayer:function(){var X=this.metadata.resourceSets[0].resources[0];var V=X.imageUrl.replace("{quadkey}","${quadkey}");V=V.replace("{culture}",this.culture);this.url=[];for(var W=0;W<X.imageUrlSubdomains.length;++W){this.url.push(V.replace("{subdomain}",X.imageUrlSubdomains[W]))}this.addOptions({maxResolution:Math.min(this.serverResolutions[X.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(X.zoomMax+1-X.zoomMin,this.numZoomLevels)},true)},getURL:function(V){if(!this.url){return}var ab=this.getXYZ(V),ae=ab.x,ac=ab.y,aa=ab.z;var X=[];for(var Y=aa;Y>0;--Y){var ad="0";var af=1<<(Y-1);if((ae&af)!=0){ad++}if((ac&af)!=0){ad++;ad++}X.push(ad)}var Z=X.join("");var W=this.selectUrl(""+ae+ac+aa,this.url);return B.String.format(W,{quadkey:Z})},updateAttribution:function(){var ab=this.metadata;if(!ab.resourceSets||!this.map||!this.map.center){return}var aa=ab.resourceSets[0].resources[0];var ah=this.map.getExtent().transform(this.map.getProjectionObject(),new B.Projection("EPSG:4326"));var X=aa.imageryProviders,ag=B.Util.indexOf(this.serverResolutions,this.getServerResolution()),V="",ac,Y,af,W,Z,ae,ad;for(Y=0,af=X.length;Y<af;++Y){ac=X[Y];for(W=0,Z=ac.coverageAreas.length;W<Z;++W){ad=ac.coverageAreas[W];ae=B.Bounds.fromArray(ad.bbox,true);if(ah.intersectsBounds(ae)&&ag<=ad.zoomMax&&ag>=ad.zoomMin){V+=ac.attribution+" "}}}this.attribution=B.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:ab.brandLogoUri,copyrights:V});this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})},setMap:function(){B.Layer.XYZ.prototype.setMap.apply(this,arguments);this.updateAttribution();this.map.events.register("moveend",this,this.updateAttribution)},clone:function(V){if(V==null){V=new B.Layer.Bing(this.options)}V=B.Layer.XYZ.prototype.clone.apply(this,[V]);return V},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);B.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"});B.Layer.Bing.processMetadata=function(W){this.metadata=W;this.initLayer();var V=document.getElementById(this._callbackId);V.parentNode.removeChild(V);window[this._callbackId]=undefined;delete this._callbackId};B.Layer.TileCache=B.Class(B.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(X,W,Y,V){this.layername=Y;B.Layer.Grid.prototype.initialize.apply(this,[X,W,{},V]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension},clone:function(V){if(V==null){V=new B.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())}V=B.Layer.Grid.prototype.clone.apply(this,[V]);return V},getURL:function(W){var aa=this.getServerResolution();var ab=this.maxExtent;var af=this.tileSize;var V=Math.round((W.left-ab.left)/(aa*af.w));var ae=Math.round((W.bottom-ab.bottom)/(aa*af.h));var ac=this.serverResolutions!=null?B.Util.indexOf(this.serverResolutions,aa):this.map.getZoom();function Z(aj,ai){aj=String(aj);var ag=[];for(var ah=0;ah<ai;++ah){ag.push("0")}return ag.join("").substring(0,ai-aj.length)+aj}var Y=[this.layername,Z(ac,2),Z(parseInt(V/1000000),3),Z((parseInt(V/1000)%1000),3),Z((parseInt(V)%1000),3),Z(parseInt(ae/1000000),3),Z((parseInt(ae/1000)%1000),3),Z((parseInt(ae)%1000),3)+"."+this.extension];var ad=Y.join("/");var X=this.url;if(B.Util.isArray(X)){X=this.selectUrl(ad,X)}X=(X.charAt(X.length-1)=="/")?X:X+"/";return X+ad},CLASS_NAME:"OpenLayers.Layer.TileCache"});B.Feature=B.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(V,X,W){this.layer=V;this.lonlat=X;this.data=(W!=null)?W:{};this.id=B.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var W=false;if((this.layer!=null)&&(this.layer.map!=null)){var V=this.layer.map.getExtent();W=V.containsLonLat(this.lonlat)}return W},createMarker:function(){if(this.lonlat!=null){this.marker=new B.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(W){if(this.lonlat!=null){if(!this.popup){var V=(this.marker)?this.marker.icon:null;var X=this.popupClass?this.popupClass:B.Popup.Anchored;this.popup=new X(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,V,W)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});B.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};B.Feature.Vector=B.Class(B.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(X,V,W){B.Feature.prototype.initialize.apply(this,[null,null,V]);this.lonlat=null;this.geometry=X?X:null;this.state=null;this.attributes={};if(V){this.attributes=B.Util.extend(this.attributes,V)}this.style=W?W:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;B.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new B.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(Y){var X=false;if(this.layer&&this.layer.map){var V=this.layer.map.getExtent();if(Y){var W=this.geometry.getBounds();X=V.intersectsBounds(W)}else{var Z=V.toGeometry();X=Z.intersects(this.geometry)}}return X},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(W,Y,X){var V=false;if(this.geometry){V=this.geometry.atPoint(W,Y,X)}return V},destroyPopup:function(){},move:function(V){if(!this.layer||!this.geometry.move){return undefined}var W;if(V.CLASS_NAME=="OpenLayers.LonLat"){W=this.layer.getViewPortPxFromLonLat(V)}else{W=V}var Y=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var X=this.layer.map.getResolution();this.geometry.move(X*(W.x-Y.x),X*(Y.y-W.y));this.layer.drawFeature(this);return Y},toState:function(V){if(V==B.State.UPDATE){switch(this.state){case B.State.UNKNOWN:case B.State.DELETE:this.state=V;break;case B.State.UPDATE:case B.State.INSERT:break}}else{if(V==B.State.INSERT){switch(this.state){case B.State.UNKNOWN:break;default:this.state=V;break}}else{if(V==B.State.DELETE){switch(this.state){case B.State.INSERT:break;case B.State.DELETE:break;case B.State.UNKNOWN:case B.State.UPDATE:this.state=V;break}}else{if(V==B.State.UNKNOWN){this.state=V}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});B.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};B.Handler=B.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(Y,W,V){B.Util.extend(this,V);this.control=Y;this.callbacks=W;var X=this.map||Y.map;if(X){this.setMap(X)}this.id=B.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(V){this.map=V},checkModifiers:function(V){if(this.keyMask==null){return true}var W=(V.shiftKey?B.Handler.MOD_SHIFT:0)|(V.ctrlKey?B.Handler.MOD_CTRL:0)|(V.altKey?B.Handler.MOD_ALT:0);return(W==this.keyMask)},activate:function(){if(this.active){return false}var X=B.Events.prototype.BROWSER_EVENTS;for(var W=0,V=X.length;W<V;W++){if(this[X[W]]){this.register(X[W],this[X[W]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var X=B.Events.prototype.BROWSER_EVENTS;for(var W=0,V=X.length;W<V;W++){if(this[X[W]]){this.unregister(X[W],this[X[W]])}}this.active=false;return true},callback:function(W,V){if(W&&this.callbacks[W]){this.callbacks[W].apply(this.control,V)}},register:function(V,W){this.map.events.registerPriority(V,this,W);this.map.events.registerPriority(V,this,this.setEvent)},unregister:function(V,W){this.map.events.unregister(V,this,W);this.map.events.unregister(V,this,this.setEvent)},setEvent:function(V){this.evt=V;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});B.Handler.MOD_NONE=0;B.Handler.MOD_SHIFT=1;B.Handler.MOD_CTRL=2;B.Handler.MOD_ALT=4;B.Handler.Click=B.Class(B.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,dblclickTolerance:13,stopSingle:false,stopDouble:false,timerId:null,touch:false,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(V){if(!this.touch){this.unregisterMouseListeners();this.touch=true}this.down=this.getEventInfo(V);this.last=this.getEventInfo(V);return true},touchmove:function(V){this.last=this.getEventInfo(V);return true},touchend:function(V){if(this.down){V.xy=this.last.xy;V.lastTouches=this.last.touches;this.handleSingle(V);this.down=null}return true},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(V){this.down=this.getEventInfo(V);this.last=this.getEventInfo(V);return true},mouseup:function(W){var V=true;if(this.checkModifiers(W)&&this.control.handleRightClicks&&B.Event.isRightClick(W)){V=this.rightclick(W)}return V},rightclick:function(W){if(this.passesTolerance(W)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[W]);return !this.stopDouble}else{var V=this["double"]?B.Util.extend({},W):this.callback("rightclick",[W]);var X=B.Function.bind(this.delayedRightCall,this,V);this.rightclickTimerId=window.setTimeout(X,this.delay)}}return !this.stopSingle},delayedRightCall:function(V){this.rightclickTimerId=null;if(V){this.callback("rightclick",[V])}},click:function(V){if(!this.last){this.last=this.getEventInfo(V)}this.handleSingle(V);return !this.stopSingle},dblclick:function(V){this.handleDouble(V);return !this.stopDouble},handleDouble:function(V){if(this.passesDblclickTolerance(V)){if(this["double"]){this.callback("dblclick",[V])}this.clearTimer()}},handleSingle:function(W){if(this.passesTolerance(W)){if(this.timerId!=null){if(this.last.touches&&this.last.touches.length===1){if(this["double"]){B.Event.stop(W)}this.handleDouble(W)}if(!this.last.touches||this.last.touches.length!==2){this.clearTimer()}}else{this.first=this.getEventInfo(W);var V=this.single?B.Util.extend({},W):null;this.queuePotentialClick(V)}}},queuePotentialClick:function(V){this.timerId=window.setTimeout(B.Function.bind(this.delayedCall,this,V),this.delay)},passesTolerance:function(V){var Y=true;if(this.pixelTolerance!=null&&this.down&&this.down.xy){Y=this.pixelTolerance>=this.down.xy.distanceTo(V.xy);if(Y&&this.touch&&this.down.touches.length===this.last.touches.length){for(var W=0,X=this.down.touches.length;W<X;++W){if(this.getTouchDistance(this.down.touches[W],this.last.touches[W])>this.pixelTolerance){Y=false;break}}}}return Y},getTouchDistance:function(W,V){return Math.sqrt(Math.pow(W.clientX-V.clientX,2)+Math.pow(W.clientY-V.clientY,2))},passesDblclickTolerance:function(V){var W=true;if(this.down&&this.first){W=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance}return W},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(V){this.timerId=null;if(V){this.callback("click",[V])}},getEventInfo:function(W){var Y;if(W.touches){var V=W.touches.length;Y=new Array(V);var Z;for(var X=0;X<V;X++){Z=W.touches[X];Y[X]={clientX:Z.clientX,clientY:Z.clientY}}}return{xy:W.xy,touches:Y}},deactivate:function(){var V=false;if(B.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;this.touch=false;V=true}return V},CLASS_NAME:"OpenLayers.Handler.Click"});B.Handler.Hover=B.Class(B.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,mousemove:function(V){if(this.passesTolerance(V.xy)){this.clearTimer();this.callback("move",[V]);this.px=V.xy;V=B.Util.extend({},V);this.timerId=window.setTimeout(B.Function.bind(this.delayedCall,this,V),this.delay)}return !this.stopMove},mouseout:function(V){if(B.Util.mouseLeft(V,this.map.viewPortDiv)){this.clearTimer();this.callback("move",[V])}return true},passesTolerance:function(W){var X=true;if(this.pixelTolerance&&this.px){var V=Math.sqrt(Math.pow(this.px.x-W.x,2)+Math.pow(this.px.y-W.y,2));if(V<this.pixelTolerance){X=false}}return X},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(V){this.callback("pause",[V])},deactivate:function(){var V=false;if(B.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();V=true}return V},CLASS_NAME:"OpenLayers.Handler.Hover"});B.Handler.Point=B.Class(B.Handler,{point:null,layer:null,multi:false,citeCompliant:false,mouseDown:false,stoppedDown:null,lastDown:null,lastUp:null,persist:false,stopDown:false,stopUp:false,layerOptions:null,pixelTolerance:5,touch:false,lastTouchPx:null,initialize:function(X,W,V){if(!(V&&V.layerOptions&&V.layerOptions.styleMap)){this.style=B.Util.extend(B.Feature.Vector.style["default"],{})}B.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!B.Handler.prototype.activate.apply(this,arguments)){return false}var V=B.Util.extend({displayInLayerSwitcher:false,calculateInRange:B.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new B.Layer.Vector(this.CLASS_NAME,V);this.map.addLayer(this.layer);return true},createFeature:function(V){var W=this.layer.getLonLatFromViewPortPx(V);var X=new B.Geometry.Point(W.lon,W.lat);this.point=new B.Feature.Vector(X);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!B.Handler.prototype.deactivate.apply(this,arguments)){return false}this.cancel();if(this.layer.map!=null){this.destroyFeature(true);this.layer.destroy(false)}this.layer=null;this.touch=false;return true},destroyFeature:function(V){if(this.layer&&(V||!this.persist)){this.layer.destroyFeatures()}this.point=null},destroyPersistedFeature:function(){var V=this.layer;if(V&&V.features.length>1){this.layer.features[0].destroy()}},finalize:function(W){var V=W?"cancel":"done";this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(V,[this.geometryClone()]);this.destroyFeature(W)},cancel:function(){this.finalize(true)},click:function(V){B.Event.stop(V);return false},dblclick:function(V){B.Event.stop(V);return false},modifyFeature:function(V){if(!this.point){this.createFeature(V)}var W=this.layer.getLonLatFromViewPortPx(V);this.point.geometry.x=W.lon;this.point.geometry.y=W.lat;this.callback("modify",[this.point.geometry,this.point,false]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var V=this.point&&this.point.geometry;if(V&&this.multi){V=new B.Geometry.MultiPoint([V])}return V},geometryClone:function(){var V=this.getGeometry();return V&&V.clone()},mousedown:function(V){return this.down(V)},touchstart:function(V){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})}this.lastTouchPx=V.xy;return this.down(V)},mousemove:function(V){return this.move(V)},touchmove:function(V){this.lastTouchPx=V.xy;return this.move(V)},mouseup:function(V){return this.up(V)},touchend:function(V){V.xy=this.lastTouchPx;return this.up(V)},down:function(V){this.mouseDown=true;this.lastDown=V.xy;if(!this.touch){this.modifyFeature(V.xy)}this.stoppedDown=this.stopDown;return !this.stopDown},move:function(V){if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(V.xy)}return true},up:function(V){this.mouseDown=false;this.stoppedDown=this.stopDown;if(!this.checkModifiers(V)){return true}if(this.lastUp&&this.lastUp.equals(V.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,V.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(V.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=V.xy;this.finalize();return !this.stopUp}else{return true}},mouseout:function(V){if(B.Util.mouseLeft(V,this.map.viewPortDiv)){this.stoppedDown=this.stopDown;this.mouseDown=false}},passesTolerance:function(Z,Y,V){var W=true;if(V!=null&&Z&&Y){var X=Z.distanceTo(Y);if(X>V){W=false}}return W},CLASS_NAME:"OpenLayers.Handler.Point"});B.Handler.Path=B.Class(B.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:false,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(V){var W=this.layer.getLonLatFromViewPortPx(V);var X=new B.Geometry.Point(W.lon,W.lat);this.point=new B.Feature.Vector(X);this.line=new B.Feature.Vector(new B.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(V){B.Handler.Point.prototype.destroyFeature.call(this,V);this.line=null},destroyPersistedFeature:function(){var V=this.layer;if(V&&V.features.length>2){this.layer.features[0].destroy()}},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(V){this.layer.removeFeatures([this.point]);var W=this.layer.getLonLatFromViewPortPx(V);this.point=new B.Feature.Vector(new B.Geometry.Point(W.lon,W.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(V,W){this.line.geometry.addComponent(new B.Geometry.Point(V,W),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(W,V){var X=this.getCurrentPointIndex()-1;var Y=this.line.geometry.components[X];if(Y&&!isNaN(Y.x)&&!isNaN(Y.y)){this.insertXY(Y.x+W,Y.y+V)}},insertDirectionLength:function(Y,X){Y*=Math.PI/180;var W=X*Math.cos(Y);var V=X*Math.sin(Y);this.insertDeltaXY(W,V)},insertDeflectionLength:function(X,W){var Y=this.getCurrentPointIndex()-1;if(Y>0){var Z=this.line.geometry.components[Y];var aa=this.line.geometry.components[Y-1];var V=Math.atan2(Z.y-aa.y,Z.x-aa.x);this.insertDirectionLength((V*180/Math.PI)+X,W)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var Z=this.line.geometry;var W=Z.components;var V=this.getCurrentPointIndex()-1;var Y=W[V];var X=Z.removeComponent(Y);if(X){if(!this.redoStack){this.redoStack=[]}this.redoStack.push(Y);this.drawFeature()}return X},redo:function(){var V=this.redoStack&&this.redoStack.pop();if(V){this.line.geometry.addComponent(V,this.getCurrentPointIndex());this.drawFeature()}return !!V},freehandMode:function(V){return(this.freehandToggle&&V[this.freehandToggle])?!this.freehand:this.freehand},modifyFeature:function(W,V){if(!this.line){this.createFeature(W)}var X=this.layer.getLonLatFromViewPortPx(W);this.point.geometry.x=X.lon;this.point.geometry.y=X.lat;this.callback("modify",[this.point.geometry,this.getSketch(),V]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var V=this.line&&this.line.geometry;if(V&&this.multi){V=new B.Geometry.MultiLineString([V])}return V},touchstart:function(V){if(this.timerId&&this.passesTolerance(this.lastTouchPx,V.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return false}else{if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(B.Function.bind(function(){this.timerId=null},this),300);return B.Handler.Point.prototype.touchstart.call(this,V)}},down:function(V){var W=this.stopDown;if(this.freehandMode(V)){W=true;if(this.touch){this.modifyFeature(V.xy,!!this.lastUp);B.Event.stop(V)}}if(!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,V.xy,this.pixelTolerance))){this.modifyFeature(V.xy,!!this.lastUp)}this.mouseDown=true;this.lastDown=V.xy;this.stoppedDown=W;return !W},move:function(V){if(this.stoppedDown&&this.freehandMode(V)){if(this.persist){this.destroyPersistedFeature()}if(this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices){this.removePoint();this.finalize()}else{this.addPoint(V.xy)}return false}if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(V.xy,!!this.lastUp)}return true},up:function(V){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(V.xy))){if(this.stoppedDown&&this.freehandMode(V)){if(this.persist){this.destroyPersistedFeature()}this.removePoint();this.finalize()}else{if(this.passesTolerance(this.lastDown,V.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(V.xy)}if(this.lastUp==null&&this.persist){this.destroyPersistedFeature()}this.addPoint(V.xy);this.lastUp=V.xy;if(this.line.geometry.components.length===this.maxVertices+1){this.finishGeometry()}}}}this.stoppedDown=this.stopDown;this.mouseDown=false;return !this.stopUp},finishGeometry:function(){var V=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[V]);this.removePoint();this.finalize()},dblclick:function(V){if(!this.freehandMode(V)){this.finishGeometry()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});B.Handler.Polygon=B.Class(B.Handler.Path,{holeModifier:null,drawingHole:false,polygon:null,createFeature:function(V){var W=this.layer.getLonLatFromViewPortPx(V);var X=new B.Geometry.Point(W.lon,W.lat);this.point=new B.Feature.Vector(X);this.line=new B.Feature.Vector(new B.Geometry.LinearRing([this.point.geometry]));this.polygon=new B.Feature.Vector(new B.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},addPoint:function(V){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){var aa=this.point.geometry;var Z=this.control.layer.features;var Y,X;for(var W=Z.length-1;W>=0;--W){Y=Z[W].geometry;if((Y instanceof B.Geometry.Polygon||Y instanceof B.Geometry.MultiPolygon)&&Y.intersects(aa)){X=Z[W];this.control.layer.removeFeatures([X],{silent:true});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);X.geometry.addComponent(this.line.geometry);this.polygon=X;this.drawingHole=true;break}}}B.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(Y){var V=Y.vertex;var X=this.line.geometry.components;if(!this.polygon.geometry.intersects(V)){var W=X[X.length-3];V.x=W.x;V.y=W.y}},finishGeometry:function(){var V=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[V]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var X=this.line.geometry;var W=(X.getArea()!==0);if(W){var ac=this.polygon.geometry.components;for(var Y=ac.length-2;Y>=0;--Y){if(X.intersects(ac[Y])){W=false;break}}if(W){var ab;outer:for(var Y=ac.length-2;Y>0;--Y){var Z=ac[Y].components;for(var V=0,aa=Z.length;V<aa;++V){if(X.containsPoint(Z[V])){W=false;break outer}}}}}if(W){if(this.polygon.state!==B.State.INSERT){this.polygon.state=B.State.UPDATE}}else{this.polygon.geometry.removeComponent(X)}this.restoreFeature();return false},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);this.restoreFeature(true)}return B.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(V){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:true});this.control.layer.addFeatures([this.polygon],{silent:true});this.drawingHole=false;if(!V){this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})}},destroyFeature:function(V){B.Handler.Path.prototype.destroyFeature.call(this,V);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var V=this.polygon&&this.polygon.geometry;if(V&&this.multi){V=new B.Geometry.MultiPolygon([V])}return V},CLASS_NAME:"OpenLayers.Handler.Polygon"});B.Handler.Feature=B.Class(B.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:false,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(Y,W,X,V){B.Handler.prototype.initialize.apply(this,[Y,X,V]);this.layer=W},touchstart:function(V){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})}return B.Event.isMultiTouch(V)?true:this.mousedown(V)},touchmove:function(V){B.Event.stop(V)},mousedown:function(V){if(B.Event.isLeftClick(V)||B.Event.isSingleTouch(V)){this.down=V.xy}return this.handle(V)?!this.stopDown:true},mouseup:function(V){this.up=V.xy;return this.handle(V)?!this.stopUp:true},click:function(V){return this.handle(V)?!this.stopClick:true},mousemove:function(V){if(!this.callbacks.over&&!this.callbacks.out){return true}this.handle(V);return true},dblclick:function(V){return !this.handle(V)},geometryTypeMatches:function(V){return this.geometryTypes==null||B.Util.indexOf(this.geometryTypes,V.geometry.CLASS_NAME)>-1},handle:function(V){if(this.feature&&!this.feature.layer){this.feature=null}var X=V.type;var aa=false;var Z=!!(this.feature);var Y=(X=="click"||X=="dblclick"||X=="touchstart");this.feature=this.layer.getFeatureFromEvent(V);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){if(X==="touchstart"){B.Event.stop(V)}var W=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(Z&&W){if(this.lastFeature){this.triggerCallback(X,"out",[this.lastFeature])}this.triggerCallback(X,"in",[this.feature])}else{if(!Z||Y){this.triggerCallback(X,"in",[this.feature])}}this.lastFeature=this.feature;aa=true}else{if(this.lastFeature&&(Z&&W||Y)){this.triggerCallback(X,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(Z||Y)){this.triggerCallback(X,"out",[this.lastFeature])}}return aa},triggerCallback:function(Y,Z,W){var X=this.EVENTMAP[Y][Z];if(X){if(Y=="click"&&this.up&&this.down){var V=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(V<=this.clickTolerance){this.callback(X,W)}}else{this.callback(X,W)}}},activate:function(){var V=false;if(B.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});V=true}return V},deactivate:function(){var V=false;if(B.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.touch=false;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});V=true}return V},handleMapEvents:function(V){if(V.type=="removelayer"||V.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var V=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(V)},moveLayerBack:function(){var V=this.layer.getZIndex()-1;if(V>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(V)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});B.Handler.Drag=B.Class(B.Handler,{started:false,stopDown:true,dragging:false,touch:false,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(Y,X,V){B.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===true){var W=this;this._docMove=function(Z){W.mousemove({xy:{x:Z.clientX,y:Z.clientY},element:document})};this._docUp=function(Z){W.mouseup({xy:{x:Z.clientX,y:Z.clientY}})}}},dragstart:function(W){var V=true;this.dragging=false;if(this.checkModifiers(W)&&(B.Event.isLeftClick(W)||B.Event.isSingleTouch(W))){this.started=true;this.start=W.xy;this.last=W.xy;B.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(W);this.callback("down",[W.xy]);B.Event.stop(W);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:B.Function.True}document.onselectstart=B.Function.False;V=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return V},dragmove:function(V){this.lastMoveEvt=V;if(this.started&&!this.timeoutId&&(V.xy.x!=this.last.x||V.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(V.element===document){this.adjustXY(V);this.setEvent(V)}else{this.removeDocumentEvents()}}if(this.interval>0){this.timeoutId=setTimeout(B.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(V);this.callback("move",[V.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=B.Function.False}this.last=V.xy}return true},dragend:function(W){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(W);this.removeDocumentEvents()}var V=(this.start!=this.last);this.started=false;this.dragging=false;B.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(W);this.callback("up",[W.xy]);if(V){this.callback("done",[W.xy])}document.onselectstart=this.oldOnselectstart}return true},down:function(V){},move:function(V){},up:function(V){},out:function(V){},mousedown:function(V){return this.dragstart(V)},touchstart:function(V){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})}return this.dragstart(V)},mousemove:function(V){return this.dragmove(V)},touchmove:function(V){return this.dragmove(V)},removeTimeout:function(){this.timeoutId=null;if(this.dragging){this.mousemove(this.lastMoveEvt)}},mouseup:function(V){return this.dragend(V)},touchend:function(V){V.xy=this.last;return this.dragend(V)},mouseout:function(W){if(this.started&&B.Util.mouseLeft(W,this.map.viewPortDiv)){if(this.documentDrag===true){this.addDocumentEvents()}else{var V=(this.start!=this.last);this.started=false;this.dragging=false;B.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(W);this.callback("out",[]);if(V){this.callback("done",[W.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}}return true},click:function(V){return(this.start==this.last)},activate:function(){var V=false;if(B.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;V=true}return V},deactivate:function(){var V=false;if(B.Handler.prototype.deactivate.apply(this,arguments)){this.touch=false;this.started=false;this.dragging=false;this.start=null;this.last=null;V=true;B.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return V},adjustXY:function(V){var W=B.Util.pagePosition(this.map.viewPortDiv);V.xy.x-=W[0];V.xy.y-=W[1]},addDocumentEvents:function(){B.Element.addClass(document.body,"olDragDown");this.documentEvents=true;B.Event.observe(document,"mousemove",this._docMove);B.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){B.Element.removeClass(document.body,"olDragDown");this.documentEvents=false;B.Event.stopObserving(document,"mousemove",this._docMove);B.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});B.Handler.Pinch=B.Class(B.Handler,{started:false,stopDown:false,pinching:false,last:null,start:null,touchstart:function(W){var V=true;this.pinching=false;if(B.Event.isMultiTouch(W)){this.started=true;this.last=this.start={distance:this.getDistance(W.touches),delta:0,scale:1};this.callback("start",[W,this.start]);V=!this.stopDown}else{this.started=false;this.start=null;this.last=null}B.Event.stop(W);return V},touchmove:function(V){if(this.started&&B.Event.isMultiTouch(V)){this.pinching=true;var W=this.getPinchData(V);this.callback("move",[V,W]);this.last=W;B.Event.stop(V)}return true},touchend:function(V){if(this.started){this.started=false;this.pinching=false;this.callback("done",[V,this.start,this.last]);this.start=null;this.last=null}return true},activate:function(){var V=false;if(B.Handler.prototype.activate.apply(this,arguments)){this.pinching=false;V=true}return V},deactivate:function(){var V=false;if(B.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.pinching=false;this.start=null;this.last=null;V=true}return V},getDistance:function(X){var W=X[0];var V=X[1];return Math.sqrt(Math.pow(W.clientX-V.clientX,2)+Math.pow(W.clientY-V.clientY,2))},getPinchData:function(V){var X=this.getDistance(V.touches);var W=X/this.start.distance;return{distance:X,delta:this.last.distance-X,scale:W}},CLASS_NAME:"OpenLayers.Handler.Pinch"});B.Handler.Box=B.Class(B.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(X,W,V){B.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new B.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){B.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(V){B.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(V)}},startBox:function(V){this.callback("start",[]);this.zoomBox=B.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);B.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(Z){var Y=this.dragHandler.start.x;var W=this.dragHandler.start.y;var X=Math.abs(Y-Z.x);var V=Math.abs(W-Z.y);var aa=this.getBoxOffsets();this.zoomBox.style.width=(X+aa.width+1)+"px";this.zoomBox.style.height=(V+aa.height+1)+"px";this.zoomBox.style.left=(Z.x<Y?Y-X-aa.left:Y-aa.left)+"px";this.zoomBox.style.top=(Z.y<W?W-V-aa.top:W-aa.top)+"px"},endBox:function(W){var V;if(Math.abs(this.dragHandler.start.x-W.x)>5||Math.abs(this.dragHandler.start.y-W.y)>5){var ab=this.dragHandler.start;var aa=Math.min(ab.y,W.y);var X=Math.max(ab.y,W.y);var Z=Math.min(ab.x,W.x);var Y=Math.max(ab.x,W.x);V=new B.Bounds(Z,X,Y,aa)}else{V=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[V])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;B.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(B.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(B.Handler.prototype.deactivate.apply(this,arguments)){if(this.dragHandler.deactivate()){if(this.zoomBox){this.removeBox()}}return true}else{return false}},getBoxOffsets:function(){if(!this.boxOffsets){var Y=document.createElement("div");Y.style.position="absolute";Y.style.border="1px solid black";Y.style.width="3px";document.body.appendChild(Y);var V=Y.clientWidth==3;document.body.removeChild(Y);var aa=parseInt(B.Element.getStyle(this.zoomBox,"border-left-width"));var X=parseInt(B.Element.getStyle(this.zoomBox,"border-right-width"));var Z=parseInt(B.Element.getStyle(this.zoomBox,"border-top-width"));var W=parseInt(B.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:aa,right:X,top:Z,bottom:W,width:V===false?aa+X:0,height:V===false?Z+W:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});B.Handler.MouseWheel=B.Class(B.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(X,W,V){B.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=B.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){B.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(ad){if(!this.map||!this.checkModifiers(ad)){return}var aa=false;var af=false;var Z=false;var W=B.Event.element(ad);while((W!=null)&&!Z&&!aa){if(!aa){try{if(W.currentStyle){X=W.currentStyle.overflow}else{var V=document.defaultView.getComputedStyle(W,null);var X=V.getPropertyValue("overflow")}aa=(X&&(X=="auto")||(X=="scroll"))}catch(Y){}}if(!af){for(var ab=0,ac=this.map.layers.length;ab<ac;ab++){if(W==this.map.layers[ab].div||W==this.map.layers[ab].pane){af=true;break}}}Z=(W==this.map.div);W=W.parentNode}if(!aa&&Z){if(af){var ae=0;if(!ad){ad=window.event}if(ad.wheelDelta){ae=ad.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){ae=-ae}}else{if(ad.detail){ae=-ad.detail/3}}this.delta=this.delta+ae;if(this.interval){window.clearTimeout(this._timeoutId);this._timeoutId=window.setTimeout(B.Function.bind(function(){this.wheelZoom(ad)},this),this.interval)}else{this.wheelZoom(ad)}}B.Event.stop(ad)}},wheelZoom:function(V){var W=this.delta;this.delta=0;if(W){if(this.mousePosition){V.xy=this.mousePosition}if(!V.xy){V.xy=this.map.getPixelFromLonLat(this.map.getCenter())}if(W<0){this.callback("down",[V,this.cumulative?W:-1])}else{this.callback("up",[V,this.cumulative?W:1])}}},mousemove:function(V){this.mousePosition=V.xy},activate:function(V){if(B.Handler.prototype.activate.apply(this,arguments)){var W=this.wheelListener;B.Event.observe(window,"DOMMouseScroll",W);B.Event.observe(window,"mousewheel",W);B.Event.observe(document,"mousewheel",W);return true}else{return false}},deactivate:function(V){if(B.Handler.prototype.deactivate.apply(this,arguments)){var W=this.wheelListener;B.Event.stopObserving(window,"DOMMouseScroll",W);B.Event.stopObserving(window,"mousewheel",W);B.Event.stopObserving(document,"mousewheel",W);return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});B.Handler.Keyboard=B.Class(B.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(X,W,V){B.Handler.prototype.initialize.apply(this,arguments);this.eventListener=B.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;B.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(B.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var W=0,V=this.KEY_EVENTS.length;W<V;W++){B.Event.observe(this.observeElement,this.KEY_EVENTS[W],this.eventListener)}return true}else{return false}},deactivate:function(){var X=false;if(B.Handler.prototype.deactivate.apply(this,arguments)){for(var W=0,V=this.KEY_EVENTS.length;W<V;W++){B.Event.stopObserving(this.observeElement,this.KEY_EVENTS[W],this.eventListener)}X=true}return X},handleKeyEvent:function(V){if(this.checkModifiers(V)){this.callback(V.type,[V])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});B.Control=B.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,initialize:function(V){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");B.Util.extend(this,V);this.events=new B.Events(this);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=B.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var V in this.handlers){if(this.handlers.hasOwnProperty(V)&&typeof this.handlers[V].destroy=="function"){this.handlers[V].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(V){this.map=V;if(this.handler){this.handler.setMap(V)}},draw:function(V){if(this.div==null){this.div=B.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=B.Function.False}if(this.title!=""){this.div.title=this.title}}if(V!=null){this.position=V.clone()}this.moveTo(this.position);return this.div},moveTo:function(V){if((V!=null)&&(this.div!=null)){this.div.style.left=V.x+"px";this.div.style.top=V.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){B.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){B.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});B.Control.TYPE_BUTTON=1;B.Control.TYPE_TOGGLE=2;B.Control.TYPE_TOOL=3;B.Control.CacheRead=B.Class(B.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:true,setMap:function(X){B.Control.prototype.setMap.apply(this,arguments);var V,W=this.layers||X.layers;for(V=W.length-1;V>=0;--V){this.addLayer({layer:W[V]})}if(!this.layers){X.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(V){V.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(V){V.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(W){if(this.active&&window.localStorage&&W.tile instanceof B.Tile.Image){var Y=W.tile,X=Y.url;if(!Y.layer.crossOriginKeyword&&B.ProxyHost&&X.indexOf(B.ProxyHost)===0){X=B.Control.CacheWrite.urlMap[X]}var V=window.localStorage.getItem("olCache_"+X);if(V){Y.url=V;if(W.type==="tileerror"){Y.setImgSrc(V)}}}},destroy:function(){if(this.layers||this.map){var V,W=this.layers||this.map.layers;for(V=W.length-1;V>=0;--V){this.removeLayer({layer:W[V]})}}if(this.map){this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}B.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"});B.Control.CacheWrite=B.Class(B.Control,{layers:null,imageFormat:"image/png",quotaRegEx:(/quota/i),setMap:function(X){B.Control.prototype.setMap.apply(this,arguments);var V,W=this.layers||X.layers;for(V=W.length-1;V>=0;--V){this.addLayer({layer:W[V]})}if(!this.layers){X.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}},addLayer:function(V){V.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},removeLayer:function(V){V.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},makeSameOrigin:function(V){if(this.active){var X=V.tile;if(X instanceof B.Tile.Image&&!X.crossOriginKeyword&&X.url.substr(0,5)!=="data:"){var W=B.Request.makeSameOrigin(X.url,B.ProxyHost);B.Control.CacheWrite.urlMap[W]=X.url;X.url=W}}},cache:function(ab){if(this.active&&window.localStorage){var X=ab.tile;if(X instanceof B.Tile.Image&&X.url.substr(0,5)!=="data:"){try{var V=X.getCanvasContext();if(V){var Y=B.Control.CacheWrite.urlMap;var W=Y[X.url]||X.url;window.localStorage.setItem("olCache_"+W,V.canvas.toDataURL(this.imageFormat));delete Y[X.url]}}catch(aa){var Z=aa.name||aa.message;if(Z&&this.quotaRegEx.test(Z)){this.events.triggerEvent("cachefull",{tile:X})}else{B.Console.error(aa.toString())}}}}},destroy:function(){if(this.layers||this.map){var V,W=this.layers||this.map.layers;for(V=W.length-1;V>=0;--V){this.removeLayer({layer:W[V]})}}if(this.map){this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})}B.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"});B.Control.CacheWrite.clearCache=function(){if(!window.localStorage){return}var W,V;for(W=window.localStorage.length-1;W>=0;--W){V=window.localStorage.key(W);if(V.substr(0,8)==="olCache_"){window.localStorage.removeItem(V)}}};B.Control.CacheWrite.urlMap={};B.Control.ZoomBox=B.Class(B.Control,{type:B.Control.TYPE_TOOL,out:false,keyMask:null,alwaysZoom:false,draw:function(){this.handler=new B.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(ac){if(ac instanceof B.Bounds){var W;if(!this.out){var ad=this.map.getLonLatFromPixel({x:ac.left,y:ac.bottom});var ah=this.map.getLonLatFromPixel({x:ac.right,y:ac.top});W=new B.Bounds(ad.lon,ad.lat,ah.lon,ah.lat)}else{var ab=Math.abs(ac.right-ac.left);var ae=Math.abs(ac.top-ac.bottom);var Z=Math.min((this.map.size.h/ae),(this.map.size.w/ab));var ai=this.map.getExtent();var V=this.map.getLonLatFromPixel(ac.getCenterPixel());var X=V.lon-(ai.getWidth()/2)*Z;var aa=V.lon+(ai.getWidth()/2)*Z;var ag=V.lat-(ai.getHeight()/2)*Z;var Y=V.lat+(ai.getHeight()/2)*Z;W=new B.Bounds(X,ag,aa,Y)}var af=this.map.getZoom();this.map.zoomToExtent(W);if(af==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(af+(this.out?-1:1))}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(ac),this.map.getZoom()+1)}else{this.map.setCenter(this.map.getLonLatFromPixel(ac),this.map.getZoom()-1)}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});B.Control.ZoomToMaxExtent=B.Class(B.Control,{type:B.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});B.Control.DragPan=B.Class(B.Control,{type:B.Control.TYPE_TOOL,panned:false,interval:1,documentDrag:false,kinetic:null,enableKinetic:false,kineticInterval:10,draw:function(){if(this.enableKinetic){var V={interval:this.kineticInterval};if(typeof this.enableKinetic==="object"){V=B.Util.extend(V,this.enableKinetic)}this.kinetic=new B.Kinetic(V)}this.handler=new B.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){if(this.kinetic){this.kinetic.begin()}},panMap:function(V){if(this.kinetic){this.kinetic.update(V)}this.panned=true;this.map.pan(this.handler.last.x-V.x,this.handler.last.y-V.y,{dragging:true,animate:false})},panMapDone:function(X){if(this.panned){var W=null;if(this.kinetic){W=this.kinetic.end(X)}this.map.pan(this.handler.last.x-X.x,this.handler.last.y-X.y,{dragging:!!W,animate:false});if(W){var V=this;this.kinetic.move(W,function(Y,aa,Z){V.map.pan(Y,aa,{dragging:!Z,animate:false})})}this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});B.bases.ControlDragPan=B.Control.DragPan;B.Control.DragPan=B.Class(B.Control.DragPan,{middleDown:false,middleTime:null,startAngle:0,pinchAngle:0,touchTimeout:null,wheelTimeout:null,draw:function(){if(this.enableKinetic){var V={interval:this.kineticInterval};if(typeof this.enableKinetic==="object"){V=B.Util.extend(V,this.enableKinetic)}this.kinetic=new B.Kinetic(V)}this.handler=new B.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag,stopDown:false});if(M.caps.canTouch){this.handler.register("touchstart",M.jQuery.proxy(this.touchstart,this));this.handler.register("touchmove",M.jQuery.proxy(this.touchmove,this));this.handler.register("touchend",M.jQuery.proxy(this.touchend,this))}this.handler.register("mousedown",M.jQuery.proxy(this.mousedown,this));this.handler.register("mouseup",M.jQuery.proxy(this.mouseup,this));this.handler.register("mousemove",M.jQuery.proxy(this.mousemove,this));this.handler.register("mouseout",M.jQuery.proxy(this.mouseout,this))},touchstart:function(V){this.startAngle=M.rotate();if(this.touchTimeout){clearTimeout(this.touchTimeout)}if(V.touches.length==1){if(this.touchTimeout){clearTimeout(this.touchTimeout)}this.touchTimeout=setTimeout(function(){J.wheelChange(V,-1)},500)}},touchmove:function(W,V){if(this.touchTimeout){clearTimeout(this.touchTimeout)}if(M.caps.isAndroid){W.preventDefault()}},touchend:function(V){if(this.touchTimeout){clearTimeout(this.touchTimeout)}},mousemove:function(aa,Z,Y){if(this.middleDown&&M.caps.canMiddleClick){if(this.wheelTimeout){clearTimeout(this.wheelTimeout)}var W=new B.Geometry.Point(this.map.size.w/2,this.map.size.h/2);var V=(W.x-aa.xy.x);var ac=(W.y-aa.xy.y);var X=new B.Geometry.Point(aa.xy.x,aa.xy.y);var ab=Math.acos(ac/X.distanceTo(W))*180/Math.PI*(V>0?-1:1)-this.startAngle;M.rotate(ab)}},mousedown:function(Y){if(o&&!M.caps.isMobile&&!M.caps.isTablet&&M.caps.isFireFox){return}if(this.active&&((Y.which&&Y.which==2)||(Y.button&&Y.button==4))){this.middleDown=true;if(Y.preventDefault){Y.preventDefault()}if(Y.stopImmediatePropagation){Y.stopImmediatePropagation()}if(this.middleTime&&new Date()-this.middleTime<500){if(this.wheelTimeout){clearTimeout(this.wheelTimeout)}M.rotate(0);this.middleTime=null}else{this.middleTime=new Date();var W=(this.map.size.w/2-Y.xy.x);var Z=(this.map.size.h/2-Y.xy.y);var X=new B.Geometry.Point(Y.xy.x,Y.xy.y);var V=new B.Geometry.Point(this.map.size.w/2,this.map.size.h/2);this.startAngle=Math.acos(Z/X.distanceTo(V))*180/Math.PI*(W>0?-1:1)-M.rotate();if(this.wheelTimeout){clearTimeout(this.wheelTimeout)}this.wheelTimeout=setTimeout(function(){M.moveToWhole()},500)}}return true},mouseup:function(V){this.middleDown=false},mouseout:function(V){},panMap:function(W){if(!this.middleDown){if(this.kinetic){this.kinetic.update(W)}this.panned=true;var V=new B.Geometry.Point(this.handler.last.x-W.x,this.handler.last.y-W.y);V.rotate(360-M.rotate(),new B.Geometry.Point(0,0));if(!M.maxExtent().containsPoint(M.center().translateByPixels(V.x,V.y))){return}this.map.pan(V.x,V.y,{dragging:true,animate:false})}}});B.Control.Navigation=B.Class(B.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:B.Handler.MOD_SHIFT,autoActivate:true,initialize:function(V){this.handlers={};B.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;if(this.pinchZoom){this.pinchZoom.destroy()}this.pinchZoom=null;B.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate()}if(this.pinchZoom){this.pinchZoom.activate()}return B.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.pinchZoom){this.pinchZoom.deactivate()}this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return B.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=B.Function.False}var V={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var W={"double":true,stopDouble:true};this.handlers.click=new B.Handler.Click(this,V,W);this.dragPan=new B.Control.DragPan(B.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new B.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new B.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);if(B.Control.PinchZoom){this.pinchZoom=new B.Control.PinchZoom(B.Util.extend({map:this.map},this.pinchZoomOptions))}},defaultClick:function(V){if(V.lastTouches&&V.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(W){var V=this.map.getLonLatFromViewPortPx(W.xy);this.map.setCenter(V,this.map.zoom+1)},defaultDblRightClick:function(W){var V=this.map.getLonLatFromViewPortPx(W.xy);this.map.setCenter(V,this.map.zoom-1)},wheelChange:function(ad,X){var ac=this.map.getZoom();var aa=this.map.getZoom()+Math.round(X);aa=Math.max(aa,0);aa=Math.min(aa,this.map.getNumZoomLevels());if(aa===ac){return}var ae=this.map.getSize();var Z=ae.w/2-ad.xy.x;var Y=ad.xy.y-ae.h/2;var ab=this.map.baseLayer.getResolutionForZoom(aa);var V=this.map.getLonLatFromPixel(ad.xy);var W=new B.LonLat(V.lon+Z*ab,V.lat+Y*ab);this.map.setCenter(W,aa)},wheelUp:function(V,W){this.wheelChange(V,W||1)},wheelDown:function(V,W){this.wheelChange(V,W||-1)},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate()}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"OpenLayers.Control.Navigation"});B.bases.ControlNavigation=B.Control.Navigation;B.Control.Navigation=B.Class(B.Control.Navigation,{zoomBoxEnabled:false,wheelChange:function(V,W){v(V.xy.x,V.xy.y,Math.round(W))},defaultDblClick:function(V){if(V.which==2){return}B.bases.ControlNavigation.prototype.defaultDblClick.apply(this,[V])}});B.Control.PinchZoom=B.Class(B.Control,{type:B.Control.TYPE_TOOL,containerCenter:null,pinchOrigin:null,currentCenter:null,autoActivate:true,initialize:function(V){B.Control.prototype.initialize.apply(this,arguments);this.handler=new B.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var V=B.Control.prototype.activate.apply(this,arguments);if(V){this.map.events.on({moveend:this.updateContainerCenter,scope:this});this.updateContainerCenter()}return V},deactivate:function(){var V=B.Control.prototype.deactivate.apply(this,arguments);if(this.map&&this.map.events){this.map.events.un({moveend:this.updateContainerCenter,scope:this})}return V},updateContainerCenter:function(){var V=this.map.layerContainerDiv;this.containerCenter={x:parseInt(V.style.left,10)+50,y:parseInt(V.style.top,10)+50}},pinchStart:function(V,W){this.pinchOrigin=V.xy;this.currentCenter=V.xy},pinchMove:function(W,ac){var ab=ac.scale;var Z=this.containerCenter;var Y=this.pinchOrigin;var aa=W.xy;var X=Math.round((aa.x-Y.x)+(ab-1)*(Z.x-Y.x));var V=Math.round((aa.y-Y.y)+(ab-1)*(Z.y-Y.y));this.applyTransform("translate("+X+"px, "+V+"px) scale("+ab+")");this.currentCenter=aa},applyTransform:function(V){var W=this.map.layerContainerDiv.style;W["-webkit-transform"]=V;W["-moz-transform"]=V},pinchDone:function(W,ac,ab){this.applyTransform("");var aa=this.map.getZoomForResolution(this.map.getResolution()/ab.scale,true);if(aa!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var Y=this.map.getResolutionForZoom(aa);var V=this.map.getLonLatFromPixel(this.pinchOrigin);var X=this.currentCenter;var Z=this.map.getSize();V.lon+=Y*((Z.w/2)-X.x);V.lat-=Y*((Z.h/2)-X.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(V,aa)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});B.bases.ControlPinchZoom=B.Control.PinchZoom;B.Control.PinchZoom=B.Class(B.Control.PinchZoom,{pinchStart:function(V,W){this.startAngle=M.rotate();this.pinchAngle=this.getPinchAngle(V);B.bases.ControlPinchZoom.prototype.pinchStart.apply(this,arguments);if(M.caps.isAndroid){e.preventDefault()}},pinchMove:function(W,ac){M.rotate(this.startAngle+this.getPinchAngle(W)-this.pinchAngle);var ab=ac.scale;var Z=this.containerCenter;var Y=this.pinchOrigin;var aa=W.xy;var X=Math.round((aa.x-Y.x)+(ab-1)*(Z.x-Y.x));var V=Math.round((aa.y-Y.y)+(ab-1)*(Z.y-Y.y));if(M.layersManager.backgroundLayers.length&&!M.layersManager.backgroundLayers[0].isGoogleLayer()){this.applyTransform("translate("+X+"px, "+V+"px) scale("+ab+")")}this.currentCenter=aa},getPinchAngle:function(Y){if(Y.touches.length<2){return 0}var X=Y.touches[0];var W=Y.touches[1];var V=(W.clientX-X.clientX);var aa=(W.clientY-X.clientY);var Z=Math.atan(V/aa)*180/Math.PI;if(V>=0){if(aa>=0){return 180-Z}else{return -Z}}else{if(aa>=0){return 180-Z}else{return 360-Z}}}});B.Control.TouchNavigation=B.Class(B.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:false,autoActivate:true,initialize:function(V){this.handlers={};B.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.pinchZoom){this.pinchZoom.destroy();delete this.pinchZoom}B.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(B.Control.prototype.activate.apply(this,arguments)){this.dragPan.activate();this.handlers.click.activate();this.pinchZoom.activate();return true}return false},deactivate:function(){if(B.Control.prototype.deactivate.apply(this,arguments)){this.dragPan.deactivate();this.handlers.click.deactivate();this.pinchZoom.deactivate();return true}return false},draw:function(){var V={click:this.defaultClick,dblclick:this.defaultDblClick};var W=B.Util.extend({"double":true,stopDouble:true,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new B.Handler.Click(this,V,W);this.dragPan=new B.Control.DragPan(B.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new B.Control.PinchZoom(B.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(V){if(V.lastTouches&&V.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(W){var V=this.map.getLonLatFromViewPortPx(W.xy);this.map.setCenter(V,this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});B.Control.KeyboardDefaults=B.Class(B.Control,{autoActivate:true,slideFactor:75,observeElement:null,draw:function(){var V=this.observeElement||document;this.handler=new B.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:V})},defaultKeyPress:function(V){var W,X=true;switch(V.keyCode){case B.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case B.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case B.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case B.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:W=this.map.getSize();this.map.pan(0,-0.75*W.h);break;case 34:W=this.map.getSize();this.map.pan(0,0.75*W.h);break;case 35:W=this.map.getSize();this.map.pan(0.75*W.w,0);break;case 36:W=this.map.getSize();this.map.pan(-0.75*W.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:X=false}if(X){B.Event.stop(V)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});B.Control.ScaleLine=B.Class(B.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,draw:function(){B.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var V=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(W){var Y=parseInt(Math.log(W)/Math.log(10));var V=Math.pow(10,Y);var X=parseInt(W/V);var Z;if(X>5){Z=5}else{if(X>2){Z=2}else{Z=1}}return Z*V},update:function(){var ae=this.map.getResolution();if(!ae){return}var aj=this.map.getUnits();var Z=B.INCHES_PER_UNIT;var ag=this.maxWidth*ae*Z[aj];var ai=1;if(this.geodesic===true){var W=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;var aa=ag/Z.km;ai=W/aa;ag*=ai}var V;var Y;if(ag>100000){V=this.topOutUnits;Y=this.bottomOutUnits}else{V=this.topInUnits;Y=this.bottomInUnits}var ac=ag/Z[V];var af=ag/Z[Y];var ad=this.getBarLen(ac);var ab=this.getBarLen(af);ac=ad/Z[aj]*Z[V];af=ab/Z[aj]*Z[Y];var X=ac/ae/ai;var ah=af/ae/ai;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(ah)+"px";this.eBottom.innerHTML=ab+" "+Y}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(X)+"px";this.eTop.innerHTML=ad+" "+V}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});B.Control.DrawFeature=B.Class(B.Control,{layer:null,callbacks:null,multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(W,X,V){B.Control.prototype.initialize.apply(this,[V]);this.callbacks=B.Util.extend({done:this.drawFeature,modify:function(aa,Z){this.layer.events.triggerEvent("sketchmodified",{vertex:aa,feature:Z})},create:function(aa,Z){this.layer.events.triggerEvent("sketchstarted",{vertex:aa,feature:Z})}},this.callbacks);this.layer=W;this.handlerOptions=this.handlerOptions||{};this.handlerOptions.layerOptions=B.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:W.renderers,rendererOptions:W.rendererOptions});if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi}var Y=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(Y){this.handlerOptions.layerOptions=B.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new B.StyleMap({"default":Y})})}this.handler=new X(this,this.callbacks,this.handlerOptions)},drawFeature:function(X){var V=new B.Feature.Vector(X);var W=this.layer.events.triggerEvent("sketchcomplete",{feature:V});if(W!==false){V.state=B.State.INSERT;this.layer.addFeatures([V]);this.featureAdded(V);this.events.triggerEvent("featureadded",{feature:V})}},insertXY:function(V,W){if(this.handler&&this.handler.line){this.handler.insertXY(V,W)}},insertDeltaXY:function(W,V){if(this.handler&&this.handler.line){this.handler.insertDeltaXY(W,V)}},insertDirectionLength:function(W,V){if(this.handler&&this.handler.line){this.handler.insertDirectionLength(W,V)}},insertDeflectionLength:function(W,V){if(this.handler&&this.handler.line){this.handler.insertDeflectionLength(W,V)}},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"});B.Control.DragFeature=B.Class(B.Control,{geometryTypes:null,onStart:function(W,V){},onDrag:function(W,V){},onComplete:function(W,V){},onEnter:function(V){},onLeave:function(V){},documentDrag:false,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(W,V){B.Control.prototype.initialize.apply(this,[V]);this.layer=W;this.handlers={drag:new B.Handler.Drag(this,B.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new B.Handler.Feature(this,this.layer,B.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(V){if(this.handlers.feature.touch&&!this.over&&this.overFeature(V)){this.handlers.drag.dragstart(this.handlers.feature.evt);this.handlers.drag.stopDown=false}},clickoutFeature:function(V){if(this.handlers.feature.touch&&this.over){this.outFeature(V);this.handlers.drag.stopDown=true}},destroy:function(){this.layer=null;B.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.handlers.feature.activate()&&B.Control.prototype.activate.apply(this,arguments))},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;B.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return B.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(W){var V=false;if(!this.handlers.drag.dragging){this.feature=W;this.handlers.drag.activate();V=true;this.over=true;B.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(W)}else{if(this.feature.id==W.id){this.over=true}else{this.over=false}}return V},downFeature:function(V){this.lastPixel=V;this.onStart(this.feature,V)},moveFeature:function(V){var W=this.map.getResolution();this.feature.geometry.move(W*(V.x-this.lastPixel.x),W*(this.lastPixel.y-V.y));this.layer.drawFeature(this.feature);this.lastPixel=V;this.onDrag(this.feature,V)},upFeature:function(V){if(!this.over){this.handlers.drag.deactivate()}},doneDragging:function(V){this.onComplete(this.feature,V)},outFeature:function(V){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();B.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(V);this.feature=null}else{if(this.feature.id==V.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(V){this.handlers.drag.setMap(V);this.handlers.feature.setMap(V);B.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});B.Control.ModifyFeature=B.Class(B.Control,{geometryTypes:null,clickout:true,toggle:true,standalone:false,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:true,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(Y,X){X=X||{};this.layer=Y;this.vertices=[];this.virtualVertices=[];this.virtualStyle=B.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,X.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=B.Control.ModifyFeature.RESHAPE;B.Control.prototype.initialize.apply(this,[X]);if(!(B.Util.isArray(this.deleteCodes))){this.deleteCodes=[this.deleteCodes]}var aa=this;var V={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};if(this.standalone===false){this.selectControl=new B.Control.SelectFeature(Y,V)}var W={geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(ac,ab){aa.dragStart.apply(aa,[ac,ab])},onDrag:function(ac,ab){aa.dragVertex.apply(aa,[ac,ab])},onComplete:function(ab){aa.dragComplete.apply(aa,[ab])},featureCallbacks:{over:function(ab){if(aa.standalone!==true||ab._sketch||aa.feature===ab){aa.dragControl.overFeature.apply(aa.dragControl,[ab])}}}};this.dragControl=new B.Control.DragFeature(Y,W);var Z={keydown:this.handleKeypress};this.handlers={keyboard:new B.Handler.Keyboard(this,Z)}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();B.Control.prototype.destroy.apply(this,[])},activate:function(){return((this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&B.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var X=false;if(B.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.dragControl.deactivate();var V=this.feature;var W=V&&V.geometry&&V.layer;if(this.standalone===false){if(W){this.selectControl.unselect.apply(this.selectControl,[V])}this.selectControl.deactivate()}else{if(W){this.unselectFeature(V)}}this.handlers.keyboard.deactivate();X=true}return X},beforeSelectFeature:function(V){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:V})},selectFeature:function(W){if(!this.standalone||this.beforeSelectFeature(W)!==false){this.feature=W;this.modified=false;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)}var V=W.modified;if(W.geometry&&!(V&&V.geometry)){this._originalGeometry=W.geometry.clone()}},unselectFeature:function(V){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(V);this.layer.events.triggerEvent("afterfeaturemodified",{feature:V,modified:this.modified});this.modified=false},dragStart:function(W,V){if(W!=this.feature&&!W.geometry.parent&&W!=this.dragHandle&&W!=this.radiusHandle){if(this.standalone===false&&this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}if(this.geometryTypes==null||B.Util.indexOf(this.geometryTypes,W.geometry.CLASS_NAME)!=-1){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[W]);this.dragControl.overFeature.apply(this.dragControl,[W]);this.dragControl.lastPixel=V;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=V;this.dragControl.handlers.drag.last=V}}},dragVertex:function(W,V){this.modified=true;if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=W){this.feature=W}this.layer.events.triggerEvent("vertexmodified",{vertex:W.geometry,feature:this.feature,pixel:V})}else{if(W._index){W.geometry.parent.addComponent(W.geometry,W._index);delete W._index;B.Util.removeItem(this.virtualVertices,W);this.vertices.push(W)}else{if(W==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else{if(W!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:W.geometry,feature:this.feature,pixel:V})}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent)}this.layer.drawFeature(W)},dragComplete:function(V){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=B.State.INSERT&&this.feature.state!=B.State.DELETE){this.feature.state=B.State.UPDATE;if(this.modified&&this._originalGeometry){var V=this.feature;V.modified=B.Util.extend(V.modified,{geometry:this._originalGeometry});delete this._originalGeometry}}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if((this.mode&B.Control.ModifyFeature.DRAG)){this.collectDragHandle()}if((this.mode&(B.Control.ModifyFeature.ROTATE|B.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()}if(this.mode&B.Control.ModifyFeature.RESHAPE){if(!(this.mode&B.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(V){var W=V.keyCode;if(this.feature&&B.Util.indexOf(this.deleteCodes,W)!=-1){var X=this.dragControl.feature;if(X&&B.Util.indexOf(this.vertices,X)!=-1&&!this.dragControl.handlers.drag.dragging&&X.geometry.parent){X.geometry.parent.removeComponent(X.geometry);this.layer.events.triggerEvent("vertexremoved",{vertex:X.geometry,feature:this.feature,pixel:V.xy});this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent);this.modified=true;this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var V=this;function W(ac){var Y,Z,ad,aa;if(ac.CLASS_NAME=="OpenLayers.Geometry.Point"){Z=new B.Feature.Vector(ac);Z._sketch=true;Z.renderIntent=V.vertexRenderIntent;V.vertices.push(Z)}else{var X=ac.components.length;if(ac.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){X-=1}for(Y=0;Y<X;++Y){ad=ac.components[Y];if(ad.CLASS_NAME=="OpenLayers.Geometry.Point"){Z=new B.Feature.Vector(ad);Z._sketch=true;Z.renderIntent=V.vertexRenderIntent;V.vertices.push(Z)}else{W(ad)}}if(V.createVertices&&ac.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(Y=0,aa=ac.components.length;Y<aa-1;++Y){var ag=ac.components[Y];var ah=ac.components[Y+1];if(ag.CLASS_NAME=="OpenLayers.Geometry.Point"&&ah.CLASS_NAME=="OpenLayers.Geometry.Point"){var ae=(ag.x+ah.x)/2;var ab=(ag.y+ah.y)/2;var af=new B.Feature.Vector(new B.Geometry.Point(ae,ab),null,V.virtualStyle);af.geometry.parent=ac;af._index=Y+1;af._sketch=true;V.virtualVertices.push(af)}}}}}W.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var Y=this.feature.geometry;var V=Y.getBounds().getCenterLonLat();var X=new B.Geometry.Point(V.lon,V.lat);var W=new B.Feature.Vector(X);X.move=function(Z,aa){B.Geometry.Point.prototype.move.call(this,Z,aa);Y.move(Z,aa)};W._sketch=true;this.dragHandle=W;this.dragHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var ac=this.feature.geometry;var V=ac.getBounds();var W=V.getCenterLonLat();var ad=new B.Geometry.Point(W.lon,W.lat);var ab=new B.Geometry.Point(V.right,V.bottom);var aa=new B.Feature.Vector(ab);var X=(this.mode&B.Control.ModifyFeature.RESIZE);var Z=(this.mode&B.Control.ModifyFeature.RESHAPE);var Y=(this.mode&B.Control.ModifyFeature.ROTATE);ab.move=function(ao,an){B.Geometry.Point.prototype.move.call(this,ao,an);var ap=this.x-ad.x;var ak=this.y-ad.y;var aq=ap-ao;var al=ak-an;if(Y){var af=Math.atan2(al,aq);var ae=Math.atan2(ak,ap);var ai=ae-af;ai*=180/Math.PI;ac.rotate(ai,ad)}if(X){var ah,am;if(Z){ah=ak/al;am=(ap/aq)/ah}else{var aj=Math.sqrt((aq*aq)+(al*al));var ag=Math.sqrt((ap*ap)+(ak*ak));ah=ag/aj}ac.resize(ah,ad,am)}};aa._sketch=true;this.radiusHandle=aa;this.radiusHandle.renderIntent=this.vertexRenderIntent;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(V){this.standalone||this.selectControl.setMap(V);this.dragControl.setMap(V);B.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});B.Control.ModifyFeature.RESHAPE=1;B.Control.ModifyFeature.RESIZE=2;B.Control.ModifyFeature.ROTATE=4;B.Control.ModifyFeature.DRAG=8;B.Control.SelectFeature=B.Class(B.Control,{multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(X,V){B.Control.prototype.initialize.apply(this,[V]);if(this.scope===null){this.scope=this}this.initLayer(X);var W={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){W.over=this.overFeature;W.out=this.outFeature}this.callbacks=B.Util.extend(W,this.callbacks);this.handlers={feature:new B.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new B.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},initLayer:function(V){if(B.Util.isArray(V)){this.layers=V;this.layer=new B.Layer.Vector.RootContainer(this.id+"_container",{layers:V})}else{this.layer=V}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)}B.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return B.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return B.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(W){var aa=this.layers||[this.layer];var Z,Y;for(var V=0;V<aa.length;++V){Z=aa[V];for(var X=Z.selectedFeatures.length-1;X>=0;--X){Y=Z.selectedFeatures[X];if(!W||W.except!=Y){this.unselect(Y)}}}},clickFeature:function(V){if(!this.hover){var W=(B.Util.indexOf(V.layer.selectedFeatures,V)>-1);if(W){if(this.toggleSelect()){this.unselect(V)}else{if(!this.multipleSelect()){this.unselectAll({except:V})}}}else{if(!this.multipleSelect()){this.unselectAll({except:V})}this.select(V)}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])},clickoutFeature:function(V){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(W){var V=W.layer;if(this.hover){if(this.highlightOnly){this.highlight(W)}else{if(B.Util.indexOf(V.selectedFeatures,W)==-1){this.select(W)}}}},outFeature:function(V){if(this.hover){if(this.highlightOnly){if(V._lastHighlighter==this.id){if(V._prevHighlighter&&V._prevHighlighter!=this.id){delete V._lastHighlighter;var W=this.map.getControl(V._prevHighlighter);if(W){W.highlight(V)}}else{this.unhighlight(V)}}}else{this.unselect(V)}}},highlight:function(X){var W=X.layer;var V=this.events.triggerEvent("beforefeaturehighlighted",{feature:X});if(V!==false){X._prevHighlighter=X._lastHighlighter;X._lastHighlighter=this.id;var Y=this.selectStyle||this.renderIntent;W.drawFeature(X,Y);this.events.triggerEvent("featurehighlighted",{feature:X})}},unhighlight:function(W){var V=W.layer;if(W._prevHighlighter==undefined){delete W._lastHighlighter}else{if(W._prevHighlighter==this.id){delete W._prevHighlighter}else{W._lastHighlighter=W._prevHighlighter;delete W._prevHighlighter}}V.drawFeature(W,W.style||W.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:W})},select:function(X){var V=this.onBeforeSelect.call(this.scope,X);var W=X.layer;if(V!==false){V=W.events.triggerEvent("beforefeatureselected",{feature:X});if(V!==false){W.selectedFeatures.push(X);this.highlight(X);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=W.selectedFeatures[0]}W.events.triggerEvent("featureselected",{feature:X});this.onSelect.call(this.scope,X)}}},unselect:function(W){var V=W.layer;this.unhighlight(W);B.Util.removeItem(V.selectedFeatures,W);V.events.triggerEvent("featureunselected",{feature:W});this.onUnselect.call(this.scope,W)},selectBox:function(Z){if(Z instanceof B.Bounds){var ac=this.map.getLonLatFromPixel({x:Z.left,y:Z.bottom});var ae=this.map.getLonLatFromPixel({x:Z.right,y:Z.top});var V=new B.Bounds(ac.lon,ac.lat,ae.lon,ae.lat);if(!this.multipleSelect()){this.unselectAll()}var ad=this.multiple;this.multiple=true;var Y=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:Y});var aa;for(var W=0;W<Y.length;++W){aa=Y[W];for(var X=0,ab=aa.features.length;X<ab;++X){var af=aa.features[X];if(!af.getVisibility()){continue}if(this.geometryTypes==null||B.Util.indexOf(this.geometryTypes,af.geometry.CLASS_NAME)>-1){if(V.toGeometry().intersects(af.geometry)){if(B.Util.indexOf(aa.selectedFeatures,af)==-1){this.select(af)}}}}}this.multiple=ad;this.events.triggerEvent("boxselectionend",{layers:Y})}},setMap:function(V){this.handlers.feature.setMap(V);if(this.box){this.handlers.box.setMap(V)}B.Control.prototype.setMap.apply(this,arguments)},setLayer:function(W){var V=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null}this.initLayer(W);this.handlers.feature.layer=this.layer;if(V){this.activate()}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});B.Control.TransformFeature=B.Class(B.Control,{geometryTypes:null,layer:null,preserveAspectRatio:false,rotate:true,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:false,initialize:function(W,V){B.Control.prototype.initialize.apply(this,[V]);this.layer=W;if(!this.rotationHandleSymbolizer){this.rotationHandleSymbolizer={stroke:false,pointRadius:10,fillOpacity:0,cursor:"pointer"}}this.createBox();this.createControl()},activate:function(){var V=false;if(B.Control.prototype.activate.apply(this,arguments)){this.dragControl.activate();this.layer.addFeatures([this.box]);this.rotate&&this.layer.addFeatures(this.rotationHandles);this.layer.addFeatures(this.handles);V=true}return V},deactivate:function(){var V=false;if(B.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.handles);this.rotate&&this.layer.removeFeatures(this.rotationHandles);this.layer.removeFeatures([this.box]);this.dragControl.deactivate();V=true}return V},setMap:function(V){this.dragControl.setMap(V);B.Control.prototype.setMap.apply(this,arguments)},setFeature:function(ad,X){X=B.Util.applyDefaults(X,{rotation:0,scale:1,ratio:1});var Z=this.rotation;var V=this.center;B.Util.extend(this,X);var ae=this.events.triggerEvent("beforesetfeature",{feature:ad});if(ae===false){return}this.feature=ad;this.activate();this._setfeature=true;var W=this.feature.geometry.getBounds();this.box.move(W.getCenterLonLat());this.box.geometry.rotate(-Z,V);this._angle=0;var aa;if(this.rotation){var ab=ad.geometry.clone();ab.rotate(-this.rotation,this.center);var Y=new B.Feature.Vector(ab.getBounds().toGeometry());Y.geometry.rotate(this.rotation,this.center);this.box.geometry.rotate(this.rotation,this.center);this.box.move(Y.geometry.getBounds().getCenterLonLat());var ac=Y.geometry.components[0].components[0];aa=ac.getBounds().getCenterLonLat()}else{aa=new B.LonLat(W.left,W.bottom)}this.handles[0].move(aa);delete this._setfeature;this.events.triggerEvent("setfeature",{feature:ad})},unsetFeature:function(){if(this.active){this.deactivate()}else{this.feature=null;this.rotation=0;this.scale=1;this.ratio=1}},createBox:function(){var aa=this;this.center=new B.Geometry.Point(0,0);this.box=new B.Feature.Vector(new B.Geometry.LineString([new B.Geometry.Point(-1,-1),new B.Geometry.Point(0,-1),new B.Geometry.Point(1,-1),new B.Geometry.Point(1,0),new B.Geometry.Point(1,1),new B.Geometry.Point(0,1),new B.Geometry.Point(-1,1),new B.Geometry.Point(-1,0),new B.Geometry.Point(-1,-1)]),null,typeof this.renderIntent=="string"?null:this.renderIntent);this.box.geometry.move=function(ai,aj){aa._moving=true;B.Geometry.LineString.prototype.move.apply(this,arguments);aa.center.move(ai,aj);delete aa._moving};var V=function(ai,aj){B.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(ai,aj);this._handle.geometry.move(ai,aj)};var ah=function(ak,ai,aj){B.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(ak,ai,aj);this._handle.geometry.resize(ak,ai,aj)};var af=function(aj,ai){B.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(aj,ai);this._handle.geometry.rotate(aj,ai)};var ac=function(ap,an){var ao=this.x,am=this.y;B.Geometry.Point.prototype.move.call(this,ap,an);if(aa._moving){return}var au=aa.dragControl.handlers.drag.evt;var at=!aa._setfeature&&aa.preserveAspectRatio;var aw=!at&&!(au&&au.shiftKey);var ax=new B.Geometry.Point(ao,am);var av=aa.center;this.rotate(-aa.rotation,av);ax.rotate(-aa.rotation,av);var aj=this.x-av.x;var aq=this.y-av.y;var ak=aj-(this.x-ax.x);var ar=aq-(this.y-ax.y);if(aa.irregular&&!aa._setfeature){aj-=(this.x-ax.x)/2;aq-=(this.y-ax.y)/2}this.x=ao;this.y=am;var aA,al=1;if(aw){aA=Math.abs(ar)<0.00001?1:aq/ar;al=(Math.abs(ak)<0.00001?1:(aj/ak))/aA}else{var az=Math.sqrt((ak*ak)+(ar*ar));var ay=Math.sqrt((aj*aj)+(aq*aq));aA=ay/az}aa._moving=true;aa.box.geometry.rotate(-aa.rotation,av);delete aa._moving;aa.box.geometry.resize(aA,av,al);aa.box.geometry.rotate(aa.rotation,av);aa.transformFeature({scale:aA,ratio:al});if(aa.irregular&&!aa._setfeature){var ai=av.clone();ai.x+=Math.abs(ao-av.x)<0.00001?0:(this.x-ao);ai.y+=Math.abs(am-av.y)<0.00001?0:(this.y-am);aa.box.geometry.move(this.x-ao,this.y-am);aa.transformFeature({center:ai})}};var X=function(aq,ao){var ax=this.x,au=this.y;B.Geometry.Point.prototype.move.call(this,aq,ao);if(aa._moving){return}var av=aa.dragControl.handlers.drag.evt;var ap=(av&&av.shiftKey)?45:1;var an=aa.center;var at=this.x-an.x;var al=this.y-an.y;var aw=at-aq;var am=al-ao;this.x=ax;this.y=au;var aj=Math.atan2(am,aw);var ai=Math.atan2(al,at);var ak=ai-aj;ak*=180/Math.PI;aa._angle=(aa._angle+ak)%360;var ar=aa.rotation%ap;if(Math.abs(aa._angle)>=ap||ar!==0){ak=Math.round(aa._angle/ap)*ap-ar;aa._angle=0;aa.box.geometry.rotate(ak,an);aa.transformFeature({rotation:ak})}};var ag=new Array(8);var ad=new Array(4);var ae,ab,W;var Z=["sw","s","se","e","ne","n","nw","w"];for(var Y=0;Y<8;++Y){ae=this.box.geometry.components[Y];ab=new B.Feature.Vector(ae.clone(),{role:Z[Y]+"-resize"},typeof this.renderIntent=="string"?null:this.renderIntent);if(Y%2==0){W=new B.Feature.Vector(ae.clone(),{role:Z[Y]+"-rotate"},typeof this.rotationHandleSymbolizer=="string"?null:this.rotationHandleSymbolizer);W.geometry.move=X;ae._rotationHandle=W;ad[Y/2]=W}ae.move=V;ae.resize=ah;ae.rotate=af;ab.geometry.move=ac;ae._handle=ab;ag[Y]=ab}this.rotationHandles=ad;this.handles=ag},createControl:function(){var V=this;this.dragControl=new B.Control.DragFeature(this.layer,{documentDrag:true,moveFeature:function(W){if(this.feature===V.feature){this.feature=V.box}B.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(X,W){if(X===V.box){V.transformFeature({center:V.center})}},onStart:function(Z,X){var W=!V.geometryTypes||B.Util.indexOf(V.geometryTypes,Z.geometry.CLASS_NAME)!==-1;var Y=B.Util.indexOf(V.handles,Z);Y+=B.Util.indexOf(V.rotationHandles,Z);if(Z!==V.feature&&Z!==V.box&&Y==-2&&W){V.setFeature(Z)}},onComplete:function(X,W){V.events.triggerEvent("transformcomplete",{feature:V.feature})}})},drawHandles:function(){var W=this.layer;for(var V=0;V<8;++V){if(this.rotate&&V%2===0){W.drawFeature(this.rotationHandles[V/2],this.rotationHandleSymbolizer)}W.drawFeature(this.handles[V],this.renderIntent)}},transformFeature:function(Z){if(!this._setfeature){this.scale*=(Z.scale||1);this.ratio*=(Z.ratio||1);var W=this.rotation;this.rotation=(this.rotation+(Z.rotation||0))%360;if(this.events.triggerEvent("beforetransform",Z)!==false){var Y=this.feature;var X=Y.geometry;var V=this.center;X.rotate(-W,V);if(Z.scale||Z.ratio){X.resize(Z.scale,V,Z.ratio)}else{if(Z.center){Y.move(Z.center.getBounds().getCenterLonLat())}}X.rotate(this.rotation,V);this.layer.drawFeature(Y);Y.toState(B.State.UPDATE);this.events.triggerEvent("transform",Z)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){var W;for(var V=0;V<8;++V){W=this.box.geometry.components[V];W._handle.destroy();W._handle=null;W._rotationHandle&&W._rotationHandle.destroy();W._rotationHandle=null}this.center=null;this.feature=null;this.handles=null;this.rotationHandleSymbolizer=null;this.rotationHandles=null;this.box.destroy();this.box=null;this.layer=null;this.dragControl.destroy();this.dragControl=null;B.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"});B.Control.UTFGrid=B.Class(B.Control,{autoActivate:true,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:false,single:true,"double":false,stopSingle:false,stopDouble:false},handlerMode:"click",setHandler:function(V){this.handlerMode=V;this.resetHandler()},resetHandler:function(){if(this.handler){this.handler.deactivate();this.handler.destroy();this.handler=null}if(this.handlerMode=="hover"){this.handler=new B.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions)}else{if(this.handlerMode=="click"){this.handler=new B.Handler.Click(this,{click:this.handleEvent},this.handlerOptions)}else{if(this.handlerMode=="move"){this.handler=new B.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)}}}if(this.handler){return true}else{return false}},initialize:function(V){V=V||{};V.handlerOptions=V.handlerOptions||this.defaultHandlerOptions;B.Control.prototype.initialize.apply(this,[V]);this.resetHandler()},handleEvent:function(X){if(X==null){this.reset();return}var Y=this.map.getLonLatFromPixel(X.xy);if(!Y){return}var ac=this.findLayers();if(ac.length>0){var ab={};var aa,W;for(var Z=0,V=ac.length;Z<V;Z++){aa=ac[Z];W=B.Util.indexOf(this.map.layers,aa);ab[W]=aa.getFeatureInfo(Y)}this.callback(ab,Y,X.xy)}},callback:function(V){},reset:function(V){this.callback(null)},findLayers:function(){var X=this.layers||this.map.layers;var Y=[];var W;for(var V=X.length-1;V>=0;--V){W=X[V];if(W instanceof B.Layer.UTFGrid){Y.push(W)}}return Y},CLASS_NAME:"OpenLayers.Control.UTFGrid"});B.Control.Zoom=B.Class(B.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"-",zoomOutId:"olZoomOutLink",draw:function(){var Z=B.Control.prototype.draw.apply(this),W=this.getOrCreateLinks(Z),Y=W.zoomIn,V=W.zoomOut,X=this.map.events;if(V.parentNode!==Z){X=this.events;X.attachToElement(V.parentNode)}X.register("buttonclick",this,this.onZoomClick);this.zoomInLink=Y;this.zoomOutLink=V;return Z},getOrCreateLinks:function(W){var X=document.getElementById(this.zoomInId),V=document.getElementById(this.zoomOutId);if(!X){X=document.createElement("a");X.href="#zoomIn";X.appendChild(document.createTextNode(this.zoomInText));X.className="olControlZoomIn";W.appendChild(X)}B.Element.addClass(X,"olButton");if(!V){V=document.createElement("a");V.href="#zoomOut";V.appendChild(document.createTextNode(this.zoomOutText));V.className="olControlZoomOut";W.appendChild(V)}B.Element.addClass(V,"olButton");return{zoomIn:X,zoomOut:V}},onZoomClick:function(V){var W=V.buttonElement;if(W===this.zoomInLink){this.map.zoomIn()}else{if(W===this.zoomOutLink){this.map.zoomOut()}}},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onZoomClick)}delete this.zoomInLink;delete this.zoomOutLink;B.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"});B.Geometry=B.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=B.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new B.Geometry()},setBounds:function(V){if(V){this.bounds=V.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(W){var V=this.getBounds();if(!V){this.setBounds(W)}else{this.bounds.extend(W)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(W,V){},getVertices:function(V){},atPoint:function(Z,ac,aa){var X=false;var Y=this.getBounds();if((Y!=null)&&(Z!=null)){var W=(ac!=null)?ac:0;var V=(aa!=null)?aa:0;var ab=new B.Bounds(this.bounds.left-W,this.bounds.bottom-V,this.bounds.right+W,this.bounds.top+V);X=ab.containsLonLat(Z)}return X},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var V;if(B.Format&&B.Format.WKT){V=B.Format.WKT.prototype.write(new B.Feature.Vector(this))}else{V=Object.prototype.toString.call(this)}return V},CLASS_NAME:"OpenLayers.Geometry"});B.Geometry.fromWKT=function(aa){var Y;if(B.Format&&B.Format.WKT){var ab=B.Geometry.fromWKT.format;if(!ab){ab=new B.Format.WKT();B.Geometry.fromWKT.format=ab}var W=ab.read(aa);if(W instanceof B.Feature.Vector){Y=W.geometry}else{if(B.Util.isArray(W)){var V=W.length;var Z=new Array(V);for(var X=0;X<V;++X){Z[X]=W[X].geometry}Y=new B.Geometry.Collection(Z)}}}return Y};B.Geometry.segmentsIntersect=function(V,ax,W){var aj=W&&W.point;var ao=W&&W.tolerance;var Z=false;var aq=V.x1-ax.x1;var av=V.y1-ax.y1;var ag=V.x2-V.x1;var an=V.y2-V.y1;var ak=ax.y2-ax.y1;var ad=ax.x2-ax.x1;var at=(ak*ag)-(ad*an);var Y=(ad*av)-(ak*aq);var X=(ag*av)-(an*aq);if(at==0){if(Y==0&&X==0){Z=true}}else{var au=Y/at;var ar=X/at;if(au>=0&&au<=1&&ar>=0&&ar<=1){if(!aj){Z=true}else{var ab=V.x1+(au*ag);var aa=V.y1+(au*an);Z=new B.Geometry.Point(ab,aa)}}}if(ao){var ai;if(Z){if(aj){var af=[V,ax];var ap,ab,aa;outer:for(var am=0;am<2;++am){ap=af[am];for(var al=1;al<3;++al){ab=ap["x"+al];aa=ap["y"+al];ai=Math.sqrt(Math.pow(ab-Z.x,2)+Math.pow(aa-Z.y,2));if(ai<ao){Z.x=ab;Z.y=aa;break outer}}}}}else{var af=[V,ax];var ah,aw,ab,aa,ae,ac;outer:for(var am=0;am<2;++am){ah=af[am];aw=af[(am+1)%2];for(var al=1;al<3;++al){ae={x:ah["x"+al],y:ah["y"+al]};ac=B.Geometry.distanceToSegment(ae,aw);if(ac.distance<ao){if(aj){Z=new B.Geometry.Point(ae.x,ae.y)}else{Z=true}break outer}}}}}return Z};B.Geometry.distanceToSegment=function(af,Y){var X=af.x;var ae=af.y;var W=Y.x1;var ad=Y.y1;var V=Y.x2;var aa=Y.y2;var ah=V-W;var ag=aa-ad;var ac=((ah*(X-W))+(ag*(ae-ad)))/(Math.pow(ah,2)+Math.pow(ag,2));var ab,Z;if(ac<=0){ab=W;Z=ad}else{if(ac>=1){ab=V;Z=aa}else{ab=W+ac*ah;Z=ad+ac*ag}}return{distance:Math.sqrt(Math.pow(ab-X,2)+Math.pow(Z-ae,2)),x:ab,y:Z}};B.bases.Geometry=B.Geometry;B.Geometry=B.Class(B.Geometry,{getCUBType:function(){switch(this.CLASS_NAME){case"OpenLayers.Geometry.Point":case"OpenLayers.Geometry.MultiPoint":return M.Entity.geomType.POINT;break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.MultiLineString":return M.Entity.geomType.LINE;break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.MultiPolygon":return M.Entity.geomType.POLYGON;break;case"OpenLayers.Geometry.Collection":if(this.components){type=this.components[0].getCUBType();for(var V in this.components){if(this.components[V].getCUBType()!=type){return M.Entity.geomType.MIXED}}return type}else{return null}default:return null;break}},isMulti:function(){return this.CLASS_NAME=="OpenLayers.Geometry.MultiPoint"||this.CLASS_NAME=="OpenLayers.Geometry.MultiLineString"||this.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon"||this.CLASS_NAME=="OpenLayers.Geometry.Collection"}});B.Geometry.Collection=B.Class(B.Geometry,{components:null,componentTypes:null,initialize:function(V){B.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(V!=null){this.addComponents(V)}},destroy:function(){this.components.length=0;this.components=null;B.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){var X=j("new "+this.CLASS_NAME+"()");for(var W=0,V=this.components.length;W<V;W++){X.addComponent(this.components[W].clone())}B.Util.applyDefaults(X,this);return X},getComponentsString:function(){var W=[];for(var X=0,V=this.components.length;X<V;X++){W.push(this.components[X].toShortString())}return W.join(",")},calculateBounds:function(){this.bounds=null;var Y=new B.Bounds();var X=this.components;if(X){for(var W=0,V=X.length;W<V;W++){Y.extend(X[W].getBounds())}}if(Y.left!=null&&Y.bottom!=null&&Y.right!=null&&Y.top!=null){this.setBounds(Y)}},addComponents:function(X){if(!(B.Util.isArray(X))){X=[X]}for(var W=0,V=X.length;W<V;W++){this.addComponent(X[W])}},addComponent:function(W,V){var Y=false;if(W){if(this.componentTypes==null||(B.Util.indexOf(this.componentTypes,W.CLASS_NAME)>-1)){if(V!=null&&(V<this.components.length)){var Z=this.components.slice(0,V);var X=this.components.slice(V,this.components.length);Z.push(W);this.components=Z.concat(X)}else{this.components.push(W)}W.parent=this;this.clearBounds();Y=true}}return Y},removeComponents:function(W){var X=false;if(!(B.Util.isArray(W))){W=[W]}for(var V=W.length-1;V>=0;--V){X=this.removeComponent(W[V])||X}return X},removeComponent:function(V){B.Util.removeItem(this.components,V);this.clearBounds();return true},getLength:function(){var X=0;for(var W=0,V=this.components.length;W<V;W++){X+=this.components[W].getLength()}return X},getArea:function(){var X=0;for(var W=0,V=this.components.length;W<V;W++){X+=this.components[W].getArea()}return X},getGeodesicArea:function(W){var Y=0;for(var X=0,V=this.components.length;X<V;X++){Y+=this.components[X].getGeodesicArea(W)}return Y},getCentroid:function(ab){if(!ab){return this.components.length&&this.components[0].getCentroid()}var af=this.components.length;if(!af){return false}var W=[];var X=[];var Y=0;var ac=Number.MAX_VALUE;var ag;for(var ae=0;ae<af;++ae){ag=this.components[ae];var Z=ag.getArea();var aa=ag.getCentroid(true);if(isNaN(Z)||isNaN(aa.x)||isNaN(aa.y)){continue}W.push(Z);Y+=Z;ac=(Z<ac&&Z>0)?Z:ac;X.push(aa)}af=W.length;if(Y===0){for(var ae=0;ae<af;++ae){W[ae]=1}Y=W.length}else{for(var ae=0;ae<af;++ae){W[ae]/=ac}Y/=ac}var ad=0,V=0,aa,Z;for(var ae=0;ae<af;++ae){aa=X[ae];Z=W[ae];ad+=aa.x*Z;V+=aa.y*Z}return new B.Geometry.Point(ad/Y,V/Y)},getGeodesicLength:function(W){var Y=0;for(var X=0,V=this.components.length;X<V;X++){Y+=this.components[X].getGeodesicLength(W)}return Y},move:function(W,Y){for(var X=0,V=this.components.length;X<V;X++){this.components[X].move(W,Y)}},rotate:function(Y,W){for(var X=0,V=this.components.length;X<V;++X){this.components[X].rotate(Y,W)}},resize:function(Y,V,X){for(var W=0;W<this.components.length;++W){this.components[W].resize(Y,V,X)}return this},distanceTo:function(ac,ad){var X=!(ad&&ad.edge===false);var V=X&&ad&&ad.details;var ae,Y,W;var Z=Number.POSITIVE_INFINITY;for(var aa=0,ab=this.components.length;aa<ab;++aa){ae=this.components[aa].distanceTo(ac,ad);W=V?ae.distance:ae;if(W<Z){Z=W;Y=ae;if(Z==0){break}}}return Y},equals:function(Y){var W=true;if(!Y||!Y.CLASS_NAME||(this.CLASS_NAME!=Y.CLASS_NAME)){W=false}else{if(!(B.Util.isArray(Y.components))||(Y.components.length!=this.components.length)){W=false}else{for(var X=0,V=this.components.length;X<V;++X){if(!this.components[X].equals(Y.components[X])){W=false;break}}}}return W},transform:function(Z,X){if(Z&&X){for(var Y=0,V=this.components.length;Y<V;Y++){var W=this.components[Y];W.transform(Z,X)}this.bounds=null}return this},intersects:function(Y){var W=false;for(var X=0,V=this.components.length;X<V;++X){W=Y.intersects(this.components[X]);if(W){break}}return W},getVertices:function(W){var X=[];for(var Y=0,V=this.components.length;Y<V;++Y){Array.prototype.push.apply(X,this.components[Y].getVertices(W))}return X},CLASS_NAME:"OpenLayers.Geometry.Collection"});B.bases.GeometryCollection=B.Geometry.Collection;B.Geometry.Collection=B.Class(B.Geometry.Collection,{clone:function(){var X;switch(this.CLASS_NAME){case"OpenLayers.Geometry.Polygon":X=new B.Geometry.Polygon();break;case"OpenLayers.Geometry.Curve":X=new B.Geometry.Curve();break;case"OpenLayers.Geometry.LinearRing":X=new B.Geometry.LinearRing();break;case"OpenLayers.Geometry.LineString":X=new B.Geometry.LineString();break;case"OpenLayers.Geometry.MultiLineString":X=new B.Geometry.MultiLineString();break;case"OpenLayers.Geometry.MultiPoint":X=new B.Geometry.MultiPoint();break;case"OpenLayers.Geometry.MultiPolygon":X=new B.Geometry.MultiPolygon();break;case"OpenLayers.Geometry.Point":X=new B.Geometry.Point();break;case"OpenLayers.Geometry.Rectangle":X=new B.Geometry.Rectangle();break;case"OpenLayers.Geometry.Collection":X=new B.Geometry.Collection();break;default:p.errorLog("Type de géométrie non géré",p.errorLevel.WARNING);return null}for(var W=0,V=this.components.length;W<V;W++){X.addComponent(this.components[W].clone())}B.Util.applyDefaults(X,this);return X}});B.Geometry.Point=B.Class(B.Geometry,{x:null,y:null,initialize:function(V,W){B.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(V);this.y=parseFloat(W)},clone:function(V){if(V==null){V=new B.Geometry.Point(this.x,this.y)}B.Util.applyDefaults(V,this);return V},calculateBounds:function(){this.bounds=new B.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(aa,ae){var Y=!(ae&&ae.edge===false);var V=Y&&ae&&ae.details;var W,Z,ac,X,ab,ad;if(aa instanceof B.Geometry.Point){Z=this.x;ac=this.y;X=aa.x;ab=aa.y;W=Math.sqrt(Math.pow(Z-X,2)+Math.pow(ac-ab,2));ad=!V?W:{x0:Z,y0:ac,x1:X,y1:ab,distance:W}}else{ad=aa.distanceTo(this,ae);if(V){ad={x0:ad.x1,y0:ad.y1,x1:ad.x0,y1:ad.y0,distance:ad.distance}}}return ad},equals:function(V){var W=false;if(V!=null){W=((this.x==V.x&&this.y==V.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(V.x)&&isNaN(V.y)))}return W},toShortString:function(){return(this.x+", "+this.y)},move:function(V,W){this.x=this.x+V;this.y=this.y+W;this.clearBounds()},rotate:function(Y,W){Y*=Math.PI/180;var V=this.distanceTo(W);var X=Y+Math.atan2(this.y-W.y,this.x-W.x);this.x=W.x+(V*Math.cos(X));this.y=W.y+(V*Math.sin(X));this.clearBounds()},getCentroid:function(){return new B.Geometry.Point(this.x,this.y)},resize:function(X,V,W){W=(W==undefined)?1:W;this.x=V.x+(X*W*(this.x-V.x));this.y=V.y+(X*(this.y-V.y));this.clearBounds();return this},intersects:function(W){var V=false;if(W.CLASS_NAME=="OpenLayers.Geometry.Point"){V=this.equals(W)}else{V=W.intersects(this)}return V},transform:function(W,V){if((W&&V)){B.Projection.transform(this,W,V);this.bounds=null}return this},getVertices:function(V){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});B.Geometry.MultiPoint=B.Class(B.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(V,W){this.addComponent(V,W)},removePoint:function(V){this.removeComponent(V)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});B.Geometry.Curve=B.Class(B.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var X=0;if(this.components&&(this.components.length>1)){for(var W=1,V=this.components.length;W<V;W++){X+=this.components[W-1].distanceTo(this.components[W])}}return X},getGeodesicLength:function(W){var Z=this;if(W){var X=new B.Projection("EPSG:4326");if(!X.equals(W)){Z=this.clone().transform(W,X)}}var aa=0;if(Z.components&&(Z.components.length>1)){var ac,ab;for(var Y=1,V=Z.components.length;Y<V;Y++){ac=Z.components[Y-1];ab=Z.components[Y];aa+=B.Util.distVincenty({lon:ac.x,lat:ac.y},{lon:ab.x,lat:ab.y})}}return aa*1000},CLASS_NAME:"OpenLayers.Geometry.Curve"});B.Geometry.LineString=B.Class(B.Geometry.Curve,{removeComponent:function(V){var W=this.components&&(this.components.length>2);if(W){B.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}return W},intersects:function(af){var X=false;var ae=af.CLASS_NAME;if(ae=="OpenLayers.Geometry.LineString"||ae=="OpenLayers.Geometry.LinearRing"||ae=="OpenLayers.Geometry.Point"){var ai=this.getSortedSegments();var ag;if(ae=="OpenLayers.Geometry.Point"){ag=[{x1:af.x,y1:af.y,x2:af.x,y2:af.y}]}else{ag=af.getSortedSegments()}var al,ab,Z,V,ak,aj,Y,W;outer:for(var ac=0,ad=ai.length;ac<ad;++ac){al=ai[ac];ab=al.x1;Z=al.x2;V=al.y1;ak=al.y2;inner:for(var aa=0,ah=ag.length;aa<ah;++aa){aj=ag[aa];if(aj.x1>Z){break}if(aj.x2<ab){continue}Y=aj.y1;W=aj.y2;if(Math.min(Y,W)>Math.max(V,ak)){continue}if(Math.max(Y,W)<Math.min(V,ak)){continue}if(B.Geometry.segmentsIntersect(al,aj)){X=true;break outer}}}}else{X=af.intersects(this)}return X},getSortedSegments:function(){var V=this.components.length-1;var W=new Array(V),Z,Y;for(var X=0;X<V;++X){Z=this.components[X];Y=this.components[X+1];if(Z.x<Y.x){W[X]={x1:Z.x,y1:Z.y,x2:Y.x,y2:Y.y}}else{W[X]={x1:Y.x,y1:Y.y,x2:Z.x,y2:Z.y}}}function aa(ac,ab){return ac.x1-ab.x1}return W.sort(aa)},splitWithSegment:function(al,W){var X=!(W&&W.edge===false);var ai=W&&W.tolerance;var V=[];var an=this.getVertices();var ah=[];var ap=[];var ac=false;var Z,Y,af;var ad,ak,ao;var aa={point:true,tolerance:ai};var ab=null;for(var ag=0,ae=an.length-2;ag<=ae;++ag){Z=an[ag];ah.push(Z.clone());Y=an[ag+1];ao={x1:Z.x,y1:Z.y,x2:Y.x,y2:Y.y};af=B.Geometry.segmentsIntersect(al,ao,aa);if(af instanceof B.Geometry.Point){if((af.x===al.x1&&af.y===al.y1)||(af.x===al.x2&&af.y===al.y2)||af.equals(Z)||af.equals(Y)){ak=true}else{ak=false}if(ak||X){if(!af.equals(ap[ap.length-1])){ap.push(af.clone())}if(ag===0){if(af.equals(Z)){continue}}if(af.equals(Y)){continue}ac=true;if(!af.equals(Z)){ah.push(af)}V.push(new B.Geometry.LineString(ah));ah=[af.clone()]}}}if(ac){ah.push(Y.clone());V.push(new B.Geometry.LineString(ah))}if(ap.length>0){var aj=al.x1<al.x2?1:-1;var am=al.y1<al.y2?1:-1;ab={lines:V,points:ap.sort(function(ar,aq){return(aj*ar.x-aj*aq.x)||(am*ar.y-am*aq.y)})}}return ab},split:function(ap,W){var af=null;var Y=W&&W.mutual;var ad,Z,ae,X;if(ap instanceof B.Geometry.LineString){var ao=this.getVertices();var ab,aa,an,ac,V,ah;var ak=[];ae=[];for(var al=0,ag=ao.length-2;al<=ag;++al){ab=ao[al];aa=ao[al+1];an={x1:ab.x,y1:ab.y,x2:aa.x,y2:aa.y};X=X||[ap];if(Y){ak.push(ab.clone())}for(var aj=0;aj<X.length;++aj){ac=X[aj].splitWithSegment(an,W);if(ac){V=ac.lines;if(V.length>0){V.unshift(aj,1);Array.prototype.splice.apply(X,V);aj+=V.length-2}if(Y){for(var ai=0,am=ac.points.length;ai<am;++ai){ah=ac.points[ai];if(!ah.equals(ab)){ak.push(ah);ae.push(new B.Geometry.LineString(ak));if(ah.equals(aa)){ak=[]}else{ak=[ah.clone()]}}}}}}}if(Y&&ae.length>0&&ak.length>0){ak.push(aa.clone());ae.push(new B.Geometry.LineString(ak))}}else{af=ap.splitWith(this,W)}if(X&&X.length>1){Z=true}else{X=[]}if(ae&&ae.length>1){ad=true}else{ae=[]}if(Z||ad){if(Y){af=[ae,X]}else{af=X}}return af},splitWith:function(W,V){return W.split(this,V)},getVertices:function(V){var W;if(V===true){W=[this.components[0],this.components[this.components.length-1]]}else{if(V===false){W=this.components.slice(1,this.components.length-1)}else{W=this.components.slice()}}return W},distanceTo:function(ac,ab){var ad=!(ab&&ab.edge===false);var at=ad&&ab&&ab.details;var aj,Z={};var am=Number.POSITIVE_INFINITY;if(ac instanceof B.Geometry.Point){var ak=this.getSortedSegments();var ai=ac.x;var ah=ac.y;var aq;for(var ao=0,ap=ak.length;ao<ap;++ao){aq=ak[ao];aj=B.Geometry.distanceToSegment(ac,aq);if(aj.distance<am){am=aj.distance;Z=aj;if(am===0){break}}else{if(aq.x2>ai&&((ah>aq.y1&&ah<aq.y2)||(ah<aq.y1&&ah>aq.y2))){break}}}if(at){Z={distance:Z.distance,x0:Z.x,y0:Z.y,x1:ai,y1:ah}}else{Z=Z.distance}}else{if(ac instanceof B.Geometry.LineString){var Y=this.getSortedSegments();var X=ac.getSortedSegments();var W,V,ag,ar,aa;var af=X.length;var ae={point:true};outer:for(var ao=0,ap=Y.length;ao<ap;++ao){W=Y[ao];ar=W.x1;aa=W.y1;for(var an=0;an<af;++an){V=X[an];ag=B.Geometry.segmentsIntersect(W,V,ae);if(ag){am=0;Z={distance:0,x0:ag.x,y0:ag.y,x1:ag.x,y1:ag.y};break outer}else{aj=B.Geometry.distanceToSegment({x:ar,y:aa},V);if(aj.distance<am){am=aj.distance;Z={distance:am,x0:ar,y0:aa,x1:aj.x,y1:aj.y}}}}}if(!at){Z=Z.distance}if(am!==0){if(W){aj=ac.distanceTo(new B.Geometry.Point(W.x2,W.y2),ab);var al=at?aj.distance:aj;if(al<am){if(at){Z={distance:am,x0:aj.x1,y0:aj.y1,x1:aj.x0,y1:aj.y0}}else{Z=al}}}}}else{Z=ac.distanceTo(this,ab);if(at){Z={distance:Z.distance,x0:Z.x1,y0:Z.y1,x1:Z.x0,y1:Z.y0}}}}return Z},simplify:function(ac){if(this&&this!==null){var ae=this.getVertices();if(ae.length<3){return this}var Y=function(ag,af){return(ag-af)};var X=function(ai,al,aj,af){var ak=0;var ah=0;for(var ag=al,am;ag<aj;ag++){am=W(ai[al],ai[aj],ai[ag]);if(am>ak){ak=am;ah=ag}}if(ak>af&&ah!=al){Z.push(ah);X(ai,al,ah,af);X(ai,ah,aj,af)}};var W=function(aj,ai,ag){var ak=Math.abs(0.5*(aj.x*ai.y+ai.x*ag.y+ag.x*aj.y-ai.x*aj.y-ag.x*ai.y-aj.x*ag.y));var ah=Math.sqrt(Math.pow(aj.x-ai.x,2)+Math.pow(aj.y-ai.y,2));var af=ak/ah*2;return af};var aa=0;var ad=ae.length-1;var Z=[];Z.push(aa);Z.push(ad);while(ae[aa].equals(ae[ad])){ad--;Z.push(ad)}X(ae,aa,ad,ac);var V=[];Z.sort(Y);for(var ab=0;ab<Z.length;ab++){V.push(ae[Z[ab]])}return new B.Geometry.LineString(V)}else{return this}},CLASS_NAME:"OpenLayers.Geometry.LineString"});B.Geometry.LinearRing=B.Class(B.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(V,W){var X=false;var Y=this.components.pop();if(W!=null||!V.equals(Y)){X=B.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var Z=this.components[0];B.Geometry.Collection.prototype.addComponent.apply(this,[Z]);return X},removeComponent:function(V){var W=this.components&&(this.components.length>3);if(W){this.components.pop();B.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var X=this.components[0];B.Geometry.Collection.prototype.addComponent.apply(this,[X])}return W},move:function(W,Y){for(var X=0,V=this.components.length;X<V-1;X++){this.components[X].move(W,Y)}},rotate:function(Y,W){for(var X=0,V=this.components.length;X<V-1;++X){this.components[X].rotate(Y,W)}},resize:function(Z,W,Y){for(var X=0,V=this.components.length;X<V-1;++X){this.components[X].resize(Z,W,Y)}return this},transform:function(Z,X){if(Z&&X){for(var Y=0,V=this.components.length;Y<V-1;Y++){var W=this.components[Y];W.transform(Z,X)}this.bounds=null}return this},getCentroid:function(){if(this.components&&(this.components.length>2)){var aa=0;var Z=0;for(var X=0;X<this.components.length-1;X++){var W=this.components[X];var ac=this.components[X+1];aa+=(W.x+ac.x)*(W.x*ac.y-ac.x*W.y);Z+=(W.y+ac.y)*(W.x*ac.y-ac.x*W.y)}var Y=-1*this.getArea();var V=aa/(6*Y);var ab=Z/(6*Y);return new B.Geometry.Point(V,ab)}else{return null}},getArea:function(){var Z=0;if(this.components&&(this.components.length>2)){var Y=0;for(var X=0,W=this.components.length;X<W-1;X++){var V=this.components[X];var aa=this.components[X+1];Y+=(V.x+aa.x)*(aa.y-V.y)}Z=-Y/2}return Z},getGeodesicArea:function(W){var Y=this;if(W){var X=new B.Projection("EPSG:4326");if(!X.equals(W)){Y=this.clone().transform(W,X)}}var aa=0;var V=Y.components&&Y.components.length;if(V>2){var ac,ab;for(var Z=0;Z<V-1;Z++){ac=Y.components[Z];ab=Y.components[Z+1];aa+=B.Util.rad(ab.x-ac.x)*(2+Math.sin(B.Util.rad(ac.y))+Math.sin(B.Util.rad(ab.y)))}aa=aa*6378137*6378137/2}return aa},containsPoint:function(ag){var am=B.Number.limitSigDigs;var af=14;var ae=am(ag.x,af);var ad=am(ag.y,af);function al(ar,ao,aq,an,ap){return(ar-ap)*((an-ao)/(ap-aq))+an}var V=this.components.length-1;var ab,aa,ak,Y,ai,W,Z,X;var ac=0;for(var ah=0;ah<V;++ah){ab=this.components[ah];ak=am(ab.x,af);Y=am(ab.y,af);aa=this.components[ah+1];ai=am(aa.x,af);W=am(aa.y,af);if(Y==W){if(ad==Y){if(ak<=ai&&(ae>=ak&&ae<=ai)||ak>=ai&&(ae<=ak&&ae>=ai)){ac=-1;break}}continue}Z=am(al(ad,ak,Y,ai,W),af);if(Z==ae){if(Y<W&&(ad>=Y&&ad<=W)||Y>W&&(ad<=Y&&ad>=W)){ac=-1;break}}if(Z<=ae){continue}if(ak!=ai&&(Z<Math.min(ak,ai)||Z>Math.max(ak,ai))){continue}if(Y<W&&(ad>=Y&&ad<W)||Y>W&&(ad<Y&&ad>=W)){++ac}}var aj=(ac==-1)?1:!!(ac&1);return aj},intersects:function(Y){var W=false;if(Y.CLASS_NAME=="OpenLayers.Geometry.Point"){W=this.containsPoint(Y)}else{if(Y.CLASS_NAME=="OpenLayers.Geometry.LineString"){W=Y.intersects(this)}else{if(Y.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){W=B.Geometry.LineString.prototype.intersects.apply(this,[Y])}else{for(var X=0,V=Y.components.length;X<V;++X){W=Y.components[X].intersects(this);if(W){break}}}}}return W},getVertices:function(V){return(V===true)?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});B.Geometry.Polygon=B.Class(B.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var X=0;if(this.components&&(this.components.length>0)){X+=Math.abs(this.components[0].getArea());for(var W=1,V=this.components.length;W<V;W++){X-=Math.abs(this.components[W].getArea())}}return X},getGeodesicArea:function(W){var Y=0;if(this.components&&(this.components.length>0)){Y+=Math.abs(this.components[0].getGeodesicArea(W));for(var X=1,V=this.components.length;X<V;X++){Y-=Math.abs(this.components[X].getGeodesicArea(W))}}return Y},containsPoint:function(V){var Z=this.components.length;var X=false;if(Z>0){X=this.components[0].containsPoint(V);if(X!==1){if(X&&Z>1){var Y;for(var W=1;W<Z;++W){Y=this.components[W].containsPoint(V);if(Y){if(Y===1){X=1}else{X=false}break}}}}}return X},intersects:function(Z){var W=false;var Y,V;if(Z.CLASS_NAME=="OpenLayers.Geometry.Point"){W=this.containsPoint(Z)}else{if(Z.CLASS_NAME=="OpenLayers.Geometry.LineString"||Z.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(Y=0,V=this.components.length;Y<V;++Y){W=Z.intersects(this.components[Y]);if(W){break}}if(!W){for(Y=0,V=Z.components.length;Y<V;++Y){W=this.containsPoint(Z.components[Y]);if(W){break}}}}else{for(Y=0,V=Z.components.length;Y<V;++Y){W=this.intersects(Z.components[Y]);if(W){break}}}}if(!W&&Z.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var X=this.components[0];for(Y=0,V=X.components.length;Y<V;++Y){W=Z.containsPoint(X.components[Y]);if(W){break}}}return W},distanceTo:function(Y,W){var X=!(W&&W.edge===false);var V;if(!X&&this.intersects(Y)){V=0}else{V=B.Geometry.Collection.prototype.distanceTo.apply(this,[Y,W])}return V},CLASS_NAME:"OpenLayers.Geometry.Polygon"});B.Geometry.Polygon.createRegularPolygon=function(ad,aa,W,af){var X=Math.PI*((1/W)-(1/2));if(af){X+=(af/180)*Math.PI}var V,ac,ab;var ae=[];for(var Z=0;Z<W;++Z){V=X+(Z*2*Math.PI/W);ac=ad.x+(aa*Math.cos(V));ab=ad.y+(aa*Math.sin(V));ae.push(new B.Geometry.Point(ac,ab))}var Y=new B.Geometry.LinearRing(ae);return new B.Geometry.Polygon([Y])};B.Geometry.MultiLineString=B.Class(B.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(af,ak){var ab=null;var aj=ak&&ak.mutual;var ag,V,ai,ae,W;var Z=[];var ah=[af];for(var aa=0,ac=this.components.length;aa<ac;++aa){V=this.components[aa];ae=false;for(var Y=0;Y<ah.length;++Y){ag=V.split(ah[Y],ak);if(ag){if(aj){ai=ag[0];for(var X=0,ad=ai.length;X<ad;++X){if(X===0&&Z.length){Z[Z.length-1].addComponent(ai[X])}else{Z.push(new B.Geometry.MultiLineString([ai[X]]))}}ae=true;ag=ag[1]}if(ag.length){ag.unshift(Y,1);Array.prototype.splice.apply(ah,ag);break}}}if(!ae){if(Z.length){Z[Z.length-1].addComponent(V.clone())}else{Z=[new B.Geometry.MultiLineString(V.clone())]}}}if(Z&&Z.length>1){ae=true}else{Z=[]}if(ah&&ah.length>1){W=true}else{ah=[]}if(ae||W){if(aj){ab=[Z,ah]}else{ab=ah}}return ab},splitWith:function(af,ak){var ab=null;var aj=ak&&ak.mutual;var ag,X,ai,ae,V,Z,ah;if(af instanceof B.Geometry.LineString){ah=[];Z=[af];for(var aa=0,ac=this.components.length;aa<ac;++aa){V=false;X=this.components[aa];for(var Y=0;Y<Z.length;++Y){ag=Z[Y].split(X,ak);if(ag){if(aj){ai=ag[0];if(ai.length){ai.unshift(Y,1);Array.prototype.splice.apply(Z,ai);Y+=ai.length-2}ag=ag[1];if(ag.length===0){ag=[X.clone()]}}for(var W=0,ad=ag.length;W<ad;++W){if(W===0&&ah.length){ah[ah.length-1].addComponent(ag[W])}else{ah.push(new B.Geometry.MultiLineString([ag[W]]))}}V=true}}if(!V){if(ah.length){ah[ah.length-1].addComponent(X.clone())}else{ah=[new B.Geometry.MultiLineString([X.clone()])]}}}}else{ab=af.split(this)}if(Z&&Z.length>1){ae=true}else{Z=[]}if(ah&&ah.length>1){V=true}else{ah=[]}if(ae||V){if(aj){ab=[Z,ah]}else{ab=ah}}return ab},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});B.Geometry.MultiPolygon=B.Class(B.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});B.Renderer=B.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,featureDx:0,initialize:function(V,W){this.container=B.Util.getElement(V);B.Util.extend(this,W)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(W,X){this.extent=W.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var V=W.getWidth()/this.map.getExtent().getWidth(),W=W.scale(1/V);this.extent=W.wrapDateLine(this.map.getMaxExtent()).scale(V)}if(X){this.resolution=null}return true},setSize:function(V){this.size=V.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(ad,W){if(W==null){W=ad.style}if(ad.geometry){var V=ad.geometry.getBounds();if(V){var ac;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){ac=this.map.getMaxExtent()}if(!V.intersectsBounds(this.extent,{worldBounds:ac})){W={display:"none"}}else{this.calculateFeatureDx(V,ac)}var X=this.drawGeometry(ad.geometry,W,ad.id);if(W.display!="none"&&W.label&&X!==false){var ab=ad.geometry.getCentroid();if(W.labelXOffset||W.labelYOffset){var Z=isNaN(W.labelXOffset)?0:W.labelXOffset;var Y=isNaN(W.labelYOffset)?0:W.labelYOffset;var aa=this.getResolution();ab.move(Z*aa,Y*aa)}this.drawText(ad.id,W,ab)}else{this.removeText(ad.id)}return X}}},calculateFeatureDx:function(Z,Y){this.featureDx=0;if(Y){var aa=Y.getWidth(),W=(this.extent.left+this.extent.right)/2,X=(Z.left+Z.right)/2,V=Math.round((X-W)/aa);this.featureDx=V*aa}},drawGeometry:function(X,V,W){},drawText:function(X,W,V){},removeText:function(V){},clear:function(){},getFeatureIdFromEvent:function(V){},eraseFeatures:function(Y){if(!(B.Util.isArray(Y))){Y=[Y]}for(var X=0,V=Y.length;X<V;++X){var W=Y[X];this.eraseGeometry(W.geometry,W.id);this.removeText(W.id)}},eraseGeometry:function(W,V){},moveRoot:function(V){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(W){var V=B.Util.extend({},B.Renderer.defaultSymbolizer);if(W.stroke===false){delete V.strokeWidth;delete V.strokeColor}if(W.fill===false){delete V.fillColor}B.Util.extend(V,W);return V},CLASS_NAME:"OpenLayers.Renderer"});B.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};B.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};B.bases.Renderer=B.Renderer;B.Renderer=B.Class(B.Renderer,{textGrid:null,groupFeatures:null,angle:0,canCancelMapRotationForSymbol:true,canCancelMapRotationForLabel:true,cancelMapRotationForSymbol:function(V){},drawFeature:function(Y,aj){if(aj==null){aj=Y.style}if(Y.geometry){this.canCancelMapRotationForSymbol=(typeof aj.rotation!=="number");this.canCancelMapRotationForLabel=(typeof aj.labelRotation!=="number");var Z=Y.geometry.getBounds();if(Z){var ai;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){ai=this.map.getMaxExtent()}if(!Z.intersectsBounds(this.extent,{worldBounds:ai})){aj={display:"none"}}else{this.calculateFeatureDx(Z,ai)}if(Y.layer&&Y.layer.CUB.symbolGrid>0&&!Y.isGroupFeature){var V=Y.geometry.CLASS_NAME;if((V=="OpenLayers.Geometry.Point")){var ah=this.getResolution();var W=-this.extent.left/ah;var af=this.extent.top/ah;var ab=((Y.geometry.x-this.featureDx)/ah);var aa=(Y.geometry.y/ah);var ac=Math.floor(ab/Y.layer.CUB.symbolGrid);var ak=Math.floor(aa/Y.layer.CUB.symbolGrid);var X=ac+";"+ak;if(!this.groupFeatures||this.groupFeatures.resolution!=this.map.getResolution()){if(this.groupFeatures){delete this.groupFeatures}this.groupFeatures=new Object();this.groupFeatures.resolution=this.map.getResolution()}if(!this.groupFeatures[X]){for(var an=-1;an<=1;++an){for(var am=-1;am<=1;++am){var ag=(ac+an)+";"+(ak+am);if(this.groupFeatures[ag]){var ae=((this.groupFeatures[ag].geometry.x-this.featureDx)/ah);var ad=(this.groupFeatures[ag].geometry.y/ah);if(Math.abs(ab-ae)<Y.layer.CUB.symbolGrid&&Math.abs(aa-ad)<Y.layer.CUB.symbolGrid){X=ag}}}}}if(!this.groupFeatures[X]){this.groupFeatures[X]=new B.Feature.Vector(Y.geometry);this.groupFeatures[X].id="GroupFeature_"+X;this.groupFeatures[X].features=new Array(Y);this.groupFeatures[X].layer=Y.layer;this.groupFeatures[X].isGroupFeature=true}else{var al=this.groupFeatures[X].features[0];if(Y!=al){this.eraseGeometry(Y.geometry,Y.id);this.removeFeatureText(Y);this.groupFeatures[X].features.push(Y);Y.groupFeature=this.groupFeatures[X];if(!al.groupFeature){this.eraseGeometry(al.geometry,al.id);this.removeFeatureText(al);al.groupFeature=this.groupFeatures[X]}Y=this.groupFeatures[X]}}}}Y.groupFeature=null;if(Y.layer){aj.labelForce=Y.layer.CUB.labelForce}else{aj.labelForce=false}if(Y.isGroupFeature){aj.externalGraphic=aj.externalGraphicGroup;if(aj.pointRadius>0&&aj.externalGraphicGroup&&Y.layer.groupLabel===true){aj.label=""+Y.features.length;aj.labelMaxScaledenom=999999999999;aj.labelMinScaledenom=1;aj.labelForce=true}}this.removeFeatureText(Y);var ao=this.drawGeometry(Y.geometry,aj,Y.id);if(aj.display!="none"&&aj.label&&ao!==false&&!R){this.drawFeatureText(Y,aj)}return ao}}},removeFeatureText:function(W){if(W.textGridIdx&&W.layer.renderer.textGrid){var X=W.layer.renderer.textGrid;for(var V in W.textGridIdx){if(X[W.textGridIdx[V]]){delete X[W.textGridIdx[V]]}}delete W.textGridIdx}this.removeText(W.geometry.id)},drawFeatureText:function(ag,V){if(!this.textGrid||this.textGrid.resolution!=this.map.getResolution()||this.textGrid.angle!=M.rotate()){this.textGrid=new Object();this.textGrid.resolution=this.map.getResolution();this.textGrid.angle=M.rotate()}var ae=true;var ac=B.Util.getResolutionFromScale(V.labelMaxScaledenom,"Meter");var Z=B.Util.getResolutionFromScale(V.labelMinScaledenom,"Meter");var Y=this.map.getResolution();ae=((Y>=Z)&&(Y<=ac));if(ae){var ad=ag.geometry.getCUBType()==M.Entity.geomType.LINE?null:ag.geometry.getCentroid();if(ad){if(V.labelXOffset||V.labelYOffset){var aa=isNaN(V.labelXOffset)?0:V.labelXOffset;var X=isNaN(V.labelYOffset)?0:V.labelYOffset;var ab=this.getResolution();ad.move(aa*ab,X*ab)}if(!V.labelForce){var af=this.getTextGridIndices(V,ad,ae);if(!af){ae=false}}}}if(ae){if(this.textGrid&&af){ag.textGridIdx=[];for(var W=0;W<af.length;++W){this.textGrid[af[W]]=true;ag.textGridIdx.push(af[W])}}this.drawText(ag.geometry.id,V,ad)}else{this.removeText(ag.geometry.id)}},getTextGridIndices:function(ao,V,aq){var ag=Math.round(ao.fontSize);var ap=Math.round(this.size.w/ag);var an=this.getResolution();var X=-this.extent.left/an;var aj=this.extent.top/an;var am;if(!isNaN(am=parseInt(ao.labelRotation))){am=ao.labelRotation%360;if(ao.labelRotationIsGeo){am=(360-am+90)%360}}else{am=-this.angle}var Z=new Array();var Y=new Array();Z.push(0);Y.push(0);if(am==0){Z.push(0);Y.push(1)}else{if(am<90){Z.push(0);Y.push(1);Z.push(1);Y.push(1);Z.push(1);Y.push(0)}else{if(am<180){Z.push(0);Y.push(-1);Z.push(1);Y.push(-1);Z.push(1);Y.push(0)}else{if(am<270){Z.push(0);Y.push(-1);Z.push(-1);Y.push(-1);Z.push(-1);Y.push(0)}else{Z.push(0);Y.push(1);Z.push(-1);Y.push(1);Z.push(-1);Y.push(0)}}}}var af=Math.round((V.x-this.featureDx)/an);var ae=Math.round(V.y/an);var ah=Math.floor(af/ag);var ar=Math.floor(ae/ag);var ab=new Array();var ak=ao.label.length*(ao.fontSize/2);var aw=am*Math.PI*2/360;var aa=Math.cos(aw);var ai=Math.sin(aw);var al,av,au,ac;for(var at=Math.floor(ak/2);aq&&at>=Math.floor(-ak/2);--at){al=Math.floor((af+at*aa)/ag);av=Math.floor((ae+at*ai)/ag);if(al!=au||av!=ac){for(var ad=0;aq&&ad<Z.length;++ad){var W=(al+Z[ad])+";"+(av+Y[ad]);ab.push(W);aq=aq&&!this.textGrid[W]}}au=al;ac=av}if(!aq){return null}else{return ab}},getTextRotation:function(V){return this.getRotation(V.labelRotation,V.labelRotationIsGeo)},getSymbolRotation:function(V){return this.getRotation(V.rotation,V.symbolRotationIsGeo)},getRotation:function(X,V){var W;if(!isNaN(W=parseInt(X))){W=parseInt(X)%360;if(V){return W-90}else{return 360-W}}return null},eraseFeatures:function(Y){if(!(B.Util.isArray(Y))){Y=[Y]}for(var X=0,V=Y.length;X<V;++X){var W=Y[X];if(W.groupFeature){p.removeElementFromArray(W.groupFeature.features,W);if(W.groupFeature.features.length==1){this.eraseGeometry(W.groupFeature.geometry,W.groupFeature.id);this.removeFeatureText(W);this.drawFeature(W.groupFeature.features[0])}}else{this.eraseGeometry(W.geometry,W.id);this.removeFeatureText(W)}}},eraseAllTexts:function(X){for(var W=0,V=X.length;W<V;++W){if(X[W].textGridIdx){delete X[W].textGridIdx}if(X[W].geometry){this.removeText(X[W].geometry.id)}}},cancelRotation:function(V){this.angle=V}});p.inheritsStatic(B.bases.Renderer,B.Renderer);B.ElementsIndexer=B.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(V){this.compare=V?B.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:B.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(X){if(this.exists(X)){this.remove(X)}var aa=X.id;this.determineZIndex(X);var Y=-1;var Z=this.order.length;var V;while(Z-Y>1){V=parseInt((Y+Z)/2);var W=this.compare(this,X,B.Util.getElement(this.order[V]));if(W>0){Y=V}else{Z=V}}this.order.splice(Z,0,aa);this.indices[aa]=this.getZIndex(X);return this.getNextElement(Z)},remove:function(W){var Y=W.id;var V=B.Util.indexOf(this.order,Y);if(V>=0){this.order.splice(V,1);delete this.indices[Y];if(this.order.length>0){var X=this.order[this.order.length-1];this.maxZIndex=this.indices[X]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(V){return(this.indices[V.id]!=null)},getZIndex:function(V){return V._style.graphicZIndex},determineZIndex:function(V){var W=V._style.graphicZIndex;if(W==null){W=this.maxZIndex;V._style.graphicZIndex=W}else{if(W>this.maxZIndex){this.maxZIndex=W}}},getNextElement:function(W){var V=W+1;if(V<this.order.length){var X=B.Util.getElement(this.order[V]);if(X==undefined){X=this.getNextElement(V)}return X}else{return null}},CLASS_NAME:"OpenLayers.ElementsIndexer"});B.ElementsIndexer.IndexingMethods={Z_ORDER:function(Z,Y,W){var V=Z.getZIndex(Y);var aa=0;if(W){var X=Z.getZIndex(W);aa=V-X}return aa},Z_ORDER_DRAWING_ORDER:function(X,W,V){var Y=B.ElementsIndexer.IndexingMethods.Z_ORDER(X,W,V);if(V&&Y==0){Y=1}return Y},Z_ORDER_Y_ORDER:function(Y,X,W){var Z=B.ElementsIndexer.IndexingMethods.Z_ORDER(Y,X,W);if(W&&Z===0){var V=W._boundsBottom-X._boundsBottom;Z=(V===0)?1:V}return Z}};B.Renderer.Elements=B.Class(B.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(V,W){B.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(W&&(W.zIndexing||W.yOrdering)){this.indexer=new B.ElementsIndexer(W.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;B.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var W;var V=this.vectorRoot;if(V){while(W=V.firstChild){V.removeChild(W)}}V=this.textRoot;if(V){while(W=V.firstChild){V.removeChild(W)}}if(this.indexer){this.indexer.clear()}},setExtent:function(Z,ab){var X=B.Renderer.prototype.setExtent.apply(this,arguments);var W=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var V,Y=Z.getWidth()/this.map.getExtent().getWidth(),Z=Z.scale(1/Y),aa=this.map.getMaxExtent();if(aa.right>Z.left&&aa.right<Z.right){V=true}else{if(aa.left>Z.left&&aa.left<Z.right){V=false}}if(V!==this.rightOfDateLine||ab){X=false;this.xOffset=V===true?aa.getWidth()/W:0}this.rightOfDateLine=V}return X},getNodeType:function(W,V){},drawGeometry:function(ad,V,Y){var ac=ad.CLASS_NAME;var X=true;if((ac=="OpenLayers.Geometry.Collection")||(ac=="OpenLayers.Geometry.MultiPoint")||(ac=="OpenLayers.Geometry.MultiLineString")||(ac=="OpenLayers.Geometry.MultiPolygon")){for(var aa=0,ab=ad.components.length;aa<ab;aa++){X=this.drawGeometry(ad.components[aa],V,Y)&&X}return X}X=false;var Z=false;if(V.display!="none"){if(V.backgroundGraphic){this.redrawBackgroundNode(ad.id,ad,V,Y)}else{Z=true}X=this.redrawNode(ad.id,ad,V,Y)}if(X==false){var W=document.getElementById(ad.id);if(W){if(W._style.backgroundGraphic){Z=true}W.parentNode.removeChild(W)}}if(Z){var W=document.getElementById(ad.id+this.BACKGROUND_ID_SUFFIX);if(W){W.parentNode.removeChild(W)}}return X},redrawNode:function(ab,aa,W,Z){W=this.applyDefaultSymbolizer(W);var X=this.nodeFactory(ab,this.getNodeType(aa,W));X._featureId=Z;X._boundsBottom=aa.getBounds().bottom;X._geometryClass=aa.CLASS_NAME;X._style=W;var V=this.drawGeometryNode(X,aa,W);if(V===false){return false}X=V.node;if(this.indexer){var Y=this.indexer.insert(X);if(Y){this.vectorRoot.insertBefore(X,Y)}else{this.vectorRoot.appendChild(X)}}else{if(X.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(X)}}this.postDraw(X);return V.complete},redrawBackgroundNode:function(Z,Y,W,X){var V=B.Util.extend({},W);V.externalGraphic=V.backgroundGraphic;V.graphicXOffset=V.backgroundXOffset;V.graphicYOffset=V.backgroundYOffset;V.graphicZIndex=V.backgroundGraphicZIndex;V.graphicWidth=V.backgroundWidth||V.graphicWidth;V.graphicHeight=V.backgroundHeight||V.graphicHeight;V.backgroundGraphic=null;V.backgroundXOffset=null;V.backgroundYOffset=null;V.backgroundGraphicZIndex=null;return this.redrawNode(Z+this.BACKGROUND_ID_SUFFIX,Y,V,null)},drawGeometryNode:function(X,Z,W){W=W||X._style;var V={isFilled:W.fill===undefined?true:W.fill,isStroked:W.stroke===undefined?!!W.strokeWidth:W.stroke};var Y;switch(Z.CLASS_NAME){case"OpenLayers.Geometry.Point":if(W.graphic===false){V.isFilled=false;V.isStroked=false}Y=this.drawPoint(X,Z);break;case"OpenLayers.Geometry.LineString":V.isFilled=false;Y=this.drawLineString(X,Z);break;case"OpenLayers.Geometry.LinearRing":Y=this.drawLinearRing(X,Z);break;case"OpenLayers.Geometry.Polygon":Y=this.drawPolygon(X,Z);break;case"OpenLayers.Geometry.Rectangle":Y=this.drawRectangle(X,Z);break;default:break}X._options=V;if(Y!=false){return{node:this.setStyle(X,W,V,Z),complete:Y}}else{return false}},postDraw:function(V){},drawPoint:function(V,W){},drawLineString:function(V,W){},drawLinearRing:function(V,W){},drawPolygon:function(V,W){},drawRectangle:function(V,W){},drawCircle:function(V,W){},removeText:function(X){var V=document.getElementById(X+this.LABEL_ID_SUFFIX);if(V){this.textRoot.removeChild(V)}var W=document.getElementById(X+this.LABEL_OUTLINE_SUFFIX);if(W){this.textRoot.removeChild(W)}},getFeatureIdFromEvent:function(V){var Y=V.target;var W=Y&&Y.correspondingUseElement;var X=W?W:(Y||V.srcElement);return X._featureId},eraseGeometry:function(ab,aa){if((ab.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(ab.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(ab.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(ab.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var Y=0,V=ab.components.length;Y<V;Y++){this.eraseGeometry(ab.components[Y],aa)}}else{var X=B.Util.getElement(ab.id);if(X&&X.parentNode){if(X.geometry){X.geometry.destroy();X.geometry=null}X.parentNode.removeChild(X);if(this.indexer){this.indexer.remove(X)}if(X._style.backgroundGraphic){var W=ab.id+this.BACKGROUND_ID_SUFFIX;var Z=B.Util.getElement(W);if(Z&&Z.parentNode){Z.parentNode.removeChild(Z)}}}}},nodeFactory:function(X,V){var W=B.Util.getElement(X);if(W){if(!this.nodeTypeCompare(W,V)){W.parentNode.removeChild(W);W=this.nodeFactory(X,V)}}else{W=this.createNode(V,X)}return W},nodeTypeCompare:function(W,V){},createNode:function(V,W){},moveRoot:function(W){var V=this.root;if(W.root.parentNode==this.rendererRoot){V=W.root}V.parentNode.removeChild(V);W.rendererRoot.appendChild(V)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(V){return(V!="circle")&&!!V},CLASS_NAME:"OpenLayers.Renderer.Elements"});B.bases.RendererElements=B.Renderer.Elements;B.Renderer.Elements=B.Class(B.Renderer.Elements,{drawGeometry:function(Y,V,X){if(V.display=="none"){var W=document.getElementById(Y.id+"_underStroke");if(W){W.parentNode.removeChild(W)}}return B.bases.RendererElements.prototype.drawGeometry.apply(this,[Y,V,X])},redrawNode:function(W,ab,V,Z){V=V||X._style;if(V.underStrokeWidth){var ae=V.strokeColor;V.strokeColor=V.underStrokeColor;var ac=V.strokeWidth;V.strokeWidth=V.underStrokeWidth;var aa=V.strokeOpacity;V.strokeOpacity=V.underStrokeOpacity;var ad=V.strokeLinecap;V.strokeLinecap="butt";var Y=B.bases.RendererElements.prototype.redrawNode.apply(this,[W+"_underStroke",ab,V,Z]);if(Y==false){var X=document.getElementById(W+"_underStroke");if(X){if(X._style.backgroundGraphic){removeBackground=true}X.parentNode.removeChild(X)}}V.strokeColor=ae;V.strokeWidth=ac;V.strokeOpacity=aa;V.strokeLinecap=ad}return B.bases.RendererElements.prototype.redrawNode.apply(this,[W,ab,V,Z])},eraseGeometry:function(X,W){B.bases.RendererElements.prototype.eraseGeometry.apply(this,[X,W]);var V=X.id;X.id=X.id+"_underStroke";B.bases.RendererElements.prototype.eraseGeometry.apply(this,[X,W]);X.id=V},getFeatureIdFromEvent:function(V){var Z=V.target;var W=Z&&Z.correspondingUseElement;var Y=W?W:(Z||V.srcElement);if(Y._featureId&&Y._featureId.indexOf("GroupFeature_")==0){for(var X in this.groupFeatures){if(this.groupFeatures[X].id==Y._featureId){return this.groupFeatures[X]}}}else{return Y._featureId}},clear:function(){B.bases.RendererElements.prototype.clear.apply(this);for(var V in this.groupFeatures){if(this.groupFeatures[V].geometry){this.eraseGeometry(this.groupFeatures[V].geometry,this.groupFeatures[V].id);this.removeText(this.groupFeatures[V].geometry.id)}}this.groupFeatures=null;this.textGrid=null}});B.Renderer.SVG=B.Class(B.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(V){if(!this.supported()){return}B.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}},supported:function(){var V="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(V+"SVG","1.1")||document.implementation.hasFeature(V+"BasicStructure","1.1")))},inValidRange:function(V,Z,W){var Y=V+(W?0:this.translationParameters.x);var X=Z+(W?0:this.translationParameters.y);return(Y>=-this.MAX_PIXEL&&Y<=this.MAX_PIXEL&&X>=-this.MAX_PIXEL&&X<=this.MAX_PIXEL)},setExtent:function(X,Z){var W=B.Renderer.Elements.prototype.setExtent.apply(this,arguments);var V=this.getResolution(),ab=-X.left/V,aa=X.top/V;if(Z){this.left=ab;this.top=aa;var Y="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",Y);this.translate(this.xOffset,0);return true}else{var ac=this.translate(ab-this.left+this.xOffset,aa-this.top);if(!ac){this.setExtent(X,true)}return W&&ac}},translate:function(V,X){if(!this.inValidRange(V,X,true)){return false}else{var W="";if(V||X){W="translate("+V+","+X+")"}this.root.setAttributeNS(null,"transform",W);this.translationParameters={x:V,y:X};return true}},setSize:function(V){B.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(X,W){var V=null;switch(X.CLASS_NAME){case"OpenLayers.Geometry.Point":if(W.externalGraphic){V="image"}else{if(this.isComplexSymbol(W.graphicName)){V="svg"}else{V="circle"}}break;case"OpenLayers.Geometry.Rectangle":V="rect";break;case"OpenLayers.Geometry.LineString":V="polyline";break;case"OpenLayers.Geometry.LinearRing":V="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":V="path";break;default:break}return V},setStyle:function(ak,an,W){an=an||ak._style;W=W||ak._options;var af=parseFloat(ak.getAttributeNS(null,"r"));var ae=1;var Y;if(ak._geometryClass=="OpenLayers.Geometry.Point"&&af){ak.style.visibility="";if(an.graphic===false){ak.style.visibility="hidden"}else{if(an.externalGraphic){Y=this.getPosition(ak);if(an.graphicTitle){ak.setAttributeNS(null,"title",an.graphicTitle);var aj=ak.getElementsByTagName("title");if(aj.length>0){aj[0].firstChild.textContent=an.graphicTitle}else{var aa=this.nodeFactory(null,"title");aa.textContent=an.graphicTitle;ak.appendChild(aa)}}if(an.graphicWidth&&an.graphicHeight){ak.setAttributeNS(null,"preserveAspectRatio","none")}var ai=an.graphicWidth||an.graphicHeight;var ah=an.graphicHeight||an.graphicWidth;ai=ai?ai:an.pointRadius*2;ah=ah?ah:an.pointRadius*2;var ao=(an.graphicXOffset!=undefined)?an.graphicXOffset:-(0.5*ai);var ab=(an.graphicYOffset!=undefined)?an.graphicYOffset:-(0.5*ah);var V=an.graphicOpacity||an.fillOpacity;ak.setAttributeNS(null,"x",(Y.x+ao).toFixed());ak.setAttributeNS(null,"y",(Y.y+ab).toFixed());ak.setAttributeNS(null,"width",ai);ak.setAttributeNS(null,"height",ah);ak.setAttributeNS(this.xlinkns,"href",an.externalGraphic);ak.setAttributeNS(null,"style","opacity: "+V);ak.onclick=B.Renderer.SVG.preventDefault}else{if(this.isComplexSymbol(an.graphicName)){var X=an.pointRadius*3;var ag=X*2;var Z=this.importSymbol(an.graphicName);Y=this.getPosition(ak);ae=this.symbolMetrics[Z.id][0]*3/ag;var ac=ak.parentNode;var ad=ak.nextSibling;if(ac){ac.removeChild(ak)}ak.firstChild&&ak.removeChild(ak.firstChild);ak.appendChild(Z.firstChild.cloneNode(true));ak.setAttributeNS(null,"viewBox",Z.getAttributeNS(null,"viewBox"));ak.setAttributeNS(null,"width",ag);ak.setAttributeNS(null,"height",ag);ak.setAttributeNS(null,"x",Y.x-X);ak.setAttributeNS(null,"y",Y.y-X);if(ad){ac.insertBefore(ak,ad)}else{if(ac){ac.appendChild(ak)}}}else{ak.setAttributeNS(null,"r",an.pointRadius)}}}var am=an.rotation;if((am!==undefined||ak._rotation!==undefined)&&Y){ak._rotation=am;am|=0;if(ak.nodeName!=="svg"){ak.setAttributeNS(null,"transform","rotate("+am+" "+Y.x+" "+Y.y+")")}else{var al=this.symbolMetrics[Z.id];ak.firstChild.setAttributeNS(null,"transform","rotate("+am+" "+al[1]+" "+al[2]+")")}}}if(W.isFilled){ak.setAttributeNS(null,"fill",an.fillColor);ak.setAttributeNS(null,"fill-opacity",an.fillOpacity)}else{ak.setAttributeNS(null,"fill","none")}if(W.isStroked){ak.setAttributeNS(null,"stroke",an.strokeColor);ak.setAttributeNS(null,"stroke-opacity",an.strokeOpacity);ak.setAttributeNS(null,"stroke-width",an.strokeWidth*ae);ak.setAttributeNS(null,"stroke-linecap",an.strokeLinecap||"round");ak.setAttributeNS(null,"stroke-linejoin","round");an.strokeDashstyle&&ak.setAttributeNS(null,"stroke-dasharray",this.dashStyle(an,ae))}else{ak.setAttributeNS(null,"stroke","none")}if(an.pointerEvents){ak.setAttributeNS(null,"pointer-events",an.pointerEvents)}if(an.cursor!=null){ak.setAttributeNS(null,"cursor",an.cursor)}return ak},dashStyle:function(X,W){var V=X.strokeWidth*W;var Y=X.strokeDashstyle;switch(Y){case"solid":return"none";case"dot":return[1,4*V].join();case"dash":return[4*V,4*V].join();case"dashdot":return[4*V,4*V,1,4*V].join();case"longdash":return[8*V,4*V].join();case"longdashdot":return[8*V,4*V,1,4*V].join();default:return B.String.trim(Y).replace(/\s+/g,",")}},createNode:function(V,X){var W=document.createElementNS(this.xmlns,V);if(X){W.setAttributeNS(null,"id",X)}return W},nodeTypeCompare:function(W,V){return(V==W.nodeName)},createRenderRoot:function(){var V=this.nodeFactory(this.container.id+"_svgRoot","svg");V.style.display="block";return V},createRoot:function(V){return this.nodeFactory(this.container.id+V,"g")},createDefs:function(){var V=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(V);return V},drawPoint:function(V,W){return this.drawCircle(V,W,1)},drawCircle:function(Y,Z,W){var X=this.getResolution();var V=((Z.x-this.featureDx)/X+this.left);var aa=(this.top-Z.y/X);if(this.inValidRange(V,aa)){Y.setAttributeNS(null,"cx",V);Y.setAttributeNS(null,"cy",aa);Y.setAttributeNS(null,"r",W);return Y}else{return false}},drawLineString:function(W,X){var V=this.getComponentsString(X.components);if(V.path){W.setAttributeNS(null,"points",V.path);return(V.complete?W:null)}else{return false}},drawLinearRing:function(W,X){var V=this.getComponentsString(X.components);if(V.path){W.setAttributeNS(null,"points",V.path);return(V.complete?W:null)}else{return false}},drawPolygon:function(W,ab){var aa="";var ac=true;var V=true;var X,ad;for(var Y=0,Z=ab.components.length;Y<Z;Y++){aa+=" M";X=this.getComponentsString(ab.components[Y].components," ");ad=X.path;if(ad){aa+=" "+ad;V=X.complete&&V}else{ac=false}}aa+=" z";if(ac){W.setAttributeNS(null,"d",aa);W.setAttributeNS(null,"fill-rule","evenodd");return V?W:null}else{return false}},drawRectangle:function(X,Y){var W=this.getResolution();var V=((Y.x-this.featureDx)/W+this.left);var Z=(this.top-Y.y/W);if(this.inValidRange(V,Z)){X.setAttributeNS(null,"x",V);X.setAttributeNS(null,"y",Z);X.setAttributeNS(null,"width",Y.width/W);X.setAttributeNS(null,"height",Y.height/W);return X}else{return false}},drawText:function(aa,W,aj){var V=(!!W.labelOutlineWidth);if(V){var af=B.Util.extend({},W);af.fontColor=af.labelOutlineColor;af.fontStrokeColor=af.labelOutlineColor;af.fontStrokeWidth=W.labelOutlineWidth;delete af.labelOutlineWidth;this.drawText(aa,af,aj)}var X=this.getResolution();var ai=((aj.x-this.featureDx)/X+this.left);var ae=(aj.y/X-this.top);var ak=(V)?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX;var ah=this.nodeFactory(aa+ak,"text");ah.setAttributeNS(null,"x",ai);ah.setAttributeNS(null,"y",-ae);if(W.fontColor){ah.setAttributeNS(null,"fill",W.fontColor)}if(W.fontStrokeColor){ah.setAttributeNS(null,"stroke",W.fontStrokeColor)}if(W.fontStrokeWidth){ah.setAttributeNS(null,"stroke-width",W.fontStrokeWidth)}if(W.fontOpacity){ah.setAttributeNS(null,"opacity",W.fontOpacity)}if(W.fontFamily){ah.setAttributeNS(null,"font-family",W.fontFamily)}if(W.fontSize){ah.setAttributeNS(null,"font-size",W.fontSize)}if(W.fontWeight){ah.setAttributeNS(null,"font-weight",W.fontWeight)}if(W.fontStyle){ah.setAttributeNS(null,"font-style",W.fontStyle)}if(W.labelSelect===true){ah.setAttributeNS(null,"pointer-events","visible");ah._featureId=aa}else{ah.setAttributeNS(null,"pointer-events","none")}var ac=W.labelAlign||B.Renderer.defaultSymbolizer.labelAlign;ah.setAttributeNS(null,"text-anchor",B.Renderer.SVG.LABEL_ALIGN[ac[0]]||"middle");if(B.IS_GECKO===true){ah.setAttributeNS(null,"dominant-baseline",B.Renderer.SVG.LABEL_ALIGN[ac[1]]||"central")}var Y=W.label.split("\n");var ab=Y.length;while(ah.childNodes.length>ab){ah.removeChild(ah.lastChild)}for(var Z=0;Z<ab;Z++){var ad=this.nodeFactory(aa+ak+"_tspan_"+Z,"tspan");if(W.labelSelect===true){ad._featureId=aa;ad._geometry=aj;ad._geometryClass=aj.CLASS_NAME}if(B.IS_GECKO===false){ad.setAttributeNS(null,"baseline-shift",B.Renderer.SVG.LABEL_VSHIFT[ac[1]]||"-35%")}ad.setAttribute("x",ai);if(Z==0){var ag=B.Renderer.SVG.LABEL_VFACTOR[ac[1]];if(ag==null){ag=-0.5}ad.setAttribute("dy",(ag*(ab-1))+"em")}else{ad.setAttribute("dy","1em")}ad.textContent=(Y[Z]==="")?" ":Y[Z];if(!ad.parentNode){ah.appendChild(ad)}}if(!ah.parentNode){this.textRoot.appendChild(ah)}},getComponentsString:function(Y,X){var aa=[];var V=true;var Z=Y.length;var ad=[];var ab,ac;for(var W=0;W<Z;W++){ac=Y[W];aa.push(ac);ab=this.getShortString(ac);if(ab){ad.push(ab)}else{if(W>0){if(this.getShortString(Y[W-1])){ad.push(this.clipLine(Y[W],Y[W-1]))}}if(W<Z-1){if(this.getShortString(Y[W+1])){ad.push(this.clipLine(Y[W],Y[W+1]))}}V=false}}return{path:ad.join(X||","),complete:V}},clipLine:function(Z,ac){if(ac.equals(Z)){return""}var aa=this.getResolution();var W=this.MAX_PIXEL-this.translationParameters.x;var V=this.MAX_PIXEL-this.translationParameters.y;var Y=(ac.x-this.featureDx)/aa+this.left;var ae=this.top-ac.y/aa;var X=(Z.x-this.featureDx)/aa+this.left;var ad=this.top-Z.y/aa;var ab;if(X<-W||X>W){ab=(ad-ae)/(X-Y);X=X<0?-W:W;ad=ae+(X-Y)*ab}if(ad<-V||ad>V){ab=(X-Y)/(ad-ae);ad=ad<0?-V:V;X=Y+(ad-ae)*ab}return X+","+ad},getShortString:function(W){var X=this.getResolution();var V=((W.x-this.featureDx)/X+this.left);var Y=(this.top-W.y/X);if(this.inValidRange(V,Y)){return V+","+Y}else{return false}},getPosition:function(V){return({x:parseFloat(V.getAttributeNS(null,"cx")),y:parseFloat(V.getAttributeNS(null,"cy"))})},importSymbol:function(aa){if(!this.defs){this.defs=this.createDefs()}var W=this.container.id+"-"+aa;var X=document.getElementById(W);if(X!=null){return X}var Z=B.Renderer.symbol[aa];if(!Z){throw new Error(aa+" is not a valid symbol name")}var ac=this.nodeFactory(W,"symbol");var Y=this.nodeFactory(null,"polygon");ac.appendChild(Y);var ah=new B.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var af=[];var ae,ad;for(var ab=0;ab<Z.length;ab=ab+2){ae=Z[ab];ad=Z[ab+1];ah.left=Math.min(ah.left,ae);ah.bottom=Math.min(ah.bottom,ad);ah.right=Math.max(ah.right,ae);ah.top=Math.max(ah.top,ad);af.push(ae,",",ad)}Y.setAttributeNS(null,"points",af.join(" "));var V=ah.getWidth();var ag=ah.getHeight();var ai=[ah.left-V,ah.bottom-ag,V*3,ag*3];ac.setAttributeNS(null,"viewBox",ai.join(" "));this.symbolMetrics[W]=[Math.max(V,ag),ah.getCenterLonLat().lon,ah.getCenterLonLat().lat];this.defs.appendChild(ac);return ac},getFeatureIdFromEvent:function(V){var X=B.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!X){var W=V.target;X=W.parentNode&&W!=this.rendererRoot?W.parentNode._featureId:undefined}return X},CLASS_NAME:"OpenLayers.Renderer.SVG"});B.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};B.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};B.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};B.Renderer.SVG.preventDefault=function(V){V.preventDefault&&V.preventDefault()};B.bases.RendererSVG=B.Renderer.SVG;B.Renderer.SVG=B.Class(B.Renderer.SVG,{getFeatureIdFromEvent:function(V){var X=B.bases.RendererSVG.prototype.getFeatureIdFromEvent.apply(this,arguments);if(X&&(typeof X==="string")&&X.indexOf("GroupFeature_")==0){for(var W in this.groupFeatures){if(this.groupFeatures[W].id==X){return this.groupFeatures[W]}}}else{return X}},getComponentsString:function(Z,Y){var W=true;var aa=Z.length;var ad=[];var ab,ac,V;for(var X=0;X<aa;X++){ac=Z[X];if(X==0||!(Math.abs(V.x-ac.x)<5&&Math.abs(V.y-ac.y)<5)){V=ac;ab=this.getShortString(ac);if(ab){ad.push(ab)}else{if(X>0){if(this.getShortString(Z[X-1])){ad.push(this.clipLine(Z[X],Z[X-1]))}}if(X<aa-1){if(this.getShortString(Z[X+1])){ad.push(this.clipLine(Z[X],Z[X+1]))}}W=false}}}return{path:ad.join(Y||","),complete:W}},dashStyle:function(X,W){var V=X.strokeWidth*W;var Y=X.strokeDashstyle;switch(Y){case"solid":return"none";case"dot":return[1,4*V].join();case"dash":return[4*V,4*V].join();case"dashdot":return[4*V,4*V,1,4*V].join();case"longdash":return[8*V,4*V].join();case"longdashdot":return[8*V,4*V,1,4*V].join();case"shortdot":return[0,2*V].join();case"shortdash":return[2*V,2*V].join();case"shortdashdot":return[2*V,2*V,1,2*V].join();case"shortdashdotdot":return[2*V,2*V,1,2*V,1,2*V].join();case"longdashdotdot":return[8*V,4*V,1,4*V,1,4*V].join();default:return B.String.trim(Y).replace(/\s+/g,",")}},getNodeType:function(X,W){var V=null;switch(X.CLASS_NAME){case"OpenLayers.Geometry.Point":if(W.externalGraphic){V="image"}else{if(this.isComplexSymbol(W.graphicName)){V="svg"}else{V="circle"}}break;case"OpenLayers.Geometry.Rectangle":V="rect";break;case"OpenLayers.Geometry.LineString":V="path";break;case"OpenLayers.Geometry.LinearRing":V="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":V="path";break;default:break}return V},drawLineString:function(W,X){this.tmpNode=W;var V=this.getComponentsString(X.components);if(V.path){W.setAttributeNS(null,"d"," M"+V.path);return(V.complete?W:null)}else{return false}},setStyle:function(ak,an,W){an=an||ak._style;W=W||ak._options;var af=parseFloat(ak.getAttributeNS(null,"r"));var ae=1;var Y;if(ak._geometryClass=="OpenLayers.Geometry.Point"&&af){ak.style.visibility="";if(an.graphic===false){ak.style.visibility="hidden"}else{if(an.externalGraphic){Y=this.getPosition(ak);if(an.graphicTitle){ak.setAttributeNS(null,"title",an.graphicTitle);var aj=ak.getElementsByTagName("title");if(aj.length>0){aj[0].firstChild.textContent=an.graphicTitle}else{var aa=this.nodeFactory(null,"title");aa.textContent=an.graphicTitle;ak.appendChild(aa)}}if(an.graphicWidth&&an.graphicHeight){ak.setAttributeNS(null,"preserveAspectRatio","none")}var ai=an.graphicWidth||an.graphicHeight;var ah=an.graphicHeight||an.graphicWidth;ai=ai?ai:an.pointRadius*2;ah=ah?ah:an.pointRadius*2;var ao=(an.graphicXOffset!=undefined)?an.graphicXOffset:-(0.5*ai);var ab=(an.graphicYOffset!=undefined)?an.graphicYOffset:-(0.5*ah);var V=an.graphicOpacity||an.fillOpacity;ak.setAttributeNS(null,"x",(Y.x+ao).toFixed());ak.setAttributeNS(null,"y",(Y.y+ab).toFixed());ak.setAttributeNS(null,"width",ai);ak.setAttributeNS(null,"height",ah);ak.setAttributeNS(this.xlinkns,"href",an.externalGraphic);ak.setAttributeNS(null,"style","opacity: "+V);ak.onclick=B.Renderer.SVG.preventDefault}else{if(this.isComplexSymbol(an.graphicName)){var X=an.pointRadius*3;var ag=X*2;var Z=this.importSymbol(an.graphicName);Y=this.getPosition(ak);ae=this.symbolMetrics[Z.id][0]*3/ag;var ac=ak.parentNode;var ad=ak.nextSibling;if(ac){ac.removeChild(ak)}ak.firstChild&&ak.removeChild(ak.firstChild);ak.appendChild(Z.firstChild.cloneNode(true));ak.setAttributeNS(null,"viewBox",Z.getAttributeNS(null,"viewBox"));ak.setAttributeNS(null,"width",ag);ak.setAttributeNS(null,"height",ag);ak.setAttributeNS(null,"x",Y.x-X);ak.setAttributeNS(null,"y",Y.y-X);if(ad){ac.insertBefore(ak,ad)}else{if(ac){ac.appendChild(ak)}}}else{if(an.pointRadius>0){ak.setAttributeNS(null,"r",an.pointRadius)}else{ak.setAttributeNS(null,"r",0)}}}}var am=this.getSymbolRotation(an)||-this.angle;if((am!==undefined||ak._rotation!==undefined)&&Y){ak._rotation=am;am|=0;if(ak.nodeName!=="svg"){ak.setAttributeNS(null,"transform","rotate("+am+" "+Y.x+" "+Y.y+")")}else{var al=this.symbolMetrics[Z.id];ak.firstChild.setAttributeNS(null,"transform","rotate("+am+" "+al[1]+" "+al[2]+")")}}}if(W.isFilled){ak.setAttributeNS(null,"fill",an.fillColor);ak.setAttributeNS(null,"fill-opacity",an.fillOpacity)}else{ak.setAttributeNS(null,"fill","none")}if(W.isStroked){ak.setAttributeNS(null,"stroke",an.strokeColor);ak.setAttributeNS(null,"stroke-opacity",an.strokeOpacity);ak.setAttributeNS(null,"stroke-width",an.strokeWidth*ae);ak.setAttributeNS(null,"stroke-linecap",an.strokeLinecap||"round");ak.setAttributeNS(null,"stroke-linejoin","round");an.strokeDashstyle&&ak.setAttributeNS(null,"stroke-dasharray",this.dashStyle(an,ae))}else{ak.setAttributeNS(null,"stroke","none")}if(an.pointerEvents){ak.setAttributeNS(null,"pointer-events",an.pointerEvents)}if(an.cursor!=null){ak.setAttributeNS(null,"cursor",an.cursor)}return ak},drawText:function(ak,am,V){var aa=(!!am.labelOutlineWidth);if(aa){var W=B.Util.extend({},am);W.fontColor=W.labelOutlineColor;W.fontStrokeColor=W.labelOutlineColor;W.fontStrokeWidth=am.labelOutlineWidth;delete W.labelOutlineWidth;this.drawText(ak,W,V)}var X=(aa)?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX;var ad=this.nodeFactory(ak+X,"text");var aj=am.labelAlign||B.Renderer.defaultSymbolizer.labelAlign;if(V){var ai=this.getResolution();var af=((V.x-this.featureDx)/ai+this.left);var ae=(V.y/ai-this.top);ad.setAttributeNS(null,"x",af);ad.setAttributeNS(null,"y",-ae);var Z=am.label.split("\n");var Y=Z.length;while(ad.childNodes.length>Y){ad.removeChild(ad.lastChild)}for(var al=0;al<Y;al++){var ab=this.nodeFactory(ak+X+"_tspan_"+al,"tspan");if(am.labelSelect===true){ab._featureId=ak;ab._geometry=V;ab._geometryClass=V.CLASS_NAME}if(B.IS_GECKO===false){ab.setAttributeNS(null,"baseline-shift",B.Renderer.SVG.LABEL_VSHIFT[aj[1]]||"-35%")}ab.setAttribute("x",af);if(al==0){var ag=B.Renderer.SVG.LABEL_VFACTOR[aj[1]];if(ag==null){ag=-0.5}ab.setAttribute("dy",(ag*(Y-1))+"em")}else{ab.setAttribute("dy","1em")}ab.textContent=(Z[al]==="")?" ":Z[al];if(!ab.parentNode){ad.appendChild(ab)}}var ah=this.getTextRotation(am);if(!ah){ah=-this.angle}else{ad.setAttributeNS(null,"fixed-rot","true")}ad.setAttributeNS(null,"transform","rotate("+ah+" "+af+" "+-ae+")")}else{var ac=this.nodeFactory(ak+X+"_path","textPath");ac.textContent=am.label;ac.setAttributeNS(null,"startOffset","50%");ac.setAttributeNS(this.xlinkns,"href","#"+this.tmpNode.id);if(!ac.parentNode){ad.appendChild(ac)}}if(am.fontColor){ad.setAttributeNS(null,"fill",am.fontColor)}if(am.fontStrokeColor){ad.setAttributeNS(null,"stroke",am.fontStrokeColor)}if(am.fontStrokeWidth){ad.setAttributeNS(null,"stroke-width",am.fontStrokeWidth)}if(am.fontOpacity){ad.setAttributeNS(null,"opacity",am.fontOpacity)}if(am.fontFamily){ad.setAttributeNS(null,"font-family",am.fontFamily)}if(am.fontSize){ad.setAttributeNS(null,"font-size",am.fontSize)}if(am.fontWeight){ad.setAttributeNS(null,"font-weight",am.fontWeight)}if(am.fontStyle){ad.setAttributeNS(null,"font-style",am.fontStyle)}if(am.labelSelect===true){ad.setAttributeNS(null,"pointer-events","visible");ad._featureId=ak}else{ad.setAttributeNS(null,"pointer-events","none")}ad.setAttributeNS(null,"text-anchor",B.Renderer.SVG.LABEL_ALIGN[aj[0]]||"middle");if(B.IS_GECKO===true){ad.setAttributeNS(null,"dominant-baseline",B.Renderer.SVG.LABEL_ALIGN[aj[1]]||"central")}if(!ad.parentNode){this.textRoot.appendChild(ad)}},cancelRotation:function(V){this.angle=V;if(this.canCancelMapRotationForLabel){this.cancelRotationForLabel(V)}if(this.canCancelMapRotationForSymbol){this.cancelMapRotationForSymbol(V)}},cancelRotationForLabel:function(V){this.angle=V;return},cancelMapRotationForSymbol:function(X){this.angle=X;for(var V=0;V<this.vectorRoot.childNodes.length;++V){var W=this.vectorRoot.childNodes[V];if(W.nodeName=="image"){var Y=this.getPosition(W);W.setAttributeNS(null,"transform","rotate("+(-X)+" "+Y.x+" "+Y.y+")")}}}});p.inheritsStatic(B.bases.RendererSVG,B.Renderer.SVG);B.Renderer.Canvas=B.Class(B.Renderer,{hitDetection:true,hitOverflow:0,canvas:null,features:null,pendingRedraw:false,cachedSymbolBounds:{},initialize:function(V,W){B.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},setExtent:function(){B.Renderer.prototype.setExtent.apply(this,arguments);return false},eraseGeometry:function(W,V){this.eraseFeatures(this.features[V][0])},supported:function(){return B.CANVAS_SUPPORTED},setSize:function(W){this.size=W.clone();var V=this.root;V.style.width=W.w+"px";V.style.height=W.h+"px";V.width=W.w;V.height=W.h;this.resolution=null;if(this.hitDetection){var X=this.hitCanvas;X.style.width=W.w+"px";X.style.height=W.h+"px";X.width=W.w;X.height=W.h}},drawFeature:function(V,W){var aa;if(V.geometry){W=this.applyDefaultSymbolizer(W||V.style);var Z=V.geometry.getBounds();var Y;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){Y=this.map.getMaxExtent()}var X=Z&&Z.intersectsBounds(this.extent,{worldBounds:Y});aa=(W.display!=="none")&&!!Z&&X;if(aa){this.features[V.id]=[V,W]}else{delete (this.features[V.id])}this.pendingRedraw=true}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=false}return aa},drawGeometry:function(Z,X,Y){var W=Z.CLASS_NAME;if((W=="OpenLayers.Geometry.Collection")||(W=="OpenLayers.Geometry.MultiPoint")||(W=="OpenLayers.Geometry.MultiLineString")||(W=="OpenLayers.Geometry.MultiPolygon")){for(var V=0;V<Z.components.length;V++){this.drawGeometry(Z.components[V],X,Y)}return}switch(Z.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(Z,X,Y);break;case"OpenLayers.Geometry.LineString":this.drawLineString(Z,X,Y);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(Z,X,Y);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(Z,X,Y);break;default:break}},drawExternalGraphic:function(ad,V,Y){var Z=new Image();if(V.graphicTitle){Z.title=V.graphicTitle}var W=V.graphicWidth||V.graphicHeight;var ae=V.graphicHeight||V.graphicWidth;W=W?W:V.pointRadius*2;ae=ae?ae:V.pointRadius*2;var ab=(V.graphicXOffset!=undefined)?V.graphicXOffset:-(0.5*W);var X=(V.graphicYOffset!=undefined)?V.graphicYOffset:-(0.5*ae);var aa=V.graphicOpacity||V.fillOpacity;var ac=function(){if(!this.features[Y]){return}var ai=this.getLocalXY(ad);var al=ai[0];var aj=ai[1];if(!isNaN(al)&&!isNaN(aj)){var af=(al+ab)|0;var ak=(aj+X)|0;var ag=this.canvas;ag.globalAlpha=aa;var ah=B.Renderer.Canvas.drawImageScaleFactor||(B.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);ag.drawImage(Z,af*ah,ak*ah,W*ah,ae*ah);if(this.hitDetection){this.setHitContextStyle("fill",Y);this.hitContext.fillRect(af,ak,W,ae)}}};Z.onload=B.Function.bind(ac,this);Z.src=V.externalGraphic},drawNamedSymbol:function(ag,W,ac){var ah,af,ab,aa,ad,V,X,Z;var ae;var ai=Math.PI/180;var Y=B.Renderer.symbol[W.graphicName];if(!Y){throw new Error(W.graphicName+" is not a valid symbol name")}if(!Y.length||Y.length<2){return}var al=this.getLocalXY(ag);var ak=al[0];var aj=al[1];if(isNaN(ak)||isNaN(aj)){return}this.canvas.lineCap="round";this.canvas.lineJoin="round";if(this.hitDetection){this.hitContext.lineCap="round";this.hitContext.lineJoin="round"}if(W.graphicName in this.cachedSymbolBounds){V=this.cachedSymbolBounds[W.graphicName]}else{V=new B.Bounds();for(ad=0;ad<Y.length;ad+=2){V.extend(new B.LonLat(Y[ad],Y[ad+1]))}this.cachedSymbolBounds[W.graphicName]=V}this.canvas.save();if(this.hitDetection){this.hitContext.save()}this.canvas.translate(ak,aj);if(this.hitDetection){this.hitContext.translate(ak,aj)}Z=ai*W.rotation;if(!isNaN(Z)){this.canvas.rotate(Z);if(this.hitDetection){this.hitContext.rotate(Z)}}X=2*W.pointRadius/Math.max(V.getWidth(),V.getHeight());this.canvas.scale(X,X);if(this.hitDetection){this.hitContext.scale(X,X)}ab=V.getCenterLonLat().lon;aa=V.getCenterLonLat().lat;this.canvas.translate(-ab,-aa);if(this.hitDetection){this.hitContext.translate(-ab,-aa)}ae=W.strokeWidth;W.strokeWidth=ae/X;if(W.fill!==false){this.setCanvasStyle("fill",W);this.canvas.beginPath();for(ad=0;ad<Y.length;ad=ad+2){ah=Y[ad];af=Y[ad+1];if(ad==0){this.canvas.moveTo(ah,af)}this.canvas.lineTo(ah,af)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",ac,W);this.hitContext.beginPath();for(ad=0;ad<Y.length;ad=ad+2){ah=Y[ad];af=Y[ad+1];if(ad==0){this.canvas.moveTo(ah,af)}this.hitContext.lineTo(ah,af)}this.hitContext.closePath();this.hitContext.fill()}}if(W.stroke!==false){this.setCanvasStyle("stroke",W);this.canvas.beginPath();for(ad=0;ad<Y.length;ad=ad+2){ah=Y[ad];af=Y[ad+1];if(ad==0){this.canvas.moveTo(ah,af)}this.canvas.lineTo(ah,af)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",ac,W,X);this.hitContext.beginPath();for(ad=0;ad<Y.length;ad=ad+2){ah=Y[ad];af=Y[ad+1];if(ad==0){this.hitContext.moveTo(ah,af)}this.hitContext.lineTo(ah,af)}this.hitContext.closePath();this.hitContext.stroke()}}W.strokeWidth=ae;this.canvas.restore();if(this.hitDetection){this.hitContext.restore()}this.setCanvasStyle("reset")},setCanvasStyle:function(W,V){if(W==="fill"){this.canvas.globalAlpha=V.fillOpacity;this.canvas.fillStyle=V.fillColor}else{if(W==="stroke"){this.canvas.globalAlpha=V.strokeOpacity;this.canvas.strokeStyle=V.strokeColor;this.canvas.lineWidth=V.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}}},featureIdToHex:function(X){var Y=Number(X.split("_").pop())+1;if(Y>=16777216){this.hitOverflow=Y-16777215;Y=Y%16777216+1}var W="000000"+Y.toString(16);var V=W.length;W="#"+W.substring(V-6,V);return W},setHitContextStyle:function(W,Z,V,Y){var X=this.featureIdToHex(Z);if(W=="fill"){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=X}else{if(W=="stroke"){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=X;if(typeof Y==="undefined"){this.hitContext.lineWidth=V.strokeWidth+2}else{if(!isNaN(Y)){this.hitContext.lineWidth=V.strokeWidth+2/Y}}}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}}},drawPoint:function(ab,X,aa){if(X.graphic!==false){if(X.externalGraphic){this.drawExternalGraphic(ab,X,aa)}else{if(X.graphicName&&(X.graphicName!="circle")){this.drawNamedSymbol(ab,X,aa)}else{var Y=this.getLocalXY(ab);var ac=Y[0];var Z=Y[1];if(!isNaN(ac)&&!isNaN(Z)){var W=Math.PI*2;var V=X.pointRadius;if(X.fill!==false){this.setCanvasStyle("fill",X);this.canvas.beginPath();this.canvas.arc(ac,Z,V,0,W,true);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",aa,X);this.hitContext.beginPath();this.hitContext.arc(ac,Z,V,0,W,true);this.hitContext.fill()}}if(X.stroke!==false){this.setCanvasStyle("stroke",X);this.canvas.beginPath();this.canvas.arc(ac,Z,V,0,W,true);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",aa,X);this.hitContext.beginPath();this.hitContext.arc(ac,Z,V,0,W,true);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}}}},drawLineString:function(X,V,W){V=B.Util.applyDefaults({fill:false},V);this.drawLinearRing(X,V,W)},drawLinearRing:function(X,V,W){if(V.fill!==false){this.setCanvasStyle("fill",V);this.renderPath(this.canvas,X,V,W,"fill");if(this.hitDetection){this.setHitContextStyle("fill",W,V);this.renderPath(this.hitContext,X,V,W,"fill")}}if(V.stroke!==false){this.setCanvasStyle("stroke",V);this.renderPath(this.canvas,X,V,W,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",W,V);this.renderPath(this.hitContext,X,V,W,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(X,ae,V,Z,ac){var aa=ae.components;var ab=aa.length;X.beginPath();var W=this.getLocalXY(aa[0]);var af=W[0];var ad=W[1];if(!isNaN(af)&&!isNaN(ad)){X.moveTo(W[0],W[1]);for(var Y=1;Y<ab;++Y){var ag=this.getLocalXY(aa[Y]);X.lineTo(ag[0],ag[1])}if(ac==="fill"){X.fill()}else{X.stroke()}}},drawPolygon:function(aa,X,Z){var Y=aa.components;var V=Y.length;this.drawLinearRing(Y[0],X,Z);for(var W=1;W<V;++W){this.canvas.globalCompositeOperation="destination-out";if(this.hitDetection){this.hitContext.globalCompositeOperation="destination-out"}this.drawLinearRing(Y[W],B.Util.applyDefaults({stroke:false,fillOpacity:1},X),Z);this.canvas.globalCompositeOperation="source-over";if(this.hitDetection){this.hitContext.globalCompositeOperation="source-over"}this.drawLinearRing(Y[W],B.Util.applyDefaults({fill:false},X),Z)}},drawText:function(af,V){var ag=this.getLocalXY(af);this.setCanvasStyle("reset");this.canvas.fillStyle=V.fontColor;this.canvas.globalAlpha=V.fontOpacity||1;var Y=[V.fontStyle?V.fontStyle:"normal","normal",V.fontWeight?V.fontWeight:"normal",V.fontSize?V.fontSize:"1em",V.fontFamily?V.fontFamily:"sans-serif"].join(" ");var X=V.label.split("\n");var aa=X.length;if(this.canvas.fillText){this.canvas.font=Y;this.canvas.textAlign=B.Renderer.Canvas.LABEL_ALIGN[V.labelAlign[0]]||"center";this.canvas.textBaseline=B.Renderer.Canvas.LABEL_ALIGN[V.labelAlign[1]]||"middle";var ad=B.Renderer.Canvas.LABEL_FACTOR[V.labelAlign[1]];if(ad==null){ad=-0.5}var ae=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;ag[1]+=ae*ad*(aa-1);for(var Z=0;Z<aa;Z++){if(V.labelOutlineWidth){this.canvas.save();this.canvas.strokeStyle=V.labelOutlineColor;this.canvas.lineWidth=V.labelOutlineWidth;this.canvas.strokeText(X[Z],ag[0],ag[1]+(ae*Z)+1);this.canvas.restore()}this.canvas.fillText(X[Z],ag[0],ag[1]+(ae*Z))}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=Y;var W=B.Renderer.Canvas.LABEL_FACTOR[V.labelAlign[0]];if(W==null){W=-0.5}var ad=B.Renderer.Canvas.LABEL_FACTOR[V.labelAlign[1]];if(ad==null){ad=-0.5}var ae=this.canvas.mozMeasureText("xx");ag[1]+=ae*(1+(ad*aa));for(var Z=0;Z<aa;Z++){var ac=ag[0]+(W*this.canvas.mozMeasureText(X[Z]));var ab=ag[1]+(Z*ae);this.canvas.translate(ac,ab);this.canvas.mozDrawText(X[Z]);this.canvas.translate(-ac,-ab)}}}this.setCanvasStyle("reset")},getLocalXY:function(W){var X=this.getResolution();var Y=this.extent;var V=((W.x-this.featureDx)/X+(-Y.left/X));var Z=((Y.top/X)-W.y/X);return[V,Z]},clear:function(){var V=this.root.height;var W=this.root.width;this.canvas.clearRect(0,0,W,V);this.features={};if(this.hitDetection){this.hitContext.clearRect(0,0,W,V)}},getFeatureIdFromEvent:function(ab){var X,ad;if(this.hitDetection&&this.root.style.display!=="none"){if(!this.map.dragging){var ac=ab.xy;var aa=ac.x|0;var Z=ac.y|0;var Y=this.hitContext.getImageData(aa,Z,1,1).data;if(Y[3]===255){var V=Y[2]+(256*(Y[1]+(256*Y[0])));if(V){X="OpenLayers.Feature.Vector_"+(V-1+this.hitOverflow);try{ad=this.features[X][0]}catch(W){}}}}}return ad},eraseFeatures:function(W){if(!(B.Util.isArray(W))){W=[W]}for(var V=0;V<W.length;++V){delete this.features[W[V].id]}this.redraw()},redraw:function(){if(!this.locked){var ad=this.root.height;var X=this.root.width;this.canvas.clearRect(0,0,X,ad);if(this.hitDetection){this.hitContext.clearRect(0,0,X,ad)}var aa=[];var af,ab,V;var ac=(this.map.baseLayer&&this.map.baseLayer.wrapDateLine)&&this.map.getMaxExtent();for(var W in this.features){if(!this.features.hasOwnProperty(W)){continue}af=this.features[W][0];ab=af.geometry;this.calculateFeatureDx(ab.getBounds(),ac);V=this.features[W][1];this.drawGeometry(ab,V,af.id);if(V.label){aa.push([af,V])}}var ae;for(var Y=0,Z=aa.length;Y<Z;++Y){ae=aa[Y];this.drawText(ae[0].geometry.getCentroid(),ae[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});B.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};B.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};B.Renderer.Canvas.drawImageScaleFactor=null;B.bases.RendererCanvas=B.Renderer.Canvas;B.Renderer.Canvas=B.Class(B.Renderer.Canvas,{drawExternalGraphic:function(ad,V,Y){var Z=new Image();if(V.graphicTitle){Z.title=V.graphicTitle}var W=V.graphicWidth||V.graphicHeight;var ae=V.graphicHeight||V.graphicWidth;W=W?W:V.pointRadius*2;ae=ae?ae:V.pointRadius*2;var ab=(V.graphicXOffset!=undefined)?V.graphicXOffset:-(0.5*W);var X=(V.graphicYOffset!=undefined)?V.graphicYOffset:-(0.5*ae);var aa=V.graphicOpacity||V.fillOpacity;var ac=function(){if(!this.features[Y]){return}var ai=this.getLocalXY(ad);var al=ai[0];var aj=ai[1];if(!isNaN(al)&&!isNaN(aj)){var af=(al+ab)|0;var ak=(aj+X)|0;var ag=this.canvas;ag.globalAlpha=aa;var ah=B.Renderer.Canvas.drawImageScaleFactor||(B.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);ag.drawImage(Z,af*ah,ak*ah);if(this.hitDetection){this.setHitContextStyle("fill",Y);this.hitContext.fillRect(af,ak,W,ae)}}};Z.onload=B.Function.bind(ac,this);Z.src=V.externalGraphic}});p.inheritsStatic(B.bases.RendererCanvas,B.Renderer.Canvas);B.Renderer.VML=B.Class(B.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(W){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var Z=document.createStyleSheet();var X=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var Y=0,V=X.length;Y<V;Y++){Z.addRule("olv\\:"+X[Y],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}B.Renderer.Elements.prototype.initialize.apply(this,arguments)},supported:function(){return !!(document.namespaces)},setExtent:function(ae,W){var V=B.Renderer.Elements.prototype.setExtent.apply(this,arguments);var Y=this.getResolution();var X=(ae.left/Y)|0;var ac=(ae.top/Y-this.size.h)|0;if(W||!this.offset){this.offset={x:X,y:ac};X=0;ac=0}else{X=X-this.offset.x;ac=ac-this.offset.y}var ag=(X-this.xOffset)+" "+ac;this.root.coordorigin=ag;var ad=[this.root,this.vectorRoot,this.textRoot];var ab;for(var Z=0,aa=ad.length;Z<aa;++Z){ab=ad[Z];var af=this.size.w+" "+this.size.h;ab.coordsize=af}this.root.style.flip="y";return V},setSize:function(aa){B.Renderer.prototype.setSize.apply(this,arguments);var Y=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var X=this.size.w+"px";var ab=this.size.h+"px";var W;for(var Z=0,V=Y.length;Z<V;++Z){W=Y[Z];W.style.width=X;W.style.height=ab}},getNodeType:function(X,W){var V=null;switch(X.CLASS_NAME){case"OpenLayers.Geometry.Point":if(W.externalGraphic){V="olv:rect"}else{if(this.isComplexSymbol(W.graphicName)){V="olv:shape"}else{V="olv:oval"}}break;case"OpenLayers.Geometry.Rectangle":V="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":V="olv:shape";break;default:break}return V},setStyle:function(Z,W,al,af){W=W||Z._style;al=al||Z._options;var X=W.fillColor;if(Z._geometryClass==="OpenLayers.Geometry.Point"){if(W.externalGraphic){al.isFilled=true;if(W.graphicTitle){Z.title=W.graphicTitle}var Y=W.graphicWidth||W.graphicHeight;var ag=W.graphicHeight||W.graphicWidth;Y=Y?Y:W.pointRadius*2;ag=ag?ag:W.pointRadius*2;var ab=this.getResolution();var ad=(W.graphicXOffset!=undefined)?W.graphicXOffset:-(0.5*Y);var aa=(W.graphicYOffset!=undefined)?W.graphicYOffset:-(0.5*ag);Z.style.left=((((af.x-this.featureDx)/ab-this.offset.x)+ad)|0)+"px";Z.style.top=(((af.y/ab-this.offset.y)-(aa+ag))|0)+"px";Z.style.width=Y+"px";Z.style.height=ag+"px";Z.style.flip="y";X="none";al.isStroked=false}else{if(this.isComplexSymbol(W.graphicName)){var V=this.importSymbol(W.graphicName);Z.path=V.path;Z.coordorigin=V.left+","+V.bottom;var ak=V.size;Z.coordsize=ak+","+ak;this.drawCircle(Z,af,W.pointRadius);Z.style.flip="y"}else{this.drawCircle(Z,af,W.pointRadius)}}}if(al.isFilled){Z.fillcolor=X}else{Z.filled="false"}var ae=Z.getElementsByTagName("fill");var aj=(ae.length==0)?null:ae[0];if(!al.isFilled){if(aj){Z.removeChild(aj)}}else{if(!aj){aj=this.createNode("olv:fill",Z.id+"_fill")}aj.opacity=W.fillOpacity;if(Z._geometryClass==="OpenLayers.Geometry.Point"&&W.externalGraphic){if(W.graphicOpacity){aj.opacity=W.graphicOpacity}aj.src=W.externalGraphic;aj.type="frame";if(!(W.graphicWidth&&W.graphicHeight)){aj.aspect="atmost"}}if(aj.parentNode!=Z){Z.appendChild(aj)}}var ai=W.rotation;if((ai!==undefined||Z._rotation!==undefined)){Z._rotation=ai;if(W.externalGraphic){this.graphicRotate(Z,ad,aa,W);aj.opacity=0}else{if(Z._geometryClass==="OpenLayers.Geometry.Point"){Z.style.rotation=ai||0}}}var ac=Z.getElementsByTagName("stroke");var ah=(ac.length==0)?null:ac[0];if(!al.isStroked){Z.stroked=false;if(ah){ah.on=false}}else{if(!ah){ah=this.createNode("olv:stroke",Z.id+"_stroke");Z.appendChild(ah)}ah.on=true;ah.color=W.strokeColor;ah.weight=W.strokeWidth+"px";ah.opacity=W.strokeOpacity;ah.endcap=W.strokeLinecap=="butt"?"flat":(W.strokeLinecap||"round");if(W.strokeDashstyle){ah.dashstyle=this.dashStyle(W)}}if(W.cursor!="inherit"&&W.cursor!=null){Z.style.cursor=W.cursor}return Z},graphicRotate:function(ai,am,Z,al){var al=al||ai._style;var aj=al.rotation||0;var V,ae;if(!(al.graphicWidth&&al.graphicHeight)){var an=new Image();an.onreadystatechange=B.Function.bind(function(){if(an.readyState=="complete"||an.readyState=="interactive"){V=an.width/an.height;ae=Math.max(al.pointRadius*2,al.graphicWidth||0,al.graphicHeight||0);am=am*V;al.graphicWidth=ae*V;al.graphicHeight=ae;this.graphicRotate(ai,am,Z,al)}},this);an.src=al.externalGraphic;return}else{ae=Math.max(al.graphicWidth,al.graphicHeight);V=al.graphicWidth/al.graphicHeight}var ah=Math.round(al.graphicWidth||ae*V);var af=Math.round(al.graphicHeight||ae);ai.style.width=ah+"px";ai.style.height=af+"px";var ag=document.getElementById(ai.id+"_image");if(!ag){ag=this.createNode("olv:imagedata",ai.id+"_image");ai.appendChild(ag)}ag.style.width=ah+"px";ag.style.height=af+"px";ag.src=al.externalGraphic;ag.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var aa=aj*Math.PI/180;var ac=Math.sin(aa);var Y=Math.cos(aa);var ab="progid:DXImageTransform.Microsoft.Matrix(M11="+Y+",M12="+(-ac)+",M21="+ac+",M22="+Y+",SizingMethod='auto expand')\n";var W=al.graphicOpacity||al.fillOpacity;if(W&&W!=1){ab+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+W+")\n"}ai.style.filter=ab;var ak=new B.Geometry.Point(-am,-Z);var X=new B.Bounds(0,0,ah,af).toGeometry();X.rotate(al.rotation,ak);var ad=X.getBounds();ai.style.left=Math.round(parseInt(ai.style.left)+ad.left)+"px";ai.style.top=Math.round(parseInt(ai.style.top)-ad.bottom)+"px"},postDraw:function(V){V.style.visibility="visible";var X=V._style.fillColor;var W=V._style.strokeColor;if(X=="none"&&V.fillcolor!=X){V.fillcolor=X}if(W=="none"&&V.strokecolor!=W){V.strokecolor=W}},setNodeDimension:function(W,Z){var Y=Z.getBounds();if(Y){var V=this.getResolution();var X=new B.Bounds(((Y.left-this.featureDx)/V-this.offset.x)|0,(Y.bottom/V-this.offset.y)|0,((Y.right-this.featureDx)/V-this.offset.x)|0,(Y.top/V-this.offset.y)|0);W.style.left=X.left+"px";W.style.top=X.top+"px";W.style.width=X.getWidth()+"px";W.style.height=X.getHeight()+"px";W.coordorigin=X.left+" "+X.top;W.coordsize=X.getWidth()+" "+X.getHeight()}},dashStyle:function(V){var X=V.strokeDashstyle;switch(X){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return X;default:var W=X.split(/[ ,]/);if(W.length==2){if(1*W[0]>=2*W[1]){return"longdash"}return(W[0]==1||W[1]==1)?"dot":"dash"}else{if(W.length==4){return(1*W[0]>=2*W[1])?"longdashdot":"dashdot"}}return"solid"}},createNode:function(V,X){var W=document.createElement(V);if(X){W.id=X}W.unselectable="on";W.onselectstart=B.Function.False;return W},nodeTypeCompare:function(X,W){var Y=W;var V=Y.indexOf(":");if(V!=-1){Y=Y.substr(V+1)}var Z=X.nodeName;V=Z.indexOf(":");if(V!=-1){Z=Z.substr(V+1)}return(Y==Z)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(V){return this.nodeFactory(this.container.id+V,"olv:group")},drawPoint:function(V,W){return this.drawCircle(V,W,1)},drawCircle:function(Y,Z,V){if(!isNaN(Z.x)&&!isNaN(Z.y)){var W=this.getResolution();Y.style.left=((((Z.x-this.featureDx)/W-this.offset.x)|0)-V)+"px";Y.style.top=(((Z.y/W-this.offset.y)|0)-V)+"px";var X=V*2;Y.style.width=X+"px";Y.style.height=X+"px";return Y}return false},drawLineString:function(V,W){return this.drawLine(V,W,false)},drawLinearRing:function(V,W){return this.drawLine(V,W,true)},drawLine:function(W,ae,ab){this.setNodeDimension(W,ae);var X=this.getResolution();var V=ae.components.length;var Z=new Array(V);var ac,af,ad;for(var aa=0;aa<V;aa++){ac=ae.components[aa];af=((ac.x-this.featureDx)/X-this.offset.x)|0;ad=(ac.y/X-this.offset.y)|0;Z[aa]=" "+af+","+ad+" l "}var Y=(ab)?" x e":" e";W.path="m"+Z.join("")+Y;return W},drawPolygon:function(X,af){this.setNodeDimension(X,af);var Y=this.getResolution();var ak=[];var Z,ad,ah,V,ab,W,aa,aj,ac,ai,ag,ae;for(Z=0,ad=af.components.length;Z<ad;Z++){ak.push("m");ah=af.components[Z].components;V=(Z===0);ab=null;W=null;for(aa=0,aj=ah.length;aa<aj;aa++){ac=ah[aa];ag=((ac.x-this.featureDx)/Y-this.offset.x)|0;ae=(ac.y/Y-this.offset.y)|0;ai=" "+ag+","+ae;ak.push(ai);if(aa==0){ak.push(" l")}if(!V){if(!ab){ab=ai}else{if(ab!=ai){if(!W){W=ai}else{if(W!=ai){V=true}}}}}}ak.push(V?" x ":" ")}ak.push("e");X.path=ak.join("");return X},drawRectangle:function(W,X){var V=this.getResolution();W.style.left=(((X.x-this.featureDx)/V-this.offset.x)|0)+"px";W.style.top=((X.y/V-this.offset.y)|0)+"px";W.style.width=((X.width/V)|0)+"px";W.style.height=((X.height/V)|0)+"px";return W},drawText:function(Y,V,ac){var ab=this.nodeFactory(Y+this.LABEL_ID_SUFFIX,"olv:rect");var aa=this.nodeFactory(Y+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var X=this.getResolution();ab.style.left=(((ac.x-this.featureDx)/X-this.offset.x)|0)+"px";ab.style.top=((ac.y/X-this.offset.y)|0)+"px";ab.style.flip="y";aa.innerText=V.label;if(V.cursor!="inherit"&&V.cursor!=null){aa.style.cursor=V.cursor}if(V.fontColor){aa.style.color=V.fontColor}if(V.fontOpacity){aa.style.filter="alpha(opacity="+(V.fontOpacity*100)+")"}if(V.fontFamily){aa.style.fontFamily=V.fontFamily}if(V.fontSize){aa.style.fontSize=V.fontSize}if(V.fontWeight){aa.style.fontWeight=V.fontWeight}if(V.fontStyle){aa.style.fontStyle=V.fontStyle}if(V.labelSelect===true){ab._featureId=Y;aa._featureId=Y;aa._geometry=ac;aa._geometryClass=ac.CLASS_NAME}aa.style.whiteSpace="nowrap";aa.inset="1px,0px,0px,0px";if(!ab.parentNode){ab.appendChild(aa);this.textRoot.appendChild(ab)}var Z=V.labelAlign||"cm";if(Z.length==1){Z+="m"}var ad=aa.clientWidth*(B.Renderer.VML.LABEL_SHIFT[Z.substr(0,1)]);var W=aa.clientHeight*(B.Renderer.VML.LABEL_SHIFT[Z.substr(1,1)]);ab.style.left=parseInt(ab.style.left)-ad-1+"px";ab.style.top=parseInt(ab.style.top)+W+"px"},moveRoot:function(W){var V=this.map.getLayer(W.container.id);if(V instanceof B.Layer.Vector.RootContainer){V=this.map.getLayer(this.container.id)}V&&V.renderer.clear();B.Renderer.Elements.prototype.moveRoot.apply(this,arguments);V&&V.redraw()},importSymbol:function(Y){var W=this.container.id+"-"+Y;var V=this.symbolCache[W];if(V){return V}var X=B.Renderer.symbol[Y];if(!X){throw new Error(Y+" is not a valid symbol name")}var ae=new B.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var Z=["m"];for(var aa=0;aa<X.length;aa=aa+2){var ac=X[aa];var ab=X[aa+1];ae.left=Math.min(ae.left,ac);ae.bottom=Math.min(ae.bottom,ab);ae.right=Math.max(ae.right,ac);ae.top=Math.max(ae.top,ab);Z.push(ac);Z.push(ab);if(aa==0){Z.push("l")}}Z.push("x e");var af=Z.join(" ");var ad=(ae.getWidth()-ae.getHeight())/2;if(ad>0){ae.bottom=ae.bottom-ad;ae.top=ae.top+ad}else{ae.left=ae.left+ad;ae.right=ae.right-ad}V={path:af,size:ae.getWidth(),left:ae.left,bottom:ae.bottom};this.symbolCache[W]=V;return V},CLASS_NAME:"OpenLayers.Renderer.VML"});B.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};B.bases.RendererVML=B.Renderer.VML;B.Renderer.VML=B.Class(B.Renderer.VML,{drawLine:function(W,ag,ab){this.setNodeDimension(W,ag);var X=this.getResolution();var V=ag.components.length;var Z=new Array();var ac,ah,af,ae,ad;for(var aa=0;aa<V;aa++){ac=ag.components[aa];ah=(ac.x/X-this.offset.x)|0;af=(ac.y/X-this.offset.y)|0;if(aa==0||!(Math.abs(ae-ah)<5&&Math.abs(ad-af)<5)){ae=ah;ad=af;Z.push(" "+ah+","+af+" l ")}}var Y=(ab)?" x e":" e";W.path="m"+Z.join("")+Y;return W},drawPolygon:function(ad,V){this.setNodeDimension(ad,V);var af=this.getResolution();var ab=[];var ag,aj,ah,ak,W,am,ai,Z,al,ae,Y,X,ac,aa;for(ag=0,aj=V.components.length;ag<aj;ag++){ab.push("m");ah=V.components[ag].components;ak=(ag===0);W=null;am=null;for(ai=0,Z=ah.length;ai<Z;ai++){al=ah[ai];Y=(al.x/af-this.offset.x)|0;X=(al.y/af-this.offset.y)|0;if(ai==0||!(Math.abs(ac-Y)<5&&Math.abs(aa-X)<5)){ac=Y;aa=X;ae=" "+Y+","+X;ab.push(ae);if(ai==0){ab.push(" l")}if(!ak){if(!W){W=ae}else{if(W!=ae){if(!am){am=ae}else{if(am!=ae){ak=true}}}}}}}ab.push(ak?" x ":" ")}ab.push("e");ad.path=ab.join("");return ad},drawSurface:function(W,ad){this.setNodeDimension(W,ad);var X=this.getResolution();var ag=[];var Z,af,ac,ae,ab,V;V=0;for(var Y=0,aa=ad.components.length;Y<aa;Y++){Z=ad.components[Y];af=(Z.x/X-this.offset.x)|0;ac=(Z.y/X-this.offset.y)|0;if(Y==0||!(Math.abs(ae-af)<5&&Math.abs(ab-ac)<5)){ae=af;ab=ac;if((V%3)==0&&(V/3)==0){ag.push("m")}else{if(V%3==1){ag.push(" c")}}ag.push(" "+af+","+ac);V+=1}}ag.push(" x e");W.path=ag.join("");return W},drawCircle:function(W,X,V){if(V<=0){return false}B.bases.RendererVML.prototype.drawCircle.apply(this,arguments)},drawText:function(X,W,V){if(!V){return}B.bases.RendererVML.prototype.drawText.apply(this,arguments)},dashStyle:function(V){return V.strokeDashstyle}});p.inheritsStatic(B.bases.RendererVML,B.Renderer.VML);B.Layer.Vector=B.Class(B.Layer,{isBaseLayer:false,isFixed:false,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,ratio:1,initialize:function(X,W){B.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new B.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var Y=0,V=this.strategies.length;Y<V;Y++){this.strategies[Y].setLayer(this)}}},destroy:function(){if(this.strategies){var X,W,V;for(W=0,V=this.strategies.length;W<V;W++){X=this.strategies[W];if(X.autoDestroy){X.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;B.Layer.prototype.destroy.apply(this,arguments)},clone:function(Z){if(Z==null){Z=new B.Layer.Vector(this.name,this.getOptions())}Z=B.Layer.prototype.clone.apply(this,[Z]);var X=this.features;var V=X.length;var Y=new Array(V);for(var W=0;W<V;++W){Y[W]=X[W].clone()}Z.features=Y;return Z},refresh:function(V){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",V)}},assignRenderer:function(){for(var X=0,V=this.renderers.length;X<V;X++){var W=this.renderers[X];var Y=(typeof W=="function")?W:B.Renderer[W];if(Y&&Y.prototype.supported()){this.renderer=new Y(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){B.Console.userError(B.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(W){B.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;var V=this.map.getSize();V.w=V.w*this.ratio;V.h=V.h*this.ratio;this.renderer.setSize(V)}},afterAdd:function(){if(this.strategies){var X,W,V;for(W=0,V=this.strategies.length;W<V;W++){X=this.strategies[W];if(X.autoActivate){X.activate()}}}},removeMap:function(X){this.drawn=false;if(this.strategies){var Y,W,V;for(W=0,V=this.strategies.length;W<V;W++){Y=this.strategies[W];if(Y.autoActivate){Y.deactivate()}}}},onMapResize:function(){B.Layer.prototype.onMapResize.apply(this,arguments);var V=this.map.getSize();V.w=V.w*this.ratio;V.h=V.h*this.ratio;this.renderer.setSize(V)},moveTo:function(V,W,af){B.Layer.prototype.moveTo.apply(this,arguments);var X=true;if(!af){this.renderer.root.style.visibility="hidden";var ae=this.map.getSize(),ac=ae.w,aa=ae.h,Z=(ac/2*this.ratio)-ac/2,Y=(aa/2*this.ratio)-aa/2;Z+=parseInt(this.map.layerContainerDiv.style.left,10);Z=-Math.round(Z);Y+=parseInt(this.map.layerContainerDiv.style.top,10);Y=-Math.round(Y);this.div.style.left=Z+"px";this.div.style.top=Y+"px";var ag=this.map.getExtent().scale(this.ratio);X=this.renderer.setExtent(ag,W);this.renderer.root.style.visibility="visible";if(B.IS_GECKO===true){this.div.scrollLeft=this.div.scrollLeft}if(!W&&X){for(var ab in this.unrenderedFeatures){var ah=this.unrenderedFeatures[ab];this.drawFeature(ah)}}}if(!this.drawn||W||!X){this.drawn=true;var ah;for(var ab=0,ad=this.features.length;ab<ad;ab++){this.renderer.locked=(ab!==(ad-1));ah=this.features[ab];this.drawFeature(ah)}}},display:function(V){B.Layer.prototype.display.apply(this,arguments);var W=this.div.style.display;if(W!=this.renderer.root.style.display){this.renderer.root.style.display=W}},addFeatures:function(W,ad){if(!(B.Util.isArray(W))){W=[W]}var ab=!ad||!ad.silent;if(ab){var V={features:W};var aa=this.events.triggerEvent("beforefeaturesadded",V);if(aa===false){return}W=V.features}var Y=[];for(var X=0,Z=W.length;X<Z;X++){if(X!=(W.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var ac=W[X];if(this.geometryType&&!(ac.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)}ac.layer=this;if(!ac.style&&this.style){ac.style=B.Util.extend({},this.style)}if(ab){if(this.events.triggerEvent("beforefeatureadded",{feature:ac})===false){continue}this.preFeatureInsert(ac)}Y.push(ac);this.features.push(ac);this.drawFeature(ac);if(ab){this.events.triggerEvent("featureadded",{feature:ac});this.onFeatureInsert(ac)}}if(ab){this.events.triggerEvent("featuresadded",{features:Y})}},removeFeatures:function(Z,V){if(!Z||Z.length===0){return}if(Z===this.features){return this.removeAllFeatures(V)}if(!(B.Util.isArray(Z))){Z=[Z]}if(Z===this.selectedFeatures){Z=Z.slice()}var Y=!V||!V.silent;if(Y){this.events.triggerEvent("beforefeaturesremoved",{features:Z})}for(var X=Z.length-1;X>=0;X--){if(X!=0&&Z[X-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var W=Z[X];delete this.unrenderedFeatures[W.id];if(Y){this.events.triggerEvent("beforefeatureremoved",{feature:W})}this.features=B.Util.removeItem(this.features,W);W.layer=null;if(W.geometry){this.renderer.eraseFeatures(W)}if(B.Util.indexOf(this.selectedFeatures,W)!=-1){B.Util.removeItem(this.selectedFeatures,W)}if(Y){this.events.triggerEvent("featureremoved",{feature:W})}}if(Y){this.events.triggerEvent("featuresremoved",{features:Z})}},removeAllFeatures:function(V){var Y=!V||!V.silent;var Z=this.features;if(Y){this.events.triggerEvent("beforefeaturesremoved",{features:Z})}var X;for(var W=Z.length-1;W>=0;W--){X=Z[W];if(Y){this.events.triggerEvent("beforefeatureremoved",{feature:X})}X.layer=null;if(Y){this.events.triggerEvent("featureremoved",{feature:X})}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(Y){this.events.triggerEvent("featuresremoved",{features:Z})}},destroyFeatures:function(Y,V){var X=(Y==undefined);if(X){Y=this.features}if(Y){this.removeFeatures(Y,V);for(var W=Y.length-1;W>=0;W--){Y[W].destroy()}}},drawFeature:function(V,W){if(!this.drawn){return}if(typeof W!="object"){if(!W&&V.state===B.State.DELETE){W="delete"}var X=W||V.renderIntent;W=V.style||this.style;if(!W){W=this.styleMap.createSymbolizer(V,X)}}var Y=this.renderer.drawFeature(V,W);if(Y===false||Y===null){this.unrenderedFeatures[V.id]=V}else{delete this.unrenderedFeatures[V.id]}},eraseFeatures:function(V){this.renderer.eraseFeatures(V)},getFeatureFromEvent:function(V){if(!this.renderer){throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")}var W=null;var X=this.renderer.getFeatureIdFromEvent(V);if(X){if(typeof X==="string"){W=this.getFeatureById(X)}else{W=X}}return W},getFeatureBy:function(Z,Y){var X=null;for(var W=0,V=this.features.length;W<V;++W){if(this.features[W][Z]==Y){X=this.features[W];break}}return X},getFeatureById:function(V){return this.getFeatureBy("id",V)},getFeatureByFid:function(V){return this.getFeatureBy("fid",V)},getFeaturesByAttribute:function(Y,Z){var X,W,V=this.features.length,aa=[];for(X=0;X<V;X++){W=this.features[X];if(W&&W.attributes){if(W.attributes[Y]===Z){aa.push(W)}}}return aa},onFeatureInsert:function(V){},preFeatureInsert:function(V){},getDataExtent:function(){var W=null;var Y=this.features;if(Y&&(Y.length>0)){var Z=null;for(var X=0,V=Y.length;X<V;X++){Z=Y[X].geometry;if(Z){if(W===null){W=new B.Bounds()}W.extend(Z.getBounds())}}}return W},CLASS_NAME:"OpenLayers.Layer.Vector"});B.bases.LayerVector=B.Layer.Vector;B.Layer.Vector=B.Class(B.Layer.Vector,{initialize:function(W,V){B.bases.LayerVector.prototype.initialize.apply(this,arguments);D.events.register("startRotation",this,this.onStartRotateMap);D.events.register("rotation",this,this.onRotateMap);D.events.register("endRotation",this,this.onEndRotateMap);this.featuresType=null},onStartRotateMap:function(V){if(this.renderer){this.renderer.eraseAllTexts(this.features)}},onRotateMap:function(V){if(this.renderer){this.renderer.cancelMapRotationForSymbol(V.angle)}},onEndRotateMap:function(W){if(this.renderer){for(var V in this.features){this.drawFeature(this.features[V])}if(this.renderer.cancelRotationForLabel){this.renderer.cancelRotationForLabel(W.angle)}}},addFeatures:function(X,V){this.renderer.angle=M.rotate();if(this.CUB.layerType!=M.Layer.Dynamic.layerType.WFS&&!this.projection.equals(this.map.projection)){for(W in X){X[W].geometry.transform(this.projection,this.map.projection)}}for(var W in X){if(!this.featuresType){this.featuresType=X[W].geometryType}else{if(this.featuresType!=X[W].geometryType){this.featuresType=M.Entity.geomType.MIXED;break}}}X.style="";if(typeof id3!="undefined"){M.chrono.pause(id3)}B.bases.LayerVector.prototype.addFeatures.apply(this,arguments);if(typeof id3!="undefined"){M.chrono.start(id3)}},moveTo:function(V,W,af){B.Layer.prototype.moveTo.apply(this,arguments);var X=true;if(!af){this.renderer.root.style.visibility="hidden";var ae=this.map.getSize(),ac=ae.w,aa=ae.h,Z=(ac/2*this.ratio)-ac/2,Y=(aa/2*this.ratio)-aa/2;Z+=parseInt(this.map.layerContainerDiv.style.left,10);Z=-Math.round(Z);Y+=parseInt(this.map.layerContainerDiv.style.top,10);Y=-Math.round(Y);this.div.style.left=Z+"px";this.div.style.top=Y+"px";var ag=this.map.getExtent().scale(this.ratio);X=this.renderer.setExtent(ag,W);this.renderer.root.style.visibility="visible";if(B.IS_GECKO===true){this.div.scrollLeft=this.div.scrollLeft}if(!W&&X){for(var ab in this.unrenderedFeatures){var ah=this.unrenderedFeatures[ab];this.drawFeature(ah)}}}if(!this.drawn||W||!X){this.drawn=true;var ah;if(this.renderer){this.renderer.textGrid=null}for(var ab=0,ad=this.features.length;ab<ad;ab++){this.renderer.locked=(ab!==(ad-1));ah=this.features[ab];this.drawFeature(ah)}}},drawFeature:function(W,V){if(!V){var X=W.renderIntent;style=W.style||this.style;if(!style){style=this.styleMap.createSymbolizer(W,X)}}else{style=this.styleMap.createSymbolizer(W,V)}var Y={feature:W,style:style,style_type:V};this.events.triggerEvent("beforefeaturerender",Y);if(W.CUB.visible===false){Y.style.display="none"}B.bases.LayerVector.prototype.drawFeature.apply(this,[W,Y.style])}});B.Layer.PointGrid=B.Class(B.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(V){V=V||{};B.Layer.Vector.prototype.initialize.apply(this,[V.name,V])},setMap:function(V){B.Layer.Vector.prototype.setMap.apply(this,arguments);V.events.register("moveend",this,this.onMoveEnd)},removeMap:function(V){V.events.unregister("moveend",this,this.onMoveEnd);B.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(V){this.ratio=V;this.updateGrid(true)},setMaxFeatures:function(V){this.maxFeatures=V;this.updateGrid(true)},setSpacing:function(W,V){this.dx=W;this.dy=V||W;this.updateGrid(true)},setOrigin:function(V){this.origin=V;this.updateGrid(true)},getOrigin:function(){if(!this.origin){this.origin=this.map.getExtent().getCenterLonLat()}return this.origin},setRotation:function(V){this.rotation=V;this.updateGrid(true)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var Y=this.map.getExtent();if(this.rotation){var V=this.getOrigin();var W=new B.Geometry.Point(V.lon,V.lat);var X=Y.toGeometry();X.rotate(-this.rotation,W);Y=X.getBounds()}return Y},updateGrid:function(X){if(X||this.invalidBounds()){var ab=this.getViewBounds();var aq=this.getOrigin();var ak=new B.Geometry.Point(aq.lon,aq.lat);var Y=ab.getWidth();var aj=ab.getHeight();var V=Y/aj;var ah=Math.sqrt(this.dx*this.dy*this.maxFeatures/V);var an=ah*V;var ao=Math.min(Y*this.ratio,an);var ag=Math.min(aj*this.ratio,ah);var ap=ab.getCenterLonLat();this.gridBounds=new B.Bounds(ap.lon-(ao/2),ap.lat-(ag/2),ap.lon+(ao/2),ap.lat+(ag/2));var ae=Math.floor(ag/this.dy);var af=Math.floor(ao/this.dx);var W=aq.lon+(this.dx*Math.ceil((this.gridBounds.left-aq.lon)/this.dx));var Z=aq.lat+(this.dy*Math.ceil((this.gridBounds.bottom-aq.lat)/this.dy));var aa=new Array(ae*af);var ad,ac,ai;for(var am=0;am<af;++am){ad=W+(am*this.dx);for(var al=0;al<ae;++al){ac=Z+(al*this.dy);ai=new B.Geometry.Point(ad,ac);if(this.rotation){ai.rotate(this.rotation,ak)}aa[(am*ae)+al]=new B.Feature.Vector(ai)}}this.destroyFeatures(this.features,{silent:true});this.addFeatures(aa,{silent:true})}},invalidBounds:function(){return !this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"});B.Layer.Vector.RootContainer=B.Class(B.Layer.Vector,{displayInLayerSwitcher:false,layers:null,display:function(){},getFeatureFromEvent:function(V){var Y=this.layers;var X;for(var W=0;W<Y.length;W++){X=Y[W].getFeatureFromEvent(V);if(X){return X}}},setMap:function(V){B.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();V.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(V){V.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();B.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var W;for(var V=0;V<this.map.layers.length;++V){W=this.map.layers[V];if(B.Util.indexOf(this.layers,W)!=-1){W.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var W;for(var V=0;V<this.layers.length;++V){W=this.layers[V];if(this.renderer&&W.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(W.renderer)}}},handleChangeLayer:function(V){var W=V.layer;if(V.property=="order"&&B.Util.indexOf(this.layers,W)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});B.Strategy=B.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(V){B.Util.extend(this,V);this.options=V;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(V){this.layer=V},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});B.Strategy.Filter=B.Class(B.Strategy,{filter:null,cache:null,caching:false,activate:function(){var V=B.Strategy.prototype.activate.apply(this,arguments);if(V){this.cache=[];this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return V},deactivate:function(){this.cache=null;if(this.layer&&this.layer.events){this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return B.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(Z){if(!this.caching&&this.filter){var Y=Z.features;Z.features=[];var W;for(var V=0,X=Y.length;V<X;++V){W=Y[V];if(this.filter.evaluate(W)){Z.features.push(W)}else{this.cache.push(W)}}}},handleRemove:function(V){if(!this.caching){this.cache=[]}},setFilter:function(V){this.filter=V;var X=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});if(this.cache.length>0){this.caching=true;this.layer.removeFeatures(this.cache.slice());this.caching=false}if(X.length>0){var W={features:X};this.handleAdd(W);if(W.features.length>0){this.caching=true;this.layer.addFeatures(W.features);this.caching=false}}},CLASS_NAME:"OpenLayers.Strategy.Filter"});B.Strategy.Fixed=B.Class(B.Strategy,{preload:false,activate:function(){if(B.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return true}return false},deactivate:function(){var V=B.Strategy.prototype.deactivate.call(this);if(V){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})}return V},load:function(V){var W=this.layer;W.events.triggerEvent("loadstart");W.protocol.read(B.Util.applyDefaults({callback:B.Function.bind(this.merge,this,W.map.getProjectionObject()),filter:W.filter},V));W.events.un({visibilitychanged:this.load,scope:this})},merge:function(aa,ab){var Y=this.layer;Y.destroyFeatures();var Z=ab.features;if(Z&&Z.length>0){if(!aa.equals(Y.projection)){var X;for(var W=0,V=Z.length;W<V;++W){X=Z[W].geometry;if(X){X.transform(Y.projection,aa)}}}Y.addFeatures(Z)}Y.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});B.bases.StrategyFixed=B.Strategy.Fixed;B.Strategy.Fixed=B.Class(B.Strategy.Fixed,{merge:function(aa,ab){var Y=this.layer;Y.destroyFeatures();if(ab.code==B.Protocol.Response.FAILURE){Y.events.triggerEvent("loaderror",ab)}else{var Z=ab.features;if(Z&&Z.length>0){if(!aa.equals(Y.projection)){var X;for(var W=0,V=Z.length;W<V;++W){X=Z[W].geometry;if(X){X.transform(Y.projection,aa)}}}Y.addFeatures(Z)}Y.events.triggerEvent("loadend")}}});B.Strategy.BBOX=B.Class(B.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var V=B.Strategy.prototype.activate.call(this);if(V){this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});this.update()}return V},deactivate:function(){var V=B.Strategy.prototype.deactivate.call(this);if(V){this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this})}return V},update:function(W){var V=this.getMapBounds();if(V!==null&&((W&&W.force)||(this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(V)))){this.calculateBounds(V);this.resolution=this.layer.map.getResolution();this.triggerRead(W)}},getMapBounds:function(){if(this.layer.map===null){return null}var V=this.layer.map.getExtent();if(V&&!this.layer.projection.equals(this.layer.map.getProjectionObject())){V=V.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)}return V},invalidBounds:function(V){if(!V){V=this.getMapBounds()}var X=!this.bounds||!this.bounds.containsBounds(V);if(!X&&this.resFactor){var W=this.resolution/this.layer.map.getResolution();X=(W>=this.resFactor||W<=(1/this.resFactor))}return X},calculateBounds:function(W){if(!W){W=this.getMapBounds()}var V=W.getCenterLonLat();var Y=W.getWidth()*this.ratio;var X=W.getHeight()*this.ratio;this.bounds=new B.Bounds(V.lon-(Y/2),V.lat-(X/2),V.lon+(Y/2),V.lat+(X/2))},triggerRead:function(V){if(this.response&&!(V&&V.noAbort===true)){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadend")}this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read(B.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},V))},createFilter:function(){var V=new B.Filter.Spatial({type:B.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){V=new B.Filter.Logical({type:B.Filter.Logical.AND,filters:[this.layer.filter,V]})}return V},merge:function(ab){this.layer.destroyFeatures();var Z=ab.features;if(Z&&Z.length>0){var aa=this.layer.projection;var Y=this.layer.map.getProjectionObject();if(!Y.equals(aa)){var X;for(var W=0,V=Z.length;W<V;++W){X=Z[W].geometry;if(X){X.transform(aa,Y)}}}this.layer.addFeatures(Z)}this.response=null;this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"});B.bases.StrategyBBOX=B.Strategy.BBOX;B.Strategy.BBOX=B.Class(B.Strategy.BBOX,{merge:function(ab){this.layer.destroyFeatures();this.response=null;if(ab.code==B.Protocol.Response.FAILURE){this.layer.events.triggerEvent("loaderror",ab)}else{var Z=ab.features;if(Z&&Z.length>0){var aa=this.layer.projection;var Y=this.layer.map.getProjectionObject();if(!Y.equals(aa)){var X;for(var W=0,V=Z.length;W<V;++W){X=Z[W].geometry;if(X){X.transform(aa,Y)}}}this.layer.addFeatures(Z)}this.layer.events.triggerEvent("loadend")}}});B.Strategy.Refresh=B.Class(B.Strategy,{force:false,interval:0,timer:null,activate:function(){var V=B.Strategy.prototype.activate.call(this);if(V){if(this.layer.visibility===true){this.start()}this.layer.events.on({visibilitychanged:this.reset,scope:this})}return V},deactivate:function(){var V=B.Strategy.prototype.deactivate.call(this);if(V){this.stop()}return V},reset:function(){if(this.layer.visibility===true){this.start()}else{this.stop()}},start:function(){if(this.interval&&typeof this.interval==="number"&&this.interval>0){this.timer=window.setInterval(B.Function.bind(this.refresh,this),this.interval)}},refresh:function(){if(this.layer&&this.layer.refresh&&typeof this.layer.refresh=="function"){this.layer.refresh({force:this.force})}},stop:function(){if(this.timer!==null){window.clearInterval(this.timer);this.timer=null}},CLASS_NAME:"OpenLayers.Strategy.Refresh"});B.Filter=B.Class({initialize:function(V){B.Util.extend(this,V)},destroy:function(){},evaluate:function(V){return true},clone:function(){return null},toString:function(){var V;if(B.Format&&B.Format.CQL){V=B.Format.CQL.prototype.write(this)}else{V=Object.prototype.toString.call(this)}return V},CLASS_NAME:"OpenLayers.Filter"});B.bases.Filter=B.Filter;B.Filter=B.Class(B.Filter,{toKVP:function(){return""}});B.Filter.Logical=B.Class(B.Filter,{filters:null,type:null,initialize:function(V){this.filters=[];B.Filter.prototype.initialize.apply(this,[V])},destroy:function(){this.filters=null;B.Filter.prototype.destroy.apply(this)},evaluate:function(X){var W,V;switch(this.type){case B.Filter.Logical.AND:for(W=0,V=this.filters.length;W<V;W++){if(this.filters[W].evaluate(X)==false){return false}}return true;case B.Filter.Logical.OR:for(W=0,V=this.filters.length;W<V;W++){if(this.filters[W].evaluate(X)==true){return true}}return false;case B.Filter.Logical.NOT:return(!this.filters[0].evaluate(X))}return undefined},clone:function(){var X=[];for(var W=0,V=this.filters.length;W<V;++W){X.push(this.filters[W].clone())}return new B.Filter.Logical({type:this.type,filters:X})},CLASS_NAME:"OpenLayers.Filter.Logical"});B.Filter.Logical.AND="&&";B.Filter.Logical.OR="||";B.Filter.Logical.NOT="!";B.bases.FilterLogical=B.Filter.Logical;B.Filter.Logical=B.Class(B.Filter.Logical,{toKVP:function(){filters=[];for(var V in this.filters){filters.push(this.filters[V].toKVP())}var W;switch(this.type){case B.Filter.Logical.AND:W="AND";break;case B.Filter.Logical.OR:W="OR";break;case B.Filter.Logical.NOT:W="NOT";break}return"<"+W+">"+filters.join("")+"</"+W+">"}});p.inheritsStatic(B.bases.FilterLogical,B.Filter.Logical);B.Filter.Comparison=B.Class(B.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(V){B.Filter.prototype.initialize.apply(this,[V]);if(this.type===B.Filter.Comparison.LIKE&&V.matchCase===undefined){this.matchCase=null}},evaluate:function(X){if(X instanceof B.Feature.Vector){X=X.attributes}var V=false;var W=X[this.property];var Z;switch(this.type){case B.Filter.Comparison.EQUAL_TO:Z=this.value;if(!this.matchCase&&typeof W=="string"&&typeof Z=="string"){V=(W.toUpperCase()==Z.toUpperCase())}else{V=(W==Z)}break;case B.Filter.Comparison.NOT_EQUAL_TO:Z=this.value;if(!this.matchCase&&typeof W=="string"&&typeof Z=="string"){V=(W.toUpperCase()!=Z.toUpperCase())}else{V=(W!=Z)}break;case B.Filter.Comparison.LESS_THAN:V=W<this.value;break;case B.Filter.Comparison.GREATER_THAN:V=W>this.value;break;case B.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:V=W<=this.value;break;case B.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:V=W>=this.value;break;case B.Filter.Comparison.BETWEEN:V=(W>=this.lowerBoundary)&&(W<=this.upperBoundary);break;case B.Filter.Comparison.LIKE:var Y=new RegExp(this.value,"gi");V=Y.test(W);break}return V},value2regex:function(X,W,V){if(X=="."){throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison")}X=X?X:"*";W=W?W:".";V=V?V:"!";this.value=this.value.replace(new RegExp("\\"+V+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+W,"g"),".");this.value=this.value.replace(new RegExp("\\"+X,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+X);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+W);return this.value},regex2value:function(){var V=this.value;V=V.replace(/!/g,"!!");V=V.replace(/(\\)?\\\./g,function(X,W){return W?X:"!."});V=V.replace(/(\\)?\\\*/g,function(X,W){return W?X:"!*"});V=V.replace(/\\\\/g,"\\");V=V.replace(/\.\*/g,"*");return V},clone:function(){return B.Util.extend(new B.Filter.Comparison(),this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});B.Filter.Comparison.EQUAL_TO="==";B.Filter.Comparison.NOT_EQUAL_TO="!=";B.Filter.Comparison.LESS_THAN="<";B.Filter.Comparison.GREATER_THAN=">";B.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";B.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";B.Filter.Comparison.BETWEEN="..";B.Filter.Comparison.LIKE="~";B.Filter.Spatial=B.Class(B.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(X){var V=false;switch(this.type){case B.Filter.Spatial.BBOX:case B.Filter.Spatial.INTERSECTS:if(X.geometry){var W=this.value;if(this.value.CLASS_NAME=="OpenLayers.Bounds"){W=this.value.toGeometry()}if(X.geometry.intersects(W)){V=true}}break;default:throw new Error("evaluate is not implemented for this filter type.")}return V},clone:function(){var V=B.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new B.Filter.Spatial(V)},CLASS_NAME:"OpenLayers.Filter.Spatial"});B.Filter.Spatial.BBOX="BBOX";B.Filter.Spatial.INTERSECTS="INTERSECTS";B.Filter.Spatial.DWITHIN="DWITHIN";B.Filter.Spatial.WITHIN="WITHIN";B.Filter.Spatial.CONTAINS="CONTAINS";B.bases.FilterSpatial=B.Filter.Spatial;B.Filter.Spatial=B.Class(B.Filter.Spatial,{toKVP:function(){switch(this.type){case B.Filter.Spatial.BBOX:return"<BBOX><PropertyName>NAME</PropertyName><Box srsName='"+this.projection.projCode+"'><coordinates>"+this.value.left+","+this.value.bottom+" "+this.value.right+","+this.value.top+"</coordinates></Box></BBOX>";break}return""}});p.inheritsStatic(B.bases.FilterSpatial,B.Filter.Spatial);B.Filter.WKT=B.Class(B.Filter,{value:"",toKVP:function(){return this.value}});B.Protocol=B.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(V){V=V||{};B.Util.extend(this,V);this.options=V},mergeWithDefaultFilter:function(W){var V;if(W&&this.defaultFilter){V=new B.Filter.Logical({type:B.Filter.Logical.AND,filters:[this.defaultFilter,W]})}else{V=W||this.defaultFilter||undefined}return V},destroy:function(){this.options=null;this.format=null},read:function(V){V=V||{};V.filter=this.mergeWithDefaultFilter(V.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(V){},createCallback:function(X,V,W){return B.Function.bind(function(){X.apply(this,[V,W])},this)},CLASS_NAME:"OpenLayers.Protocol"});B.Protocol.Response=B.Class({code:null,requestType:null,last:true,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(V){B.Util.extend(this,V)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});B.Protocol.Response.SUCCESS=1;B.Protocol.Response.FAILURE=0;B.Protocol.HTTP=B.Class(B.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,updateWithPOST:false,deleteWithPOST:false,wildcarded:false,srsInBBOX:false,initialize:function(V){V=V||{};this.params={};this.headers={};B.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&B.Format.QueryStringFilter){var W=new B.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(X,Y){return W.write(X,Y)}}},destroy:function(){this.params=null;this.headers=null;B.Protocol.prototype.destroy.apply(this)},read:function(V){B.Protocol.prototype.read.apply(this,arguments);V=V||{};V.params=B.Util.applyDefaults(V.params,this.options.params);V=B.Util.applyDefaults(V,this.options);if(V.filter&&this.filterToParams){V.params=this.filterToParams(V.filter,V.params)}var W=(V.readWithPOST!==undefined)?V.readWithPOST:this.readWithPOST;var Y=new B.Protocol.Response({requestType:"read"});if(W){var X=V.headers||{};X["Content-Type"]="application/x-www-form-urlencoded";Y.priv=B.Request.POST({url:V.url,callback:this.createCallback(this.handleRead,Y,V),data:B.Util.getParameterString(V.params),headers:X})}else{Y.priv=B.Request.GET({url:V.url,callback:this.createCallback(this.handleRead,Y,V),params:V.params,headers:V.headers})}return Y},handleRead:function(W,V){this.handleResponse(W,V)},create:function(W,V){V=B.Util.applyDefaults(V,this.options);var X=new B.Protocol.Response({reqFeatures:W,requestType:"create"});X.priv=B.Request.POST({url:V.url,callback:this.createCallback(this.handleCreate,X,V),headers:V.headers,data:this.format.write(W)});return X},handleCreate:function(W,V){this.handleResponse(W,V)},update:function(X,W){W=W||{};var V=W.url||X.url||this.options.url+"/"+X.fid;W=B.Util.applyDefaults(W,this.options);var Y=new B.Protocol.Response({reqFeatures:X,requestType:"update"});var Z=this.updateWithPOST?"POST":"PUT";Y.priv=B.Request[Z]({url:V,callback:this.createCallback(this.handleUpdate,Y,W),headers:W.headers,data:this.format.write(X)});return Y},handleUpdate:function(W,V){this.handleResponse(W,V)},"delete":function(Y,X){X=X||{};var W=X.url||Y.url||this.options.url+"/"+Y.fid;X=B.Util.applyDefaults(X,this.options);var Z=new B.Protocol.Response({reqFeatures:Y,requestType:"delete"});var aa=this.deleteWithPOST?"POST":"DELETE";var V={url:W,callback:this.createCallback(this.handleDelete,Z,X),headers:X.headers};if(this.deleteWithPOST){V.data=this.format.write(Y)}Z.priv=B.Request[aa](V);return Z},handleDelete:function(W,V){this.handleResponse(W,V)},handleResponse:function(X,V){var W=X.priv;if(V.callback){if(W.status>=200&&W.status<300){if(X.requestType!="delete"){X.features=this.parseFeatures(W)}X.code=B.Protocol.Response.SUCCESS}else{X.code=B.Protocol.Response.FAILURE}V.callback.call(V.scope,X)}},parseFeatures:function(V){var W=V.responseXML;if(!W||!W.documentElement){W=V.responseText}if(!W||W.length<=0){return null}return this.format.read(W)},commit:function(W,ak){ak=B.Util.applyDefaults(ak,this.options);var Y=[],ag=0;var ae={};ae[B.State.INSERT]=[];ae[B.State.UPDATE]=[];ae[B.State.DELETE]=[];var aj,af,X=[];for(var Z=0,ad=W.length;Z<ad;++Z){aj=W[Z];af=ae[aj.state];if(af){af.push(aj);X.push(aj)}}var ab=(ae[B.State.INSERT].length>0?1:0)+ae[B.State.UPDATE].length+ae[B.State.DELETE].length;var ai=true;var V=new B.Protocol.Response({reqFeatures:X});function ac(am){var al=am.features?am.features.length:0;var ao=new Array(al);for(var an=0;an<al;++an){ao[an]=am.features[an].fid}V.insertIds=ao;ah.apply(this,[am])}function ah(al){this.callUserCallback(al,ak);ai=ai&&al.success();ag++;if(ag>=ab){if(ak.callback){V.code=ai?B.Protocol.Response.SUCCESS:B.Protocol.Response.FAILURE;ak.callback.apply(ak.scope,[V])}}}var aa=ae[B.State.INSERT];if(aa.length>0){Y.push(this.create(aa,B.Util.applyDefaults({callback:ac,scope:this},ak.create)))}aa=ae[B.State.UPDATE];for(var Z=aa.length-1;Z>=0;--Z){Y.push(this.update(aa[Z],B.Util.applyDefaults({callback:ah,scope:this},ak.update)))}aa=ae[B.State.DELETE];for(var Z=aa.length-1;Z>=0;--Z){Y.push(this["delete"](aa[Z],B.Util.applyDefaults({callback:ah,scope:this},ak["delete"])))}return Y},abort:function(V){if(V){V.priv.abort()}},callUserCallback:function(X,V){var W=V[X.requestType];if(W&&W.callback){W.callback.call(W.scope,X)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});B.bases.ProtocolHTTP=B.Protocol.HTTP;B.Protocol.HTTP=B.Class(B.Protocol.HTTP,{handleResponse:function(X,V){var W=X.priv;if(V.callback){if(W.status>=200&&W.status<300){if(X.requestType!="delete"){X.features=this.parseFeatures(W)}X.code=B.Protocol.Response.SUCCESS}else{X.code=B.Protocol.Response.FAILURE;if(W.status==404){X.error={error:"INVALIDURL",errorText:W.statusText}}}V.callback.call(V.scope,X)}}});B.Protocol.BinaryHTTP=B.Class(B.Protocol.HTTP,{responses:[],read:function(V){B.Protocol.prototype.read.apply(this,arguments);V=V||{};V.params=B.Util.applyDefaults(V.params,this.options.params);V=B.Util.applyDefaults(V,this.options);if(V.filter&&this.filterToParams){V.params=this.filterToParams(V.filter,V.params)}var X=new B.Protocol.Response({requestType:"read"});if(!M.jQuery.isArray(V.url)){V.url=[V.url]}this.responses=[];this.url=V.url;this.options=V;for(var W in V.url){T.loadBinary(V.url[W],p.createDelegate(this.responsesManager,this))}},responsesManager:function(V){for(var W in this.url){if(this.url[W]==V.url){this.responses.push(V);break}}if(this.responses.length<this.url.length){return}if(this.options.callback){var X={features:this.parseFeatures({responseText:this.responses})};this.options.callback.call(this.options.scope,X)}},CLASS_NAME:"OpenLayers.Protocol.BinaryHTTP"});B.Protocol.WFS=function(W){W=B.Util.applyDefaults(W,B.Protocol.WFS.DEFAULTS);var V=B.Protocol.WFS["v"+W.version.replace(/\./g,"_")];if(!V){throw"Unsupported WFS version: "+W.version}return new V(W)};B.Protocol.WFS.fromWMSLayer=function(Y,X){var V,Z;var ab=Y.params.LAYERS;var aa=(B.Util.isArray(ab)?ab[0]:ab).split(":");if(aa.length>1){Z=aa[0]}V=aa.pop();var W={url:Y.url,featureType:V,featurePrefix:Z,srsName:Y.projection&&Y.projection.getCode()||Y.map&&Y.map.getProjectionObject().getCode(),version:"1.1.0"};return new B.Protocol.WFS(B.Util.applyDefaults(X,W))};B.Protocol.WFS.DEFAULTS={version:"1.0.0"};B.Protocol.WFS.v1=B.Class(B.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(V){B.Protocol.prototype.initialize.apply(this,[V]);if(!V.format){this.format=B.Format.WFST(B.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))}if(!V.geometryName&&parseFloat(this.format.version)>1){this.setGeometryName(null)}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;B.Protocol.prototype.destroy.apply(this)},read:function(W){B.Protocol.prototype.read.apply(this,arguments);W=B.Util.extend({},W);B.Util.applyDefaults(W,this.options||{});var V=new B.Protocol.Response({requestType:"read"});var X=B.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",W)]);V.priv=B.Request.POST({url:W.url,callback:this.createCallback(this.handleRead,V,W),params:W.params,headers:W.headers,data:X});return V},setFeatureType:function(V){this.featureType=V;this.format.featureType=V},setGeometryName:function(V){this.geometryName=V;this.format.geometryName=V},handleRead:function(W,X){X=B.Util.extend({},X);B.Util.applyDefaults(X,this.options);if(X.callback){var Y=W.priv;if(Y.status>=200&&Y.status<300){var V=this.parseResponse(Y,X.readOptions);if(V&&V.success!==false){if(X.readOptions&&X.readOptions.output=="object"){B.Util.extend(W,V)}else{W.features=V}W.code=B.Protocol.Response.SUCCESS}else{W.code=B.Protocol.Response.FAILURE;W.error=V}}else{W.code=B.Protocol.Response.FAILURE}X.callback.call(X.scope,W)}},parseResponse:function(X,W){var Z=X.responseXML;if(!Z||!Z.documentElement){Z=X.responseText}if(!Z||Z.length<=0){return null}var V=(this.readFormat!==null)?this.readFormat.read(Z):this.format.read(Z,W);if(!this.featureNS){var Y=this.readFormat||this.format;this.featureNS=Y.featureNS;Y.autoConfig=false;if(!this.geometryName){this.setGeometryName(Y.geometryName)}}return V},commit:function(X,W){W=B.Util.extend({},W);B.Util.applyDefaults(W,this.options);var V=new B.Protocol.Response({requestType:"commit",reqFeatures:X});V.priv=B.Request.POST({url:W.url,headers:W.headers,data:this.format.write(X,W),callback:this.createCallback(this.handleCommit,V,W)});return V},handleCommit:function(V,W){if(W.callback){var X=V.priv;var Y=X.responseXML;if(!Y||!Y.documentElement){Y=X.responseText}var Z=this.format.read(Y)||{};V.insertIds=Z.insertIds||[];if(Z.success){V.code=B.Protocol.Response.SUCCESS}else{V.code=B.Protocol.Response.FAILURE;V.error=Z}W.callback.call(W.scope,V)}},filterDelete:function(Z,X){X=B.Util.extend({},X);B.Util.applyDefaults(X,this.options);var W=new B.Protocol.Response({requestType:"commit"});var V=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});var Y=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(X.featureNS?this.featurePrefix+":":"")+X.featureType}});if(X.featureNS){Y.setAttribute("xmlns:"+this.featurePrefix,X.featureNS)}var ab=this.format.writeNode("ogc:Filter",Z);Y.appendChild(ab);V.appendChild(Y);var aa=B.Format.XML.prototype.write.apply(this.format,[V]);return B.Request.POST({url:this.url,callback:X.callback||function(){},data:aa})},abort:function(V){if(V){V.priv.abort()}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});B.bases.ProtocolWFSv1=B.Protocol.WFS.v1;B.Protocol.WFS.v1=B.Class(B.Protocol.WFS.v1,{read:function(W){B.Protocol.prototype.read.apply(this,arguments);W=B.Util.extend({},W);B.Util.applyDefaults(W,this.options||{});var V=new B.Protocol.Response({requestType:"read"});W.params=B.Util.extend(W.params,{REQUEST:"GetFeature",SERVICE:"WFS",SRSNAME:W.srsName.projCode,TYPENAME:this.featureType,VERSION:this.version});if(W.filter){W.params=B.Util.extend(W.params,{Filter:"<Filter>"+W.filter.toKVP()+"</Filter>"})}V.priv=B.Request.GET({url:W.url,callback:this.createCallback(this.handleRead,V,W),params:W.params,headers:W.headers});return V},handleRead:function(W,X){X=B.Util.extend({},X);B.Util.applyDefaults(X,this.options);if(X.callback){var Y=W.priv;if(Y.status>=200&&Y.status<300){var V=this.parseResponse(Y,X.readOptions);if(V&&V.success!==false){if(X.readOptions&&X.readOptions.output=="object"){B.Util.extend(W,V)}else{W.features=V}W.code=B.Protocol.Response.SUCCESS}else{W.code=B.Protocol.Response.FAILURE;W.error=V}}else{W.code=B.Protocol.Response.FAILURE;W.error=Y.error;if(Y.status==404){W.error={error:"INVALIDURL",errorText:Y.statusText}}}X.callback.call(X.scope,W)}}});B.Protocol.WFS.v1_0_0=B.Class(B.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});B.Protocol.WFS.v1_1_0=B.Class(B.Protocol.WFS.v1,{version:"1.1.0",initialize:function(V){B.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);if(this.outputFormat&&!this.readFormat){if(this.outputFormat.toLowerCase()=="gml2"){this.readFormat=new B.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName})}else{if(this.outputFormat.toLowerCase()=="json"){this.readFormat=new B.Format.GeoJSON()}}}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});B.Protocol.CSW=function(W){W=B.Util.applyDefaults(W,B.Protocol.CSW.DEFAULTS);var V=B.Protocol.CSW["v"+W.version.replace(/\./g,"_")];if(!V){throw"Unsupported CSW version: "+W.version}return new V(W)};B.Protocol.CSW.DEFAULTS={version:"2.0.2"};B.Protocol.CSW.v2_0_2=B.Class(B.Protocol,{formatOptions:null,initialize:function(V){B.Protocol.prototype.initialize.apply(this,[V]);if(!V.format){this.format=new B.Format.CSWGetRecords.v2_0_2(B.Util.extend({},this.formatOptions))}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;B.Protocol.prototype.destroy.apply(this)},read:function(W){W=B.Util.extend({},W);B.Util.applyDefaults(W,this.options||{});var V=new B.Protocol.Response({requestType:"read"});var X=this.format.write(W.params);V.priv=B.Request.POST({url:W.url,callback:this.createCallback(this.handleRead,V,W),params:W.params,headers:W.headers,data:X});return V},handleRead:function(V,W){if(W.callback){var X=V.priv;if(X.status>=200&&X.status<300){V.data=this.parseData(X);V.code=B.Protocol.Response.SUCCESS}else{V.code=B.Protocol.Response.FAILURE}W.callback.call(W.scope,V)}},parseData:function(V){var W=V.responseXML;if(!W||!W.documentElement){W=V.responseText}if(!W||W.length<=0){return null}return this.format.read(W)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});B.Style=B.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(W,V){B.Util.extend(this,V);this.rules=[];if(V&&V.rules){this.addRules(V.rules)}this.setDefaultStyle(W||B.Feature.Vector.style["default"]);this.id=B.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var W=0,V=this.rules.length;W<V;W++){this.rules[W].destroy();this.rules[W]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(ae){var V=this.defaultsPerSymbolizer?{}:this.createLiterals(B.Util.extend({},this.defaultStyle),ae);var ad=this.rules;var ac,W;var X=[];var aa=false;for(var Y=0,Z=ad.length;Y<Z;Y++){ac=ad[Y];var ab=ac.evaluate(ae);if(ab){if(ac instanceof B.Rule&&ac.elseFilter){X.push(ac)}else{aa=true;this.applySymbolizer(ac,V,ae)}}}if(aa==false&&X.length>0){aa=true;for(var Y=0,Z=X.length;Y<Z;Y++){this.applySymbolizer(X[Y],V,ae)}}if(ad.length>0&&aa==false){V.display="none"}if(V.label!=null&&typeof V.label!=="string"){V.label=String(V.label)}return V},applySymbolizer:function(aa,Y,W){var V=W.geometry?this.getSymbolizerPrefix(W.geometry):B.Style.SYMBOLIZER_PREFIXES[0];var X=aa.symbolizer[V]||aa.symbolizer;if(this.defaultsPerSymbolizer===true){var Z=this.defaultStyle;B.Util.applyDefaults(X,{pointRadius:Z.pointRadius});if(X.stroke===true||X.graphic===true){B.Util.applyDefaults(X,{strokeWidth:Z.strokeWidth,strokeColor:Z.strokeColor,strokeOpacity:Z.strokeOpacity,strokeDashstyle:Z.strokeDashstyle,strokeLinecap:Z.strokeLinecap})}if(X.fill===true||X.graphic===true){B.Util.applyDefaults(X,{fillColor:Z.fillColor,fillOpacity:Z.fillOpacity})}if(X.graphic===true){B.Util.applyDefaults(X,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(B.Util.extend(Y,X),W)},createLiterals:function(Y,X){var W=B.Util.extend({},X.attributes||X.data);B.Util.extend(W,this.context);for(var V in this.propertyStyles){Y[V]=B.Style.createLiteral(Y[V],W,X,V)}return Y},findPropertyStyles:function(){var Y={};var aa=this.defaultStyle;this.addPropertyStyles(Y,aa);var ac=this.rules;var Z,ab;for(var X=0,V=ac.length;X<V;X++){Z=ac[X].symbolizer;for(var W in Z){ab=Z[W];if(typeof ab=="object"){this.addPropertyStyles(Y,ab)}else{this.addPropertyStyles(Y,Z);break}}}return Y},addPropertyStyles:function(W,X){var Y;for(var V in X){Y=X[V];if(typeof Y=="string"&&Y.match(/\$\{\w+\}/)){W[V]=true}}return W},addRules:function(V){Array.prototype.push.apply(this.rules,V);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(V){this.defaultStyle=V;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(Y){var X=B.Style.SYMBOLIZER_PREFIXES;for(var W=0,V=X.length;W<V;W++){if(Y.CLASS_NAME.indexOf(X[W])!=-1){return X[W]}}},clone:function(){var W=B.Util.extend({},this);if(this.rules){W.rules=[];for(var X=0,V=this.rules.length;X<V;++X){W.rules.push(this.rules[X].clone())}}W.context=this.context&&B.Util.extend({},this.context);var Y=B.Util.extend({},this.defaultStyle);return new B.Style(Y,W)},CLASS_NAME:"OpenLayers.Style"});B.Style.createLiteral=function(Y,W,V,X){if(typeof Y=="string"&&Y.indexOf("${")!=-1){Y=B.String.format(Y,W,[V,X]);Y=(isNaN(Y)||!Y)?Y:parseFloat(Y)}return Y};B.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];B.Style2=B.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,initialize:function(V){B.Util.extend(this,V);this.id=B.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var W=0,V=this.rules.length;W<V;W++){this.rules[W].destroy()}delete this.rules},clone:function(){var W=B.Util.extend({},this);if(this.rules){W.rules=[];for(var X=0,V=this.rules.length;X<V;++X){W.rules.push(this.rules[X].clone())}}return new B.Style2(W)},CLASS_NAME:"OpenLayers.Style2"});B.StyleMap=B.Class({styles:null,extendDefault:true,initialize:function(X,V){this.styles={"default":new B.Style(B.Feature.Vector.style["default"]),select:new B.Style(B.Feature.Vector.style.select),temporary:new B.Style(B.Feature.Vector.style.temporary),"delete":new B.Style(B.Feature.Vector.style["delete"])};if(X instanceof B.Style){this.styles["default"]=X;this.styles.select=X;this.styles.temporary=X;this.styles["delete"]=X}else{if(typeof X=="object"){for(var W in X){if(X[W] instanceof B.Style){this.styles[W]=X[W]}else{if(typeof X[W]=="object"){this.styles[W]=new B.Style(X[W])}else{this.styles["default"]=new B.Style(X);this.styles.select=new B.Style(X);this.styles.temporary=new B.Style(X);this.styles["delete"]=new B.Style(X);break}}}}}B.Util.extend(this,V)},destroy:function(){for(var V in this.styles){this.styles[V].destroy()}this.styles=null},createSymbolizer:function(W,X){if(!W){W=new B.Feature.Vector()}if(!this.styles[X]){X="default"}W.renderIntent=X;var V={};if(this.extendDefault&&X!="default"){V=this.styles["default"].createSymbolizer(W)}return B.Util.extend(V,this.styles[X].createSymbolizer(W))},addUniqueValueRules:function(W,Y,aa,V){var Z=[];for(var X in aa){Z.push(new B.Rule({symbolizer:aa[X],context:V,filter:new B.Filter.Comparison({type:B.Filter.Comparison.EQUAL_TO,property:Y,value:X})}))}this.styles[W].addRules(Z)},CLASS_NAME:"OpenLayers.StyleMap"});B.Format=B.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(V){B.Util.extend(this,V);this.options=V},destroy:function(){},read:function(V){throw new Error("Read not implemented.")},write:function(V){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});B.Format.QueryStringFilter=(function(){var W={};W[B.Filter.Comparison.EQUAL_TO]="eq";W[B.Filter.Comparison.NOT_EQUAL_TO]="ne";W[B.Filter.Comparison.LESS_THAN]="lt";W[B.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";W[B.Filter.Comparison.GREATER_THAN]="gt";W[B.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";W[B.Filter.Comparison.LIKE]="ilike";function V(X){X=X.replace(/%/g,"\\%");X=X.replace(/\\\\\.(\*)?/g,function(Z,Y){return Y?Z:"\\\\_"});X=X.replace(/\\\\\.\*/g,"\\\\%");X=X.replace(/(\\)?\.(\*)?/g,function(Z,Y,aa){return Y||aa?Z:"_"});X=X.replace(/(\\)?\.\*/g,function(Z,Y){return Y?Z:"%"});X=X.replace(/\\\./g,".");X=X.replace(/(\\)?\\\*/g,function(Z,Y){return Y?Z:"*"});return X}return B.Class(B.Format,{wildcarded:false,srsInBBOX:false,write:function(aa,ad){ad=ad||{};var Z=aa.CLASS_NAME;var ab=Z.substring(Z.lastIndexOf(".")+1);switch(ab){case"Spatial":switch(aa.type){case B.Filter.Spatial.BBOX:ad.bbox=aa.value.toArray();if(this.srsInBBOX&&aa.projection){ad.bbox.push(aa.projection.getCode())}break;case B.Filter.Spatial.DWITHIN:ad.tolerance=aa.distance;case B.Filter.Spatial.WITHIN:ad.lon=aa.value.x;ad.lat=aa.value.y;break;default:B.Console.warn("Unknown spatial filter type "+aa.type)}break;case"Comparison":var ae=W[aa.type];if(ae!==undefined){var ac=aa.value;if(aa.type==B.Filter.Comparison.LIKE){ac=V(ac);if(this.wildcarded){ac="%"+ac+"%"}}ad[aa.property+"__"+ae]=ac;ad.queryable=ad.queryable||[];ad.queryable.push(aa.property)}else{B.Console.warn("Unknown comparison filter type "+aa.type)}break;case"Logical":if(aa.type===B.Filter.Logical.AND){for(var Y=0,X=aa.filters.length;Y<X;Y++){ad=this.write(aa.filters[Y],ad)}}else{B.Console.warn("Unsupported logical filter type "+aa.type)}break;default:B.Console.warn("Unknown filter type "+ab)}return ad},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})})();B.Format.XML=B.Class(B.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(V){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}B.Format.prototype.initialize.apply(this,[V]);this.namespaces=B.Util.extend({},this.namespaces);this.namespaceAlias={};for(var W in this.namespaces){this.namespaceAlias[this.namespaces[W]]=W}},destroy:function(){this.xmldom=null;B.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(V,W){this.namespaces[V]=W;this.namespaceAlias[W]=V},read:function(X){var V=X.indexOf("<");if(V>0){X=X.substring(V)}var W=B.Util.Try(B.Function.bind((function(){var Y;if(window.ActiveXObject&&!this.xmldom){Y=new ActiveXObject("Microsoft.XMLDOM")}else{Y=this.xmldom}Y.loadXML(X);return Y}),this),function(){return new DOMParser().parseFromString(X,"text/xml")},function(){var Y=new XMLHttpRequest();Y.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(X),false);if(Y.overrideMimeType){Y.overrideMimeType("text/xml")}Y.send(null);return Y.responseXML});if(this.keepData){this.data=W}return W},write:function(W){var X;if(this.xmldom){X=W.xml}else{var V=new XMLSerializer();if(W.nodeType==1){var Y=document.implementation.createDocument("","",null);if(Y.importNode){W=Y.importNode(W,true)}Y.appendChild(W);X=V.serializeToString(Y)}else{X=V.serializeToString(W)}}return X},createElementNS:function(X,V){var W;if(this.xmldom){if(typeof X=="string"){W=this.xmldom.createNode(1,V,X)}else{W=this.xmldom.createNode(1,V,"")}}else{W=document.createElementNS(X,V)}return W},createTextNode:function(W){var V;if(typeof W!=="string"){W=String(W)}if(this.xmldom){V=this.xmldom.createTextNode(W)}else{V=document.createTextNode(W)}return V},getElementsByTagNameNS:function(Z,Y,X){var V=[];if(Z.getElementsByTagNameNS){V=Z.getElementsByTagNameNS(Y,X)}else{var W=Z.getElementsByTagName("*");var ad,aa;for(var ab=0,ac=W.length;ab<ac;++ab){ad=W[ab];aa=(ad.prefix)?(ad.prefix+":"+X):X;if((X=="*")||(aa==ad.nodeName)){if((Y=="*")||(Y==ad.namespaceURI)){V.push(ad)}}}}return V},getAttributeNodeNS:function(X,W,V){var ad=null;if(X.getAttributeNodeNS){ad=X.getAttributeNodeNS(W,V)}else{var Z=X.attributes;var ac,Y;for(var aa=0,ab=Z.length;aa<ab;++aa){ac=Z[aa];if(ac.namespaceURI==W){Y=(ac.prefix)?(ac.prefix+":"+V):V;if(Y==ac.nodeName){ad=ac;break}}}}return ad},getAttributeNS:function(Z,Y,V){var W="";if(Z.getAttributeNS){W=Z.getAttributeNS(Y,V)||""}else{var X=this.getAttributeNodeNS(Z,Y,V);if(X){W=X.nodeValue}}return W},getChildValue:function(V,X){var W=X||"";if(V){for(var Y=V.firstChild;Y;Y=Y.nextSibling){switch(Y.nodeType){case 3:case 4:W+=Y.nodeValue}}}return W},isSimpleContent:function(V){var X=true;for(var W=V.firstChild;W;W=W.nextSibling){if(W.nodeType===1){X=false;break}}return X},contentType:function(X){var Z=false,W=false;var V=B.Format.XML.CONTENT_TYPE.EMPTY;for(var Y=X.firstChild;Y;Y=Y.nextSibling){switch(Y.nodeType){case 1:W=true;break;case 8:break;default:Z=true}if(W&&Z){break}}if(W&&Z){V=B.Format.XML.CONTENT_TYPE.MIXED}else{if(W){return B.Format.XML.CONTENT_TYPE.COMPLEX}else{if(Z){return B.Format.XML.CONTENT_TYPE.SIMPLE}}}return V},hasAttributeNS:function(X,W,V){var Y=false;if(X.hasAttributeNS){Y=X.hasAttributeNS(W,V)}else{Y=!!this.getAttributeNodeNS(X,W,V)}return Y},setAttributeNS:function(Y,X,V,Z){if(Y.setAttributeNS){Y.setAttributeNS(X,V,Z)}else{if(this.xmldom){if(X){var W=Y.ownerDocument.createNode(2,V,X);W.nodeValue=Z;Y.setAttributeNode(W)}else{Y.setAttribute(V,Z)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(W,V){V=V||{};var Y=V.uri||this.namespaces[V.prefix];if(!Y){var aa=W.indexOf(":");Y=this.namespaces[W.substring(0,aa)]}if(!Y){Y=this.namespaces[this.defaultPrefix]}var X=this.createElementNS(Y,W);if(V.attributes){this.setAttributes(X,V.attributes)}var Z=V.value;if(Z!=null){X.appendChild(this.createTextNode(Z))}return X},setAttributes:function(X,Z){var Y,W;for(var V in Z){if(Z[V]!=null&&Z[V].toString){Y=Z[V].toString();W=this.namespaces[V.substring(0,V.indexOf(":"))]||null;this.setAttributeNS(X,W,V,Y)}}},readNode:function(X,Z){if(!Z){Z={}}var Y=this.readers[X.namespaceURI?this.namespaceAlias[X.namespaceURI]:this.defaultPrefix];if(Y){var W=X.localName||X.nodeName.split(":").pop();var V=Y[W]||Y["*"];if(V){V.apply(this,[X,Z])}}return Z},readChildNodes:function(Y,Z){if(!Z){Z={}}var X=Y.childNodes;var aa;for(var W=0,V=X.length;W<V;++W){aa=X[W];if(aa.nodeType==1){this.readNode(aa,Z)}}return Z},writeNode:function(V,aa,Y){var Z,X;var W=V.indexOf(":");if(W>0){Z=V.substring(0,W);X=V.substring(W+1)}else{if(Y){Z=this.namespaceAlias[Y.namespaceURI]}else{Z=this.defaultPrefix}X=V}var ab=this.writers[Z][X].apply(this,[aa]);if(Y){Y.appendChild(ab)}return ab},getChildEl:function(X,V,W){return X&&this.getThisOrNextEl(X.firstChild,V,W)},getNextEl:function(X,V,W){return X&&this.getThisOrNextEl(X.nextSibling,V,W)},getThisOrNextEl:function(Y,V,X){outer:for(var W=Y;W;W=W.nextSibling){switch(W.nodeType){case 1:if((!V||V===(W.localName||W.nodeName.split(":").pop()))&&(!X||X===W.namespaceURI)){break outer}W=null;break outer;case 3:if(/^\s*$/.test(W.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:W=null;break outer}}return W||null},lookupNamespaceURI:function(Z,aa){var Y=null;if(Z){if(Z.lookupNamespaceURI){Y=Z.lookupNamespaceURI(aa)}else{outer:switch(Z.nodeType){case 1:if(Z.namespaceURI!==null&&Z.prefix===aa){Y=Z.namespaceURI;break outer}var W=Z.attributes.length;if(W){var V;for(var X=0;X<W;++X){V=Z.attributes[X];if(V.prefix==="xmlns"&&V.name==="xmlns:"+aa){Y=V.value||null;break outer}else{if(V.name==="xmlns"&&aa===null){Y=V.value||null;break outer}}}}Y=this.lookupNamespaceURI(Z.parentNode,aa);break outer;case 2:Y=this.lookupNamespaceURI(Z.ownerElement,aa);break outer;case 9:Y=this.lookupNamespaceURI(Z.documentElement,aa);break outer;case 6:case 12:case 10:case 11:break outer;default:Y=this.lookupNamespaceURI(Z.parentNode,aa);break outer}}}return Y},getXMLDoc:function(){if(!B.Format.XML.document&&!this.xmldom){if(document.implementation&&document.implementation.createDocument){B.Format.XML.document=document.implementation.createDocument("","",null)}else{if(!this.xmldom&&window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}}}return B.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});B.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};B.Format.XML.lookupNamespaceURI=B.Function.bind(B.Format.XML.prototype.lookupNamespaceURI,B.Format.XML.prototype);B.Format.XML.document=null;B.Format.XML.VersionedOGC=B.Class(B.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:false,parser:null,initialize:function(V){B.Format.XML.prototype.initialize.apply(this,[V]);var W=this.CLASS_NAME;this.name=W.substring(W.lastIndexOf(".")+1)},getVersion:function(W,X){var V;if(W){V=this.version;if(!V){V=W.getAttribute("version");if(!V){V=this.defaultVersion}}}else{V=(X&&X.version)||this.version||this.defaultVersion}return V},getParser:function(V){V=V||this.defaultVersion;var W=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=V){var X=B.Format[this.name]["v"+V.replace(/\./g,"_")+W];if(!X){throw"Can't find a "+this.name+" parser for version "+V+W}this.parser=new X(this.options)}return this.parser},write:function(Y,X){var W=this.getVersion(null,X);this.parser=this.getParser(W);var V=this.parser.write(Y,X);if(this.stringifyOutput===false){return V}else{return B.Format.XML.prototype.write.apply(this,[V])}},read:function(Y,X){if(typeof Y=="string"){Y=B.Format.XML.prototype.read.apply(this,[Y])}var W=Y.documentElement;var V=this.getVersion(W);this.parser=this.getParser(V);var aa=this.parser.read(Y,X);if(this.errorProperty!==null&&aa[this.errorProperty]===undefined){var Z=new B.Format.OGCExceptionReport();aa.error=Z.read(Y)}aa.version=V;return aa},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});B.Format.Context=B.Class(B.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(Y,W){var X=B.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);var Z;if(W&&W.map){this.context=X;if(W.map instanceof B.Map){Z=this.mergeContextToMap(X,W.map)}else{var V=W.map;if(B.Util.isElement(V)||typeof V=="string"){V={div:V}}Z=this.contextToMap(X,V)}}else{Z=X}return Z},getLayerFromContext:function(ab){var X,aa;var ad={queryable:ab.queryable,visibility:ab.visibility,maxExtent:ab.maxExtent,metadata:B.Util.applyDefaults(ab.metadata,{styles:ab.styles,formats:ab.formats,"abstract":ab["abstract"],dataURL:ab.dataURL}),numZoomLevels:ab.numZoomLevels,units:ab.units,isBaseLayer:ab.isBaseLayer,opacity:ab.opacity,displayInLayerSwitcher:ab.displayInLayerSwitcher,singleTile:ab.singleTile,tileSize:(ab.tileSize)?new B.Size(ab.tileSize.width,ab.tileSize.height):undefined,minScale:ab.minScale||ab.maxScaleDenominator,maxScale:ab.maxScale||ab.minScaleDenominator,srs:ab.srs,dimensions:ab.dimensions,metadataURL:ab.metadataURL};if(this.layerOptions){B.Util.applyDefaults(ad,this.layerOptions)}var W={layers:ab.name,transparent:ab.transparent,version:ab.version};if(ab.formats&&ab.formats.length>0){W.format=ab.formats[0].value;for(X=0,aa=ab.formats.length;X<aa;X++){var ac=ab.formats[X];if(ac.current==true){W.format=ac.value;break}}}if(ab.styles&&ab.styles.length>0){for(X=0,aa=ab.styles.length;X<aa;X++){var V=ab.styles[X];if(V.current==true){if(V.href){W.sld=V.href}else{if(V.body){W.sld_body=V.body}else{W.styles=V.name}}break}}}if(this.layerParams){B.Util.applyDefaults(W,this.layerParams)}var Y=null;var Z=ab.service;if(Z==B.Format.Context.serviceTypes.WFS){ad.strategies=[new B.Strategy.BBOX()];ad.protocol=new B.Protocol.WFS({url:ab.url,featurePrefix:ab.name.split(":")[0],featureType:ab.name.split(":").pop()});Y=new B.Layer.Vector(ab.title||ab.name,ad)}else{if(Z==B.Format.Context.serviceTypes.KML){ad.strategies=[new B.Strategy.Fixed()];ad.protocol=new B.Protocol.HTTP({url:ab.url,format:new B.Format.KML()});Y=new B.Layer.Vector(ab.title||ab.name,ad)}else{if(Z==B.Format.Context.serviceTypes.GML){ad.strategies=[new B.Strategy.Fixed()];ad.protocol=new B.Protocol.HTTP({url:ab.url,format:new B.Format.GML()});Y=new B.Layer.Vector(ab.title||ab.name,ad)}else{if(ab.features){Y=new B.Layer.Vector(ab.title||ab.name,ad);Y.addFeatures(ab.features)}else{if(ab.categoryLayer!==true){Y=new B.Layer.WMS(ab.title||ab.name,ab.url,W,ad)}}}}}return Y},getLayersFromContext:function(Y){var Z=[];for(var X=0,V=Y.length;X<V;X++){var W=this.getLayerFromContext(Y[X]);if(W!==null){Z.push(W)}}return Z},contextToMap:function(X,V){V=B.Util.applyDefaults({maxExtent:X.maxExtent,projection:X.projection,units:X.units},V);if(V.maxExtent){V.maxResolution=V.maxExtent.getWidth()/B.Map.TILE_WIDTH}var W={contactInformation:X.contactInformation,"abstract":X["abstract"],keywords:X.keywords,logo:X.logo,descriptionURL:X.descriptionURL};V.metadata=W;var Y=new B.Map(V);Y.addLayers(this.getLayersFromContext(X.layersContext));Y.setCenter(X.bounds.getCenterLonLat(),Y.getZoomForExtent(X.bounds,true));return Y},mergeContextToMap:function(V,W){W.addLayers(this.getLayersFromContext(V.layersContext));return W},write:function(W,V){W=this.toContext(W);return B.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"});B.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};B.Format.GML=B.Class(B.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(V){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};B.Format.XML.prototype.initialize.apply(this,[V])},read:function(Y){if(typeof Y=="string"){Y=B.Format.XML.prototype.read.apply(this,[Y])}var Z=this.getElementsByTagNameNS(Y.documentElement,this.gmlns,this.featureName);var X=[];for(var W=0;W<Z.length;W++){var V=this.parseFeature(Z[W]);if(V){X.push(V)}}return X},parseFeature:function(Y){var Z=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var aj,ac,ak,X;for(var af=0;af<Z.length;++af){aj=Z[af];ac=this.getElementsByTagNameNS(Y,this.gmlns,aj);if(ac.length>0){X=this.parseGeometry[aj.toLowerCase()];if(X){ak=X.apply(this,[ac[0]]);if(this.internalProjection&&this.externalProjection){ak.transform(this.externalProjection,this.internalProjection)}}else{throw new TypeError("Unsupported geometry type: "+aj)}break}}var W;var ae=this.getElementsByTagNameNS(Y,this.gmlns,"Box");for(af=0;af<ae.length;++af){var ai=ae[af];var ah=this.parseGeometry.box.apply(this,[ai]);var ag=ai.parentNode;var ab=ag.localName||ag.nodeName.split(":").pop();if(ab==="boundedBy"){W=ah}else{ak=ah.toGeometry()}}var ad;if(this.extractAttributes){ad=this.parseAttributes(Y)}var al=new B.Feature.Vector(ak,ad);al.bounds=W;al.gml={featureType:Y.firstChild.nodeName.split(":")[1],featureNS:Y.firstChild.namespaceURI,featureNSPrefix:Y.firstChild.prefix};var V=Y.firstChild;var aa;while(V){if(V.nodeType==1){aa=V.getAttribute("fid")||V.getAttribute("id");if(aa){break}}V=V.nextSibling}al.fid=aa;return al},parseGeometry:{point:function(Y){var W,V;var Z=[];var W=this.getElementsByTagNameNS(Y,this.gmlns,"pos");if(W.length>0){V=W[0].firstChild.nodeValue;V=V.replace(this.regExes.trimSpace,"");Z=V.split(this.regExes.splitSpace)}if(Z.length==0){W=this.getElementsByTagNameNS(Y,this.gmlns,"coordinates");if(W.length>0){V=W[0].firstChild.nodeValue;V=V.replace(this.regExes.removeSpace,"");Z=V.split(",")}}if(Z.length==0){W=this.getElementsByTagNameNS(Y,this.gmlns,"coord");if(W.length>0){var aa=this.getElementsByTagNameNS(W[0],this.gmlns,"X");var X=this.getElementsByTagNameNS(W[0],this.gmlns,"Y");if(aa.length>0&&X.length>0){Z=[aa[0].firstChild.nodeValue,X[0].firstChild.nodeValue]}}}if(Z.length==2){Z[2]=null}if(this.xy){return new B.Geometry.Point(Z[0],Z[1],Z[2])}else{return new B.Geometry.Point(Z[1],Z[0],Z[2])}},multipoint:function(Z){var W=this.getElementsByTagNameNS(Z,this.gmlns,"Point");var Y=[];if(W.length>0){var V;for(var X=0;X<W.length;++X){V=this.parseGeometry.point.apply(this,[W[X]]);if(V){Y.push(V)}}}return new B.Geometry.MultiPoint(Y)},linestring:function(X,Z){var Y,W;var ag=[];var ah=[];Y=this.getElementsByTagNameNS(X,this.gmlns,"posList");if(Y.length>0){W=this.getChildValue(Y[0]);W=W.replace(this.regExes.trimSpace,"");ag=W.split(this.regExes.splitSpace);var ac=parseInt(Y[0].getAttribute("dimension"));var aa,af,ae,ad;for(var ab=0;ab<ag.length/ac;++ab){aa=ab*ac;af=ag[aa];ae=ag[aa+1];ad=(ac==2)?null:ag[aa+2];if(this.xy){ah.push(new B.Geometry.Point(af,ae,ad))}else{ah.push(new B.Geometry.Point(ae,af,ad))}}}if(ag.length==0){Y=this.getElementsByTagNameNS(X,this.gmlns,"coordinates");if(Y.length>0){W=this.getChildValue(Y[0]);W=W.replace(this.regExes.trimSpace,"");W=W.replace(this.regExes.trimComma,",");var V=W.split(this.regExes.splitSpace);for(var ab=0;ab<V.length;++ab){ag=V[ab].split(",");if(ag.length==2){ag[2]=null}if(this.xy){ah.push(new B.Geometry.Point(ag[0],ag[1],ag[2]))}else{ah.push(new B.Geometry.Point(ag[1],ag[0],ag[2]))}}}}var ai=null;if(ah.length!=0){if(Z){ai=new B.Geometry.LinearRing(ah)}else{ai=new B.Geometry.LineString(ah)}}return ai},multilinestring:function(Z){var W=this.getElementsByTagNameNS(Z,this.gmlns,"LineString");var Y=[];if(W.length>0){var V;for(var X=0;X<W.length;++X){V=this.parseGeometry.linestring.apply(this,[W[X]]);if(V){Y.push(V)}}}return new B.Geometry.MultiLineString(Y)},polygon:function(Z){var W=this.getElementsByTagNameNS(Z,this.gmlns,"LinearRing");var Y=[];if(W.length>0){var V;for(var X=0;X<W.length;++X){V=this.parseGeometry.linestring.apply(this,[W[X],true]);if(V){Y.push(V)}}}return new B.Geometry.Polygon(Y)},multipolygon:function(Z){var V=this.getElementsByTagNameNS(Z,this.gmlns,"Polygon");var Y=[];if(V.length>0){var X;for(var W=0;W<V.length;++W){X=this.parseGeometry.polygon.apply(this,[V[W]]);if(X){Y.push(X)}}}return new B.Geometry.MultiPolygon(Y)},envelope:function(W){var Z=[];var V;var aa;var ae=this.getElementsByTagNameNS(W,this.gmlns,"lowerCorner");if(ae.length>0){var ac=[];if(ae.length>0){V=ae[0].firstChild.nodeValue;V=V.replace(this.regExes.trimSpace,"");ac=V.split(this.regExes.splitSpace)}if(ac.length==2){ac[2]=null}if(this.xy){var Y=new B.Geometry.Point(ac[0],ac[1],ac[2])}else{var Y=new B.Geometry.Point(ac[1],ac[0],ac[2])}}var ab=this.getElementsByTagNameNS(W,this.gmlns,"upperCorner");if(ab.length>0){var ac=[];if(ab.length>0){V=ab[0].firstChild.nodeValue;V=V.replace(this.regExes.trimSpace,"");ac=V.split(this.regExes.splitSpace)}if(ac.length==2){ac[2]=null}if(this.xy){var ad=new B.Geometry.Point(ac[0],ac[1],ac[2])}else{var ad=new B.Geometry.Point(ac[1],ac[0],ac[2])}}if(Y&&ad){Z.push(new B.Geometry.Point(Y.x,Y.y));Z.push(new B.Geometry.Point(ad.x,Y.y));Z.push(new B.Geometry.Point(ad.x,ad.y));Z.push(new B.Geometry.Point(Y.x,ad.y));Z.push(new B.Geometry.Point(Y.x,Y.y));var X=new B.Geometry.LinearRing(Z);aa=new B.Geometry.Polygon([X])}return aa},box:function(Z){var X=this.getElementsByTagNameNS(Z,this.gmlns,"coordinates");var W;var aa,V=null,Y=null;if(X.length>0){W=X[0].firstChild.nodeValue;aa=W.split(" ");if(aa.length==2){V=aa[0].split(",");Y=aa[1].split(",")}}if(V!==null&&Y!==null){return new B.Bounds(parseFloat(V[0]),parseFloat(V[1]),parseFloat(Y[0]),parseFloat(Y[1]))}}},parseAttributes:function(Z){var aa={};var V=Z.firstChild;var Y,ab,X,ae,ad,W,ac;while(V){if(V.nodeType==1){Y=V.childNodes;for(ab=0;ab<Y.length;++ab){X=Y[ab];if(X.nodeType==1){ae=X.childNodes;if(ae.length==1){ad=ae[0];if(ad.nodeType==3||ad.nodeType==4){W=(X.prefix)?X.nodeName.split(":")[1]:X.nodeName;ac=ad.nodeValue.replace(this.regExes.trimSpace,"");aa[W]=ac}}else{aa[X.nodeName.split(":").pop()]=null}}}break}V=V.nextSibling}return aa},write:function(X){if(!(B.Util.isArray(X))){X=[X]}var W=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var V=0;V<X.length;V++){W.appendChild(this.createFeatureXML(X[V]))}return B.Format.XML.prototype.write.apply(this,[W])},createFeatureXML:function(ae){var ac=ae.geometry;var Z=this.buildGeometryNode(ac);var ad=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);ad.appendChild(Z);var V=this.createElementNS(this.gmlns,"gml:"+this.featureName);var af=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var X=ae.fid||ae.id;af.setAttribute("fid",X);af.appendChild(ad);for(var ab in ae.attributes){var aa=this.createTextNode(ae.attributes[ab]);var Y=ab.substring(ab.lastIndexOf(":")+1);var W=this.createElementNS(this.featureNS,this.featurePrefix+":"+Y);W.appendChild(aa);af.appendChild(W)}V.appendChild(af);return V},buildGeometryNode:function(Y){if(this.externalProjection&&this.internalProjection){Y=Y.clone();Y.transform(this.internalProjection,this.externalProjection)}var X=Y.CLASS_NAME;var W=X.substring(X.lastIndexOf(".")+1);var V=this.buildGeometry[W.toLowerCase()];return V.apply(this,[Y])},buildGeometry:{point:function(W){var V=this.createElementNS(this.gmlns,"gml:Point");V.appendChild(this.buildCoordinatesNode(W));return V},multipoint:function(aa){var Y=this.createElementNS(this.gmlns,"gml:MultiPoint");var X=aa.components;var W,Z;for(var V=0;V<X.length;V++){W=this.createElementNS(this.gmlns,"gml:pointMember");Z=this.buildGeometry.point.apply(this,[X[V]]);W.appendChild(Z);Y.appendChild(W)}return Y},linestring:function(W){var V=this.createElementNS(this.gmlns,"gml:LineString");V.appendChild(this.buildCoordinatesNode(W));return V},multilinestring:function(aa){var Y=this.createElementNS(this.gmlns,"gml:MultiLineString");var V=aa.components;var X,Z;for(var W=0;W<V.length;++W){X=this.createElementNS(this.gmlns,"gml:lineStringMember");Z=this.buildGeometry.linestring.apply(this,[V[W]]);X.appendChild(Z);Y.appendChild(X)}return Y},linearring:function(W){var V=this.createElementNS(this.gmlns,"gml:LinearRing");V.appendChild(this.buildCoordinatesNode(W));return V},polygon:function(ab){var Y=this.createElementNS(this.gmlns,"gml:Polygon");var aa=ab.components;var X,Z,W;for(var V=0;V<aa.length;++V){W=(V==0)?"outerBoundaryIs":"innerBoundaryIs";X=this.createElementNS(this.gmlns,"gml:"+W);Z=this.buildGeometry.linearring.apply(this,[aa[V]]);X.appendChild(Z);Y.appendChild(X)}return Y},multipolygon:function(aa){var Y=this.createElementNS(this.gmlns,"gml:MultiPolygon");var V=aa.components;var Z,W;for(var X=0;X<V.length;++X){Z=this.createElementNS(this.gmlns,"gml:polygonMember");W=this.buildGeometry.polygon.apply(this,[V[X]]);Z.appendChild(W);Y.appendChild(Z)}return Y},bounds:function(W){var V=this.createElementNS(this.gmlns,"gml:Box");V.appendChild(this.buildCoordinatesNode(W));return V}},buildCoordinatesNode:function(aa){var V=this.createElementNS(this.gmlns,"gml:coordinates");V.setAttribute("decimal",".");V.setAttribute("cs",",");V.setAttribute("ts"," ");var Z=[];if(aa instanceof B.Bounds){Z.push(aa.left+","+aa.bottom);Z.push(aa.right+","+aa.top)}else{var X=(aa.components)?aa.components:[aa];for(var W=0;W<X.length;W++){Z.push(X[W].x+","+X[W].y)}}var Y=this.createTextNode(Z.join(" "));V.appendChild(Y);return V},CLASS_NAME:"OpenLayers.Format.GML"});if(!B.Format.GML){B.Format.GML={}}B.Format.GML.Base=B.Class(B.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),featureMember:(/^(.*:)?featureMembers?$/)},initialize:function(V){B.Format.XML.prototype.initialize.apply(this,[V]);this.setGeometryTypes();if(V&&V.featureNS){this.setNamespace("feature",V.featureNS)}this.singleFeatureType=!V||(typeof V.featureType==="string")},read:function(Z){if(typeof Z=="string"){Z=B.Format.XML.prototype.read.apply(this,[Z])}if(Z&&Z.nodeType==9){Z=Z.documentElement}var X=[];this.readNode(Z,{features:X},true);if(X.length==0){var Y=this.getElementsByTagNameNS(Z,this.namespaces.gml,"featureMember");if(Y.length){for(var W=0,V=Y.length;W<V;++W){this.readNode(Y[W],{features:X},true)}}else{var Y=this.getElementsByTagNameNS(Z,this.namespaces.gml,"featureMembers");if(Y.length){this.readNode(Y[0],{features:X},true)}}}return X},readNode:function(V,W,X){if(X===true&&this.autoConfig===true){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&(!(V.prefix in this.namespaces)&&V.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(V.parentNode.nodeName))){this.featureType=V.nodeName.split(":").pop();this.setNamespace("feature",V.namespaceURI);this.featureNS=V.namespaceURI;this.autoConfig=true}return B.Format.XML.prototype.readNode.apply(this,[V,W])},readers:{gml:{featureMember:function(V,W){this.readChildNodes(V,W)},featureMembers:function(V,W){this.readChildNodes(V,W)},name:function(V,W){W.name=this.getChildValue(V)},boundedBy:function(W,X){var V={};this.readChildNodes(W,V);if(V.components&&V.components.length>0){X.bounds=V.components[0]}},Point:function(W,V){var X={points:[]};this.readChildNodes(W,X);if(!V.components){V.components=[]}V.components.push(X.points[0])},coordinates:function(Z,ab){var ac=this.getChildValue(Z).replace(this.regExes.trimSpace,"");ac=ac.replace(this.regExes.trimComma,",");var V=ac.split(this.regExes.splitSpace);var aa;var Y=V.length;var X=new Array(Y);for(var W=0;W<Y;++W){aa=V[W].split(",");if(this.xy){X[W]=new B.Geometry.Point(aa[0],aa[1],aa[2])}else{X[W]=new B.Geometry.Point(aa[1],aa[0],aa[2])}}ab.points=X},coord:function(V,W){var X={};this.readChildNodes(V,X);if(!W.points){W.points=[]}W.points.push(new B.Geometry.Point(X.x,X.y,X.z))},X:function(V,W){W.x=this.getChildValue(V)},Y:function(V,W){W.y=this.getChildValue(V)},Z:function(V,W){W.z=this.getChildValue(V)},MultiPoint:function(W,V){var X={components:[]};this.readChildNodes(W,X);V.components=[new B.Geometry.MultiPoint(X.components)]},pointMember:function(V,W){this.readChildNodes(V,W)},LineString:function(W,V){var X={};this.readChildNodes(W,X);if(!V.components){V.components=[]}V.components.push(new B.Geometry.LineString(X.points))},MultiLineString:function(W,V){var X={components:[]};this.readChildNodes(W,X);V.components=[new B.Geometry.MultiLineString(X.components)]},lineStringMember:function(V,W){this.readChildNodes(V,W)},Polygon:function(W,V){var X={outer:null,inner:[]};this.readChildNodes(W,X);X.inner.unshift(X.outer);if(!V.components){V.components=[]}V.components.push(new B.Geometry.Polygon(X.inner))},LinearRing:function(W,X){var V={};this.readChildNodes(W,V);X.components=[new B.Geometry.LinearRing(V.points)]},MultiPolygon:function(W,V){var X={components:[]};this.readChildNodes(W,X);V.components=[new B.Geometry.MultiPolygon(X.components)]},polygonMember:function(V,W){this.readChildNodes(V,W)},GeometryCollection:function(W,V){var X={components:[]};this.readChildNodes(W,X);V.components=[new B.Geometry.Collection(X.components)]},geometryMember:function(V,W){this.readChildNodes(V,W)}},feature:{"*":function(X,Y){var V;var W=X.localName||X.nodeName.split(":").pop();if(Y.features){if(!this.singleFeatureType&&(B.Util.indexOf(this.featureType,W)!==-1)){V="_typeName"}else{if(W===this.featureType){V="_typeName"}}}else{if(X.childNodes.length==0||(X.childNodes.length==1&&X.firstChild.nodeType==3)){if(this.extractAttributes){V="_attribute"}}else{V="_geometry"}}if(V){this.readers.feature[V].apply(this,[X,Y])}},_typeName:function(X,Y){var V={components:[],attributes:{}};this.readChildNodes(X,V);if(V.name){V.attributes.name=V.name}var W=new B.Feature.Vector(V.components[0],V.attributes);if(!this.singleFeatureType){W.type=X.nodeName.split(":").pop();W.namespace=X.namespaceURI}var Z=X.getAttribute("fid")||this.getAttributeNS(X,this.namespaces.gml,"id");if(Z){W.fid=Z}if(this.internalProjection&&this.externalProjection&&W.geometry){W.geometry.transform(this.externalProjection,this.internalProjection)}if(V.bounds){W.bounds=V.bounds}Y.features.push(W)},_geometry:function(V,W){if(!this.geometryName){this.geometryName=V.nodeName.split(":").pop()}this.readChildNodes(V,W)},_attribute:function(W,Y){var V=W.localName||W.nodeName.split(":").pop();var X=this.getChildValue(W);Y.attributes[V]=X}},wfs:{FeatureCollection:function(V,W){this.readChildNodes(V,W)}}},write:function(X){var W;if(B.Util.isArray(X)){W="featureMembers"}else{W="featureMember"}var V=this.writeNode("gml:"+W,X);this.setAttributeNS(V,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return B.Format.XML.prototype.write.apply(this,[V])},writers:{gml:{featureMember:function(V){var W=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",V,W);return W},MultiPoint:function(Z){var Y=this.createElementNSPlus("gml:MultiPoint");var X=Z.components||[Z];for(var V=0,W=X.length;V<W;++V){this.writeNode("pointMember",X[V],Y)}return Y},pointMember:function(W){var V=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",W,V);return V},MultiLineString:function(Z){var Y=this.createElementNSPlus("gml:MultiLineString");var X=Z.components||[Z];for(var V=0,W=X.length;V<W;++V){this.writeNode("lineStringMember",X[V],Y)}return Y},lineStringMember:function(W){var V=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",W,V);return V},MultiPolygon:function(Z){var Y=this.createElementNSPlus("gml:MultiPolygon");var X=Z.components||[Z];for(var V=0,W=X.length;V<W;++V){this.writeNode("polygonMember",X[V],Y)}return Y},polygonMember:function(W){var V=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",W,V);return V},GeometryCollection:function(Y){var X=this.createElementNSPlus("gml:GeometryCollection");for(var W=0,V=Y.components.length;W<V;++W){this.writeNode("geometryMember",Y.components[W],X)}return X},geometryMember:function(W){var V=this.createElementNSPlus("gml:geometryMember");var X=this.writeNode("feature:_geometry",W);V.appendChild(X.firstChild);return V}},feature:{_typeName:function(W){var X=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:W.fid}});if(W.geometry){this.writeNode("feature:_geometry",W.geometry,X)}for(var V in W.attributes){var Y=W.attributes[V];if(Y!=null){this.writeNode("feature:_attribute",{name:V,value:Y},X)}}return X},_geometry:function(X){if(this.externalProjection&&this.internalProjection){X=X.clone().transform(this.internalProjection,this.externalProjection)}var W=this.createElementNSPlus("feature:"+this.geometryName);var V=this.geometryTypes[X.CLASS_NAME];var Y=this.writeNode("gml:"+V,X,W);if(this.srsName){Y.setAttribute("srsName",this.srsName)}return W},_attribute:function(V){return this.createElementNSPlus("feature:"+V.name,{value:V.value})}},wfs:{FeatureCollection:function(X){var Y=this.createElementNSPlus("wfs:FeatureCollection");for(var W=0,V=X.length;W<V;++W){this.writeNode("gml:featureMember",X[W],Y)}return Y}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});B.Format.GML.v2=B.Class(B.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(V){B.Format.GML.Base.prototype.initialize.apply(this,[V])},readers:{gml:B.Util.applyDefaults({outerBoundaryIs:function(W,V){var X={};this.readChildNodes(W,X);V.outer=X.components[0]},innerBoundaryIs:function(W,V){var X={};this.readChildNodes(W,X);V.inner.push(X.components[0])},Box:function(Y,W){var Z={};this.readChildNodes(Y,Z);if(!W.components){W.components=[]}var X=Z.points[0];var V=Z.points[1];W.components.push(new B.Bounds(X.x,X.y,V.x,V.y))}},B.Format.GML.Base.prototype.readers.gml),feature:B.Format.GML.Base.prototype.readers.feature,wfs:B.Format.GML.Base.prototype.readers.wfs},write:function(X){var W;if(B.Util.isArray(X)){W="wfs:FeatureCollection"}else{W="gml:featureMember"}var V=this.writeNode(W,X);this.setAttributeNS(V,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return B.Format.XML.prototype.write.apply(this,[V])},writers:{gml:B.Util.applyDefaults({Point:function(W){var V=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[W],V);return V},coordinates:function(Y){var X=Y.length;var Z=new Array(X);var V;for(var W=0;W<X;++W){V=Y[W];if(this.xy){Z[W]=V.x+","+V.y}else{Z[W]=V.y+","+V.x}if(V.z!=undefined){Z[W]+=","+V.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(X==1)?Z[0]:Z.join(" ")})},LineString:function(W){var V=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",W.components,V);return V},Polygon:function(X){var W=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",X.components[0],W);for(var V=1;V<X.components.length;++V){this.writeNode("innerBoundaryIs",X.components[V],W)}return W},outerBoundaryIs:function(V){var W=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",V,W);return W},innerBoundaryIs:function(V){var W=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",V,W);return W},LinearRing:function(V){var W=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",V.components,W);return W},Box:function(W){var V=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:W.left,y:W.bottom},{x:W.right,y:W.top}],V);if(this.srsName){V.setAttribute("srsName",this.srsName)}return V}},B.Format.GML.Base.prototype.writers.gml),feature:B.Format.GML.Base.prototype.writers.feature,wfs:B.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});B.Format.GML.v3=B.Class(B.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(V){B.Format.GML.Base.prototype.initialize.apply(this,[V])},readers:{gml:B.Util.applyDefaults({featureMembers:function(V,W){this.readChildNodes(V,W)},Curve:function(W,V){var X={points:[]};this.readChildNodes(W,X);if(!V.components){V.components=[]}V.components.push(new B.Geometry.LineString(X.points))},segments:function(V,W){this.readChildNodes(V,W)},LineStringSegment:function(W,V){var X={};this.readChildNodes(W,X);if(X.points){Array.prototype.push.apply(V.points,X.points)}},pos:function(W,Y){var Z=this.getChildValue(W).replace(this.regExes.trimSpace,"");var X=Z.split(this.regExes.splitSpace);var V;if(this.xy){V=new B.Geometry.Point(X[0],X[1],X[2])}else{V=new B.Geometry.Point(X[1],X[0],X[2])}Y.points=[V]},posList:function(V,Y){var ac=this.getChildValue(V).replace(this.regExes.trimSpace,"");var af=ac.split(this.regExes.splitSpace);var Z=parseInt(V.getAttribute("dimension"))||2;var W,ag,ae,ab;var ad=af.length/Z;var ah=new Array(ad);for(var X=0,aa=af.length;X<aa;X+=Z){ag=af[X];ae=af[X+1];ab=(Z==2)?undefined:af[X+2];if(this.xy){ah[X/Z]=new B.Geometry.Point(ag,ae,ab)}else{ah[X/Z]=new B.Geometry.Point(ae,ag,ab)}}Y.points=ah},Surface:function(V,W){this.readChildNodes(V,W)},patches:function(V,W){this.readChildNodes(V,W)},PolygonPatch:function(V,W){this.readers.gml.Polygon.apply(this,[V,W])},exterior:function(W,V){var X={};this.readChildNodes(W,X);V.outer=X.components[0]},interior:function(W,V){var X={};this.readChildNodes(W,X);V.inner.push(X.components[0])},MultiCurve:function(W,V){var X={components:[]};this.readChildNodes(W,X);if(X.components.length>0){V.components=[new B.Geometry.MultiLineString(X.components)]}},curveMember:function(V,W){this.readChildNodes(V,W)},MultiSurface:function(W,V){var X={components:[]};this.readChildNodes(W,X);if(X.components.length>0){V.components=[new B.Geometry.MultiPolygon(X.components)]}},surfaceMember:function(V,W){this.readChildNodes(V,W)},surfaceMembers:function(V,W){this.readChildNodes(V,W)},pointMembers:function(V,W){this.readChildNodes(V,W)},lineStringMembers:function(V,W){this.readChildNodes(V,W)},polygonMembers:function(V,W){this.readChildNodes(V,W)},geometryMembers:function(V,W){this.readChildNodes(V,W)},Envelope:function(Y,W){var Z={points:new Array(2)};this.readChildNodes(Y,Z);if(!W.components){W.components=[]}var X=Z.points[0];var V=Z.points[1];W.components.push(new B.Bounds(X.x,X.y,V.x,V.y))},lowerCorner:function(W,V){var X={};this.readers.gml.pos.apply(this,[W,X]);V.points[0]=X.points[0]},upperCorner:function(W,V){var X={};this.readers.gml.pos.apply(this,[W,X]);V.points[1]=X.points[0]}},B.Format.GML.Base.prototype.readers.gml),feature:B.Format.GML.Base.prototype.readers.feature,wfs:B.Format.GML.Base.prototype.readers.wfs},write:function(X){var W;if(B.Util.isArray(X)){W="featureMembers"}else{W="featureMember"}var V=this.writeNode("gml:"+W,X);this.setAttributeNS(V,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return B.Format.XML.prototype.write.apply(this,[V])},writers:{gml:B.Util.applyDefaults({featureMembers:function(X){var Y=this.createElementNSPlus("gml:featureMembers");for(var W=0,V=X.length;W<V;++W){this.writeNode("feature:_typeName",X[W],Y)}return Y},Point:function(W){var V=this.createElementNSPlus("gml:Point");this.writeNode("pos",W,V);return V},pos:function(V){var W=(this.xy)?(V.x+" "+V.y):(V.y+" "+V.x);return this.createElementNSPlus("gml:pos",{value:W})},LineString:function(W){var V=this.createElementNSPlus("gml:LineString");this.writeNode("posList",W.components,V);return V},Curve:function(W){var V=this.createElementNSPlus("gml:Curve");this.writeNode("segments",W,V);return V},segments:function(W){var V=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",W,V);return V},LineStringSegment:function(W){var V=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",W.components,V);return V},posList:function(Y){var W=Y.length;var Z=new Array(W);var V;for(var X=0;X<W;++X){V=Y[X];if(this.xy){Z[X]=V.x+" "+V.y}else{Z[X]=V.y+" "+V.x}}return this.createElementNSPlus("gml:posList",{value:Z.join(" ")})},Surface:function(W){var V=this.createElementNSPlus("gml:Surface");this.writeNode("patches",W,V);return V},patches:function(W){var V=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",W,V);return V},PolygonPatch:function(Y){var X=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",Y.components[0],X);for(var W=1,V=Y.components.length;W<V;++W){this.writeNode("interior",Y.components[W],X)}return X},Polygon:function(Y){var X=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",Y.components[0],X);for(var W=1,V=Y.components.length;W<V;++W){this.writeNode("interior",Y.components[W],X)}return X},exterior:function(V){var W=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",V,W);return W},interior:function(V){var W=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",V,W);return W},LinearRing:function(V){var W=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",V.components,W);return W},MultiCurve:function(Z){var Y=this.createElementNSPlus("gml:MultiCurve");var X=Z.components||[Z];for(var W=0,V=X.length;W<V;++W){this.writeNode("curveMember",X[W],Y)}return Y},curveMember:function(W){var V=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",W,V)}else{this.writeNode("LineString",W,V)}return V},MultiSurface:function(Z){var Y=this.createElementNSPlus("gml:MultiSurface");var X=Z.components||[Z];for(var W=0,V=X.length;W<V;++W){this.writeNode("surfaceMember",X[W],Y)}return Y},surfaceMember:function(V){var W=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",V,W)}else{this.writeNode("Polygon",V,W)}return W},Envelope:function(W){var V=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",W,V);this.writeNode("upperCorner",W,V);if(this.srsName){V.setAttribute("srsName",this.srsName)}return V},lowerCorner:function(V){var W=(this.xy)?(V.left+" "+V.bottom):(V.bottom+" "+V.left);return this.createElementNSPlus("gml:lowerCorner",{value:W})},upperCorner:function(V){var W=(this.xy)?(V.right+" "+V.top):(V.top+" "+V.right);return this.createElementNSPlus("gml:upperCorner",{value:W})}},B.Format.GML.Base.prototype.writers.gml),feature:B.Format.GML.Base.prototype.writers.feature,wfs:B.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});B.Format.KML=B.Class(B.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date(),extractAttributes:true,kvpAttributes:false,extractStyles:false,extractTracks:false,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(V){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),kmlColor:(/(\w{2})(\w{2})(\w{2})(\w{2})/),kmlIconPalette:(/root:\/\/icons\/palette-(\d+)(\.\w+)/),straightBracket:(/\$\[(.*?)\]/g)};this.externalProjection=new B.Projection("EPSG:4326");B.Format.XML.prototype.initialize.apply(this,[V])},read:function(W){this.features=[];this.styles={};this.fetched={};var V={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(W,V)},parseData:function(ab,X){if(typeof ab=="string"){ab=B.Format.XML.prototype.read.apply(this,[ab])}var Z=["Link","NetworkLink","Style","StyleMap","Placemark"];for(var Y=0,V=Z.length;Y<V;++Y){var aa=Z[Y];var W=this.getElementsByTagNameNS(ab,"*",aa);if(W.length==0){continue}switch(aa.toLowerCase()){case"link":case"networklink":this.parseLinks(W,X);break;case"style":if(this.extractStyles){this.parseStyles(W,X)}break;case"stylemap":if(this.extractStyles){this.parseStyleMaps(W,X)}break;case"placemark":this.parseFeatures(W,X);break}}return this.features},parseLinks:function(X,Y){if(Y.depth>=this.maxDepth){return false}var ab=B.Util.extend({},Y);ab.depth++;for(var Z=0,V=X.length;Z<V;Z++){var W=this.parseProperty(X[Z],"*","href");if(W&&!this.fetched[W]){this.fetched[W]=true;var aa=this.fetchLink(W);if(aa){this.parseData(aa,ab)}}}},fetchLink:function(V){var W=B.Request.GET({url:V,async:false});if(W){return W.responseText}},parseStyles:function(W,X){for(var Z=0,V=W.length;Z<V;Z++){var aa=this.parseStyle(W[Z]);if(aa){var Y=(X.styleBaseUrl||"")+"#"+aa.id;this.styles[Y]=aa}}},parseKmlColor:function(W){var V=null;if(W){var X=W.match(this.regExes.kmlColor);if(X){V={color:"#"+X[4]+X[3]+X[2],opacity:parseInt(X[1],16)/255}}}return V},parseStyle:function(aq){var az={};var ak=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"];var Z,ae,aC,ab,Y;for(var aw=0,ay=ak.length;aw<ay;++aw){Z=ak[aw];ae=this.getElementsByTagNameNS(aq,"*",Z)[0];if(!ae){continue}switch(Z.toLowerCase()){case"linestyle":var X=this.parseProperty(ae,"*","color");var at=this.parseKmlColor(X);if(at){az.strokeColor=at.color;az.strokeOpacity=at.opacity}var ap=this.parseProperty(ae,"*","width");if(ap){az.strokeWidth=ap}break;case"polystyle":var X=this.parseProperty(ae,"*","color");var at=this.parseKmlColor(X);if(at){az.fillOpacity=at.opacity;az.fillColor=at.color}var au=this.parseProperty(ae,"*","fill");if(au=="0"){az.fillColor="none"}var ac=this.parseProperty(ae,"*","outline");if(ac=="0"){az.strokeWidth="0"}break;case"iconstyle":var aE=parseFloat(this.parseProperty(ae,"*","scale")||1);var ap=32*aE;var an=32*aE;var aD=this.getElementsByTagNameNS(ae,"*","Icon")[0];if(aD){var av=this.parseProperty(aD,"*","href");if(av){var aj=this.parseProperty(aD,"*","w");var ax=this.parseProperty(aD,"*","h");var aa="http://maps.google.com/mapfiles/kml";if(B.String.startsWith(av,aa)&&!aj&&!ax){aj=64;ax=64;aE=aE/2}aj=aj||ax;ax=ax||aj;if(aj){ap=parseInt(aj)*aE}if(ax){an=parseInt(ax)*aE}var W=av.match(this.regExes.kmlIconPalette);if(W){var aA=W[1];var am=W[2];var ai=this.parseProperty(aD,"*","x");var ah=this.parseProperty(aD,"*","y");var ag=ai?ai/32:0;var af=ah?(7-ah/32):7;var ad=af*8+ag;av="http://maps.google.com/mapfiles/kml/pal"+aA+"/icon"+ad+am}az.graphicOpacity=1;az.externalGraphic=av}}var al=this.getElementsByTagNameNS(ae,"*","hotSpot")[0];if(al){var ai=parseFloat(al.getAttribute("x"));var ah=parseFloat(al.getAttribute("y"));var ar=al.getAttribute("xunits");if(ar=="pixels"){az.graphicXOffset=-ai*aE}else{if(ar=="insetPixels"){az.graphicXOffset=-ap+(ai*aE)}else{if(ar=="fraction"){az.graphicXOffset=-ap*ai}}}var aB=al.getAttribute("yunits");if(aB=="pixels"){az.graphicYOffset=-an+(ah*aE)+1}else{if(aB=="insetPixels"){az.graphicYOffset=-(ah*aE)+1}else{if(aB=="fraction"){az.graphicYOffset=-an*(1-ah)+1}}}}az.graphicWidth=ap;az.graphicHeight=an;break;case"balloonstyle":var V=B.Util.getXmlNodeValue(ae);if(V){az.balloonStyle=V.replace(this.regExes.straightBracket,"${$1}")}break;case"labelstyle":var X=this.parseProperty(ae,"*","color");var at=this.parseKmlColor(X);if(at){az.fontColor=at.color;az.fontOpacity=at.opacity}break;default:}}if(!az.strokeColor&&az.fillColor){az.strokeColor=az.fillColor}var ao=aq.getAttribute("id");if(ao&&az){az.id=ao}return az},parseStyleMaps:function(V,ag){for(var ab=0,ac=V.length;ab<ac;ab++){var Y=V[ab];var X=this.getElementsByTagNameNS(Y,"*","Pair");var W=Y.getAttribute("id");for(var aa=0,af=X.length;aa<af;aa++){var Z=X[aa];var ae=this.parseProperty(Z,"*","key");var ad=this.parseProperty(Z,"*","styleUrl");if(ad&&ae=="normal"){this.styles[(ag.styleBaseUrl||"")+"#"+W]=this.styles[(ag.styleBaseUrl||"")+ad]}}}},parseFeatures:function(W,ag){var aa=[];for(var ab=0,ac=W.length;ab<ac;ab++){var X=W[ab];var af=this.parseFeature.apply(this,[X]);if(af){if(this.extractStyles&&af.attributes&&af.attributes.styleUrl){af.style=this.getStyle(af.attributes.styleUrl,ag)}if(this.extractStyles){var ae=this.getElementsByTagNameNS(X,"*","Style")[0];if(ae){var Z=this.parseStyle(ae);if(Z){af.style=B.Util.extend(af.style,Z)}}}if(this.extractTracks){var ad=this.getElementsByTagNameNS(X,this.namespaces.gx,"Track");if(ad&&ad.length>0){var Y=ad[0];var V={features:[],feature:af};this.readNode(Y,V);if(V.features.length>0){aa.push.apply(aa,V.features)}}}else{aa.push(af)}}else{throw"Bad Placemark: "+ab}}this.features=this.features.concat(aa)},readers:{kml:{when:function(W,V){V.whens.push(B.Date.parse(this.getChildValue(W)))},_trackPointAttribute:function(X,V){var W=X.nodeName.split(":").pop();V.attributes[W].push(this.getChildValue(X))}},gx:{Track:function(X,W){var Z={whens:[],points:[],angles:[]};if(this.trackAttributes){var V;Z.attributes={};for(var aa=0,af=this.trackAttributes.length;aa<af;++aa){V=this.trackAttributes[aa];Z.attributes[V]=[];if(!(V in this.readers.kml)){this.readers.kml[V]=this.readers.kml._trackPointAttribute}}}this.readChildNodes(X,Z);if(Z.whens.length!==Z.points.length){throw new Error("gx:Track with unequal number of when ("+Z.whens.length+") and gx:coord ("+Z.points.length+") elements.")}var ad=Z.angles.length>0;if(ad&&Z.whens.length!==Z.angles.length){throw new Error("gx:Track with unequal number of when ("+Z.whens.length+") and gx:angles ("+Z.angles.length+") elements.")}var ag,ae,ac;for(var aa=0,af=Z.whens.length;aa<af;++aa){ag=W.feature.clone();ag.fid=W.feature.fid||W.feature.id;ae=Z.points[aa];ag.geometry=ae;if("z" in ae){ag.attributes.altitude=ae.z}if(this.internalProjection&&this.externalProjection){ag.geometry.transform(this.externalProjection,this.internalProjection)}if(this.trackAttributes){for(var Y=0,ab=this.trackAttributes.length;Y<ab;++Y){ag.attributes[V]=Z.attributes[this.trackAttributes[Y]][aa]}}ag.attributes.when=Z.whens[aa];ag.attributes.trackId=W.feature.id;if(ad){ac=Z.angles[aa];ag.attributes.heading=parseFloat(ac[0]);ag.attributes.tilt=parseFloat(ac[1]);ag.attributes.roll=parseFloat(ac[2])}W.features.push(ag)}},coord:function(X,W){var Z=this.getChildValue(X);var Y=Z.replace(this.regExes.trimSpace,"").split(/\s+/);var V=new B.Geometry.Point(Y[0],Y[1]);if(Y.length>2){V.z=parseFloat(Y[2])}W.points.push(V)},angles:function(W,V){var Y=this.getChildValue(W);var X=Y.replace(this.regExes.trimSpace,"").split(/\s+/);V.angles.push(X)}}},parseFeature:function(W){var X=["MultiGeometry","Polygon","LineString","Point"];var ad,Z,ae,V;for(var ab=0,ac=X.length;ab<ac;++ab){ad=X[ab];this.internalns=W.namespaceURI?W.namespaceURI:this.kmlns;Z=this.getElementsByTagNameNS(W,this.internalns,ad);if(Z.length>0){var V=this.parseGeometry[ad.toLowerCase()];if(V){ae=V.apply(this,[Z[0]]);if(this.internalProjection&&this.externalProjection){ae.transform(this.externalProjection,this.internalProjection)}}else{throw new TypeError("Unsupported geometry type: "+ad)}break}}var aa;if(this.extractAttributes){aa=this.parseAttributes(W)}var af=new B.Feature.Vector(ae,aa);var Y=W.getAttribute("id")||W.getAttribute("name");if(Y!=null){af.fid=Y}return af},getStyle:function(W,V){var X=B.Util.removeTail(W);var aa=B.Util.extend({},V);aa.depth++;aa.styleBaseUrl=X;if(!this.styles[W]&&!B.String.startsWith(W,"#")&&aa.depth<=this.maxDepth&&!this.fetched[X]){var Z=this.fetchLink(X);if(Z){this.parseData(Z,aa)}}var Y=B.Util.extend({},this.styles[W]);return Y},parseGeometry:{point:function(Y){var X=this.getElementsByTagNameNS(Y,this.internalns,"coordinates");var Z=[];if(X.length>0){var W=X[0].firstChild.nodeValue;W=W.replace(this.regExes.removeSpace,"");Z=W.split(",")}var V=null;if(Z.length>1){if(Z.length==2){Z[2]=null}V=new B.Geometry.Point(Z[0],Z[1],Z[2])}else{throw"Bad coordinate string: "+W}return V},linestring:function(X,Z){var Y=this.getElementsByTagNameNS(X,this.internalns,"coordinates");var af=null;if(Y.length>0){var W=this.getChildValue(Y[0]);W=W.replace(this.regExes.trimSpace,"");W=W.replace(this.regExes.trimComma,",");var V=W.split(this.regExes.splitSpace);var ac=V.length;var ae=new Array(ac);var ad,ab;for(var aa=0;aa<ac;++aa){ad=V[aa].split(",");ab=ad.length;if(ab>1){if(ad.length==2){ad[2]=null}ae[aa]=new B.Geometry.Point(ad[0],ad[1],ad[2])}else{throw"Bad LineString point coordinates: "+V[aa]}}if(ac){if(Z){af=new B.Geometry.LinearRing(ae)}else{af=new B.Geometry.LineString(ae)}}else{throw"Bad LineString coordinates: "+W}}return af},polygon:function(aa){var X=this.getElementsByTagNameNS(aa,this.internalns,"LinearRing");var ab=X.length;var Z=new Array(ab);if(ab>0){var W;for(var Y=0,V=X.length;Y<V;++Y){W=this.parseGeometry.linestring.apply(this,[X[Y],true]);if(W){Z[Y]=W}else{throw"Bad LinearRing geometry: "+Y}}}return new B.Geometry.Polygon(Z)},multigeometry:function(Z){var ac,ab;var aa=[];var X=Z.childNodes;for(var W=0,V=X.length;W<V;++W){ac=X[W];if(ac.nodeType==1){var Y=(ac.prefix)?ac.nodeName.split(":")[1]:ac.nodeName;var ab=this.parseGeometry[Y.toLowerCase()];if(ab){aa.push(ab.apply(this,[ac]))}}}return new B.Geometry.Collection(aa)}},parseAttributes:function(Y){var aa={};var ac=Y.getElementsByTagName("ExtendedData");if(ac.length){aa=this.parseExtendedData(ac[0])}var W,ah,ag;var X=Y.childNodes;for(var ad=0,ae=X.length;ad<ae;++ad){W=X[ad];if(W.nodeType==1){ah=W.childNodes;if(ah.length>=1&&ah.length<=3){var ag;switch(ah.length){case 1:ag=ah[0];break;case 2:var ab=ah[0];var Z=ah[1];ag=(ab.nodeType==3||ab.nodeType==4)?ab:Z;break;case 3:default:ag=ah[1];break}if(ag.nodeType==3||ag.nodeType==4){var V=(W.prefix)?W.nodeName.split(":")[1]:W.nodeName;var af=B.Util.getXmlNodeValue(ag);if(af){af=af.replace(this.regExes.trimSpace,"");aa[V]=af}}}}}return aa},parseExtendedData:function(W){var Y={};var aa,ac,Z,ae;var X=W.getElementsByTagName("Data");for(aa=0,ac=X.length;aa<ac;aa++){Z=X[aa];ae=Z.getAttribute("name");var ab={};var af=Z.getElementsByTagName("value");if(af.length){ab.value=this.getChildValue(af[0])}if(this.kvpAttributes){Y[ae]=ab.value}else{var V=Z.getElementsByTagName("displayName");if(V.length){ab.displayName=this.getChildValue(V[0])}Y[ae]=ab}}var ad=W.getElementsByTagName("SimpleData");for(aa=0,ac=ad.length;aa<ac;aa++){var ab={};Z=ad[aa];ae=Z.getAttribute("name");ab.value=this.getChildValue(Z);if(this.kvpAttributes){Y[ae]=ab.value}else{ab.displayName=ae;Y[ae]=ab}}return Y},parseProperty:function(X,Y,W){var Z;var V=this.getElementsByTagNameNS(X,Y,W);try{Z=B.Util.getXmlNodeValue(V[0])}catch(aa){Z=null}return Z},write:function(Y){if(!(B.Util.isArray(Y))){Y=[Y]}var W=this.createElementNS(this.kmlns,"kml");var Z=this.createFolderXML();for(var X=0,V=Y.length;X<V;++X){Z.appendChild(this.createPlacemarkXML(Y[X]))}W.appendChild(Z);return B.Format.XML.prototype.write.apply(this,[W])},createFolderXML:function(){var X=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var Z=this.createElementNS(this.kmlns,"name");var Y=this.createTextNode(this.foldersName);Z.appendChild(Y);X.appendChild(Z)}if(this.foldersDesc){var V=this.createElementNS(this.kmlns,"description");var W=this.createTextNode(this.foldersDesc);V.appendChild(W);X.appendChild(V)}return X},createPlacemarkXML:function(Z){var ac=this.createElementNS(this.kmlns,"name");var X=Z.style&&Z.style.label?Z.style.label:Z.attributes.name||Z.id;ac.appendChild(this.createTextNode(X));var Y=this.createElementNS(this.kmlns,"description");var ab=Z.attributes.description||this.placemarksDesc;Y.appendChild(this.createTextNode(ab));var W=this.createElementNS(this.kmlns,"Placemark");if(Z.fid!=null){W.setAttribute("id",Z.fid)}W.appendChild(ac);W.appendChild(Y);var V=this.buildGeometryNode(Z.geometry);W.appendChild(V);if(Z.attributes){var aa=this.buildExtendedData(Z.attributes);if(aa){W.appendChild(aa)}}return W},buildGeometryNode:function(Z){var X=Z.CLASS_NAME;var W=X.substring(X.lastIndexOf(".")+1);var V=this.buildGeometry[W.toLowerCase()];var Y=null;if(V){Y=V.apply(this,[Z])}return Y},buildGeometry:{point:function(W){var V=this.createElementNS(this.kmlns,"Point");V.appendChild(this.buildCoordinatesNode(W));return V},multipoint:function(V){return this.buildGeometry.collection.apply(this,[V])},linestring:function(W){var V=this.createElementNS(this.kmlns,"LineString");V.appendChild(this.buildCoordinatesNode(W));return V},multilinestring:function(V){return this.buildGeometry.collection.apply(this,[V])},linearring:function(W){var V=this.createElementNS(this.kmlns,"LinearRing");V.appendChild(this.buildCoordinatesNode(W));return V},polygon:function(ac){var W=this.createElementNS(this.kmlns,"Polygon");var ab=ac.components;var Z,aa,Y;for(var X=0,V=ab.length;X<V;++X){Y=(X==0)?"outerBoundaryIs":"innerBoundaryIs";Z=this.createElementNS(this.kmlns,Y);aa=this.buildGeometry.linearring.apply(this,[ab[X]]);Z.appendChild(aa);W.appendChild(Z)}return W},multipolygon:function(V){return this.buildGeometry.collection.apply(this,[V])},collection:function(Y){var W=this.createElementNS(this.kmlns,"MultiGeometry");var Z;for(var X=0,V=Y.components.length;X<V;++X){Z=this.buildGeometryNode.apply(this,[Y.components[X]]);if(Z){W.appendChild(Z)}}return W}},buildCoordinatesNode:function(Z){var V=this.createElementNS(this.kmlns,"coordinates");var ad;var ac=Z.components;if(ac){var ab;var aa=ac.length;var X=new Array(aa);for(var Y=0;Y<aa;++Y){ab=ac[Y];X[Y]=this.buildCoordinates(ab)}ad=X.join(" ")}else{ad=this.buildCoordinates(Z)}var W=this.createTextNode(ad);V.appendChild(W);return V},buildCoordinates:function(V){if(this.internalProjection&&this.externalProjection){V=V.clone();V.transform(this.internalProjection,this.externalProjection)}return V.x+","+V.y},buildExtendedData:function(W){var Y=this.createElementNS(this.kmlns,"ExtendedData");for(var X in W){if(W[X]&&X!="name"&&X!="description"&&X!="styleUrl"){var aa=this.createElementNS(this.kmlns,"Data");aa.setAttribute("name",X);var Z=this.createElementNS(this.kmlns,"value");if(typeof W[X]=="object"){if(W[X].value){Z.appendChild(this.createTextNode(W[X].value))}if(W[X].displayName){var V=this.createElementNS(this.kmlns,"displayName");V.appendChild(this.getXMLDoc().createCDATASection(W[X].displayName));aa.appendChild(V)}}else{Z.appendChild(this.createTextNode(W[X]))}aa.appendChild(Z);Y.appendChild(aa)}}if(this.isSimpleContent(Y)){return null}else{return Y}},CLASS_NAME:"OpenLayers.Format.KML"});B.bases.FormatKML=B.Format.KML;B.Format.KML=B.Class(B.Format.KML,{buildGeometryNode:function(W){var V=W.clone();V.transform(p.CUBProjToOLProj(M.projection()),"epsg:4326");return B.bases.FormatKML.prototype.buildGeometryNode.apply(this,[V])}});B.Format.WFS=B.Class(B.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(V,W){B.Format.GML.prototype.initialize.apply(this,[V]);this.layer=W;if(this.layer.featureNS){this.featureNS=this.layer.featureNS}if(this.layer.options.geometry_column){this.geometryName=this.layer.options.geometry_column}if(this.layer.options.typename){this.featureName=this.layer.options.typename}},write:function(W){var X=this.createElementNS(this.wfsns,"wfs:Transaction");X.setAttribute("version","1.0.0");X.setAttribute("service","WFS");for(var V=0;V<W.length;V++){switch(W[V].state){case B.State.INSERT:X.appendChild(this.insert(W[V]));break;case B.State.UPDATE:X.appendChild(this.update(W[V]));break;case B.State.DELETE:X.appendChild(this.remove(W[V]));break}}return B.Format.XML.prototype.write.apply(this,[X])},createFeatureXML:function(aa){var X=this.buildGeometryNode(aa.geometry);var ab=this.createElementNS(this.featureNS,"feature:"+this.geometryName);ab.appendChild(X);var W=this.createElementNS(this.featureNS,"feature:"+this.featureName);W.appendChild(ab);for(var V in aa.attributes){var ac=this.createTextNode(aa.attributes[V]);var Y=V;if(V.search(":")!=-1){Y=V.split(":")[1]}var Z=this.createElementNS(this.featureNS,"feature:"+Y);Z.appendChild(ac);W.appendChild(Z)}return W},insert:function(W){var V=this.createElementNS(this.wfsns,"wfs:Insert");V.appendChild(this.createFeatureXML(W));return V},update:function(ae){if(!ae.fid){B.Console.userError(B.i18n("noFID"))}var aa=this.createElementNS(this.wfsns,"wfs:Update");aa.setAttribute("typeName",this.featurePrefix+":"+this.featureName);aa.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var ac=this.createElementNS(this.wfsns,"wfs:Property");var V=this.createElementNS(this.wfsns,"wfs:Name");var X=this.createTextNode(this.geometryName);V.appendChild(X);ac.appendChild(V);var ad=this.createElementNS(this.wfsns,"wfs:Value");var Y=this.buildGeometryNode(ae.geometry);if(ae.layer){Y.setAttribute("srsName",ae.layer.projection.getCode())}ad.appendChild(Y);ac.appendChild(ad);aa.appendChild(ac);for(var Z in ae.attributes){ac=this.createElementNS(this.wfsns,"wfs:Property");V=this.createElementNS(this.wfsns,"wfs:Name");V.appendChild(this.createTextNode(Z));ac.appendChild(V);ad=this.createElementNS(this.wfsns,"wfs:Value");ad.appendChild(this.createTextNode(ae.attributes[Z]));ac.appendChild(ad);aa.appendChild(ac)}var ab=this.createElementNS(this.ogcns,"ogc:Filter");var W=this.createElementNS(this.ogcns,"ogc:FeatureId");W.setAttribute("fid",ae.fid);ab.appendChild(W);aa.appendChild(ab);return aa},remove:function(W){if(!W.fid){B.Console.userError(B.i18n("noFID"));return false}var V=this.createElementNS(this.wfsns,"wfs:Delete");V.setAttribute("typeName",this.featurePrefix+":"+this.featureName);V.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var X=this.createElementNS(this.ogcns,"ogc:Filter");var Y=this.createElementNS(this.ogcns,"ogc:FeatureId");Y.setAttribute("fid",W.fid);X.appendChild(Y);V.appendChild(X);return V},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});B.Format.OWSCommon=B.Class(B.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(W,X){var V=this.version;if(!V){var Y=W.getAttribute("xmlns:ows");if(Y&&Y.substring(Y.lastIndexOf("/")+1)==="1.1"){V="1.1.0"}if(!V){V=this.defaultVersion}}return V},CLASS_NAME:"OpenLayers.Format.OWSCommon"});B.Format.OWSCommon.v1=B.Class(B.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(W,V){V=B.Util.applyDefaults(V,this.options);var X={};this.readChildNodes(W,X);return X},readers:{ows:{Exception:function(W,X){var V={code:W.getAttribute("exceptionCode"),locator:W.getAttribute("locator"),texts:[]};X.exceptions.push(V);this.readChildNodes(W,V)},ExceptionText:function(W,V){var X=this.getChildValue(W);V.texts.push(X)},ServiceIdentification:function(V,W){W.serviceIdentification={};this.readChildNodes(V,W.serviceIdentification)},Title:function(V,W){W.title=this.getChildValue(V)},Abstract:function(V,W){W["abstract"]=this.getChildValue(V)},Keywords:function(V,W){W.keywords={};this.readChildNodes(V,W.keywords)},Keyword:function(W,V){V[this.getChildValue(W)]=true},ServiceType:function(V,W){W.serviceType={codeSpace:V.getAttribute("codeSpace"),value:this.getChildValue(V)}},ServiceTypeVersion:function(V,W){W.serviceTypeVersion=this.getChildValue(V)},Fees:function(V,W){W.fees=this.getChildValue(V)},AccessConstraints:function(V,W){W.accessConstraints=this.getChildValue(V)},ServiceProvider:function(V,W){W.serviceProvider={};this.readChildNodes(V,W.serviceProvider)},ProviderName:function(V,W){W.providerName=this.getChildValue(V)},ProviderSite:function(V,W){W.providerSite=this.getAttributeNS(V,this.namespaces.xlink,"href")},ServiceContact:function(V,W){W.serviceContact={};this.readChildNodes(V,W.serviceContact)},IndividualName:function(W,V){V.individualName=this.getChildValue(W)},PositionName:function(W,V){V.positionName=this.getChildValue(W)},ContactInfo:function(W,V){V.contactInfo={};this.readChildNodes(W,V.contactInfo)},Phone:function(W,V){V.phone={};this.readChildNodes(W,V.phone)},Voice:function(W,V){V.voice=this.getChildValue(W)},Address:function(W,V){V.address={};this.readChildNodes(W,V.address)},DeliveryPoint:function(W,V){V.deliveryPoint=this.getChildValue(W)},City:function(W,V){V.city=this.getChildValue(W)},AdministrativeArea:function(W,V){V.administrativeArea=this.getChildValue(W)},PostalCode:function(W,V){V.postalCode=this.getChildValue(W)},Country:function(W,V){V.country=this.getChildValue(W)},ElectronicMailAddress:function(W,V){V.electronicMailAddress=this.getChildValue(W)},Role:function(W,V){V.role=this.getChildValue(W)},OperationsMetadata:function(V,W){W.operationsMetadata={};this.readChildNodes(V,W.operationsMetadata)},Operation:function(X,W){var V=X.getAttribute("name");W[V]={};this.readChildNodes(X,W[V])},DCP:function(W,V){V.dcp={};this.readChildNodes(W,V.dcp)},HTTP:function(W,V){V.http={};this.readChildNodes(W,V.http)},Get:function(W,V){if(!V.get){V.get=[]}var X={url:this.getAttributeNS(W,this.namespaces.xlink,"href")};this.readChildNodes(W,X);V.get.push(X)},Post:function(W,V){if(!V.post){V.post=[]}var X={url:this.getAttributeNS(W,this.namespaces.xlink,"href")};this.readChildNodes(W,X);V.post.push(X)},Parameter:function(X,V){if(!V.parameters){V.parameters={}}var W=X.getAttribute("name");V.parameters[W]={};this.readChildNodes(X,V.parameters[W])},Constraint:function(W,X){if(!X.constraints){X.constraints={}}var V=W.getAttribute("name");X.constraints[V]={};this.readChildNodes(W,X.constraints[V])},Value:function(V,W){W[this.getChildValue(V)]=true},OutputFormat:function(V,W){W.formats.push({value:this.getChildValue(V)});this.readChildNodes(V,W)},WGS84BoundingBox:function(W,X){var V={};V.crs=W.getAttribute("crs");if(X.BoundingBox){X.BoundingBox.push(V)}else{X.projection=V.crs;V=X}this.readChildNodes(W,V)},BoundingBox:function(V,W){this.readers.ows["WGS84BoundingBox"].apply(this,[V,W])},LowerCorner:function(W,X){var Y=this.getChildValue(W).replace(this.regExes.trimSpace,"");Y=Y.replace(this.regExes.trimComma,",");var V=Y.split(this.regExes.splitSpace);X.left=V[0];X.bottom=V[1]},UpperCorner:function(W,X){var Y=this.getChildValue(W).replace(this.regExes.trimSpace,"");Y=Y.replace(this.regExes.trimComma,",");var V=Y.split(this.regExes.splitSpace);X.right=V[0];X.top=V[1];X.bounds=new B.Bounds(X.left,X.bottom,X.right,X.top);delete X.left;delete X.bottom;delete X.right;delete X.top},Language:function(V,W){W.language=this.getChildValue(V)}}},writers:{ows:{BoundingBox:function(V){var W=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:V.projection}});this.writeNode("ows:LowerCorner",V,W);this.writeNode("ows:UpperCorner",V,W);return W},LowerCorner:function(V){var W=this.createElementNSPlus("ows:LowerCorner",{value:V.bounds.left+" "+V.bounds.bottom});return W},UpperCorner:function(V){var W=this.createElementNSPlus("ows:UpperCorner",{value:V.bounds.right+" "+V.bounds.top});return W},Identifier:function(V){var W=this.createElementNSPlus("ows:Identifier",{value:V});return W},Title:function(W){var V=this.createElementNSPlus("ows:Title",{value:W});return V},Abstract:function(V){var W=this.createElementNSPlus("ows:Abstract",{value:V});return W},OutputFormat:function(W){var V=this.createElementNSPlus("ows:OutputFormat",{value:W});return V}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});B.Format.OWSCommon.v1_0_0=B.Class(B.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:B.Util.applyDefaults({ExceptionReport:function(V,W){W.success=false;W.exceptionReport={version:V.getAttribute("version"),language:V.getAttribute("language"),exceptions:[]};this.readChildNodes(V,W.exceptionReport)}},B.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:B.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});B.Format.OWSCommon.v1_1_0=B.Class(B.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:B.Util.applyDefaults({ExceptionReport:function(V,W){W.exceptionReport={version:V.getAttribute("version"),language:V.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(V,W.exceptionReport)},AllowedValues:function(V,W){W.allowedValues={};this.readChildNodes(V,W.allowedValues)},AnyValue:function(V,W){W.anyValue=true},DataType:function(V,W){W.dataType=this.getChildValue(V)},Range:function(V,W){W.range={};this.readChildNodes(V,W.range)},MinimumValue:function(W,V){V.minValue=this.getChildValue(W)},MaximumValue:function(W,V){V.maxValue=this.getChildValue(W)},Identifier:function(V,W){W.identifier=this.getChildValue(V)},SupportedCRS:function(V,W){W.supportedCRS=this.getChildValue(V)}},B.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:B.Util.applyDefaults({Range:function(V){var W=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":V.closure}});this.writeNode("ows:MinimumValue",V.minValue,W);this.writeNode("ows:MaximumValue",V.maxValue,W);return W},MinimumValue:function(W){var V=this.createElementNSPlus("ows:MinimumValue",{value:W});return V},MaximumValue:function(W){var V=this.createElementNSPlus("ows:MaximumValue",{value:W});return V},Value:function(W){var V=this.createElementNSPlus("ows:Value",{value:W});return V}},B.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});B.Format.WFSCapabilities=B.Class(B.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});B.Format.WFSCapabilities.v1=B.Class(B.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",read:function(X){if(typeof X=="string"){X=B.Format.XML.prototype.read.apply(this,[X])}var W=X;if(X&&X.nodeType==9){X=X.documentElement}var V={};this.readNode(X,V);return V},readers:{wfs:{WFS_Capabilities:function(V,W){this.readChildNodes(V,W)},FeatureTypeList:function(W,V){V.featureTypeList={featureTypes:[]};this.readChildNodes(W,V.featureTypeList)},FeatureType:function(X,V){var W={};this.readChildNodes(X,W);V.featureTypes.push(W)},Name:function(W,Y){var V=this.getChildValue(W);if(V){var X=V.split(":");Y.name=X.pop();if(X.length>0){Y.featureNS=this.lookupNamespaceURI(W,X[0])}}},Title:function(V,W){var X=this.getChildValue(V);if(X){W.title=X}},Abstract:function(W,X){var V=this.getChildValue(W);if(V){X["abstract"]=V}}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});B.Format.WFSCapabilities.v1_0_0=B.Class(B.Format.WFSCapabilities.v1,{readers:{wfs:B.Util.applyDefaults({Service:function(W,V){V.service={};this.readChildNodes(W,V.service)},Fees:function(X,V){var W=this.getChildValue(X);if(W&&W.toLowerCase()!="none"){V.fees=W}},AccessConstraints:function(W,V){var X=this.getChildValue(W);if(X&&X.toLowerCase()!="none"){V.accessConstraints=X}},OnlineResource:function(X,V){var W=this.getChildValue(X);if(W&&W.toLowerCase()!="none"){V.onlineResource=W}},Keywords:function(X,V){var W=this.getChildValue(X);if(W&&W.toLowerCase()!="none"){V.keywords=W.split(", ")}},Capability:function(W,V){V.capability={};this.readChildNodes(W,V.capability)},Request:function(V,W){W.request={};this.readChildNodes(V,W.request)},GetFeature:function(W,V){V.getfeature={href:{},formats:[]};this.readChildNodes(W,V.getfeature)},ResultFormat:function(Y,Z){var X=Y.childNodes;var W;for(var V=0;V<X.length;V++){W=X[V];if(W.nodeType==1){Z.formats.push(W.nodeName)}}},DCPType:function(V,W){this.readChildNodes(V,W)},HTTP:function(V,W){this.readChildNodes(V,W.href)},Get:function(V,W){W.get=V.getAttribute("onlineResource")},Post:function(V,W){W.post=V.getAttribute("onlineResource")},SRS:function(W,X){var V=this.getChildValue(W);if(V){X.srs=V}}},B.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});B.Format.WFSCapabilities.v1_1_0=B.Class(B.Format.WFSCapabilities.v1,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{wfs:B.Util.applyDefaults({DefaultSRS:function(W,X){var V=this.getChildValue(W);if(V){X.srs=V}}},B.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:B.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});B.Format.WFSDescribeFeatureType=B.Class(B.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(Y,ad){var Z=[];var W={};var aa={complexTypes:Z,customTypes:W};this.readChildNodes(Y,aa);var ab=Y.attributes;var af,V;for(var ac=0,ae=ab.length;ac<ae;++ac){af=ab[ac];V=af.name;if(V.indexOf("xmlns")==0){this.setNamespace(V.split(":")[1]||"",af.value)}else{ad[V]=af.value}}ad.featureTypes=Z;ad.targetPrefix=this.namespaceAlias[ad.targetNamespace];var ag,X;for(var ac=0,ae=Z.length;ac<ae;++ac){ag=Z[ac];X=W[ag.typeName];if(W[ag.typeName]){ag.typeName=X.name}}},complexType:function(W,X){var V={typeName:W.getAttribute("name")};this.readChildNodes(W,V);X.complexTypes.push(V)},complexContent:function(V,W){this.readChildNodes(V,W)},extension:function(V,W){this.readChildNodes(V,W)},sequence:function(V,W){var X={elements:[]};this.readChildNodes(V,X);W.properties=X.elements},element:function(V,X){if(X.elements){var Y={};var W=V.attributes;var ab;for(var Z=0,aa=W.length;Z<aa;++Z){ab=W[Z];Y[ab.name]=ab.value}var ac=Y.type;if(!ac){ac={};this.readChildNodes(V,ac);Y.restriction=ac;Y.type=ac.base}var ae=ac.base||ac;Y.localType=ae.split(":").pop();X.elements.push(Y)}if(X.complexTypes){var ac=V.getAttribute("type");var ad=ac.split(":").pop();X.customTypes[ad]={name:V.getAttribute("name"),type:ac}}},simpleType:function(V,W){this.readChildNodes(V,W)},restriction:function(V,W){W.base=V.getAttribute("base");this.readRestriction(V,W)}}},readRestriction:function(Y,aa){var X=Y.childNodes;var ac,ab,Z;for(var W=0,V=X.length;W<V;++W){ac=X[W];if(ac.nodeType==1){ab=ac.nodeName.split(":").pop();Z=ac.getAttribute("value");if(!aa[ab]){aa[ab]=Z}else{if(typeof aa[ab]=="string"){aa[ab]=[aa[ab]]}aa[ab].push(Z)}}}},read:function(W){if(typeof W=="string"){W=B.Format.XML.prototype.read.apply(this,[W])}if(W&&W.nodeType==9){W=W.documentElement}var V={};this.readNode(W,V);return V},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});B.Format.WMSDescribeLayer=B.Class(B.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",getVersion:function(W,X){var V=B.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);if(V=="1.1.1"||V=="1.1.0"){V="1.1"}return V},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});B.Format.WMSDescribeLayer.v1_1=B.Class(B.Format.WMSDescribeLayer,{initialize:function(V){B.Format.WMSDescribeLayer.prototype.initialize.apply(this,[V])},read:function(Y){if(typeof Y=="string"){Y=B.Format.XML.prototype.read.apply(this,[Y])}var ad=Y.documentElement;var W=ad.childNodes;var aa=[];var V,ag;for(var Z=0;Z<W.length;++Z){V=W[Z];ag=V.nodeName;if(ag=="LayerDescription"){var ab=V.getAttribute("name");var af="";var X="";var ae="";if(V.getAttribute("owsType")){af=V.getAttribute("owsType");X=V.getAttribute("owsURL")}else{if(V.getAttribute("wfs")!=""){af="WFS";X=V.getAttribute("wfs")}else{if(V.getAttribute("wcs")!=""){af="WCS";X=V.getAttribute("wcs")}}}var ac=V.getElementsByTagName("Query");if(ac.length>0){ae=ac[0].getAttribute("typeName");if(!ae){ae=ac[0].getAttribute("typename")}}aa.push({layerName:ab,owsType:af,owsURL:X,typeName:ae})}}return aa},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"});B.Format.OSM=B.Class(B.Format.XML,{checkTags:false,interestingTagsExclude:null,areaTags:null,initialize:function(V){var Y={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};Y=B.Util.extend(Y,V);var Z={};for(var W=0;W<Y.interestingTagsExclude.length;W++){Z[Y.interestingTagsExclude[W]]=true}Y.interestingTagsExclude=Z;var X={};for(var W=0;W<Y.areaTags.length;W++){X[Y.areaTags[W]]=true}Y.areaTags=X;this.externalProjection=new B.Projection("EPSG:4326");B.Format.XML.prototype.initialize.apply(this,[Y])},read:function(ag){if(typeof ag=="string"){ag=B.Format.XML.prototype.read.apply(this,[ag])}var W=this.getNodes(ag);var ah=this.getWays(ag);var ab=new Array(ah.length);for(var aa=0;aa<ah.length;aa++){var ae=new Array(ah[aa].nodes.length);var V=this.isWayArea(ah[aa])?1:0;for(var Z=0;Z<ah[aa].nodes.length;Z++){var X=W[ah[aa].nodes[Z]];var af=new B.Geometry.Point(X.lon,X.lat);af.osm_id=parseInt(ah[aa].nodes[Z]);ae[Z]=af;X.used=true}var ad=null;if(V){ad=new B.Geometry.Polygon(new B.Geometry.LinearRing(ae))}else{ad=new B.Geometry.LineString(ae)}if(this.internalProjection&&this.externalProjection){ad.transform(this.externalProjection,this.internalProjection)}var ac=new B.Feature.Vector(ad,ah[aa].tags);ac.osm_id=parseInt(ah[aa].id);ac.fid="way."+ac.osm_id;ab[aa]=ac}for(var Y in W){var X=W[Y];if(!X.used||this.checkTags){var aj=null;if(this.checkTags){var ai=this.getTags(X.node,true);if(X.used&&!ai[1]){continue}aj=ai[0]}else{aj=this.getTags(X.node)}var ac=new B.Feature.Vector(new B.Geometry.Point(X.lon,X.lat),aj);if(this.internalProjection&&this.externalProjection){ac.geometry.transform(this.externalProjection,this.internalProjection)}ac.osm_id=parseInt(Y);ac.fid="node."+ac.osm_id;ab.push(ac)}X.node=null}return ab},getNodes:function(Z){var Y=Z.getElementsByTagName("node");var V={};for(var W=0;W<Y.length;W++){var X=Y[W];var aa=X.getAttribute("id");V[aa]={lat:X.getAttribute("lat"),lon:X.getAttribute("lon"),node:X}}return V},getWays:function(ab){var aa=ab.getElementsByTagName("way");var ac=[];for(var Y=0;Y<aa.length;Y++){var W=aa[Y];var X={id:W.getAttribute("id")};X.tags=this.getTags(W);var Z=W.getElementsByTagName("nd");X.nodes=new Array(Z.length);for(var V=0;V<Z.length;V++){X.nodes[V]=Z[V].getAttribute("ref")}ac.push(X)}return ac},getTags:function(Z,ab){var V=Z.getElementsByTagName("tag");var X={};var aa=false;for(var W=0;W<V.length;W++){var Y=V[W].getAttribute("k");X[Y]=V[W].getAttribute("v");if(ab){if(!this.interestingTagsExclude[Y]){aa=true}}}return ab?[X,aa]:X},isWayArea:function(W){var V=false;var Y=false;if(W.nodes[0]==W.nodes[W.nodes.length-1]){V=true}if(this.checkTags){for(var X in W.tags){if(this.areaTags[X]){Y=true;break}}}return V&&(this.checkTags?Y:true)},write:function(Y){if(!(B.Util.isArray(Y))){Y=[Y]}this.osm_id=1;this.created_nodes={};var Z=this.createElementNS(null,"osm");Z.setAttribute("version","0.5");Z.setAttribute("generator","OpenLayers "+B.VERSION_NUMBER);for(var X=Y.length-1;X>=0;X--){var V=this.createFeatureNodes(Y[X]);for(var W=0;W<V.length;W++){Z.appendChild(V[W])}}return B.Format.XML.prototype.write.apply(this,[Z])},createFeatureNodes:function(X){var W=[];var Z=X.geometry.CLASS_NAME;var Y=Z.substring(Z.lastIndexOf(".")+1);Y=Y.toLowerCase();var V=this.createXML[Y];if(V){W=V.apply(this,[X])}return W},createXML:{point:function(V){var Z=null;var X=V.geometry?V.geometry:V;if(this.internalProjection&&this.externalProjection){X=X.clone();X.transform(this.internalProjection,this.externalProjection)}var Y=false;if(V.osm_id){Z=V.osm_id;if(this.created_nodes[Z]){Y=true}}else{Z=-this.osm_id;this.osm_id++}if(Y){W=this.created_nodes[Z]}else{var W=this.createElementNS(null,"node")}this.created_nodes[Z]=W;W.setAttribute("id",Z);W.setAttribute("lon",X.x);W.setAttribute("lat",X.y);if(V.attributes){this.serializeTags(V,W)}this.setState(V,W);return Y?[]:[W]},linestring:function(ad){var W;var V=[];var aa=ad.geometry;if(ad.osm_id){W=ad.osm_id}else{W=-this.osm_id;this.osm_id++}var ac=this.createElementNS(null,"way");ac.setAttribute("id",W);for(var Y=0;Y<aa.components.length;Y++){var X=this.createXML.point.apply(this,[aa.components[Y]]);if(X.length){X=X[0];var ab=X.getAttribute("id");V.push(X)}else{ab=aa.components[Y].osm_id;X=this.created_nodes[ab]}this.setState(ad,X);var Z=this.createElementNS(null,"nd");Z.setAttribute("ref",ab);ac.appendChild(Z)}this.serializeTags(ad,ac);V.push(ac);return V},polygon:function(W){var V=B.Util.extend({area:"yes"},W.attributes);var X=new B.Feature.Vector(W.geometry.components[0],V);X.osm_id=W.osm_id;return this.createXML.linestring.apply(this,[X])}},serializeTags:function(X,Y){for(var W in X.attributes){var V=this.createElementNS(null,"tag");V.setAttribute("k",W);V.setAttribute("v",X.attributes[W]);Y.appendChild(V)}},setState:function(V,W){if(V.state){var X=null;switch(V.state){case B.State.UPDATE:X="modify";case B.State.DELETE:X="delete"}if(X){W.setAttribute("action",X)}}},CLASS_NAME:"OpenLayers.Format.OSM"});B.Format.Filter=B.Class(B.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});B.Format.Filter.v1=B.Class(B.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(V){B.Format.XML.prototype.initialize.apply(this,[V])},read:function(V){var W={};this.readers.ogc.Filter.apply(this,[V,W]);return W.filter},readers:{ogc:{_expression:function(V){var X,W="";for(var Y=V.firstChild;Y;Y=Y.nextSibling){switch(Y.nodeType){case 1:X=this.readNode(Y);if(X.property){W+="${"+X.property+"}"}else{if(X.value!==undefined){W+=X.value}}break;case 3:case 4:W+=Y.nodeValue}}return W},Filter:function(W,V){var X={fids:[],filters:[]};this.readChildNodes(W,X);if(X.fids.length>0){V.filter=new B.Filter.FeatureId({fids:X.fids})}else{if(X.filters.length>0){V.filter=X.filters[0]}}},FeatureId:function(V,W){var X=V.getAttribute("fid");if(X){W.fids.push(X)}},And:function(W,X){var V=new B.Filter.Logical({type:B.Filter.Logical.AND});this.readChildNodes(W,V);X.filters.push(V)},Or:function(W,X){var V=new B.Filter.Logical({type:B.Filter.Logical.OR});this.readChildNodes(W,V);X.filters.push(V)},Not:function(W,X){var V=new B.Filter.Logical({type:B.Filter.Logical.NOT});this.readChildNodes(W,V);X.filters.push(V)},PropertyIsLessThan:function(W,X){var V=new B.Filter.Comparison({type:B.Filter.Comparison.LESS_THAN});this.readChildNodes(W,V);X.filters.push(V)},PropertyIsGreaterThan:function(W,X){var V=new B.Filter.Comparison({type:B.Filter.Comparison.GREATER_THAN});this.readChildNodes(W,V);X.filters.push(V)},PropertyIsLessThanOrEqualTo:function(W,X){var V=new B.Filter.Comparison({type:B.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(W,V);X.filters.push(V)},PropertyIsGreaterThanOrEqualTo:function(W,X){var V=new B.Filter.Comparison({type:B.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(W,V);X.filters.push(V)},PropertyIsBetween:function(W,X){var V=new B.Filter.Comparison({type:B.Filter.Comparison.BETWEEN});this.readChildNodes(W,V);X.filters.push(V)},Literal:function(V,W){W.value=B.String.numericIf(this.getChildValue(V))},PropertyName:function(W,V){V.property=this.getChildValue(W)},LowerBoundary:function(W,V){V.lowerBoundary=B.String.numericIf(this.readers.ogc._expression.call(this,W))},UpperBoundary:function(W,V){V.upperBoundary=B.String.numericIf(this.readers.ogc._expression.call(this,W))},Intersects:function(V,W){this.readSpatial(V,W,B.Filter.Spatial.INTERSECTS)},Within:function(V,W){this.readSpatial(V,W,B.Filter.Spatial.WITHIN)},Contains:function(V,W){this.readSpatial(V,W,B.Filter.Spatial.CONTAINS)},DWithin:function(V,W){this.readSpatial(V,W,B.Filter.Spatial.DWITHIN)},Distance:function(V,W){W.distance=parseInt(this.getChildValue(V));W.distanceUnits=V.getAttribute("units")},Function:function(V,W){return}}},readSpatial:function(X,Y,W){var V=new B.Filter.Spatial({type:W});this.readChildNodes(X,V);V.value=V.components[0];delete V.components;Y.filters.push(V)},writeOgcExpression:function(W,V){if(W instanceof B.Filter.Function){var X=this.writeNode("Function",W,V);V.appendChild(X)}else{this.writeNode("Literal",W,V)}return V},write:function(V){return this.writers.ogc.Filter.apply(this,[V])},writeFeatureIdNodes:function(X,Y){for(var V=0,W=X.fids.length;V<W;++V){this.writeNode("FeatureId",X.fids[V],Y)}},writers:{ogc:{Filter:function(V){var W=this.createElementNSPlus("ogc:Filter");if(V.type==="FID"){B.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,V,W)}else{this.writeNode(this.getFilterType(V),V,W)}return W},FeatureId:function(V){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:V}})},And:function(Y){var Z=this.createElementNSPlus("ogc:And");var X;for(var V=0,W=Y.filters.length;V<W;++V){X=Y.filters[V];if(X.type==="FID"){B.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,X,Z)}else{this.writeNode(this.getFilterType(X),X,Z)}}return Z},Or:function(Y){var Z=this.createElementNSPlus("ogc:Or");var X;for(var V=0,W=Y.filters.length;V<W;++V){X=Y.filters[V];if(X.type==="FID"){B.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,X,Z)}else{this.writeNode(this.getFilterType(X),X,Z)}}return Z},Not:function(W){var X=this.createElementNSPlus("ogc:Not");var V=W.filters[0];if(V.type==="FID"){B.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,V,X)}else{this.writeNode(this.getFilterType(V),V,X)}return X},PropertyIsLessThan:function(V){var W=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsGreaterThan:function(V){var W=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsLessThanOrEqualTo:function(V){var W=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsGreaterThanOrEqualTo:function(V){var W=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsBetween:function(V){var W=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",V,W);this.writeNode("LowerBoundary",V,W);this.writeNode("UpperBoundary",V,W);return W},PropertyName:function(V){return this.createElementNSPlus("ogc:PropertyName",{value:V.property})},Literal:function(V){return this.createElementNSPlus("ogc:Literal",{value:V})},LowerBoundary:function(V){var W=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(V.lowerBoundary,W);return W},UpperBoundary:function(V){var W=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",V.upperBoundary,W);return W},INTERSECTS:function(V){return this.writeSpatial(V,"Intersects")},WITHIN:function(V){return this.writeSpatial(V,"Within")},CONTAINS:function(V){return this.writeSpatial(V,"Contains")},DWITHIN:function(V){var W=this.writeSpatial(V,"DWithin");this.writeNode("Distance",V,W);return W},Distance:function(V){return this.createElementNSPlus("ogc:Distance",{attributes:{units:V.distanceUnits},value:V.distance})},Function:function(X){var Y=this.createElementNSPlus("ogc:Function",{attributes:{name:X.name}});var Z=X.params;for(var W=0,V=Z.length;W<V;W++){this.writeOgcExpression(Z[W],Y)}return Y}}},getFilterType:function(V){var W=this.filterMap[V.type];if(!W){throw"Filter writing not supported for rule type: "+V.type}return W},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});B.Format.Filter.v1_0_0=B.Class(B.Format.GML.v2,B.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(V){B.Format.GML.v2.prototype.initialize.apply(this,[V])},readers:{ogc:B.Util.applyDefaults({PropertyIsEqualTo:function(W,X){var V=new B.Filter.Comparison({type:B.Filter.Comparison.EQUAL_TO});this.readChildNodes(W,V);X.filters.push(V)},PropertyIsNotEqualTo:function(W,X){var V=new B.Filter.Comparison({type:B.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(W,V);X.filters.push(V)},PropertyIsLike:function(Y,Z){var X=new B.Filter.Comparison({type:B.Filter.Comparison.LIKE});this.readChildNodes(Y,X);var aa=Y.getAttribute("wildCard");var W=Y.getAttribute("singleChar");var V=Y.getAttribute("escape");X.value2regex(aa,W,V);Z.filters.push(X)}},B.Format.Filter.v1.prototype.readers.ogc),gml:B.Format.GML.v2.prototype.readers.gml,feature:B.Format.GML.v2.prototype.readers.feature},writers:{ogc:B.Util.applyDefaults({PropertyIsEqualTo:function(V){var W=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsNotEqualTo:function(V){var W=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsLike:function(V){var W=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",V,W);this.writeNode("Literal",V.regex2value(),W);return W},BBOX:function(V){var X=this.createElementNSPlus("ogc:BBOX");V.property&&this.writeNode("PropertyName",V,X);var W=this.writeNode("gml:Box",V.value,X);if(V.projection){W.setAttribute("srsName",V.projection)}return X}},B.Format.Filter.v1.prototype.writers.ogc),gml:B.Format.GML.v2.prototype.writers.gml,feature:B.Format.GML.v2.prototype.writers.feature},writeSpatial:function(W,V){var X=this.createElementNSPlus("ogc:"+V);this.writeNode("PropertyName",W,X);if(W.value instanceof B.Filter.Function){this.writeNode("Function",W.value,X)}else{var Y;if(W.value instanceof B.Geometry){Y=this.writeNode("feature:_geometry",W.value).firstChild}else{Y=this.writeNode("gml:Box",W.value)}if(W.projection){Y.setAttribute("srsName",W.projection)}X.appendChild(Y)}return X},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});B.Format.Filter.v1_1_0=B.Class(B.Format.GML.v3,B.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(V){B.Format.GML.v3.prototype.initialize.apply(this,[V])},readers:{ogc:B.Util.applyDefaults({PropertyIsEqualTo:function(W,Y){var X=W.getAttribute("matchCase");var V=new B.Filter.Comparison({type:B.Filter.Comparison.EQUAL_TO,matchCase:!(X==="false"||X==="0")});this.readChildNodes(W,V);Y.filters.push(V)},PropertyIsNotEqualTo:function(W,Y){var X=W.getAttribute("matchCase");var V=new B.Filter.Comparison({type:B.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(X==="false"||X==="0")});this.readChildNodes(W,V);Y.filters.push(V)},PropertyIsLike:function(Y,Z){var X=new B.Filter.Comparison({type:B.Filter.Comparison.LIKE});this.readChildNodes(Y,X);var aa=Y.getAttribute("wildCard");var W=Y.getAttribute("singleChar");var V=Y.getAttribute("escapeChar");X.value2regex(aa,W,V);Z.filters.push(X)}},B.Format.Filter.v1.prototype.readers.ogc),gml:B.Format.GML.v3.prototype.readers.gml,feature:B.Format.GML.v3.prototype.readers.feature},writers:{ogc:B.Util.applyDefaults({PropertyIsEqualTo:function(V){var W=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:V.matchCase}});this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsNotEqualTo:function(V){var W=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:V.matchCase}});this.writeNode("PropertyName",V,W);this.writeOgcExpression(V.value,W);return W},PropertyIsLike:function(V){var W=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:V.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",V,W);this.writeNode("Literal",V.regex2value(),W);return W},BBOX:function(V){var X=this.createElementNSPlus("ogc:BBOX");V.property&&this.writeNode("PropertyName",V,X);var W=this.writeNode("gml:Envelope",V.value);if(V.projection){W.setAttribute("srsName",V.projection)}X.appendChild(W);return X},SortBy:function(Y){var X=this.createElementNSPlus("ogc:SortBy");for(var W=0,V=Y.length;W<V;W++){this.writeNode("ogc:SortProperty",Y[W],X)}return X},SortProperty:function(W){var V=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",W,V);this.writeNode("ogc:SortOrder",(W.order=="DESC")?"DESC":"ASC",V);return V},SortOrder:function(W){var V=this.createElementNSPlus("ogc:SortOrder",{value:W});return V}},B.Format.Filter.v1.prototype.writers.ogc),gml:B.Format.GML.v3.prototype.writers.gml,feature:B.Format.GML.v3.prototype.writers.feature},writeSpatial:function(W,V){var X=this.createElementNSPlus("ogc:"+V);this.writeNode("PropertyName",W,X);if(W.value instanceof B.Filter.Function){this.writeNode("Function",W.value,X)}else{var Y;if(W.value instanceof B.Geometry){Y=this.writeNode("feature:_geometry",W.value).firstChild}else{Y=this.writeNode("gml:Envelope",W.value)}if(W.projection){Y.setAttribute("srsName",W.projection)}X.appendChild(Y)}return X},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});B.Format.SLD=B.Class(B.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:true,namedLayersAsArray:false,CLASS_NAME:"OpenLayers.Format.SLD"});B.Format.SLD.v1=B.Class(B.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:false,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(X,V){V=B.Util.applyDefaults(V,this.options);var W={namedLayers:V.namedLayersAsArray===true?[]:{}};this.readChildNodes(X,W);return W},readers:B.Util.applyDefaults({sld:{StyledLayerDescriptor:function(V,W){W.version=V.getAttribute("version");this.readChildNodes(V,W)},Name:function(V,W){W.name=this.getChildValue(V)},Title:function(V,W){W.title=this.getChildValue(V)},Abstract:function(V,W){W.description=this.getChildValue(V)},NamedLayer:function(Y,Z){var X={userStyles:[],namedStyles:[]};this.readChildNodes(Y,X);for(var W=0,V=X.userStyles.length;W<V;++W){X.userStyles[W].layerName=X.name}if(B.Util.isArray(Z.namedLayers)){Z.namedLayers.push(X)}else{Z.namedLayers[X.name]=X}},NamedStyle:function(W,V){V.namedStyles.push(this.getChildName(W.firstChild))},UserStyle:function(X,V){var Y={defaultsPerSymbolizer:true,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(X,Y);var W;if(this.multipleSymbolizers){delete Y.defaultsPerSymbolizer;W=new B.Style2(Y)}else{W=new B.Style(this.defaultSymbolizer,Y)}V.userStyles.push(W)},IsDefault:function(W,V){if(this.getChildValue(W)=="1"){V.isDefault=true}},FeatureTypeStyle:function(W,V){++this.featureTypeCounter;var X={rules:this.multipleSymbolizers?V.rules:[]};this.readChildNodes(W,X);if(!this.multipleSymbolizers){V.rules=X.rules}},Rule:function(W,Y){var V;if(this.multipleSymbolizers){V={symbolizers:[]}}var X=new B.Rule(V);this.readChildNodes(W,X);Y.rules.push(X)},ElseFilter:function(V,W){W.elseFilter=true},MinScaleDenominator:function(V,W){W.minScaleDenominator=parseFloat(this.getChildValue(V))},MaxScaleDenominator:function(V,W){W.maxScaleDenominator=parseFloat(this.getChildValue(V))},TextSymbolizer:function(W,X){var V={};this.readChildNodes(W,V);if(this.multipleSymbolizers){V.zIndex=this.featureTypeCounter;X.symbolizers.push(new B.Symbolizer.Text(V))}else{X.symbolizer.Text=B.Util.applyDefaults(V,X.symbolizer.Text)}},LabelPlacement:function(W,V){this.readChildNodes(W,V)},PointPlacement:function(Z,Y){var W={};this.readChildNodes(Z,W);W.labelRotation=W.rotation;delete W.rotation;var X,V=Y.labelAnchorPointX,aa=Y.labelAnchorPointY;if(V<=1/3){X="l"}else{if(V>1/3&&V<2/3){X="c"}else{if(V>=2/3){X="r"}}}if(aa<=1/3){X+="b"}else{if(aa>1/3&&aa<2/3){X+="m"}else{if(aa>=2/3){X+="t"}}}W.labelAlign=X;B.Util.applyDefaults(Y,W)},AnchorPoint:function(W,V){this.readChildNodes(W,V)},AnchorPointX:function(X,W){var V=this.readers.ogc._expression.call(this,X);if(V){W.labelAnchorPointX=V}},AnchorPointY:function(X,W){var V=this.readers.ogc._expression.call(this,X);if(V){W.labelAnchorPointY=V}},Displacement:function(W,V){this.readChildNodes(W,V)},DisplacementX:function(X,W){var V=this.readers.ogc._expression.call(this,X);if(V){W.labelXOffset=V}},DisplacementY:function(X,V){var W=this.readers.ogc._expression.call(this,X);if(W){V.labelYOffset=W}},LinePlacement:function(W,V){this.readChildNodes(W,V)},PerpendicularOffset:function(W,V){var X=this.readers.ogc._expression.call(this,W);if(X){V.labelPerpendicularOffset=X}},Label:function(W,V){var X=this.readers.ogc._expression.call(this,W);if(X){V.label=X}},Font:function(W,V){this.readChildNodes(W,V)},Halo:function(W,V){var X={};this.readChildNodes(W,X);V.haloRadius=X.haloRadius;V.haloColor=X.fillColor;V.haloOpacity=X.fillOpacity},Radius:function(X,W){var V=this.readers.ogc._expression.call(this,X);if(V!=null){W.haloRadius=V}},RasterSymbolizer:function(W,X){var V={};this.readChildNodes(W,V);if(this.multipleSymbolizers){V.zIndex=this.featureTypeCounter;X.symbolizers.push(new B.Symbolizer.Raster(V))}else{X.symbolizer.Raster=B.Util.applyDefaults(V,X.symbolizer.Raster)}},Geometry:function(V,W){W.geometry={};this.readChildNodes(V,W.geometry)},ColorMap:function(W,V){V.colorMap=[];this.readChildNodes(W,V.colorMap)},ColorMapEntry:function(W,V){var X=W.getAttribute("quantity");var Y=W.getAttribute("opacity");V.push({color:W.getAttribute("color"),quantity:X!==null?parseFloat(X):undefined,label:W.getAttribute("label")||undefined,opacity:Y!==null?parseFloat(Y):undefined})},LineSymbolizer:function(W,X){var V={};this.readChildNodes(W,V);if(this.multipleSymbolizers){V.zIndex=this.featureTypeCounter;X.symbolizers.push(new B.Symbolizer.Line(V))}else{X.symbolizer.Line=B.Util.applyDefaults(V,X.symbolizer.Line)}},PolygonSymbolizer:function(W,X){var V={fill:false,stroke:false};if(!this.multipleSymbolizers){V=X.symbolizer.Polygon||V}this.readChildNodes(W,V);if(this.multipleSymbolizers){V.zIndex=this.featureTypeCounter;X.symbolizers.push(new B.Symbolizer.Polygon(V))}else{X.symbolizer.Polygon=V}},PointSymbolizer:function(W,X){var V={fill:false,stroke:false,graphic:false};if(!this.multipleSymbolizers){V=X.symbolizer.Point||V}this.readChildNodes(W,V);if(this.multipleSymbolizers){V.zIndex=this.featureTypeCounter;X.symbolizers.push(new B.Symbolizer.Point(V))}else{X.symbolizer.Point=V}},Stroke:function(W,V){V.stroke=true;this.readChildNodes(W,V)},Fill:function(W,V){V.fill=true;this.readChildNodes(W,V)},CssParameter:function(X,W){var V=X.getAttribute("name");var Z=this.cssMap[V];if(W.label){if(V==="fill"){Z="fontColor"}else{if(V==="fill-opacity"){Z="fontOpacity"}}}if(Z){var Y=this.readers.ogc._expression.call(this,X);if(Y){W[Z]=Y}}},Graphic:function(X,ad){ad.graphic=true;var V={};this.readChildNodes(X,V);var aa=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var W,ac;for(var Y=0,Z=aa.length;Y<Z;++Y){W=aa[Y];ac=V[W];if(ac!=undefined){ad[W]=ac}}if(V.opacity!=undefined){ad.graphicOpacity=V.opacity}if(V.size!=undefined){var ab=V.size/2;if(isNaN(ab)){ad.graphicWidth=V.size}else{ad.pointRadius=V.size/2}}if(V.href!=undefined){ad.externalGraphic=V.href}if(V.rotation!=undefined){ad.rotation=V.rotation}},ExternalGraphic:function(V,W){this.readChildNodes(V,W)},Mark:function(V,W){this.readChildNodes(V,W)},WellKnownName:function(V,W){W.graphicName=this.getChildValue(V)},Opacity:function(W,X){var V=this.readers.ogc._expression.call(this,W);if(V){X.opacity=V}},Size:function(W,X){var V=this.readers.ogc._expression.call(this,W);if(V){X.size=V}},Rotation:function(W,X){var V=this.readers.ogc._expression.call(this,W);if(V){X.rotation=V}},OnlineResource:function(V,W){W.href=this.getAttributeNS(V,this.namespaces.xlink,"href")},Format:function(V,W){W.graphicFormat=this.getChildValue(V)}}},B.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(V){var W=null;for(var X in this.cssMap){if(this.cssMap[X]==V){W=X;break}}return W},getGraphicFormat:function(V){var Y,X;for(var W in this.graphicFormats){if(this.graphicFormats[W].test(V)){Y=W;break}}return Y||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(V){return this.writers.sld.StyledLayerDescriptor.apply(this,[V])},writers:B.Util.applyDefaults({sld:{_OGCExpression:function(ac,aa){var Z=this.createElementNSPlus(ac);var ab=typeof aa=="string"?aa.split("${"):[aa];Z.appendChild(this.createTextNode(ab[0]));var Y,X;for(var W=1,V=ab.length;W<V;W++){Y=ab[W];X=Y.indexOf("}");if(X>0){this.writeNode("ogc:PropertyName",{property:Y.substring(0,X)},Z);Z.appendChild(this.createTextNode(Y.substring(++X)))}else{Z.appendChild(this.createTextNode("${"+Y))}}return Z},StyledLayerDescriptor:function(Z){var W=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});W.setAttribute("xmlns:ogc",this.namespaces.ogc);W.setAttribute("xmlns:gml",this.namespaces.gml);if(Z.name){this.writeNode("Name",Z.name,W)}if(Z.title){this.writeNode("Title",Z.title,W)}if(Z.description){this.writeNode("Abstract",Z.description,W)}if(B.Util.isArray(Z.namedLayers)){for(var Y=0,V=Z.namedLayers.length;Y<V;++Y){this.writeNode("NamedLayer",Z.namedLayers[Y],W)}}else{for(var X in Z.namedLayers){this.writeNode("NamedLayer",Z.namedLayers[X],W)}}return W},Name:function(V){return this.createElementNSPlus("sld:Name",{value:V})},Title:function(V){return this.createElementNSPlus("sld:Title",{value:V})},Abstract:function(V){return this.createElementNSPlus("sld:Abstract",{value:V})},NamedLayer:function(X){var Y=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",X.name,Y);if(X.namedStyles){for(var W=0,V=X.namedStyles.length;W<V;++W){this.writeNode("NamedStyle",X.namedStyles[W],Y)}}if(X.userStyles){for(var W=0,V=X.userStyles.length;W<V;++W){this.writeNode("UserStyle",X.userStyles[W],Y)}}return Y},NamedStyle:function(V){var W=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",V,W);return W},UserStyle:function(W){var Y=this.createElementNSPlus("sld:UserStyle");if(W.name){this.writeNode("Name",W.name,Y)}if(W.title){this.writeNode("Title",W.title,Y)}if(W.description){this.writeNode("Abstract",W.description,Y)}if(W.isDefault){this.writeNode("IsDefault",W.isDefault,Y)}if(this.multipleSymbolizers&&W.rules){var af={0:[]};var X=[0];var ae,V,ai,ad,ac;for(var aa=0,ah=W.rules.length;aa<ah;++aa){ae=W.rules[aa];if(ae.symbolizers){V={};for(var Z=0,ab=ae.symbolizers.length;Z<ab;++Z){ai=ae.symbolizers[Z];ad=ai.zIndex;if(!(ad in V)){ac=ae.clone();ac.symbolizers=[];V[ad]=ac}V[ad].symbolizers.push(ai.clone())}for(ad in V){if(!(ad in af)){X.push(ad);af[ad]=[]}af[ad].push(V[ad])}}else{af[0].push(ae.clone())}}X.sort();var ag;for(var aa=0,ah=X.length;aa<ah;++aa){ag=af[X[aa]];if(ag.length>0){ac=W.clone();ac.rules=af[X[aa]];this.writeNode("FeatureTypeStyle",ac,Y)}}}else{this.writeNode("FeatureTypeStyle",W,Y)}return Y},IsDefault:function(V){return this.createElementNSPlus("sld:IsDefault",{value:(V)?"1":"0"})},FeatureTypeStyle:function(X){var Y=this.createElementNSPlus("sld:FeatureTypeStyle");for(var W=0,V=X.rules.length;W<V;++W){this.writeNode("Rule",X.rules[W],Y)}return Y},Rule:function(ac){var ab=this.createElementNSPlus("sld:Rule");if(ac.name){this.writeNode("Name",ac.name,ab)}if(ac.title){this.writeNode("Title",ac.title,ab)}if(ac.description){this.writeNode("Abstract",ac.description,ab)}if(ac.elseFilter){this.writeNode("ElseFilter",null,ab)}else{if(ac.filter){this.writeNode("ogc:Filter",ac.filter,ab)}}if(ac.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",ac.minScaleDenominator,ab)}if(ac.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",ac.maxScaleDenominator,ab)}var aa,Z;if(this.multipleSymbolizers&&ac.symbolizers){var Z;for(var X=0,Y=ac.symbolizers.length;X<Y;++X){Z=ac.symbolizers[X];aa=Z.CLASS_NAME.split(".").pop();this.writeNode(aa+"Symbolizer",Z,ab)}}else{var W=B.Style.SYMBOLIZER_PREFIXES;for(var X=0,V=W.length;X<V;++X){aa=W[X];Z=ac.symbolizer[aa];if(Z){this.writeNode(aa+"Symbolizer",Z,ab)}}}return ab},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(V){return this.createElementNSPlus("sld:MinScaleDenominator",{value:V})},MaxScaleDenominator:function(V){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:V})},LineSymbolizer:function(V){var W=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",V,W);return W},Stroke:function(V){var W=this.createElementNSPlus("sld:Stroke");if(V.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:V,key:"strokeColor"},W)}if(V.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:V,key:"strokeOpacity"},W)}if(V.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:V,key:"strokeWidth"},W)}if(V.strokeDashstyle!=undefined&&V.strokeDashstyle!=="solid"){this.writeNode("CssParameter",{symbolizer:V,key:"strokeDashstyle"},W)}if(V.strokeLinecap!=undefined){this.writeNode("CssParameter",{symbolizer:V,key:"strokeLinecap"},W)}return W},CssParameter:function(V){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(V.key)},value:V.symbolizer[V.key]})},TextSymbolizer:function(V){var W=this.createElementNSPlus("sld:TextSymbolizer");if(V.label!=null){this.writeNode("Label",V.label,W)}if(V.fontFamily!=null||V.fontSize!=null||V.fontWeight!=null||V.fontStyle!=null){this.writeNode("Font",V,W)}if(V.labelAnchorPointX!=null||V.labelAnchorPointY!=null||V.labelAlign!=null||V.labelXOffset!=null||V.labelYOffset!=null||V.labelRotation!=null||V.labelPerpendicularOffset!=null){this.writeNode("LabelPlacement",V,W)}if(V.haloRadius!=null||V.haloColor!=null||V.haloOpacity!=null){this.writeNode("Halo",V,W)}if(V.fontColor!=null||V.fontOpacity!=null){this.writeNode("Fill",{fillColor:V.fontColor,fillOpacity:V.fontOpacity},W)}return W},LabelPlacement:function(V){var W=this.createElementNSPlus("sld:LabelPlacement");if((V.labelAnchorPointX!=null||V.labelAnchorPointY!=null||V.labelAlign!=null||V.labelXOffset!=null||V.labelYOffset!=null||V.labelRotation!=null)&&V.labelPerpendicularOffset==null){this.writeNode("PointPlacement",V,W)}if(V.labelPerpendicularOffset!=null){this.writeNode("LinePlacement",V,W)}return W},LinePlacement:function(V){var W=this.createElementNSPlus("sld:LinePlacement");this.writeNode("PerpendicularOffset",V.labelPerpendicularOffset,W);return W},PerpendicularOffset:function(V){return this.createElementNSPlus("sld:PerpendicularOffset",{value:V})},PointPlacement:function(V){var W=this.createElementNSPlus("sld:PointPlacement");if(V.labelAnchorPointX!=null||V.labelAnchorPointY!=null||V.labelAlign!=null){this.writeNode("AnchorPoint",V,W)}if(V.labelXOffset!=null||V.labelYOffset!=null){this.writeNode("Displacement",V,W)}if(V.labelRotation!=null){this.writeNode("Rotation",V.labelRotation,W)}return W},AnchorPoint:function(W){var X=this.createElementNSPlus("sld:AnchorPoint");var V=W.labelAnchorPointX,aa=W.labelAnchorPointY;if(V!=null){this.writeNode("AnchorPointX",V,X)}if(aa!=null){this.writeNode("AnchorPointY",aa,X)}if(V==null&&aa==null){var Z=W.labelAlign.substr(0,1),Y=W.labelAlign.substr(1,1);if(Z==="l"){V=0}else{if(Z==="c"){V=0.5}else{if(Z==="r"){V=1}}}if(Y==="b"){aa=0}else{if(Y==="m"){aa=0.5}else{if(Y==="t"){aa=1}}}this.writeNode("AnchorPointX",V,X);this.writeNode("AnchorPointY",aa,X)}return X},AnchorPointX:function(V){return this.createElementNSPlus("sld:AnchorPointX",{value:V})},AnchorPointY:function(V){return this.createElementNSPlus("sld:AnchorPointY",{value:V})},Displacement:function(V){var W=this.createElementNSPlus("sld:Displacement");if(V.labelXOffset!=null){this.writeNode("DisplacementX",V.labelXOffset,W)}if(V.labelYOffset!=null){this.writeNode("DisplacementY",V.labelYOffset,W)}return W},DisplacementX:function(V){return this.createElementNSPlus("sld:DisplacementX",{value:V})},DisplacementY:function(V){return this.createElementNSPlus("sld:DisplacementY",{value:V})},Font:function(V){var W=this.createElementNSPlus("sld:Font");if(V.fontFamily){this.writeNode("CssParameter",{symbolizer:V,key:"fontFamily"},W)}if(V.fontSize){this.writeNode("CssParameter",{symbolizer:V,key:"fontSize"},W)}if(V.fontWeight){this.writeNode("CssParameter",{symbolizer:V,key:"fontWeight"},W)}if(V.fontStyle){this.writeNode("CssParameter",{symbolizer:V,key:"fontStyle"},W)}return W},Label:function(V){return this.writers.sld._OGCExpression.call(this,"sld:Label",V)},Halo:function(V){var W=this.createElementNSPlus("sld:Halo");if(V.haloRadius){this.writeNode("Radius",V.haloRadius,W)}if(V.haloColor||V.haloOpacity){this.writeNode("Fill",{fillColor:V.haloColor,fillOpacity:V.haloOpacity},W)}return W},Radius:function(V){return this.createElementNSPlus("sld:Radius",{value:V})},RasterSymbolizer:function(V){var W=this.createElementNSPlus("sld:RasterSymbolizer");if(V.geometry){this.writeNode("Geometry",V.geometry,W)}if(V.opacity){this.writeNode("Opacity",V.opacity,W)}if(V.colorMap){this.writeNode("ColorMap",V.colorMap,W)}return W},Geometry:function(W){var V=this.createElementNSPlus("sld:Geometry");if(W.property){this.writeNode("ogc:PropertyName",W,V)}return V},ColorMap:function(W){var Y=this.createElementNSPlus("sld:ColorMap");for(var X=0,V=W.length;X<V;++X){this.writeNode("ColorMapEntry",W[X],Y)}return Y},ColorMapEntry:function(W){var X=this.createElementNSPlus("sld:ColorMapEntry");var V=W;X.setAttribute("color",V.color);V.opacity!==undefined&&X.setAttribute("opacity",parseFloat(V.opacity));V.quantity!==undefined&&X.setAttribute("quantity",parseFloat(V.quantity));V.label!==undefined&&X.setAttribute("label",V.label);return X},PolygonSymbolizer:function(V){var W=this.createElementNSPlus("sld:PolygonSymbolizer");if(V.fill!==false){this.writeNode("Fill",V,W)}if(V.stroke!==false){this.writeNode("Stroke",V,W)}return W},Fill:function(V){var W=this.createElementNSPlus("sld:Fill");if(V.fillColor){this.writeNode("CssParameter",{symbolizer:V,key:"fillColor"},W)}if(V.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:V,key:"fillOpacity"},W)}return W},PointSymbolizer:function(V){var W=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",V,W);return W},Graphic:function(V){var W=this.createElementNSPlus("sld:Graphic");if(V.externalGraphic!=undefined){this.writeNode("ExternalGraphic",V,W)}else{this.writeNode("Mark",V,W)}if(V.graphicOpacity!=undefined){this.writeNode("Opacity",V.graphicOpacity,W)}if(V.pointRadius!=undefined){this.writeNode("Size",V.pointRadius*2,W)}else{if(V.graphicWidth!=undefined){this.writeNode("Size",V.graphicWidth,W)}}if(V.rotation!=undefined){this.writeNode("Rotation",V.rotation,W)}return W},ExternalGraphic:function(V){var W=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",V.externalGraphic,W);var X=V.graphicFormat||this.getGraphicFormat(V.externalGraphic);this.writeNode("Format",X,W);return W},Mark:function(V){var W=this.createElementNSPlus("sld:Mark");if(V.graphicName){this.writeNode("WellKnownName",V.graphicName,W)}if(V.fill!==false){this.writeNode("Fill",V,W)}if(V.stroke!==false){this.writeNode("Stroke",V,W)}return W},WellKnownName:function(V){return this.createElementNSPlus("sld:WellKnownName",{value:V})},Opacity:function(V){return this.createElementNSPlus("sld:Opacity",{value:V})},Size:function(V){return this.writers.sld._OGCExpression.call(this,"sld:Size",V)},Rotation:function(V){return this.createElementNSPlus("sld:Rotation",{value:V})},OnlineResource:function(V){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":V}})},Format:function(V){return this.createElementNSPlus("sld:Format",{value:V})}}},B.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});B.Format.SLD.v1_0_0=B.Class(B.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});B.Format.SLD.v1_0_0_GeoServer=B.Class(B.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:B.Util.applyDefaults({sld:B.Util.applyDefaults({Priority:function(V,X){var W=this.readers.ogc._expression.call(this,V);if(W){X.priority=W}},VendorOption:function(V,W){if(!W.vendorOptions){W.vendorOptions={}}W.vendorOptions[V.getAttribute("name")]=this.getChildValue(V)}},B.Format.SLD.v1_0_0.prototype.readers.sld)},B.Format.SLD.v1_0_0.prototype.readers),writers:B.Util.applyDefaults({sld:B.Util.applyDefaults({Priority:function(V){return this.writers.sld._OGCExpression.call(this,"sld:Priority",V)},VendorOption:function(V){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:V.name},value:V.value})},TextSymbolizer:function(W){var V=B.Format.SLD.v1_0_0.prototype.writers;var X=V.sld["TextSymbolizer"].apply(this,arguments);if(W.graphic!==false&&(W.externalGraphic||W.graphicName)){this.writeNode("Graphic",W,X)}if("priority" in W){this.writeNode("Priority",W.priority,X)}return this.addVendorOptions(X,W)},PointSymbolizer:function(W){var V=B.Format.SLD.v1_0_0.prototype.writers;var X=V.sld["PointSymbolizer"].apply(this,arguments);return this.addVendorOptions(X,W)},LineSymbolizer:function(W){var V=B.Format.SLD.v1_0_0.prototype.writers;var X=V.sld["LineSymbolizer"].apply(this,arguments);return this.addVendorOptions(X,W)},PolygonSymbolizer:function(W){var V=B.Format.SLD.v1_0_0.prototype.writers;var X=V.sld["PolygonSymbolizer"].apply(this,arguments);return this.addVendorOptions(X,W)}},B.Format.SLD.v1_0_0.prototype.writers.sld)},B.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(Y,X){var V=X.vendorOptions;if(V){for(var W in X.vendorOptions){this.writeNode("VendorOption",{name:W,value:X.vendorOptions[W]},Y)}}return Y},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});B.Format.OWSCommon=B.Class(B.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(W,X){var V=this.version;if(!V){var Y=W.getAttribute("xmlns:ows");if(Y&&Y.substring(Y.lastIndexOf("/")+1)==="1.1"){V="1.1.0"}if(!V){V=this.defaultVersion}}return V},CLASS_NAME:"OpenLayers.Format.OWSCommon"});B.Format.OWSCommon.v1=B.Class(B.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(W,V){V=B.Util.applyDefaults(V,this.options);var X={};this.readChildNodes(W,X);return X},readers:{ows:{Exception:function(W,X){var V={code:W.getAttribute("exceptionCode"),locator:W.getAttribute("locator"),texts:[]};X.exceptions.push(V);this.readChildNodes(W,V)},ExceptionText:function(W,V){var X=this.getChildValue(W);V.texts.push(X)},ServiceIdentification:function(V,W){W.serviceIdentification={};this.readChildNodes(V,W.serviceIdentification)},Title:function(V,W){W.title=this.getChildValue(V)},Abstract:function(V,W){W["abstract"]=this.getChildValue(V)},Keywords:function(V,W){W.keywords={};this.readChildNodes(V,W.keywords)},Keyword:function(W,V){V[this.getChildValue(W)]=true},ServiceType:function(V,W){W.serviceType={codeSpace:V.getAttribute("codeSpace"),value:this.getChildValue(V)}},ServiceTypeVersion:function(V,W){W.serviceTypeVersion=this.getChildValue(V)},Fees:function(V,W){W.fees=this.getChildValue(V)},AccessConstraints:function(V,W){W.accessConstraints=this.getChildValue(V)},ServiceProvider:function(V,W){W.serviceProvider={};this.readChildNodes(V,W.serviceProvider)},ProviderName:function(V,W){W.providerName=this.getChildValue(V)},ProviderSite:function(V,W){W.providerSite=this.getAttributeNS(V,this.namespaces.xlink,"href")},ServiceContact:function(V,W){W.serviceContact={};this.readChildNodes(V,W.serviceContact)},IndividualName:function(W,V){V.individualName=this.getChildValue(W)},PositionName:function(W,V){V.positionName=this.getChildValue(W)},ContactInfo:function(W,V){V.contactInfo={};this.readChildNodes(W,V.contactInfo)},Phone:function(W,V){V.phone={};this.readChildNodes(W,V.phone)},Voice:function(W,V){V.voice=this.getChildValue(W)},Address:function(W,V){V.address={};this.readChildNodes(W,V.address)},DeliveryPoint:function(W,V){V.deliveryPoint=this.getChildValue(W)},City:function(W,V){V.city=this.getChildValue(W)},AdministrativeArea:function(W,V){V.administrativeArea=this.getChildValue(W)},PostalCode:function(W,V){V.postalCode=this.getChildValue(W)},Country:function(W,V){V.country=this.getChildValue(W)},ElectronicMailAddress:function(W,V){V.electronicMailAddress=this.getChildValue(W)},Role:function(W,V){V.role=this.getChildValue(W)},OperationsMetadata:function(V,W){W.operationsMetadata={};this.readChildNodes(V,W.operationsMetadata)},Operation:function(X,W){var V=X.getAttribute("name");W[V]={};this.readChildNodes(X,W[V])},DCP:function(W,V){V.dcp={};this.readChildNodes(W,V.dcp)},HTTP:function(W,V){V.http={};this.readChildNodes(W,V.http)},Get:function(W,V){if(!V.get){V.get=[]}var X={url:this.getAttributeNS(W,this.namespaces.xlink,"href")};this.readChildNodes(W,X);V.get.push(X)},Post:function(W,V){if(!V.post){V.post=[]}var X={url:this.getAttributeNS(W,this.namespaces.xlink,"href")};this.readChildNodes(W,X);V.post.push(X)},Parameter:function(X,V){if(!V.parameters){V.parameters={}}var W=X.getAttribute("name");V.parameters[W]={};this.readChildNodes(X,V.parameters[W])},Constraint:function(W,X){if(!X.constraints){X.constraints={}}var V=W.getAttribute("name");X.constraints[V]={};this.readChildNodes(W,X.constraints[V])},Value:function(V,W){W[this.getChildValue(V)]=true},OutputFormat:function(V,W){W.formats.push({value:this.getChildValue(V)});this.readChildNodes(V,W)},WGS84BoundingBox:function(W,X){var V={};V.crs=W.getAttribute("crs");if(X.BoundingBox){X.BoundingBox.push(V)}else{X.projection=V.crs;V=X}this.readChildNodes(W,V)},BoundingBox:function(V,W){this.readers.ows["WGS84BoundingBox"].apply(this,[V,W])},LowerCorner:function(W,X){var Y=this.getChildValue(W).replace(this.regExes.trimSpace,"");Y=Y.replace(this.regExes.trimComma,",");var V=Y.split(this.regExes.splitSpace);X.left=V[0];X.bottom=V[1]},UpperCorner:function(W,X){var Y=this.getChildValue(W).replace(this.regExes.trimSpace,"");Y=Y.replace(this.regExes.trimComma,",");var V=Y.split(this.regExes.splitSpace);X.right=V[0];X.top=V[1];X.bounds=new B.Bounds(X.left,X.bottom,X.right,X.top);delete X.left;delete X.bottom;delete X.right;delete X.top},Language:function(V,W){W.language=this.getChildValue(V)}}},writers:{ows:{BoundingBox:function(V){var W=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:V.projection}});this.writeNode("ows:LowerCorner",V,W);this.writeNode("ows:UpperCorner",V,W);return W},LowerCorner:function(V){var W=this.createElementNSPlus("ows:LowerCorner",{value:V.bounds.left+" "+V.bounds.bottom});return W},UpperCorner:function(V){var W=this.createElementNSPlus("ows:UpperCorner",{value:V.bounds.right+" "+V.bounds.top});return W},Identifier:function(V){var W=this.createElementNSPlus("ows:Identifier",{value:V});return W},Title:function(W){var V=this.createElementNSPlus("ows:Title",{value:W});return V},Abstract:function(V){var W=this.createElementNSPlus("ows:Abstract",{value:V});return W},OutputFormat:function(W){var V=this.createElementNSPlus("ows:OutputFormat",{value:W});return V}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});B.Format.OWSCommon.v1_0_0=B.Class(B.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:B.Util.applyDefaults({ExceptionReport:function(V,W){W.success=false;W.exceptionReport={version:V.getAttribute("version"),language:V.getAttribute("language"),exceptions:[]};this.readChildNodes(V,W.exceptionReport)}},B.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:B.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});B.Format.OWSCommon.v1_1_0=B.Class(B.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:B.Util.applyDefaults({ExceptionReport:function(V,W){W.exceptionReport={version:V.getAttribute("version"),language:V.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(V,W.exceptionReport)},AllowedValues:function(V,W){W.allowedValues={};this.readChildNodes(V,W.allowedValues)},AnyValue:function(V,W){W.anyValue=true},DataType:function(V,W){W.dataType=this.getChildValue(V)},Range:function(V,W){W.range={};this.readChildNodes(V,W.range)},MinimumValue:function(W,V){V.minValue=this.getChildValue(W)},MaximumValue:function(W,V){V.maxValue=this.getChildValue(W)},Identifier:function(V,W){W.identifier=this.getChildValue(V)},SupportedCRS:function(V,W){W.supportedCRS=this.getChildValue(V)}},B.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:B.Util.applyDefaults({Range:function(V){var W=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":V.closure}});this.writeNode("ows:MinimumValue",V.minValue,W);this.writeNode("ows:MaximumValue",V.maxValue,W);return W},MinimumValue:function(W){var V=this.createElementNSPlus("ows:MinimumValue",{value:W});return V},MaximumValue:function(W){var V=this.createElementNSPlus("ows:MaximumValue",{value:W});return V},Value:function(W){var V=this.createElementNSPlus("ows:Value",{value:W});return V}},B.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});B.Format.CSWGetDomain=function(W){W=B.Util.applyDefaults(W,B.Format.CSWGetDomain.DEFAULTS);var V=B.Format.CSWGetDomain["v"+W.version.replace(/\./g,"_")];if(!V){throw"Unsupported CSWGetDomain version: "+W.version}return new V(W)};B.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};B.Format.CSWGetDomain.v2_0_2=B.Class(B.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(V){if(typeof V=="string"){V=B.Format.XML.prototype.read.apply(this,[V])}if(V&&V.nodeType==9){V=V.documentElement}var W={};this.readNode(V,W);return W},readers:{csw:{GetDomainResponse:function(V,W){this.readChildNodes(V,W)},DomainValues:function(Y,Z){if(!(B.Util.isArray(Z.DomainValues))){Z.DomainValues=[]}var W=Y.attributes;var aa={};for(var X=0,V=W.length;X<V;++X){aa[W[X].name]=W[X].nodeValue}this.readChildNodes(Y,aa);Z.DomainValues.push(aa)},PropertyName:function(V,W){W.PropertyName=this.getChildValue(V)},ParameterName:function(V,W){W.ParameterName=this.getChildValue(V)},ListOfValues:function(V,W){if(!(B.Util.isArray(W.ListOfValues))){W.ListOfValues=[]}this.readChildNodes(V,W.ListOfValues)},Value:function(Y,aa){var W=Y.attributes;var Z={};for(var X=0,V=W.length;X<V;++X){Z[W[X].name]=W[X].nodeValue}Z.value=this.getChildValue(Y);aa.push({Value:Z})},ConceptualScheme:function(V,W){W.ConceptualScheme={};this.readChildNodes(V,W.ConceptualScheme)},Name:function(V,W){W.Name=this.getChildValue(V)},Document:function(V,W){W.Document=this.getChildValue(V)},Authority:function(V,W){W.Authority=this.getChildValue(V)},RangeOfValues:function(V,W){W.RangeOfValues={};this.readChildNodes(V,W.RangeOfValues)},MinValue:function(Y,aa){var W=Y.attributes;var Z={};for(var X=0,V=W.length;X<V;++X){Z[W[X].name]=W[X].nodeValue}Z.value=this.getChildValue(Y);aa.MinValue=Z},MaxValue:function(Y,aa){var W=Y.attributes;var Z={};for(var X=0,V=W.length;X<V;++X){Z[W[X].name]=W[X].nodeValue}Z.value=this.getChildValue(Y);aa.MaxValue=Z}}},write:function(V){var W=this.writeNode("csw:GetDomain",V);return B.Format.XML.prototype.write.apply(this,[W])},writers:{csw:{GetDomain:function(V){var W=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});if(V.PropertyName||this.PropertyName){this.writeNode("csw:PropertyName",V.PropertyName||this.PropertyName,W)}else{if(V.ParameterName||this.ParameterName){this.writeNode("csw:ParameterName",V.ParameterName||this.ParameterName,W)}}this.readChildNodes(W,V);return W},PropertyName:function(W){var V=this.createElementNSPlus("csw:PropertyName",{value:W});return V},ParameterName:function(W){var V=this.createElementNSPlus("csw:ParameterName",{value:W});return V}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});B.Format.CSWGetRecords=function(W){W=B.Util.applyDefaults(W,B.Format.CSWGetRecords.DEFAULTS);var V=B.Format.CSWGetRecords["v"+W.version.replace(/\./g,"_")];if(!V){throw"Unsupported CSWGetRecords version: "+W.version}return new V(W)};B.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};B.Format.CSWGetRecords.v2_0_2=B.Class(B.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(V){B.Format.XML.prototype.initialize.apply(this,[V])},read:function(V){if(typeof V=="string"){V=B.Format.XML.prototype.read.apply(this,[V])}if(V&&V.nodeType==9){V=V.documentElement}var W={};this.readNode(V,W);return W},readers:{csw:{GetRecordsResponse:function(W,X){X.records=[];this.readChildNodes(W,X);var V=this.getAttributeNS(W,"","version");if(V!=""){X.version=V}},RequestId:function(V,W){W.RequestId=this.getChildValue(V)},SearchStatus:function(V,X){X.SearchStatus={};var W=this.getAttributeNS(V,"","timestamp");if(W!=""){X.SearchStatus.timestamp=W}},SearchResults:function(Y,Z){this.readChildNodes(Y,Z);var W=Y.attributes;var aa={};for(var X=0,V=W.length;X<V;++X){if((W[X].name=="numberOfRecordsMatched")||(W[X].name=="numberOfRecordsReturned")||(W[X].name=="nextRecord")){aa[W[X].name]=parseInt(W[X].nodeValue)}else{aa[W[X].name]=W[X].nodeValue}}Z.SearchResults=aa},SummaryRecord:function(W,X){var V={type:"SummaryRecord"};this.readChildNodes(W,V);X.records.push(V)},BriefRecord:function(W,X){var V={type:"BriefRecord"};this.readChildNodes(W,V);X.records.push(V)},DCMIRecord:function(W,X){var V={type:"DCMIRecord"};this.readChildNodes(W,V);X.records.push(V)},Record:function(W,X){var V={type:"Record"};this.readChildNodes(W,V);X.records.push(V)},"*":function(W,X){var V=W.localName||W.nodeName.split(":").pop();X[V]=this.getChildValue(W)}},geonet:{info:function(W,X){var V={};this.readChildNodes(W,V);X.gninfo=V}},dc:{"*":function(aa,ab){var Y=aa.localName||aa.nodeName.split(":").pop();if(!(B.Util.isArray(ab[Y]))){ab[Y]=[]}var X={};var W=aa.attributes;for(var Z=0,V=W.length;Z<V;++Z){X[W[Z].name]=W[Z].nodeValue}X.value=this.getChildValue(aa);if(X.value!=""){ab[Y].push(X)}}},dct:{"*":function(W,X){var V=W.localName||W.nodeName.split(":").pop();if(!(B.Util.isArray(X[V]))){X[V]=[]}X[V].push(this.getChildValue(W))}},ows:B.Util.applyDefaults({BoundingBox:function(V,W){if(W.bounds){W.BoundingBox=[{crs:W.projection,value:[W.bounds.left,W.bounds.bottom,W.bounds.right,W.bounds.top]}];delete W.projection;delete W.bounds}B.Format.OWSCommon.v1_0_0.prototype.readers.ows["BoundingBox"].apply(this,arguments)}},B.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(V){var W=this.writeNode("csw:GetRecords",V);W.setAttribute("xmlns:gmd",this.namespaces.gmd);return B.Format.XML.prototype.write.apply(this,[W])},writers:{csw:{GetRecords:function(W){if(!W){W={}}var Z=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:W.requestId||this.requestId,resultType:W.resultType||this.resultType,outputFormat:W.outputFormat||this.outputFormat,outputSchema:W.outputSchema||this.outputSchema,startPosition:W.startPosition||this.startPosition,maxRecords:W.maxRecords||this.maxRecords}});if(W.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",W.DistributedSearch||this.DistributedSearch,Z)}var Y=W.ResponseHandler||this.ResponseHandler;if(B.Util.isArray(Y)&&Y.length>0){for(var X=0,V=Y.length;X<V;X++){this.writeNode("csw:ResponseHandler",Y[X],Z)}}this.writeNode("Query",W.Query||this.Query,Z);return Z},DistributedSearch:function(V){var W=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:V.hopCount}});return W},ResponseHandler:function(V){var W=this.createElementNSPlus("csw:ResponseHandler",{value:V.value});return W},Query:function(W){if(!W){W={}}var Z=this.createElementNSPlus("csw:Query",{attributes:{typeNames:W.typeNames||"csw:Record"}});var Y=W.ElementName;if(B.Util.isArray(Y)&&Y.length>0){for(var X=0,V=Y.length;X<V;X++){this.writeNode("csw:ElementName",Y[X],Z)}}else{this.writeNode("csw:ElementSetName",W.ElementSetName||{value:"summary"},Z)}if(W.Constraint){this.writeNode("csw:Constraint",W.Constraint,Z)}if(W.SortBy){this.writeNode("ogc:SortBy",W.SortBy,Z)}return Z},ElementName:function(V){var W=this.createElementNSPlus("csw:ElementName",{value:V.value});return W},ElementSetName:function(V){var W=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:V.typeNames},value:V.value});return W},Constraint:function(V){var W=this.createElementNSPlus("csw:Constraint",{attributes:{version:V.version}});if(V.Filter){var X=new B.Format.Filter({version:V.version});W.appendChild(X.write(V.Filter))}else{if(V.CqlText){var Y=this.createElementNSPlus("CqlText",{value:V.CqlText.value});W.appendChild(Y)}}return W}},ogc:B.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});B.Format.WFST=function(W){W=B.Util.applyDefaults(W,B.Format.WFST.DEFAULTS);var V=B.Format.WFST["v"+W.version.replace(/\./g,"_")];if(!V){throw"Unsupported WFST version: "+W.version}return new V(W)};B.Format.WFST.DEFAULTS={version:"1.0.0"};B.Format.WFST.v1=B.Class(B.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:true,xy:true,stateName:null,initialize:function(V){this.stateName={};this.stateName[B.State.INSERT]="wfs:Insert";this.stateName[B.State.UPDATE]="wfs:Update";this.stateName[B.State.DELETE]="wfs:Delete";B.Format.XML.prototype.initialize.apply(this,[V])},getSrsName:function(X,W){var V=W&&W.srsName;if(!V){if(X&&X.layer){V=X.layer.projection.getCode()}else{V=this.srsName}}return V},read:function(W,V){V=V||{};B.Util.applyDefaults(V,{output:"features"});if(typeof W=="string"){W=B.Format.XML.prototype.read.apply(this,[W])}if(W&&W.nodeType==9){W=W.documentElement}var X={};if(W){this.readNode(W,X,true)}if(X.features&&V.output==="features"){X=X.features}return X},readers:{wfs:{FeatureCollection:function(V,W){W.features=[];this.readChildNodes(V,W)}}},write:function(W,V){var X=this.writeNode("wfs:Transaction",{features:W,options:V});var Y=this.schemaLocationAttr();if(Y){this.setAttributeNS(X,this.namespaces.xsi,"xsi:schemaLocation",Y)}return B.Format.XML.prototype.write.apply(this,[X])},writers:{wfs:{GetFeature:function(W){var Y=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:W&&W.handle,outputFormat:W&&W.outputFormat,maxFeatures:W&&W.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(W)}});if(typeof this.featureType=="string"){this.writeNode("Query",W,Y)}else{for(var X=0,V=this.featureType.length;X<V;X++){W.featureType=this.featureType[X];this.writeNode("Query",W,Y)}}return Y},Transaction:function(ac){ac=ac||{};var X=ac.options||{};var ab=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:X.handle}});var Z,V;var aa=ac.features;if(aa){if(X.multi===true){B.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":(this.multiCurve===true)?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":(this.multiSurface===true)?"MultiSurface":"MultiPolygon"})}var W,Y;for(Z=0,V=aa.length;Z<V;++Z){Y=aa[Z];W=this.stateName[Y.state];if(W){this.writeNode(W,{feature:Y,options:X},ab)}}if(X.multi===true){this.setGeometryTypes()}}if(X.nativeElements){for(Z=0,V=X.nativeElements.length;Z<V;++Z){this.writeNode("wfs:Native",X.nativeElements[Z],ab)}}return ab},Native:function(W){var V=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:W.vendorId,safeToIgnore:W.safeToIgnore},value:W.value});return V},Insert:function(Y){var W=Y.feature;var V=Y.options;var X=this.createElementNSPlus("wfs:Insert",{attributes:{handle:V&&V.handle}});this.srsName=this.getSrsName(W);this.writeNode("feature:_typeName",W,X);return X},Update:function(aa){var Y=aa.feature;var W=aa.options;var Z=this.createElementNSPlus("wfs:Update",{attributes:{handle:W&&W.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){Z.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}var V=Y.modified;if(this.geometryName!==null&&(!V||V.geometry!==undefined)){this.srsName=this.getSrsName(Y);this.writeNode("Property",{name:this.geometryName,value:Y.geometry},Z)}for(var X in Y.attributes){if(Y.attributes[X]!==undefined&&(!V||!V.attributes||(V.attributes&&V.attributes[X]!==undefined))){this.writeNode("Property",{name:X,value:Y.attributes[X]},Z)}}this.writeNode("ogc:Filter",new B.Filter.FeatureId({fids:[Y.fid]}),Z);return Z},Property:function(W){var V=this.createElementNSPlus("wfs:Property");this.writeNode("Name",W.name,V);if(W.value!==null){this.writeNode("Value",W.value,V)}return V},Name:function(V){return this.createElementNSPlus("wfs:Name",{value:V})},Value:function(X){var W;if(X instanceof B.Geometry){W=this.createElementNSPlus("wfs:Value");var V=this.writeNode("feature:_geometry",X).firstChild;W.appendChild(V)}else{W=this.createElementNSPlus("wfs:Value",{value:X})}return W},Delete:function(Y){var W=Y.feature;var V=Y.options;var X=this.createElementNSPlus("wfs:Delete",{attributes:{handle:V&&V.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){X.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("ogc:Filter",new B.Filter.FeatureId({fids:[W.fid]}),X);return X}}},schemaLocationAttr:function(V){V=B.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},V);var aa=B.Util.extend({},this.schemaLocations);if(V.schema){aa[V.featurePrefix]=V.schema}var Z=[];var X;for(var W in aa){X=this.namespaces[W];if(X){Z.push(X+" "+aa[W])}}var Y=Z.join(" ")||undefined;return Y},setFilterProperty:function(X){if(X.filters){for(var W=0,V=X.filters.length;W<V;++W){B.Format.WFST.v1.prototype.setFilterProperty.call(this,X.filters[W])}}else{if(X instanceof B.Filter.Spatial&&!X.property){X.property=this.geometryName}}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});B.Format.WFST.v1_0_0=B.Class(B.Format.Filter.v1_0_0,B.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:false,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(V){B.Format.Filter.v1_0_0.prototype.initialize.apply(this,[V]);B.Format.WFST.v1.prototype.initialize.apply(this,[V])},readNode:function(V,W,X){return B.Format.GML.v2.prototype.readNode.apply(this,[V,W])},readers:{wfs:B.Util.applyDefaults({WFS_TransactionResponse:function(V,W){W.insertIds=[];W.success=false;this.readChildNodes(V,W)},InsertResult:function(W,V){var X={fids:[]};this.readChildNodes(W,X);V.insertIds.push(X.fids[0])},TransactionResult:function(V,W){this.readChildNodes(V,W)},Status:function(V,W){this.readChildNodes(V,W)},SUCCESS:function(V,W){W.success=true}},B.Format.WFST.v1.prototype.readers.wfs),gml:B.Format.GML.v2.prototype.readers.gml,feature:B.Format.GML.v2.prototype.readers.feature,ogc:B.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:B.Util.applyDefaults({Query:function(W){W=B.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},W);var Z=W.featurePrefix;var Y=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(Z?Z+":":"")+W.featureType}});if(W.srsNameInQuery&&W.srsName){Y.setAttribute("srsName",W.srsName)}if(W.featureNS){Y.setAttribute("xmlns:"+Z,W.featureNS)}if(W.propertyNames){for(var X=0,V=W.propertyNames.length;X<V;X++){this.writeNode("ogc:PropertyName",{property:W.propertyNames[X]},Y)}}if(W.filter){this.setFilterProperty(W.filter);this.writeNode("ogc:Filter",W.filter,Y)}return Y}},B.Format.WFST.v1.prototype.writers.wfs),gml:B.Format.GML.v2.prototype.writers.gml,feature:B.Format.GML.v2.prototype.writers.feature,ogc:B.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});B.Format.WFST.v1_1_0=B.Class(B.Format.Filter.v1_1_0,B.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(V){B.Format.Filter.v1_1_0.prototype.initialize.apply(this,[V]);B.Format.WFST.v1.prototype.initialize.apply(this,[V])},readNode:function(V,W,X){return B.Format.GML.v3.prototype.readNode.apply(this,[V,W])},readers:{wfs:B.Util.applyDefaults({FeatureCollection:function(V,W){W.numberOfFeatures=parseInt(V.getAttribute("numberOfFeatures"));B.Format.WFST.v1.prototype.readers.wfs["FeatureCollection"].apply(this,arguments)},TransactionResponse:function(V,W){W.insertIds=[];W.success=false;this.readChildNodes(V,W)},TransactionSummary:function(V,W){W.success=true},InsertResults:function(V,W){this.readChildNodes(V,W)},Feature:function(W,V){var X={fids:[]};this.readChildNodes(W,X);V.insertIds.push(X.fids[0])}},B.Format.WFST.v1.prototype.readers.wfs),gml:B.Format.GML.v3.prototype.readers.gml,feature:B.Format.GML.v3.prototype.readers.feature,ogc:B.Format.Filter.v1_1_0.prototype.readers.ogc,ows:B.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:B.Util.applyDefaults({GetFeature:function(V){var W=B.Format.WFST.v1.prototype.writers.wfs["GetFeature"].apply(this,arguments);V&&this.setAttributes(W,{resultType:V.resultType,startIndex:V.startIndex,count:V.count});return W},Query:function(W){W=B.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},W);var Z=W.featurePrefix;var Y=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(Z?Z+":":"")+W.featureType,srsName:W.srsName}});if(W.featureNS){Y.setAttribute("xmlns:"+Z,W.featureNS)}if(W.propertyNames){for(var X=0,V=W.propertyNames.length;X<V;X++){this.writeNode("wfs:PropertyName",{property:W.propertyNames[X]},Y)}}if(W.filter){B.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,W.filter);this.writeNode("ogc:Filter",W.filter,Y)}return Y},PropertyName:function(V){return this.createElementNSPlus("wfs:PropertyName",{value:V.property})}},B.Format.WFST.v1.prototype.writers.wfs),gml:B.Format.GML.v3.prototype.writers.gml,feature:B.Format.GML.v3.prototype.writers.feature,ogc:B.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});B.Format.Text=B.Class(B.Format,{defaultStyle:null,extractStyles:true,initialize:function(V){V=V||{};if(V.extractStyles!==false){V.defaultStyle={externalGraphic:B.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}}B.Format.prototype.initialize.apply(this,[V])},read:function(ae){var V=ae.split("\n");var W;var ab=[];for(var ao=0;ao<(V.length-1);ao++){var an=V[ao].replace(/^\s*/,"").replace(/\s*$/,"");if(an.charAt(0)!="#"){if(!W){W=an.split("\t")}else{var ag=an.split("\t");var Y=new B.Geometry.Point(0,0);var ac={};var ak=this.defaultStyle?B.Util.applyDefaults({},this.defaultStyle):null;var al,am,X,ai;var af=false;for(var ad=0;ad<ag.length;ad++){if(ag[ad]){if(W[ad]=="point"){var aj=ag[ad].split(",");Y.y=parseFloat(aj[0]);Y.x=parseFloat(aj[1]);af=true}else{if(W[ad]=="lat"){Y.y=parseFloat(ag[ad]);af=true}else{if(W[ad]=="lon"){Y.x=parseFloat(ag[ad]);af=true}else{if(W[ad]=="title"){ac.title=ag[ad]}else{if(W[ad]=="image"||W[ad]=="icon"&&ak){ak.externalGraphic=ag[ad]}else{if(W[ad]=="iconSize"&&ak){var ah=ag[ad].split(",");ak.graphicWidth=parseFloat(ah[0]);ak.graphicHeight=parseFloat(ah[1])}else{if(W[ad]=="iconOffset"&&ak){var aa=ag[ad].split(",");ak.graphicXOffset=parseFloat(aa[0]);ak.graphicYOffset=parseFloat(aa[1])}else{if(W[ad]=="description"){ac.description=ag[ad]}else{if(W[ad]=="overflow"){ac.overflow=ag[ad]}else{ac[W[ad]]=ag[ad]}}}}}}}}}}}if(af){if(this.internalProjection&&this.externalProjection){Y.transform(this.externalProjection,this.internalProjection)}var Z=new B.Feature.Vector(Y,ac,ak);ab.push(Z)}}}}return ab},CLASS_NAME:"OpenLayers.Format.Text"});B.Format.JSON=B.Class(B.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,nativeJSON:(function(){return !!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")})(),read:function(X,Y){var W;if(this.nativeJSON){W=JSON.parse(X,Y)}else{try{if(/^[\],:{}\s]*$/.test(X.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){W=j("("+X+")");if(typeof Y==="function"){function V(ab,aa){if(aa&&typeof aa==="object"){for(var ac in aa){if(aa.hasOwnProperty(ac)){aa[ac]=V(ac,aa[ac])}}}return Y(ab,aa)}W=V("",W)}}}catch(Z){}}if(this.keepData){this.data=W}return W},write:function(Z,X){this.pretty=!!X;var V=null;var W=typeof Z;if(this.serialize[W]){try{V=(!this.pretty&&this.nativeJSON)?JSON.stringify(Z):this.serialize[W].apply(this,[Z])}catch(Y){B.Console.error("Trouble serializing: "+Y)}}return V},writeIndent:function(){var W=[];if(this.pretty){for(var V=0;V<this.level;++V){W.push(this.indent)}}return W.join("")},writeNewline:function(){return(this.pretty)?this.newline:""},writeSpace:function(){return(this.pretty)?this.space:""},serialize:{object:function(X){if(X==null){return"null"}if(X.constructor==Date){return this.serialize.date.apply(this,[X])}if(X.constructor==Array){return this.serialize.array.apply(this,[X])}var aa=["{"];this.level+=1;var Y,W,Z;var V=false;for(Y in X){if(X.hasOwnProperty(Y)){W=B.Format.JSON.prototype.write.apply(this,[Y,this.pretty]);Z=B.Format.JSON.prototype.write.apply(this,[X[Y],this.pretty]);if(W!=null&&Z!=null){if(V){aa.push(",")}aa.push(this.writeNewline(),this.writeIndent(),W,":",this.writeSpace(),Z);V=true}}}this.level-=1;aa.push(this.writeNewline(),this.writeIndent(),"}");return aa.join("")},array:function(Z){var X;var Y=["["];this.level+=1;for(var W=0,V=Z.length;W<V;++W){X=B.Format.JSON.prototype.write.apply(this,[Z[W],this.pretty]);if(X!=null){if(W>0){Y.push(",")}Y.push(this.writeNewline(),this.writeIndent(),X)}}this.level-=1;Y.push(this.writeNewline(),this.writeIndent(),"]");return Y.join("")},string:function(W){var V={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(W)){return'"'+W.replace(/([\x00-\x1f\\"])/g,function(Y,X){var Z=V[X];if(Z){return Z}Z=X.charCodeAt();return"\\u00"+Math.floor(Z/16).toString(16)+(Z%16).toString(16)})+'"'}return'"'+W+'"'},number:function(V){return isFinite(V)?String(V):"null"},"boolean":function(V){return String(V)},date:function(V){function W(X){return(X<10)?"0"+X:X}return'"'+V.getFullYear()+"-"+W(V.getMonth()+1)+"-"+W(V.getDate())+"T"+W(V.getHours())+":"+W(V.getMinutes())+":"+W(V.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});B.Format.GeoJSON=B.Class(B.Format.JSON,{ignoreExtraDims:false,read:function(ad,ab,V){ab=(ab)?ab:"FeatureCollection";var Y=null;var X=null;if(typeof ad=="string"){X=B.Format.JSON.prototype.read.apply(this,[ad,V])}else{X=ad}if(!X){B.Console.error("Bad JSON: "+ad)}else{if(typeof(X.type)!="string"){B.Console.error("Bad GeoJSON - no type: "+ad)}else{if(this.isValidType(X,ab)){switch(ab){case"Geometry":try{Y=this.parseGeometry(X)}catch(W){B.Console.error(W)}break;case"Feature":try{Y=this.parseFeature(X);Y.type="Feature"}catch(W){B.Console.error(W)}break;case"FeatureCollection":Y=[];switch(X.type){case"Feature":try{Y.push(this.parseFeature(X))}catch(W){Y=null;B.Console.error(W)}break;case"FeatureCollection":for(var Z=0,aa=X.features.length;Z<aa;++Z){try{Y.push(this.parseFeature(X.features[Z]))}catch(W){Y=null;B.Console.error(W)}}break;default:try{var ac=this.parseGeometry(X);Y.push(new B.Feature.Vector(ac))}catch(W){Y=null;B.Console.error(W)}}break}}}}return Y},isValidType:function(X,V){var W=false;switch(V){case"Geometry":if(B.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],X.type)==-1){B.Console.error("Unsupported geometry type: "+X.type)}else{W=true}break;case"FeatureCollection":W=true;break;default:if(X.type==V){W=true}else{B.Console.error("Cannot convert types from "+X.type+" to "+V)}}return W},parseFeature:function(Y){var W,aa,V,Z;V=(Y.properties)?Y.properties:{};Z=(Y.geometry&&Y.geometry.bbox)||Y.bbox;try{aa=this.parseGeometry(Y.geometry)}catch(X){throw X}W=new B.Feature.Vector(aa,V);if(Z){W.bounds=B.Bounds.fromArray(Z)}if(Y.id){W.fid=Y.id}return W},parseGeometry:function(Z){if(Z==null){return null}var ab,aa=false;if(Z.type=="GeometryCollection"){if(!(B.Util.isArray(Z.geometries))){throw"GeometryCollection must have geometries array: "+Z}var W=Z.geometries.length;var Y=new Array(W);for(var V=0;V<W;++V){Y[V]=this.parseGeometry.apply(this,[Z.geometries[V]])}ab=new B.Geometry.Collection(Y);aa=true}else{if(!(B.Util.isArray(Z.coordinates))){throw"Geometry must have coordinates array: "+Z}if(!this.parseCoords[Z.type.toLowerCase()]){throw"Unsupported geometry type: "+Z.type}try{ab=this.parseCoords[Z.type.toLowerCase()].apply(this,[Z.coordinates])}catch(X){throw X}}if(this.internalProjection&&this.externalProjection&&!aa){ab.transform(this.externalProjection,this.internalProjection)}return ab},parseCoords:{point:function(V){if(this.ignoreExtraDims==false&&V.length!=2){throw"Only 2D points are supported: "+V}return new B.Geometry.Point(V[0],V[1])},multipoint:function(aa){var X=[];var Z=null;for(var W=0,V=aa.length;W<V;++W){try{Z=this.parseCoords.point.apply(this,[aa[W]])}catch(Y){throw Y}X.push(Z)}return new B.Geometry.MultiPoint(X)},linestring:function(aa){var X=[];var Z=null;for(var W=0,V=aa.length;W<V;++W){try{Z=this.parseCoords.point.apply(this,[aa[W]])}catch(Y){throw Y}X.push(Z)}return new B.Geometry.LineString(X)},multilinestring:function(aa){var X=[];var W=null;for(var Y=0,V=aa.length;Y<V;++Y){try{W=this.parseCoords.linestring.apply(this,[aa[Y]])}catch(Z){throw Z}X.push(W)}return new B.Geometry.MultiLineString(X)},polygon:function(ab){var aa=[];var Z,W;for(var X=0,V=ab.length;X<V;++X){try{W=this.parseCoords.linestring.apply(this,[ab[X]])}catch(Y){throw Y}Z=new B.Geometry.LinearRing(W.components);aa.push(Z)}return new B.Geometry.Polygon(aa)},multipolygon:function(aa){var W=[];var Z=null;for(var X=0,V=aa.length;X<V;++X){try{Z=this.parseCoords.polygon.apply(this,[aa[X]])}catch(Y){throw Y}W.push(Z)}return new B.Geometry.MultiPolygon(W)},box:function(V){if(V.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new B.Geometry.Polygon([new B.Geometry.LinearRing([new B.Geometry.Point(V[0][0],V[0][1]),new B.Geometry.Point(V[1][0],V[0][1]),new B.Geometry.Point(V[1][0],V[1][1]),new B.Geometry.Point(V[0][0],V[1][1]),new B.Geometry.Point(V[0][0],V[0][1])])])}},write:function(Z,Y){var V={type:null};if(B.Util.isArray(Z)){V.type="FeatureCollection";var ab=Z.length;V.features=new Array(ab);for(var X=0;X<ab;++X){var W=Z[X];if(!W instanceof B.Feature.Vector){var aa="FeatureCollection only supports collections of features: "+W;throw aa}V.features[X]=this.extract.feature.apply(this,[W])}}else{if(Z.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){V=this.extract.geometry.apply(this,[Z])}else{if(Z instanceof B.Feature.Vector){V=this.extract.feature.apply(this,[Z]);if(Z.layer&&Z.layer.projection){V.crs=this.createCRSObject(Z)}}}}return B.Format.JSON.prototype.write.apply(this,[V,Y])},createCRSObject:function(W){var X=W.layer.projection.toString();var V={};if(X.match(/epsg:/i)){var Y=parseInt(X.substring(X.indexOf(":")+1));if(Y==4326){V={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{V={type:"name",properties:{name:"EPSG:"+Y}}}}return V},extract:{feature:function(X){var W=this.extract.geometry.apply(this,[X.geometry]);var V={type:"Feature",properties:X.attributes,geometry:W};if(X.fid!=null){V.id=X.fid}return V},geometry:function(Y){if(Y==null){return null}if(this.internalProjection&&this.externalProjection){Y=Y.clone();Y.transform(this.internalProjection,this.externalProjection)}var V=Y.CLASS_NAME.split(".")[2];var X=this.extract[V.toLowerCase()].apply(this,[Y]);var W;if(V=="Collection"){W={type:"GeometryCollection",geometries:X}}else{W={type:V,coordinates:X}}return W},point:function(V){return[V.x,V.y]},multipoint:function(X){var Y=[];for(var W=0,V=X.components.length;W<V;++W){Y.push(this.extract.point.apply(this,[X.components[W]]))}return Y},linestring:function(W){var Y=[];for(var X=0,V=W.components.length;X<V;++X){Y.push(this.extract.point.apply(this,[W.components[X]]))}return Y},multilinestring:function(X){var Y=[];for(var W=0,V=X.components.length;W<V;++W){Y.push(this.extract.linestring.apply(this,[X.components[W]]))}return Y},polygon:function(X){var Y=[];for(var W=0,V=X.components.length;W<V;++W){Y.push(this.extract.linestring.apply(this,[X.components[W]]))}return Y},multipolygon:function(Y){var X=[];for(var W=0,V=Y.components.length;W<V;++W){X.push(this.extract.polygon.apply(this,[Y.components[W]]))}return X},collection:function(X){var V=X.components.length;var Y=new Array(V);for(var W=0;W<V;++W){Y[W]=this.extract.geometry.apply(this,[X.components[W]])}return Y}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});B.Format.WCSGetCoverage=B.Class(B.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(V){var W=this.writeNode("wcs:GetCoverage",V);this.setAttributeNS(W,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return B.Format.XML.prototype.write.apply(this,[W])},writers:{wcs:{GetCoverage:function(V){var W=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:V.version||this.VERSION,service:"WCS"}});this.writeNode("ows:Identifier",V.identifier,W);this.writeNode("wcs:DomainSubset",V.domainSubset,W);this.writeNode("wcs:Output",V.output,W);return W},DomainSubset:function(V){var W=this.createElementNSPlus("wcs:DomainSubset",{});this.writeNode("ows:BoundingBox",V.boundingBox,W);if(V.temporalSubset){this.writeNode("wcs:TemporalSubset",V.temporalSubset,W)}return W},TemporalSubset:function(Y){var X=this.createElementNSPlus("wcs:TemporalSubset",{});for(var W=0,V=Y.timePeriods.length;W<V;++W){this.writeNode("wcs:TimePeriod",Y.timePeriods[W],X)}return X},TimePeriod:function(V){var W=this.createElementNSPlus("wcs:TimePeriod",{});this.writeNode("wcs:BeginPosition",V.begin,W);this.writeNode("wcs:EndPosition",V.end,W);if(V.resolution){this.writeNode("wcs:TimeResolution",V.resolution,W)}return W},BeginPosition:function(V){var W=this.createElementNSPlus("wcs:BeginPosition",{value:V});return W},EndPosition:function(V){var W=this.createElementNSPlus("wcs:EndPosition",{value:V});return W},TimeResolution:function(V){var W=this.createElementNSPlus("wcs:TimeResolution",{value:V});return W},Output:function(V){var W=this.createElementNSPlus("wcs:Output",{attributes:{format:V.format,store:V.store}});if(V.gridCRS){this.writeNode("wcs:GridCRS",V.gridCRS,W)}return W},GridCRS:function(V){var W=this.createElementNSPlus("wcs:GridCRS",{});this.writeNode("wcs:GridBaseCRS",V.baseCRS,W);if(V.type){this.writeNode("wcs:GridType",V.type,W)}if(V.origin){this.writeNode("wcs:GridOrigin",V.origin,W)}this.writeNode("wcs:GridOffsets",V.offsets,W);if(V.CS){this.writeNode("wcs:GridCS",V.CS,W)}return W},GridBaseCRS:function(V){return this.createElementNSPlus("wcs:GridBaseCRS",{value:V})},GridOrigin:function(V){return this.createElementNSPlus("wcs:GridOrigin",{value:V})},GridType:function(V){return this.createElementNSPlus("wcs:GridType",{value:V})},GridOffsets:function(V){return this.createElementNSPlus("wcs:GridOffsets",{value:V})},GridCS:function(V){return this.createElementNSPlus("wcs:GridCS",{value:V})}},ows:B.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"});B.Format.WMSCapabilities=B.Class(B.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});B.Format.WMSCapabilities.v1=B.Class(B.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(X){if(typeof X=="string"){X=B.Format.XML.prototype.read.apply(this,[X])}var W=X;if(X&&X.nodeType==9){X=X.documentElement}var V={};this.readNode(X,V);if(V.service===undefined){var Y=new B.Format.OGCExceptionReport();V.error=Y.read(W)}return V},readers:{wms:{Service:function(V,W){W.service={};this.readChildNodes(V,W.service)},Name:function(V,W){W.name=this.getChildValue(V)},Title:function(V,W){W.title=this.getChildValue(V)},Abstract:function(V,W){W["abstract"]=this.getChildValue(V)},BoundingBox:function(W,X){var Y={};Y.bbox=[parseFloat(W.getAttribute("minx")),parseFloat(W.getAttribute("miny")),parseFloat(W.getAttribute("maxx")),parseFloat(W.getAttribute("maxy"))];var V={x:parseFloat(W.getAttribute("resx")),y:parseFloat(W.getAttribute("resy"))};if(!(isNaN(V.x)&&isNaN(V.y))){Y.res=V}return Y},OnlineResource:function(V,W){W.href=this.getAttributeNS(V,this.namespaces.xlink,"href")},ContactInformation:function(V,W){W.contactInformation={};this.readChildNodes(V,W.contactInformation)},ContactPersonPrimary:function(V,W){W.personPrimary={};this.readChildNodes(V,W.personPrimary)},ContactPerson:function(V,W){W.person=this.getChildValue(V)},ContactOrganization:function(V,W){W.organization=this.getChildValue(V)},ContactPosition:function(V,W){W.position=this.getChildValue(V)},ContactAddress:function(V,W){W.contactAddress={};this.readChildNodes(V,W.contactAddress)},AddressType:function(V,W){W.type=this.getChildValue(V)},Address:function(V,W){W.address=this.getChildValue(V)},City:function(V,W){W.city=this.getChildValue(V)},StateOrProvince:function(V,W){W.stateOrProvince=this.getChildValue(V)},PostCode:function(V,W){W.postcode=this.getChildValue(V)},Country:function(V,W){W.country=this.getChildValue(V)},ContactVoiceTelephone:function(V,W){W.phone=this.getChildValue(V)},ContactFacsimileTelephone:function(V,W){W.fax=this.getChildValue(V)},ContactElectronicMailAddress:function(V,W){W.email=this.getChildValue(V)},Fees:function(W,X){var V=this.getChildValue(W);if(V&&V.toLowerCase()!="none"){X.fees=V}},AccessConstraints:function(V,W){var X=this.getChildValue(V);if(X&&X.toLowerCase()!="none"){W.accessConstraints=X}},Capability:function(V,W){W.capability={nestedLayers:[],layers:[]};this.readChildNodes(V,W.capability)},Request:function(V,W){W.request={};this.readChildNodes(V,W.request)},GetCapabilities:function(V,W){W.getcapabilities={formats:[]};this.readChildNodes(V,W.getcapabilities)},Format:function(V,W){if(B.Util.isArray(W.formats)){W.formats.push(this.getChildValue(V))}else{W.format=this.getChildValue(V)}},DCPType:function(V,W){this.readChildNodes(V,W)},HTTP:function(V,W){this.readChildNodes(V,W)},Get:function(V,W){W.get={};this.readChildNodes(V,W.get);if(!W.href){W.href=W.get.href}},Post:function(V,W){W.post={};this.readChildNodes(V,W.post);if(!W.href){W.href=W.get.href}},GetMap:function(V,W){W.getmap={formats:[]};this.readChildNodes(V,W.getmap)},GetFeatureInfo:function(V,W){W.getfeatureinfo={formats:[]};this.readChildNodes(V,W.getfeatureinfo)},Exception:function(V,W){W.exception={formats:[]};this.readChildNodes(V,W.exception)},Layer:function(X,ad){var Z,W;if(ad.capability){W=ad.capability;Z=ad}else{W=ad}var al=X.getAttributeNode("queryable");var Y=(al&&al.specified)?X.getAttribute("queryable"):null;al=X.getAttributeNode("cascaded");var ah=(al&&al.specified)?X.getAttribute("cascaded"):null;al=X.getAttributeNode("opaque");var ae=(al&&al.specified)?X.getAttribute("opaque"):null;var aj=X.getAttribute("noSubsets");var V=X.getAttribute("fixedWidth");var ag=X.getAttribute("fixedHeight");var ak=Z||{},ai=B.Util.extend;var af={nestedLayers:[],styles:Z?[].concat(Z.styles):[],srs:Z?ai({},ak.srs):{},metadataURLs:[],bbox:Z?ai({},ak.bbox):{},llbbox:ak.llbbox,dimensions:Z?ai({},ak.dimensions):{},authorityURLs:Z?ai({},ak.authorityURLs):{},identifiers:{},keywords:[],queryable:(Y&&Y!=="")?(Y==="1"||Y==="true"):(ak.queryable||false),cascaded:(ah!==null)?parseInt(ah):(ak.cascaded||0),opaque:ae?(ae==="1"||ae==="true"):(ak.opaque||false),noSubsets:(aj!==null)?(aj==="1"||aj==="true"):(ak.noSubsets||false),fixedWidth:(V!=null)?parseInt(V):(ak.fixedWidth||0),fixedHeight:(ag!=null)?parseInt(ag):(ak.fixedHeight||0),minScale:ak.minScale,maxScale:ak.maxScale,attribution:ak.attribution};ad.nestedLayers.push(af);af.capability=W;this.readChildNodes(X,af);delete af.capability;if(af.name){var ac=af.name.split(":"),ab=W.request,aa=ab.getfeatureinfo;if(ac.length>0){af.prefix=ac[0]}W.layers.push(af);if(af.formats===undefined){af.formats=ab.getmap.formats}if(af.infoFormats===undefined&&aa){af.infoFormats=aa.formats}}},Attribution:function(V,W){W.attribution={};this.readChildNodes(V,W.attribution)},LogoURL:function(V,W){W.logo={width:V.getAttribute("width"),height:V.getAttribute("height")};this.readChildNodes(V,W.logo)},Style:function(W,X){var V={};X.styles.push(V);this.readChildNodes(W,V)},LegendURL:function(W,X){var V={width:W.getAttribute("width"),height:W.getAttribute("height")};X.legend=V;this.readChildNodes(W,V)},MetadataURL:function(V,W){var X={type:V.getAttribute("type")};W.metadataURLs.push(X);this.readChildNodes(V,X)},DataURL:function(V,W){W.dataURL={};this.readChildNodes(V,W.dataURL)},FeatureListURL:function(V,W){W.featureListURL={};this.readChildNodes(V,W.featureListURL)},AuthorityURL:function(W,Y){var V=W.getAttribute("name");var X={};this.readChildNodes(W,X);Y.authorityURLs[V]=X.href},Identifier:function(V,X){var W=V.getAttribute("authority");X.identifiers[W]=this.getChildValue(V)},KeywordList:function(V,W){this.readChildNodes(V,W)},SRS:function(V,W){W.srs[this.getChildValue(V)]=true}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});B.Format.WMSCapabilities.v1_1=B.Class(B.Format.WMSCapabilities.v1,{readers:{wms:B.Util.applyDefaults({WMT_MS_Capabilities:function(V,W){this.readChildNodes(V,W)},Keyword:function(V,W){if(W.keywords){W.keywords.push(this.getChildValue(V))}},DescribeLayer:function(V,W){W.describelayer={formats:[]};this.readChildNodes(V,W.describelayer)},GetLegendGraphic:function(V,W){W.getlegendgraphic={formats:[]};this.readChildNodes(V,W.getlegendgraphic)},GetStyles:function(V,W){W.getstyles={formats:[]};this.readChildNodes(V,W.getstyles)},PutStyles:function(V,W){W.putstyles={formats:[]};this.readChildNodes(V,W.putstyles)},UserDefinedSymbolization:function(V,W){var X={supportSLD:parseInt(V.getAttribute("SupportSLD"))==1,userLayer:parseInt(V.getAttribute("UserLayer"))==1,userStyle:parseInt(V.getAttribute("UserStyle"))==1,remoteWFS:parseInt(V.getAttribute("RemoteWFS"))==1};W.userSymbols=X},LatLonBoundingBox:function(V,W){W.llbbox=[parseFloat(V.getAttribute("minx")),parseFloat(V.getAttribute("miny")),parseFloat(V.getAttribute("maxx")),parseFloat(V.getAttribute("maxy"))]},BoundingBox:function(V,W){var X=B.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[V,W]);X.srs=V.getAttribute("SRS");W.bbox[X.srs]=X},ScaleHint:function(Z,aa){var Y=Z.getAttribute("min");var V=Z.getAttribute("max");var X=Math.pow(2,0.5);var W=B.INCHES_PER_UNIT.m;aa.maxScale=parseFloat(((Y/X)*W*B.DOTS_PER_INCH).toPrecision(13));aa.minScale=parseFloat(((V/X)*W*B.DOTS_PER_INCH).toPrecision(13))},Dimension:function(W,Y){var V=W.getAttribute("name").toLowerCase();var X={name:V,units:W.getAttribute("units"),unitsymbol:W.getAttribute("unitSymbol")};Y.dimensions[X.name]=X},Extent:function(Y,Z){var W=Y.getAttribute("name").toLowerCase();if(W in Z.dimensions){var X=Z.dimensions[W];X.nearestVal=Y.getAttribute("nearestValue")==="1";X.multipleVal=Y.getAttribute("multipleValues")==="1";X.current=Y.getAttribute("current")==="1";X["default"]=Y.getAttribute("default")||"";var V=this.getChildValue(Y);X.values=V.split(",")}}},B.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});B.Format.WMSCapabilities.v1_1_0=B.Class(B.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:B.Util.applyDefaults({SRS:function(Z,aa){var Y=this.getChildValue(Z);var W=Y.split(/ +/);for(var X=0,V=W.length;X<V;X++){aa.srs[W[X]]=true}}},B.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});B.Format.WMSCapabilities.v1_1_1=B.Class(B.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:B.Util.applyDefaults({SRS:function(V,W){W.srs[this.getChildValue(V)]=true}},B.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});B.Format.WMSCapabilities.v1_3=B.Class(B.Format.WMSCapabilities.v1,{readers:{wms:B.Util.applyDefaults({WMS_Capabilities:function(V,W){this.readChildNodes(V,W)},LayerLimit:function(V,W){W.layerLimit=parseInt(this.getChildValue(V))},MaxWidth:function(V,W){W.maxWidth=parseInt(this.getChildValue(V))},MaxHeight:function(V,W){W.maxHeight=parseInt(this.getChildValue(V))},BoundingBox:function(V,W){var X=B.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[V,W]);X.srs=V.getAttribute("CRS");W.bbox[X.srs]=X},CRS:function(V,W){this.readers.wms.SRS.apply(this,[V,W])},EX_GeographicBoundingBox:function(V,W){W.llbbox=[];this.readChildNodes(V,W.llbbox)},westBoundLongitude:function(V,W){W[0]=this.getChildValue(V)},eastBoundLongitude:function(V,W){W[2]=this.getChildValue(V)},southBoundLatitude:function(V,W){W[1]=this.getChildValue(V)},northBoundLatitude:function(V,W){W[3]=this.getChildValue(V)},MinScaleDenominator:function(V,W){W.maxScale=parseFloat(this.getChildValue(V)).toPrecision(16)},MaxScaleDenominator:function(V,W){W.minScale=parseFloat(this.getChildValue(V)).toPrecision(16)},Dimension:function(W,Y){var V=W.getAttribute("name").toLowerCase();var X={name:V,units:W.getAttribute("units"),unitsymbol:W.getAttribute("unitSymbol"),nearestVal:W.getAttribute("nearestValue")==="1",multipleVal:W.getAttribute("multipleValues")==="1","default":W.getAttribute("default")||"",current:W.getAttribute("current")==="1",values:this.getChildValue(W).split(",")};Y.dimensions[X.name]=X},Keyword:function(W,X){var V={value:this.getChildValue(W),vocabulary:W.getAttribute("vocabulary")};if(X.keywords){X.keywords.push(V)}}},B.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(V,W){this.readers.wms.UserDefinedSymbolization.apply(this,[V,W]);W.userSymbols.inlineFeature=parseInt(V.getAttribute("InlineFeature"))==1;W.userSymbols.remoteWCS=parseInt(V.getAttribute("RemoteWCS"))==1},DescribeLayer:function(V,W){this.readers.wms.DescribeLayer.apply(this,[V,W])},GetLegendGraphic:function(V,W){this.readers.wms.GetLegendGraphic.apply(this,[V,W])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});B.Format.WMSCapabilities.v1_3_0=B.Class(B.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});B.Format.WMSCapabilities.v1_1_1_WMSC=B.Class(B.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:B.Util.applyDefaults({VendorSpecificCapabilities:function(V,W){W.vendorSpecific={tileSets:[]};this.readChildNodes(V,W.vendorSpecific)},TileSet:function(W,V){var X={srs:{},bbox:{},resolutions:[]};this.readChildNodes(W,X);V.tileSets.push(X)},Resolutions:function(Y,Z){var X=this.getChildValue(Y).split(" ");for(var W=0,V=X.length;W<V;W++){if(X[W]!=""){Z.resolutions.push(parseFloat(X[W]))}}},Width:function(V,W){W.width=parseInt(this.getChildValue(V))},Height:function(V,W){W.height=parseInt(this.getChildValue(V))},Layers:function(V,W){W.layers=this.getChildValue(V)},Styles:function(V,W){W.styles=this.getChildValue(V)}},B.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});B.Format.WMSGetFeatureInfo=B.Class(B.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,read:function(Z){var V;if(typeof Z=="string"){Z=B.Format.XML.prototype.read.apply(this,[Z])}var W=Z.documentElement;if(W){var X=this;var Y=this["read_"+W.nodeName];if(Y){V=Y.call(this,W)}else{V=new B.Format.GML((this.options?this.options:{})).read(Z)}}else{V=Z}return V},read_msGMLOutput:function(ac){var Z=[];var W=this.getSiblingNodesByTagCriteria(ac,this.layerIdentifier);if(W){for(var ad=0,ag=W.length;ad<ag;++ad){var X=W[ad];var ae=X.nodeName;if(X.prefix){ae=ae.split(":")[1]}var ae=ae.replace(this.layerIdentifier,"");var af=this.getSiblingNodesByTagCriteria(X,this.featureIdentifier);if(af){for(var ab=0;ab<af.length;ab++){var V=af[ab];var Y=this.parseGeometry(V);var aa=this.parseAttributes(V);var ah=new B.Feature.Vector(Y.geometry,aa,null);ah.bounds=Y.bounds;ah.type=ae;Z.push(ah)}}}}return Z},read_FeatureInfoResponse:function(ac){var Z=[];var ae=this.getElementsByTagNameNS(ac,"*","FIELDS");for(var ad=0,af=ae.length;ad<af;ad++){var W=ae[ad];var ag=null;var ab={};var aa;var ah=W.attributes.length;if(ah>0){for(aa=0;aa<ah;aa++){var X=W.attributes[aa];ab[X.nodeName]=X.nodeValue}}else{var V=W.childNodes;for(aa=0,ah=V.length;aa<ah;++aa){var Y=V[aa];if(Y.nodeType!=3){ab[Y.getAttribute("name")]=Y.getAttribute("value")}}}Z.push(new B.Feature.Vector(ag,ab,null))}return Z},getSiblingNodesByTagCriteria:function(aa,ad){var V=[];var X,Z,Y,ab,W;if(aa&&aa.hasChildNodes()){X=aa.childNodes;Y=X.length;for(var ac=0;ac<Y;ac++){W=X[ac];while(W&&W.nodeType!=1){W=W.nextSibling;ac++}Z=(W?W.nodeName:"");if(Z.length>0&&Z.indexOf(ad)>-1){V.push(W)}else{ab=this.getSiblingNodesByTagCriteria(W,ad);if(ab.length>0){(V.length==0)?V=ab:V.push(ab)}}}}return V},parseAttributes:function(Z){var aa={};if(Z.nodeType==1){var X=Z.childNodes;var Y=X.length;for(var ab=0;ab<Y;++ab){var W=X[ab];if(W.nodeType==1){var ae=W.childNodes;var V=(W.prefix)?W.nodeName.split(":")[1]:W.nodeName;if(ae.length==0){aa[V]=null}else{if(ae.length==1){var ad=ae[0];if(ad.nodeType==3||ad.nodeType==4){var ac=ad.nodeValue.replace(this.regExes.trimSpace,"");aa[V]=ac}}}}}}return aa},parseGeometry:function(X){if(!this.gmlFormat){this.gmlFormat=new B.Format.GML()}var V=this.gmlFormat.parseFeature(X);var Y,W=null;if(V){Y=V.geometry&&V.geometry.clone();W=V.bounds&&V.bounds.clone();V.destroy()}return{geometry:Y,bounds:W}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});B.Format.WPSCapabilities=B.Class(B.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"});B.Format.WPSCapabilities.v1_0_0=B.Class(B.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(V){B.Format.XML.prototype.initialize.apply(this,[V])},read:function(W){if(typeof W=="string"){W=B.Format.XML.prototype.read.apply(this,[W])}if(W&&W.nodeType==9){W=W.documentElement}var V={};this.readNode(W,V);return V},readers:{wps:{Capabilities:function(V,W){this.readChildNodes(V,W)},ProcessOfferings:function(V,W){W.processOfferings={};this.readChildNodes(V,W.processOfferings)},Process:function(W,V){var Y=this.getAttributeNS(W,this.namespaces.wps,"processVersion");var X={processVersion:Y};this.readChildNodes(W,X);V[X.identifier]=X},Languages:function(V,W){W.languages=[];this.readChildNodes(V,W.languages)},Default:function(V,W){var X={isDefault:true};this.readChildNodes(V,X);W.push(X)},Supported:function(V,W){var X={};this.readChildNodes(V,X);W.push(X)}},ows:B.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"});B.Format.WPSDescribeProcess=B.Class(B.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(V){if(typeof V=="string"){V=B.Format.XML.prototype.read.apply(this,[V])}if(V&&V.nodeType==9){V=V.documentElement}var W={};this.readNode(V,W);return W},readers:{wps:{ProcessDescriptions:function(V,W){W.processDescriptions={};this.readChildNodes(V,W.processDescriptions)},ProcessDescription:function(X,V){var Y=this.getAttributeNS(X,this.namespaces.wps,"processVersion");var W={processVersion:Y,statusSupported:(X.getAttribute("statusSupported")==="true"),storeSupported:(X.getAttribute("storeSupported")==="true")};this.readChildNodes(X,W);V[W.identifier]=W},DataInputs:function(W,V){V.dataInputs=[];this.readChildNodes(W,V.dataInputs)},ProcessOutputs:function(W,V){V.processOutputs=[];this.readChildNodes(W,V.processOutputs)},Output:function(X,W){var V={};this.readChildNodes(X,V);W.push(V)},ComplexOutput:function(W,V){V.complexOutput={};this.readChildNodes(W,V.complexOutput)},Input:function(X,W){var V={maxOccurs:parseInt(X.getAttribute("maxOccurs")),minOccurs:parseInt(X.getAttribute("minOccurs"))};this.readChildNodes(X,V);W.push(V)},BoundingBoxData:function(W,V){V.boundingBoxData={};this.readChildNodes(W,V.boundingBoxData)},CRS:function(V,W){if(!W.CRSs){W.CRSs={}}W.CRSs[this.getChildValue(V)]=true},LiteralData:function(W,V){V.literalData={};this.readChildNodes(W,V.literalData)},ComplexData:function(W,V){V.complexData={};this.readChildNodes(W,V.complexData)},Default:function(W,V){V["default"]={};this.readChildNodes(W,V["default"])},Supported:function(W,V){V.supported={};this.readChildNodes(W,V.supported)},Format:function(V,X){var W={};this.readChildNodes(V,W);if(!X.formats){X.formats={}}X.formats[W.mimeType]=true},MimeType:function(V,W){W.mimeType=this.getChildValue(V)}},ows:B.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"});B.Format.WPSExecute=B.Class(B.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(V){return undefined},write:function(V){var X;if(window.ActiveXObject){X=new ActiveXObject("Microsoft.XMLDOM");this.xmldom=X}else{X=document.implementation.createDocument("","",null)}var W=this.writeNode("wps:Execute",V,X);this.setAttributeNS(W,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return B.Format.XML.prototype.write.apply(this,[W])},writers:{wps:{Execute:function(V){var W=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});this.writeNode("ows:Identifier",V.identifier,W);this.writeNode("wps:DataInputs",V.dataInputs,W);this.writeNode("wps:ResponseForm",V.responseForm,W);return W},ResponseForm:function(V){var W=this.createElementNSPlus("wps:ResponseForm",{});if(V.rawDataOutput){this.writeNode("wps:RawDataOutput",V.rawDataOutput,W)}if(V.responseDocument){this.writeNode("wps:ResponseDocument",V.responseDocument,W)}return W},ResponseDocument:function(V){var W=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:V.storeExecuteResponse,lineage:V.lineage,status:V.status}});if(V.output){this.writeNode("wps:Output",V.output,W)}return W},Output:function(V){var W=this.createElementNSPlus("wps:Output",{attributes:{asReference:V.asReference}});this.writeNode("ows:Identifier",V.identifier,W);this.writeNode("ows:Title",V.title,W);this.writeNode("ows:Abstract",V["abstract"],W);return W},RawDataOutput:function(V){var W=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:V.mimeType}});this.writeNode("ows:Identifier",V.identifier,W);return W},DataInputs:function(V){var Y=this.createElementNSPlus("wps:DataInputs",{});for(var W=0,X=V.length;W<X;++W){this.writeNode("wps:Input",V[W],Y)}return Y},Input:function(V){var W=this.createElementNSPlus("wps:Input",{});this.writeNode("ows:Identifier",V.identifier,W);if(V.title){this.writeNode("ows:Title",V.title,W)}if(V.data){this.writeNode("wps:Data",V.data,W)}if(V.reference){this.writeNode("wps:Reference",V.reference,W)}return W},Data:function(W){var V=this.createElementNSPlus("wps:Data",{});if(W.literalData){this.writeNode("wps:LiteralData",W.literalData,V)}else{if(W.complexData){this.writeNode("wps:ComplexData",W.complexData,V)}}return V},LiteralData:function(W){var V=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:W.uom},value:W.value});return V},ComplexData:function(V){var W=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:V.mimeType,encoding:V.encoding,schema:V.schema}});var X=V.value;if(typeof X==="string"){W.appendChild(this.getXMLDoc().createCDATASection(V.value))}else{W.appendChild(X)}return W},Reference:function(V){var W=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:V.mimeType,"xlink:href":V.href,method:V.method,encoding:V.encoding,schema:V.schema}});if(V.body){this.writeNode("wps:Body",V.body,W)}return W},Body:function(V){var W=this.createElementNSPlus("wps:Body",{});if(V.wcs){this.writeNode("wcs:GetCoverage",V.wcs,W)}else{if(V.wfs){this.featureType=V.wfs.featureType;this.version=V.wfs.version;this.writeNode("wfs:GetFeature",V.wfs,W)}else{this.writeNode("wps:Execute",V,W)}}return W}},wcs:B.Format.WCSGetCoverage.prototype.writers.wcs,wfs:B.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:B.Format.Filter.v1_1_0.prototype.writers.ogc,ows:B.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"});B.Format.OGCExceptionReport=B.Class(B.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},defaultPrefix:"ogc",read:function(X){var V;if(typeof X=="string"){X=B.Format.XML.prototype.read.apply(this,[X])}var W=X.documentElement;var Y={exceptionReport:null};if(W){this.readChildNodes(X,Y);if(Y.exceptionReport===null){Y=new B.Format.OWSCommon().read(X)}}return Y},readers:{ogc:{ServiceExceptionReport:function(V,W){W.exceptionReport={exceptions:[]};this.readChildNodes(V,W.exceptionReport)},ServiceException:function(W,X){var V={code:W.getAttribute("code"),locator:W.getAttribute("locator"),text:this.getChildValue(W)};X.exceptions.push(V)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});B.Format.ShapeFile=B.Class(B.Format,{read:function(ax){var ah,al,ai;for(var av in ax){if(ax[av].extension=="shp"){al=ax[av].content}else{if(ax[av].extension=="dbf"){ah=ax[av].content}else{if(ax[av].extension=="prj"){ai=ax[av].content}}}}if(ai){this.internalProjection=p.CUBProjToOLProj(this.guessProjection(ai))}var ak=p.stringToBytes(al),aq=0,aw;if(p.bytesToInt32BE(ak,0)!=9994||p.bytesToInt32LE(ak,28)!=1000){p.errorLog("ShapeFile : Format de fichier invalide",p.errorLevel.WARNING);return null}var at=p.bytesToInt32BE(ak,24);aw=p.bytesToInt32LE(ak,32);aq=100;var ae=[];while(aq<at*2){var au=p.bytesToInt32BE(ak,aq);var Y=p.bytesToInt32BE(ak,aq+4);if(Y<0){break}aq+=8;var aw=p.bytesToInt32LE(ak,aq);switch(aw){case 1:case 11:ae.push(new B.Feature.Vector(new B.Geometry.Point(p.bytesToDouble(ak,aq+4),p.bytesToDouble(ak,aq+12)).transform(this.internalProjection,D.projection)));break;case 3:case 13:case 5:case 15:var af=this.parseBounds(ak,aq+4);var am=p.bytesToInt32LE(ak,aq+36);var ad=[];var az=p.bytesToInt32LE(ak,aq+40);var aj=aq+44;for(var ao=0;ao<am;++ao,aj+=4){ad.push(p.bytesToInt32LE(ak,aj))}var Z=[];var ap=[];var X=1;var ac;if(M.jQuery.inArray(aw,[3,13])!=-1){ac=B.Geometry.LineString}else{ac=B.Geometry.LinearRing}for(var ao=0;ao<az;++ao,aj+=16){ap.push(new B.Geometry.Point(p.bytesToDouble(ak,aj),p.bytesToDouble(ak,aj+8)));if(X<ad.length&&ad[X]==ao+1){Z.push(new ac(ap));++X;ap=[]}}Z.push(new ac(ap));var ab=new B.Feature.Vector(M.jQuery.inArray(aw,[3,13])!=-1?new B.Geometry.Collection(Z):new B.Geometry.Polygon(Z));ab.geometry.transform(this.internalProjection,D.projection);ab.bounds=af.transform(this.internalProjection,D.projection);ae.push(ab);break}aq+=Y*2}delete ak;ak=p.stringToBytes(ah);if(ak[0]==3){var V=p.bytesToInt32LE(ak,4);var ar=p.bytesToInt16LE(ak,8);var ag=p.bytesToInt16LE(ak,10);aq=32;var W=[];while(ak[aq]!=13){var aa=0;var ay="";while(ak[aq+aa]!=0&&aa<11){ay+=String.fromCharCode(ak[aq+aa++])}W[ay]={type:ak[aq+11],length:ak[aq+16]};aq+=32}++aq;X=0;ab=ae[0];while(aq<ak.length&&ak[aq]!=26){aa=0;aq++;for(var an in W){ab.attributes[an]=this.parseData(ak,aq,W[an]);aq+=W[an].length}if(++X<ae.length){ab=ae[X]}else{break}}}else{p.errorLog("Format de fichier dbf non pris en charge",p.errorLevel.WARNING)}return ae},parseData:function(V,X,Z){var Y="";var W=0;switch(Z.type){case 67:while(W<Z.length){Y+=String.fromCharCode(V[X+W++])}Y=Y.replace(/[ ]+$/,"");break;case 68:if(Z.length==8&&V[X]!=32){while(W<Z.length){Y+=String.fromCharCode(V[X+W++])}Y=new Date(parseInt(Y.substr(0,4)),parseInt(Y.substr(4,2))-1,parseInt(Y.substr(6,2)))}else{Y=null}break;case 78:while(V[X+W]==32&&W++<Z.length){}while(W<Z.length){Y+=String.fromCharCode(V[X+W++])}Y=parseFloat(Y)|0;break}return Y},parseBounds:function(V,W){return new B.Bounds(p.bytesToDouble(V,W),p.bytesToDouble(V,W+8),p.bytesToDouble(V,W+16),p.bytesToDouble(V,W+24))},guessProjection:function(W){if(new RegExp("(?:WGS_1984)|(?:epsg['\"]s*,s*4326)","i").test(W)){return M.projections.WGS84}if(new RegExp("(?:RGF93_Lambert_93)|(?:epsg['\"]s*,s*2154)","i").test(W)){return M.projections.RGF93LAMBERT93}for(var V=42;V<=50;++V){if(new RegExp("(?:RGF_1993_Lambert_Zone_"+(V-41)+')|(?:epsg"s*,s*39'+V+")","i").test(W)){return M.projections["RGF93CC"+V]}}if(new RegExp("(?:GCS_RGF_1993)","i").test(W)){return M.projections.RGF93}return M.projections.UNKNOWN},write:function(V){return{shp:this.writeShp(V),shx:this.writeShx(V),dbf:this.writeDbf(V),prj:this.writePrj()}},writeHeaders:function(W,Z,Y,X){W.setInt32(0,9994);W.setInt32(4,0);W.setInt32(8,0);W.setInt32(12,0);W.setInt32(16,0);W.setInt32(20,0);W.setInt32(24,100/2+Z/2);W.setInt32(28,1000,true);var aa;for(var V in X){if(aa=this.getGeometryType(X[V].geometry)){break}}W.setInt32(32,aa,true);W.setFloat64(36,Y?Y.xmin:0,true);W.setFloat64(44,Y?Y.ymin:0,true);W.setFloat64(52,Y?Y.xmax:0,true);W.setFloat64(60,Y?Y.ymax:0,true);W.setFloat64(68,0,true);W.setFloat64(76,0,true);W.setFloat64(84,0,true);W.setFloat64(92,0,true)},writeShp:function(Y){var ag=this.getFirstExtent(Y);var X=0;for(var ae in Y){var ai=Y[ae];if(ai.geometry){ag.add(ai.CUB.getExtent())}X+=8;X+=this.getGeometryLength(Y[ae].geometry)}var ah=new ArrayBuffer(100+X);var V=new DataView(ah);this.writeHeaders(V,X,ag,Y);var ad=100;for(var ae in Y){var ai=Y[ae];V.setInt32(ad,parseInt(ae)+1);ad+=4;if(ai.geometry){switch(ai.geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":V.setInt32(ad,10);V.setInt32(ad+4,1,true);V.setFloat64(ad+8,ai.geometry.x,true);V.setFloat64(ad+16,ai.geometry.y,true);ad+=24;break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.MultiPolygon":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Collection":var W=this.getGeometryLength(ai.geometry);V.setInt32(ad,W/2);var af;var aa;if(ai.geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){V.setInt32(ad+4,3,true);af=1;aa=false}else{V.setInt32(ad+4,5,true);af=ai.geometry.components.length;aa=true}V.setFloat64(ad+8,ai.geometry.bounds.left,true);V.setFloat64(ad+16,ai.geometry.bounds.bottom,true);V.setFloat64(ad+24,ai.geometry.bounds.right,true);V.setFloat64(ad+32,ai.geometry.bounds.top,true);V.setInt32(ad+40,af,true);V.setInt32(ad+44,this.getGeometryNumPoints(ai.geometry),true);ad+=48;ptIdx=0;if(aa){for(var ac in ai.geometry.components){V.setInt32(ad,ptIdx,true);ptIdx+=this.getGeometryNumPoints(ai.geometry.components[ac]);ad+=4}}else{V.setInt32(ad,ptIdx,true);ad+=4}var Z=function(al,ak){for(var aj in al.components){if(al.CLASS_NAME=="OpenLayers.Geometry.LineString"){V.setFloat64(ak,al.components[aj].x,true);V.setFloat64(ak+8,al.components[aj].y,true);ak+=16}else{for(var ab in al.components[aj].components){V.setFloat64(ak,al.components[aj].components[ab].x,true);V.setFloat64(ak+8,al.components[aj].components[ab].y,true);ak+=16}}}return ak};if(ai.geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon"||ai.geometry.CLASS_NAME=="OpenLayers.Geometry.Collection"){for(var ac in ai.geometry.components){ad=Z(ai.geometry.components[ac],ad)}}else{ad=Z(ai.geometry,ad)}}}else{V.setInt32(ad+4,0,true);ad+=4}}return new Blob([ah])},writeShx:function(X){var W=X.length*8;var ae=new ArrayBuffer(100+W);var V=new DataView(ae);var ad=this.getFirstExtent(X);for(var ac in X){if(X[ac].geometry){ad.add(X[ac].CUB.getExtent())}}this.writeHeaders(V,W,ad,X);var aa=100;var Z=100;for(var ac in X){V.setInt32(aa,Z/2);var Y=this.getGeometryLength(X[ac].geometry);Z+=Y+8;V.setInt32(aa+4,Y/2);aa+=8}return new Blob([ae])},writeDbf:function(X){var ag={};var ah=0;for(var ac in X[0].attributes){ag[ac]={type:null,length:0};ah++}for(var ad in X){var aj=X[ad];for(var ac in aj.attributes){var af=null;switch(typeof aj.attributes[ac]){case"number":af="number";break;case"object":if(typeof aj.attributes[ac].getDate==="function"){af="date"}break;case"string":default:af="string"}ag[ac].length=Math.max(ag[ac].length,(aj.attributes[ac]+"").length);if(!af){continue}else{if(!ag[ac].type){ag[ac].type=af}else{if(ag[ac].type==af){continue}ag[ac].type="string"}}}}var ae=0;for(var ad in ag){ae+=ag[ad].length}ae+=1;var aa=32+ah*32+1;var W=aa+ae*X.length+1;var ai=new ArrayBuffer(W);var V=new DataView(ai);V.setInt8(0,3);var Y=new Date();V.setInt8(1,Y.getYear());V.setInt8(2,Y.getMonth()+1);V.setInt8(3,Y.getDate());V.setInt32(4,X.length,true);V.setInt16(8,aa,true);V.setInt16(10,ae,true);V.setInt8(29,87);var Z=32;for(var ad in ag){for(var ac=0;ac<10;++ac){if(ac==ad.length){break}V.setInt8(Z+ac,ad[ac].charCodeAt(0))}switch(ag[ad].type){case"number":V.setInt8(Z+11,"N".charCodeAt(0));break;case"date":V.setInt8(Z+11,"D".charCodeAt(0));break;case"string":default:V.setInt8(Z+11,"C".charCodeAt(0))}V.setInt8(Z+16,ag[ad].length);Z+=32}V.setInt8(Z++,13);for(var ad in X){Z=this.writeData(V,X[ad],Z,ag)}V.setInt8(Z,26);return new Blob([ai])},writeData:function(aa,Z,ac,ab){aa.setInt8(ac++,32);for(var Y in ab){var W="";if(Z.attributes[Y]){W=Z.attributes[Y]+""}var X=0;for(;X<W.length;++X){aa.setInt8(ac++,W[X].charCodeAt(0))}for(var V=X+1;V<=ab[Y].length;++V){aa.setInt8(ac++,32)}}return ac},writePrj:function(){var W="";switch(M.projection()){case M.projections.RGF93:W='GEOGCS["GCS_RGF_1993",DATUM["D_RGF_1993",SPHEROID["GRS_1980",6378137.0,298.257222101]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]';break;case M.projections.RGF93CC45:W='PROJCS["RGF_1993_CC45",GEOGCS["GCS_RGF_1993",DATUM["D_RGF_1993",SPHEROID["GRS_1980",6378137.0,298.257222101]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic"],PARAMETER["False_Easting",1700000.0],PARAMETER["False_Northing",4200000.0],PARAMETER["Central_Meridian",3.0],PARAMETER["Standard_Parallel_1",44.25],PARAMETER["Standard_Parallel_2",45.75],PARAMETER["Latitude_Of_Origin",45.0],UNIT["Meter",1.0]]';break;case M.projections.RGF93LAMBERT93:W='PROJCS["RGF_1993_Lambert_93",GEOGCS["GCS_RGF_1993",DATUM["D_RGF_1993",SPHEROID["GRS_1980",6378137.0,298.257222101]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Lambert_Conformal_Conic"],PARAMETER["False_Easting",700000.0],PARAMETER["False_Northing",6600000.0],PARAMETER["Central_Meridian",3.0],PARAMETER["Standard_Parallel_1",44.0],PARAMETER["Standard_Parallel_2",49.0],PARAMETER["Latitude_Of_Origin",46.5],UNIT["Meter",1.0]]';break;case M.projections.WGS84:W='GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]';break;default:p.errorLog("Le fichier PRJ n'est pas supporté dans cette projection")}var X=new ArrayBuffer(W.length);var V=new DataView(X);return new Blob([W])},getFirstExtent:function(W){var V=0;while(V<W.length&&W[V].CUB.getExtent()===null){++V}if(V<W.length){return W[V].CUB.getExtent()}else{return new M.Extent(0,0,0,0)}},getGeometryType:function(V){if(V){switch(V.CLASS_NAME){case"OpenLayers.Geometry.Point":return 1;case"OpenLayers.Geometry.LineString":return 3;case"OpenLayers.Geometry.MultiPolygon":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Collection":return 5;default:return null}}else{return 0}},getGeometryLength:function(X){if(!X){return 0}var W=0;switch(X.CLASS_NAME){case"OpenLayers.Geometry.Point":return 20;case"OpenLayers.Geometry.LineString":return 44+4*1+16*X.components.length;case"OpenLayers.Geometry.Polygon":for(var V in X.components){W+=X.components[V].components.length}return 44+4+16*W;case"OpenLayers.Geometry.MultiPolygon":case"OpenLayers.Geometry.Collection":for(var V in X.components){W+=this.getGeometryNumPoints(X.components[V])}return 44+4*X.components.length+16*W;default:throw"Type de géométrie non supporté pour l'export shape"}},getGeometryNumPoints:function(Y){var X=0;switch(Y.CLASS_NAME){case"OpenLayers.Geometry.LineString":return Y.components.length;case"OpenLayers.Geometry.Polygon":for(var W in Y.components){for(var V in Y.components[W].components){++X}}return X;case"OpenLayers.Geometry.MultiPolygon":case"OpenLayers.Geometry.Collection":for(var W in Y.components){X+=this.getGeometryNumPoints(Y.components[W])}return X}},CLASS_NAME:"OpenLayers.Format.ShapeFile"});B.Format.DXF=B.Class(B.Format,{read:function(am){var ac=[];var ad=this.getEntitiesSection(am[0].content);if(!ad){p.errorLog("DXF : Pas d'entités à charger",p.errorLevel.WARNING);return null}var ai=ad.index+ad[0].length;var aa=/^  0 *\s+(?:.|\s)+?(?=^  0\s+(?!VERTEX))/gm;var X=am[0].content.substr(ai);var ae=0;delete am;while(row=aa.exec(X)){var V,ak,Y,al,Z,W,ah;if(typeof W=="undefined"){W=false}if(!W){Z=false;ah=[]}var af=row[0].trim().split(/\s*\r?\n\s*/);if(/ENDSEC/.test(af[1])){break}for(var ag=0;ag<af.length;ag+=2){var aj=false;switch(af[ag]){case"0":switch(af[ag+1]){case"SEQEND":V="POLYLINE_SEQEND";break;case"VERTEX":break;case"POLYLINE":W=true;case"POINT":case"INSERT":case"TEXT":case"LINE":case"HATCH":case"LWPOLYLINE":V=af[ag+1];break;default:aj=true;break}break;case"1":if(V=="TEXT"){Y=af[ag+1]}case"8":ak=af[ag+1];break;case"10":case"11":if(af[ag+1]!=0&&af[ag+3]!=0){al={x:af[ag+1]}}else{ag+=2}break;case"20":case"21":if(!al){p.errorLog("DXF : Erreur de lecture d'une entité - objet ignoré");geometryConstructor=null;break}al.y=af[ag+1];ah.push(new B.Geometry.Point(al.x,al.y));break;case"70":if(af[ag+1].trim()&1){Z=true}break}if(aj){break}}if(aj){ae++;continue}if(V=="POLYLINE"){continue}if(V&&ah.length){var ab;switch(V){case"VERTEX":case"POINT":case"INSERT":ab=new B.Feature.Vector(ah[0]);break;default:if(V=="LINE"||(M.jQuery.inArray(V,["POLYLINE_SEQEND","LWPOLYLINE","HATCH"]!=-1)&&!Z&&ah[0].distanceTo(ah[ah.length-1])>0.01)){ab=new B.Feature.Vector(new B.Geometry.Collection(new B.Geometry.LineString(ah)))}else{ab=new B.Feature.Vector(new B.Geometry.Polygon(new B.Geometry.LinearRing(ah)))}break}if(ak){ab.attributes._layer=ak}if(Y){ab.attributes._text=Y}W=false;ab.geometry.transform(this.internalProjection,D.projection);ac.push(ab)}ai+=af.length;delete af}if(ae){p.errorLog("DXF : nombre d'objets ignorés : "+ae,p.errorLevel.INFO)}return ac},getEntitiesSection:function(W){var V=/\d+\s+SECTION\s+2\s+ENTITIES/gm.exec(W);return V},getEntity:function(X,V,W){return res},CLASS_NAME:"OpenLayers.Format.DXF"});B.Control.GetFeature=B.Class(B.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:false,click:true,single:true,clickout:true,toggle:false,clickTolerance:5,hover:false,box:false,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:B.Filter.Spatial.BBOX,initialize:function(V){V.handlerOptions=V.handlerOptions||{};B.Control.prototype.initialize.apply(this,[V]);this.features={};this.handlers={};if(this.click){this.handlers.click=new B.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})}if(this.box){this.handlers.box=new B.Handler.Box(this,{done:this.selectBox},B.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))}if(this.hover){this.handlers.hover=new B.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},B.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2}))}},activate:function(){if(!this.active){for(var V in this.handlers){this.handlers[V].activate()}}return B.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var V in this.handlers){this.handlers[V].deactivate()}}return B.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(V){var W=this.pixelToBounds(V.xy);this.setModifiers(V);this.request(W,{single:this.single})},selectBox:function(V){var X;if(V instanceof B.Bounds){var Y=this.map.getLonLatFromPixel({x:V.left,y:V.bottom});var W=this.map.getLonLatFromPixel({x:V.right,y:V.top});X=new B.Bounds(Y.lon,Y.lat,W.lon,W.lat)}else{if(this.click){return}X=this.pixelToBounds(V)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(X)},selectHover:function(V){var W=this.pixelToBounds(V.xy);this.request(W,{single:true,hover:true})},cancelHover:function(){if(this.hoverResponse){this.protocol.abort(this.hoverResponse);this.hoverResponse=null;B.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},request:function(Y,W){W=W||{};var X=new B.Filter.Spatial({type:this.filterType,value:Y});B.Element.addClass(this.map.viewPortDiv,"olCursorWait");var V=this.protocol.read({maxFeatures:W.single==true?this.maxFeatures:undefined,filter:X,callback:function(Z){if(Z.success()){if(Z.features.length){if(W.single==true){this.selectBestFeature(Z.features,Y.getCenterLonLat(),W)}else{this.select(Z.features)}}else{if(W.hover){this.hoverSelect()}else{this.events.triggerEvent("clickout");if(this.clickout){this.unselectAll()}}}}B.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});if(W.hover==true){this.hoverResponse=V}},selectBestFeature:function(W,V,ad){ad=ad||{};if(W.length){var ab=new B.Geometry.Point(V.lon,V.lat);var ac,Y,Z;var aa=Number.MAX_VALUE;for(var X=0;X<W.length;++X){ac=W[X];if(ac.geometry){Z=ab.distanceTo(ac.geometry,{edge:false});if(Z<aa){aa=Z;Y=ac;if(aa==0){break}}}}if(ad.hover==true){this.hoverSelect(Y)}else{this.select(Y||W)}}},setModifiers:function(V){this.modifiers={multiple:this.multiple||(this.multipleKey&&V[this.multipleKey]),toggle:this.toggle||(this.toggleKey&&V[this.toggleKey])}},select:function(Z){if(!this.modifiers.multiple&&!this.modifiers.toggle){this.unselectAll()}if(!(B.Util.isArray(Z))){Z=[Z]}var W=this.events.triggerEvent("beforefeaturesselected",{features:Z});if(W!==false){var aa=[];var Y;for(var X=0,V=Z.length;X<V;++X){Y=Z[X];if(this.features[Y.fid||Y.id]){if(this.modifiers.toggle){this.unselect(this.features[Y.fid||Y.id])}}else{W=this.events.triggerEvent("beforefeatureselected",{feature:Y});if(W!==false){this.features[Y.fid||Y.id]=Y;aa.push(Y);this.events.triggerEvent("featureselected",{feature:Y})}}}this.events.triggerEvent("featuresselected",{features:aa})}},hoverSelect:function(V){var X=V?V.fid||V.id:null;var W=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;if(W&&W!=X){this.events.triggerEvent("outfeature",{feature:this.hoverFeature});this.hoverFeature=null}if(X&&X!=W){this.events.triggerEvent("hoverfeature",{feature:V});this.hoverFeature=V}},unselect:function(V){delete this.features[V.fid||V.id];this.events.triggerEvent("featureunselected",{feature:V})},unselectAll:function(){for(var V in this.features){this.unselect(this.features[V])}},setMap:function(W){for(var V in this.handlers){this.handlers[V].setMap(W)}B.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(W){var Z=W.add(-this.clickTolerance/2,this.clickTolerance/2);var V=W.add(this.clickTolerance/2,-this.clickTolerance/2);var X=this.map.getLonLatFromPixel(Z);var Y=this.map.getLonLatFromPixel(V);return new B.Bounds(X.lon,X.lat,Y.lon,Y.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});B.Symbolizer=B.Class({zIndex:0,initialize:function(V){B.Util.extend(this,V)},clone:function(){var V=j(this.CLASS_NAME);return new V(B.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});B.Symbolizer.Point=B.Class(B.Symbolizer,{initialize:function(V){B.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});B.Symbolizer.Line=B.Class(B.Symbolizer,{initialize:function(V){B.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});B.Symbolizer.Polygon=B.Class(B.Symbolizer,{initialize:function(V){B.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});B.Symbolizer.Text=B.Class(B.Symbolizer,{initialize:function(V){B.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});B.Lang={code:null,defaultCode:"en",getCode:function(){if(!B.Lang.code){B.Lang.setCode()}return B.Lang.code},setCode:function(W){var Y;if(!W){W=(B.BROWSER_NAME=="msie")?navigator.userLanguage:navigator.language}var X=W.split("-");X[0]=X[0].toLowerCase();if(typeof B.Lang[X[0]]=="object"){Y=X[0]}if(X[1]){var V=X[0]+"-"+X[1].toUpperCase();if(typeof B.Lang[V]=="object"){Y=V}}if(!Y){B.Console.warn("Failed to find OpenLayers.Lang."+X.join("-")+" dictionary, falling back to default language");Y=B.Lang.defaultCode}B.Lang.code=Y},translate:function(W,V){var Y=B.Lang[B.Lang.getCode()];var X=Y&&Y[W];if(!X){X=W}if(V){X=B.String.format(X,V)}return X}};B.i18n=B.Lang.translate;B.Lang.fr=B.Util.applyDefaults({unhandledRequest:"RequÃªte non gÃ©rÃ©e, retournant ${statusText}",Permalink:"Permalien",Overlays:"Calques","Base Layer":"Calque de base",noFID:"Impossible de mettre Ã  jour un objet sans identifiant (fid).",browserNotSupported:"Votre navigateur ne supporte pas le rendu vectoriel. Les renderers actuellement supportÃ©s sont : \n${renderers}",minZoomLevelError:"La propriÃ©tÃ© minZoomLevel doit seulement Ãªtre utilisÃ©e pour des couches FixedZoomLevels-descendent. Le fait que cette couche WFS vÃ©rifie la prÃ©sence de minZoomLevel est une relique du passÃ©. Nous ne pouvons toutefois la supprimer sans casser des applications qui pourraient en dÃ©pendre. C'est pourquoi nous la dÃ©prÃ©cions -- la vÃ©rification du minZoomLevel sera supprimÃ©e en version 3.0. A la place, merci d'utiliser les paramÃ¨tres de rÃ©solutions min/max tel que dÃ©crit sur : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaction WFS : SUCCES ${response}",commitFailed:"Transaction WFS : ECHEC ${response}",googleWarning:"La couche Google n'a pas Ã©tÃ© en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sÃ©lecteur de couche en haut Ã  droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causÃ© par la non-inclusion de la librairie Google Maps, ou alors parce que la clÃ© de l'API ne correspond pas Ã  votre site.\x3cbr\x3e\x3cbr\x3eDÃ©veloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3ecliquez ici\x3c/a\x3e",getLayerWarning:"La couche ${layerType} n'est pas en mesure de se charger correctement.\x3cbr\x3e\x3cbr\x3ePour supprimer ce message, choisissez une nouvelle BaseLayer dans le sÃ©lecteur de couche en haut Ã  droite.\x3cbr\x3e\x3cbr\x3eCela est possiblement causÃ© par la non-inclusion de la librairie ${layerLib}.\x3cbr\x3e\x3cbr\x3eDÃ©veloppeurs : pour savoir comment corriger ceci, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3ecliquez ici\x3c/a\x3e","Scale = 1 : ${scaleDenom}":"Echelle ~ 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",reprojectDeprecated:"Vous utilisez l'option 'reproject' sur la couche ${layerName}. Cette option est dÃ©prÃ©ciÃ©e : Son usage permettait d'afficher des donnÃ©es au dessus de couches raster commerciales.Cette fonctionalitÃ© est maintenant supportÃ©e en utilisant le support de la projection Mercator SphÃ©rique. Plus d'information est disponible sur http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Cette mÃ©thode est dÃ©prÃ©ciÃ©e, et sera supprimÃ©e Ã  la version 3.0. Merci d'utiliser ${newMethod} Ã  la place.",proxyNeeded:"Vous avez trÃ¨s probablement besoin de renseigner OpenLayers.ProxyHost pour accÃ©der Ã  ${url}. Voir http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost"});B.Spherical=B.Spherical||{};B.Spherical.DEFAULT_RADIUS=6378137;B.Spherical.computeDistanceBetween=function(ab,aa,V){var Z=V||B.Spherical.DEFAULT_RADIUS;var Y=Math.sin(Math.PI*(aa.lon-ab.lon)/360);var X=Math.sin(Math.PI*(aa.lat-ab.lat)/360);var W=X*X+Y*Y*Math.cos(Math.PI*ab.lat/180)*Math.cos(Math.PI*aa.lat/180);return 2*Z*Math.atan2(Math.sqrt(W),Math.sqrt(1-W))};B.Spherical.computeHeading=function(Y,X){var W=Math.sin(Math.PI*(Y.lon-X.lon)/180)*Math.cos(Math.PI*X.lat/180);var V=Math.cos(Math.PI*Y.lat/180)*Math.sin(Math.PI*X.lat/180)-Math.sin(Math.PI*Y.lat/180)*Math.cos(Math.PI*X.lat/180)*Math.cos(Math.PI*(Y.lon-X.lon)/180);return 180*Math.atan2(W,V)/Math.PI};
/*!
 * jQuery JavaScript Library v1.8.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Thu Aug 30 2012 17:17:22 GMT-0400 (Eastern Daylight Time)
 */
(function(bM,bl){var aq,a0,ai=bM.document,bs=bM.location,Y=bM.navigator,b0=bM.jQuery,aD=bM.$,a7=Array.prototype.push,bO=Array.prototype.slice,bu=Array.prototype.indexOf,au=Object.prototype.toString,aQ=Object.prototype.hasOwnProperty,by=String.prototype.trim,cq=function(cJ,cK){return new cq.fn.init(cJ,cK,aq)},ch=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,aV=/\S/,bF=/\s+/,ax=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,b8=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,V=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,bZ=/^[\],:{}\s]*$/,b2=/(?:^|:|,)(?:\s*\[)+/g,cn=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,bK=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,cz=/^-ms-/,bE=/-([\da-z])/gi,aI=function(cJ,cK){return(cK+"").toUpperCase()},bp=function(){if(ai.addEventListener){ai.removeEventListener("DOMContentLoaded",bp,false);cq.ready()}else{if(ai.readyState==="complete"){ai.detachEvent("onreadystatechange",bp);cq.ready()}}},aU={};cq.fn=cq.prototype={constructor:cq,init:function(cJ,cN,cM){var cL,cO,cK,cP;if(!cJ){return this}if(cJ.nodeType){this.context=this[0]=cJ;this.length=1;return this}if(typeof cJ==="string"){if(cJ.charAt(0)==="<"&&cJ.charAt(cJ.length-1)===">"&&cJ.length>=3){cL=[null,cJ,null]}else{cL=b8.exec(cJ)}if(cL&&(cL[1]||!cN)){if(cL[1]){cN=cN instanceof cq?cN[0]:cN;cP=(cN&&cN.nodeType?cN.ownerDocument||cN:ai);cJ=cq.parseHTML(cL[1],cP,true);if(V.test(cL[1])&&cq.isPlainObject(cN)){this.attr.call(cJ,cN,true)}return cq.merge(this,cJ)}else{cO=ai.getElementById(cL[2]);if(cO&&cO.parentNode){if(cO.id!==cL[2]){return cM.find(cJ)}this.length=1;this[0]=cO}this.context=ai;this.selector=cJ;return this}}else{if(!cN||cN.jquery){return(cN||cM).find(cJ)}else{return this.constructor(cN).find(cJ)}}}else{if(cq.isFunction(cJ)){return cM.ready(cJ)}}if(cJ.selector!==bl){this.selector=cJ.selector;this.context=cJ.context}return cq.makeArray(cJ,this)},selector:"",jquery:"1.8.1",length:0,size:function(){return this.length},toArray:function(){return bO.call(this)},get:function(cJ){return cJ==null?this.toArray():(cJ<0?this[this.length+cJ]:this[cJ])},pushStack:function(cK,cM,cJ){var cL=cq.merge(this.constructor(),cK);cL.prevObject=this;cL.context=this.context;if(cM==="find"){cL.selector=this.selector+(this.selector?" ":"")+cJ}else{if(cM){cL.selector=this.selector+"."+cM+"("+cJ+")"}}return cL},each:function(cK,cJ){return cq.each(this,cK,cJ)},ready:function(cJ){cq.ready.promise().done(cJ);return this},eq:function(cJ){cJ=+cJ;return cJ===-1?this.slice(cJ):this.slice(cJ,cJ+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(bO.apply(this,arguments),"slice",bO.call(arguments).join(","))},map:function(cJ){return this.pushStack(cq.map(this,function(cL,cK){return cJ.call(cL,cK,cL)}))},end:function(){return this.prevObject||this.constructor(null)},push:a7,sort:[].sort,splice:[].splice};cq.fn.init.prototype=cq.fn;cq.extend=cq.fn.extend=function(){var cS,cL,cJ,cK,cP,cQ,cO=arguments[0]||{},cN=1,cM=arguments.length,cR=false;if(typeof cO==="boolean"){cR=cO;cO=arguments[1]||{};cN=2}if(typeof cO!=="object"&&!cq.isFunction(cO)){cO={}}if(cM===cN){cO=this;--cN}for(;cN<cM;cN++){if((cS=arguments[cN])!=null){for(cL in cS){cJ=cO[cL];cK=cS[cL];if(cO===cK){continue}if(cR&&cK&&(cq.isPlainObject(cK)||(cP=cq.isArray(cK)))){if(cP){cP=false;cQ=cJ&&cq.isArray(cJ)?cJ:[]}else{cQ=cJ&&cq.isPlainObject(cJ)?cJ:{}}cO[cL]=cq.extend(cR,cQ,cK)}else{if(cK!==bl){cO[cL]=cK}}}}}return cO};cq.extend({noConflict:function(cJ){if(bM.$===cq){bM.$=aD}if(cJ&&bM.jQuery===cq){bM.jQuery=b0}return cq},isReady:false,readyWait:1,holdReady:function(cJ){if(cJ){cq.readyWait++}else{cq.ready(true)}},ready:function(cJ){if(cJ===true?--cq.readyWait:cq.isReady){return}if(!ai.body){return setTimeout(cq.ready,1)}cq.isReady=true;if(cJ!==true&&--cq.readyWait>0){return}a0.resolveWith(ai,[cq]);if(cq.fn.trigger){cq(ai).trigger("ready").off("ready")}},isFunction:function(cJ){return cq.type(cJ)==="function"},isArray:Array.isArray||function(cJ){return cq.type(cJ)==="array"},isWindow:function(cJ){return cJ!=null&&cJ==cJ.window},isNumeric:function(cJ){return !isNaN(parseFloat(cJ))&&isFinite(cJ)},type:function(cJ){return cJ==null?String(cJ):aU[au.call(cJ)]||"object"},isPlainObject:function(cL){if(!cL||cq.type(cL)!=="object"||cL.nodeType||cq.isWindow(cL)){return false}try{if(cL.constructor&&!aQ.call(cL,"constructor")&&!aQ.call(cL.constructor.prototype,"isPrototypeOf")){return false}}catch(cK){return false}var cJ;for(cJ in cL){}return cJ===bl||aQ.call(cL,cJ)},isEmptyObject:function(cK){var cJ;for(cJ in cK){return false}return true},error:function(cJ){throw new Error(cJ)},parseHTML:function(cM,cL,cJ){var cK;if(!cM||typeof cM!=="string"){return null}if(typeof cL==="boolean"){cJ=cL;cL=0}cL=cL||ai;if((cK=V.exec(cM))){return[cL.createElement(cK[1])]}cK=cq.buildFragment([cM],cL,cJ?null:[]);return cq.merge([],(cK.cacheable?cq.clone(cK.fragment):cK.fragment).childNodes)},parseJSON:function(cJ){if(!cJ||typeof cJ!=="string"){return null}cJ=cq.trim(cJ);if(bM.JSON&&bM.JSON.parse){return bM.JSON.parse(cJ)}if(bZ.test(cJ.replace(cn,"@").replace(bK,"]").replace(b2,""))){return(new Function("return "+cJ))()}cq.error("Invalid JSON: "+cJ)},parseXML:function(cL){var cJ,cK;if(!cL||typeof cL!=="string"){return null}try{if(bM.DOMParser){cK=new DOMParser();cJ=cK.parseFromString(cL,"text/xml")}else{cJ=new ActiveXObject("Microsoft.XMLDOM");cJ.async="false";cJ.loadXML(cL)}}catch(cM){cJ=bl}if(!cJ||!cJ.documentElement||cJ.getElementsByTagName("parsererror").length){cq.error("Invalid XML: "+cL)}return cJ},noop:function(){},globalEval:function(cJ){if(cJ&&aV.test(cJ)){(bM.execScript||function(cK){j.call(bM,cK)})(cJ)}},camelCase:function(cJ){return cJ.replace(cz,"ms-").replace(bE,aI)},nodeName:function(cK,cJ){return cK.nodeName&&cK.nodeName.toUpperCase()===cJ.toUpperCase()},each:function(cO,cP,cL){var cK,cM=0,cN=cO.length,cJ=cN===bl||cq.isFunction(cO);if(cL){if(cJ){for(cK in cO){if(cP.apply(cO[cK],cL)===false){break}}}else{for(;cM<cN;){if(cP.apply(cO[cM++],cL)===false){break}}}}else{if(cJ){for(cK in cO){if(cP.call(cO[cK],cK,cO[cK])===false){break}}}else{for(;cM<cN;){if(cP.call(cO[cM],cM,cO[cM++])===false){break}}}}return cO},trim:by&&!by.call("\uFEFF\xA0")?function(cJ){return cJ==null?"":by.call(cJ)}:function(cJ){return cJ==null?"":cJ.toString().replace(ax,"")},makeArray:function(cJ,cL){var cM,cK=cL||[];if(cJ!=null){cM=cq.type(cJ);if(cJ.length==null||cM==="string"||cM==="function"||cM==="regexp"||cq.isWindow(cJ)){a7.call(cK,cJ)}else{cq.merge(cK,cJ)}}return cK},inArray:function(cM,cK,cL){var cJ;if(cK){if(bu){return bu.call(cK,cM,cL)}cJ=cK.length;cL=cL?cL<0?Math.max(0,cJ+cL):cL:0;for(;cL<cJ;cL++){if(cL in cK&&cK[cL]===cM){return cL}}}return -1},merge:function(cN,cL){var cJ=cL.length,cM=cN.length,cK=0;if(typeof cJ==="number"){for(;cK<cJ;cK++){cN[cM++]=cL[cK]}}else{while(cL[cK]!==bl){cN[cM++]=cL[cK++]}}cN.length=cM;return cN},grep:function(cK,cP,cJ){var cO,cL=[],cM=0,cN=cK.length;cJ=!!cJ;for(;cM<cN;cM++){cO=!!cP(cK[cM],cM);if(cJ!==cO){cL.push(cK[cM])}}return cL},map:function(cJ,cQ,cR){var cO,cP,cN=[],cL=0,cK=cJ.length,cM=cJ instanceof cq||cK!==bl&&typeof cK==="number"&&((cK>0&&cJ[0]&&cJ[cK-1])||cK===0||cq.isArray(cJ));if(cM){for(;cL<cK;cL++){cO=cQ(cJ[cL],cL,cR);if(cO!=null){cN[cN.length]=cO}}}else{for(cP in cJ){cO=cQ(cJ[cP],cP,cR);if(cO!=null){cN[cN.length]=cO}}}return cN.concat.apply([],cN)},guid:1,proxy:function(cN,cM){var cL,cJ,cK;if(typeof cM==="string"){cL=cN[cM];cM=cN;cN=cL}if(!cq.isFunction(cN)){return bl}cJ=bO.call(arguments,2);cK=function(){return cN.apply(cM,cJ.concat(bO.call(arguments)))};cK.guid=cN.guid=cN.guid||cK.guid||cq.guid++;return cK},access:function(cJ,cP,cS,cQ,cN,cT,cR){var cL,cO=cS==null,cM=0,cK=cJ.length;if(cS&&typeof cS==="object"){for(cM in cS){cq.access(cJ,cP,cM,cS[cM],1,cT,cQ)}cN=1}else{if(cQ!==bl){cL=cR===bl&&cq.isFunction(cQ);if(cO){if(cL){cL=cP;cP=function(cV,cU,cW){return cL.call(cq(cV),cW)}}else{cP.call(cJ,cQ);cP=null}}if(cP){for(;cM<cK;cM++){cP(cJ[cM],cS,cL?cQ.call(cJ[cM],cM,cP(cJ[cM],cS)):cQ,cR)}}cN=1}}return cN?cJ:cO?cP.call(cJ):cK?cP(cJ[0],cS):cT},now:function(){return(new Date()).getTime()}});cq.ready.promise=function(cM){if(!a0){a0=cq.Deferred();if(ai.readyState==="complete"){setTimeout(cq.ready,1)}else{if(ai.addEventListener){ai.addEventListener("DOMContentLoaded",bp,false);bM.addEventListener("load",cq.ready,false)}else{ai.attachEvent("onreadystatechange",bp);bM.attachEvent("onload",cq.ready);var cL=false;try{cL=bM.frameElement==null&&ai.documentElement}catch(cK){}if(cL&&cL.doScroll){(function cJ(){if(!cq.isReady){try{cL.doScroll("left")}catch(cN){return setTimeout(cJ,50)}cq.ready()}})()}}}}return a0.promise(cM)};cq.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(cK,cJ){aU["[object "+cJ+"]"]=cJ.toLowerCase()});aq=cq(ai);var cE={};function aX(cK){var cJ=cE[cK]={};cq.each(cK.split(bF),function(cM,cL){cJ[cL]=true});return cJ}cq.Callbacks=function(cT){cT=typeof cT==="string"?(cE[cT]||aX(cT)):cq.extend({},cT);var cM,cJ,cN,cL,cO,cP,cQ=[],cR=!cT.once&&[],cK=function(cU){cM=cT.memory&&cU;cJ=true;cP=cL||0;cL=0;cO=cQ.length;cN=true;for(;cQ&&cP<cO;cP++){if(cQ[cP].apply(cU[0],cU[1])===false&&cT.stopOnFalse){cM=false;break}}cN=false;if(cQ){if(cR){if(cR.length){cK(cR.shift())}}else{if(cM){cQ=[]}else{cS.disable()}}}},cS={add:function(){if(cQ){var cV=cQ.length;(function cU(cW){cq.each(cW,function(cY,cX){var cZ=cq.type(cX);if(cZ==="function"&&(!cT.unique||!cS.has(cX))){cQ.push(cX)}else{if(cX&&cX.length&&cZ!=="string"){cU(cX)}}})})(arguments);if(cN){cO=cQ.length}else{if(cM){cL=cV;cK(cM)}}}return this},remove:function(){if(cQ){cq.each(arguments,function(cW,cU){var cV;while((cV=cq.inArray(cU,cQ,cV))>-1){cQ.splice(cV,1);if(cN){if(cV<=cO){cO--}if(cV<=cP){cP--}}}})}return this},has:function(cU){return cq.inArray(cU,cQ)>-1},empty:function(){cQ=[];return this},disable:function(){cQ=cR=cM=bl;return this},disabled:function(){return !cQ},lock:function(){cR=bl;if(!cM){cS.disable()}return this},locked:function(){return !cR},fireWith:function(cV,cU){cU=cU||[];cU=[cV,cU.slice?cU.slice():cU];if(cQ&&(!cJ||cR)){if(cN){cR.push(cU)}else{cK(cU)}}return this},fire:function(){cS.fireWith(this,arguments);return this},fired:function(){return !!cJ}};return cS};cq.extend({Deferred:function(cL){var cK=[["resolve","done",cq.Callbacks("once memory"),"resolved"],["reject","fail",cq.Callbacks("once memory"),"rejected"],["notify","progress",cq.Callbacks("memory")]],cM="pending",cN={state:function(){return cM},always:function(){cJ.done(arguments).fail(arguments);return this},then:function(){var cO=arguments;return cq.Deferred(function(cP){cq.each(cK,function(cR,cQ){var cT=cQ[0],cS=cO[cR];cJ[cQ[1]](cq.isFunction(cS)?function(){var cU=cS.apply(this,arguments);if(cU&&cq.isFunction(cU.promise)){cU.promise().done(cP.resolve).fail(cP.reject).progress(cP.notify)}else{cP[cT+"With"](this===cJ?cP:this,[cU])}}:cP[cT])});cO=null}).promise()},promise:function(cO){return typeof cO==="object"?cq.extend(cO,cN):cN}},cJ={};cN.pipe=cN.then;cq.each(cK,function(cP,cO){var cR=cO[2],cQ=cO[3];cN[cO[1]]=cR.add;if(cQ){cR.add(function(){cM=cQ},cK[cP^1][2].disable,cK[2][2].lock)}cJ[cO[0]]=cR.fire;cJ[cO[0]+"With"]=cR.fireWith});cN.promise(cJ);if(cL){cL.call(cJ,cJ)}return cJ},when:function(cN){var cL=0,cP=bO.call(arguments),cJ=cP.length,cK=cJ!==1||(cN&&cq.isFunction(cN.promise))?cJ:0,cS=cK===1?cN:cq.Deferred(),cM=function(cU,cV,cT){return function(cW){cV[cU]=this;cT[cU]=arguments.length>1?bO.call(arguments):cW;if(cT===cR){cS.notifyWith(cV,cT)}else{if(!(--cK)){cS.resolveWith(cV,cT)}}}},cR,cO,cQ;if(cJ>1){cR=new Array(cJ);cO=new Array(cJ);cQ=new Array(cJ);for(;cL<cJ;cL++){if(cP[cL]&&cq.isFunction(cP[cL].promise)){cP[cL].promise().done(cM(cL,cQ,cP)).fail(cS.reject).progress(cM(cL,cO,cR))}else{--cK}}}if(!cK){cS.resolveWith(cQ,cP)}return cS.promise()}});cq.support=(function(){var cV,cU,cS,cT,cM,cR,cQ,cO,cN,cL,cJ,cK=ai.createElement("div");cK.setAttribute("className","t");cK.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";cU=cK.getElementsByTagName("*");cS=cK.getElementsByTagName("a")[0];cS.style.cssText="top:1px;float:left;opacity:.5";if(!cU||!cU.length||!cS){return{}}cT=ai.createElement("select");cM=cT.appendChild(ai.createElement("option"));cR=cK.getElementsByTagName("input")[0];cV={leadingWhitespace:(cK.firstChild.nodeType===3),tbody:!cK.getElementsByTagName("tbody").length,htmlSerialize:!!cK.getElementsByTagName("link").length,style:/top/.test(cS.getAttribute("style")),hrefNormalized:(cS.getAttribute("href")==="/a"),opacity:/^0.5/.test(cS.style.opacity),cssFloat:!!cS.style.cssFloat,checkOn:(cR.value==="on"),optSelected:cM.selected,getSetAttribute:cK.className!=="t",enctype:!!ai.createElement("form").enctype,html5Clone:ai.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",boxModel:(ai.compatMode==="CSS1Compat"),submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true,boxSizingReliable:true,pixelPosition:false};cR.checked=true;cV.noCloneChecked=cR.cloneNode(true).checked;cT.disabled=true;cV.optDisabled=!cM.disabled;try{delete cK.test}catch(cP){cV.deleteExpando=false}if(!cK.addEventListener&&cK.attachEvent&&cK.fireEvent){cK.attachEvent("onclick",cJ=function(){cV.noCloneEvent=false});cK.cloneNode(true).fireEvent("onclick");cK.detachEvent("onclick",cJ)}cR=ai.createElement("input");cR.value="t";cR.setAttribute("type","radio");cV.radioValue=cR.value==="t";cR.setAttribute("checked","checked");cR.setAttribute("name","t");cK.appendChild(cR);cQ=ai.createDocumentFragment();cQ.appendChild(cK.lastChild);cV.checkClone=cQ.cloneNode(true).cloneNode(true).lastChild.checked;cV.appendChecked=cR.checked;cQ.removeChild(cR);cQ.appendChild(cK);if(cK.attachEvent){for(cN in {submit:true,change:true,focusin:true}){cO="on"+cN;cL=(cO in cK);if(!cL){cK.setAttribute(cO,"return;");cL=(typeof cK[cO]==="function")}cV[cN+"Bubbles"]=cL}}cq(function(){var cX,c1,cZ,c0,cY="padding:0;margin:0;border:0;display:block;overflow:hidden;",cW=ai.getElementsByTagName("body")[0];if(!cW){return}cX=ai.createElement("div");cX.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";cW.insertBefore(cX,cW.firstChild);c1=ai.createElement("div");cX.appendChild(c1);c1.innerHTML="<table><tr><td></td><td>t</td></tr></table>";cZ=c1.getElementsByTagName("td");cZ[0].style.cssText="padding:0;margin:0;border:0;display:none";cL=(cZ[0].offsetHeight===0);cZ[0].style.display="";cZ[1].style.display="none";cV.reliableHiddenOffsets=cL&&(cZ[0].offsetHeight===0);c1.innerHTML="";c1.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";cV.boxSizing=(c1.offsetWidth===4);cV.doesNotIncludeMarginInBodyOffset=(cW.offsetTop!==1);if(bM.getComputedStyle){cV.pixelPosition=(bM.getComputedStyle(c1,null)||{}).top!=="1%";cV.boxSizingReliable=(bM.getComputedStyle(c1,null)||{width:"4px"}).width==="4px";c0=ai.createElement("div");c0.style.cssText=c1.style.cssText=cY;c0.style.marginRight=c0.style.width="0";c1.style.width="1px";c1.appendChild(c0);cV.reliableMarginRight=!parseFloat((bM.getComputedStyle(c0,null)||{}).marginRight)}if(typeof c1.style.zoom!=="undefined"){c1.innerHTML="";c1.style.cssText=cY+"width:1px;padding:1px;display:inline;zoom:1";cV.inlineBlockNeedsLayout=(c1.offsetWidth===3);c1.style.display="block";c1.style.overflow="visible";c1.innerHTML="<div></div>";c1.firstChild.style.width="5px";cV.shrinkWrapBlocks=(c1.offsetWidth!==3);cX.style.zoom=1}cW.removeChild(cX);cX=c1=cZ=c0=null});cQ.removeChild(cK);cU=cS=cT=cM=cR=cQ=cK=null;return cV})();var cd=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,bv=/([A-Z])/g;cq.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(cq.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(cJ){cJ=cJ.nodeType?cq.cache[cJ[cq.expando]]:cJ[cq.expando];return !!cJ&&!aJ(cJ)},data:function(cM,cK,cO,cN){if(!cq.acceptData(cM)){return}var cP,cR,cS=cq.expando,cQ=typeof cK==="string",cT=cM.nodeType,cJ=cT?cq.cache:cM,cL=cT?cM[cS]:cM[cS]&&cS;if((!cL||!cJ[cL]||(!cN&&!cJ[cL].data))&&cQ&&cO===bl){return}if(!cL){if(cT){cM[cS]=cL=cq.deletedIds.pop()||++cq.uuid}else{cL=cS}}if(!cJ[cL]){cJ[cL]={};if(!cT){cJ[cL].toJSON=cq.noop}}if(typeof cK==="object"||typeof cK==="function"){if(cN){cJ[cL]=cq.extend(cJ[cL],cK)}else{cJ[cL].data=cq.extend(cJ[cL].data,cK)}}cP=cJ[cL];if(!cN){if(!cP.data){cP.data={}}cP=cP.data}if(cO!==bl){cP[cq.camelCase(cK)]=cO}if(cQ){cR=cP[cK];if(cR==null){cR=cP[cq.camelCase(cK)]}}else{cR=cP}return cR},removeData:function(cM,cK,cN){if(!cq.acceptData(cM)){return}var cQ,cP,cO,cR=cM.nodeType,cJ=cR?cq.cache:cM,cL=cR?cM[cq.expando]:cq.expando;if(!cJ[cL]){return}if(cK){cQ=cN?cJ[cL]:cJ[cL].data;if(cQ){if(!cq.isArray(cK)){if(cK in cQ){cK=[cK]}else{cK=cq.camelCase(cK);if(cK in cQ){cK=[cK]}else{cK=cK.split(" ")}}}for(cP=0,cO=cK.length;cP<cO;cP++){delete cQ[cK[cP]]}if(!(cN?aJ:cq.isEmptyObject)(cQ)){return}}}if(!cN){delete cJ[cL].data;if(!aJ(cJ[cL])){return}}if(cR){cq.cleanData([cM],true)}else{if(cq.support.deleteExpando||cJ!=cJ.window){delete cJ[cL]}else{cJ[cL]=null}}},_data:function(cK,cJ,cL){return cq.data(cK,cJ,cL,true)},acceptData:function(cK){var cJ=cK.nodeName&&cq.noData[cK.nodeName.toLowerCase()];return !cJ||cJ!==true&&cK.getAttribute("classid")===cJ}});cq.fn.extend({data:function(cS,cR){var cN,cK,cQ,cJ,cM,cL=this[0],cP=0,cO=null;if(cS===bl){if(this.length){cO=cq.data(cL);if(cL.nodeType===1&&!cq._data(cL,"parsedAttrs")){cQ=cL.attributes;for(cM=cQ.length;cP<cM;cP++){cJ=cQ[cP].name;if(cJ.indexOf("data-")===0){cJ=cq.camelCase(cJ.substring(5));cf(cL,cJ,cO[cJ])}}cq._data(cL,"parsedAttrs",true)}}return cO}if(typeof cS==="object"){return this.each(function(){cq.data(this,cS)})}cN=cS.split(".",2);cN[1]=cN[1]?"."+cN[1]:"";cK=cN[1]+"!";return cq.access(this,function(cT){if(cT===bl){cO=this.triggerHandler("getData"+cK,[cN[0]]);if(cO===bl&&cL){cO=cq.data(cL,cS);cO=cf(cL,cS,cO)}return cO===bl&&cN[1]?this.data(cN[0]):cO}cN[1]=cT;this.each(function(){var cU=cq(this);cU.triggerHandler("setData"+cK,cN);cq.data(this,cS,cT);cU.triggerHandler("changeData"+cK,cN)})},null,cR,arguments.length>1,null,false)},removeData:function(cJ){return this.each(function(){cq.removeData(this,cJ)})}});function cf(cL,cK,cM){if(cM===bl&&cL.nodeType===1){var cJ="data-"+cK.replace(bv,"-$1").toLowerCase();cM=cL.getAttribute(cJ);if(typeof cM==="string"){try{cM=cM==="true"?true:cM==="false"?false:cM==="null"?null:+cM+""===cM?+cM:cd.test(cM)?cq.parseJSON(cM):cM}catch(cN){}cq.data(cL,cK,cM)}else{cM=bl}}return cM}function aJ(cK){var cJ;for(cJ in cK){if(cJ==="data"&&cq.isEmptyObject(cK[cJ])){continue}if(cJ!=="toJSON"){return false}}return true}cq.extend({queue:function(cL,cK,cM){var cJ;if(cL){cK=(cK||"fx")+"queue";cJ=cq._data(cL,cK);if(cM){if(!cJ||cq.isArray(cM)){cJ=cq._data(cL,cK,cq.makeArray(cM))}else{cJ.push(cM)}}return cJ||[]}},dequeue:function(cO,cN){cN=cN||"fx";var cK=cq.queue(cO,cN),cP=cK.length,cM=cK.shift(),cJ=cq._queueHooks(cO,cN),cL=function(){cq.dequeue(cO,cN)};if(cM==="inprogress"){cM=cK.shift();cP--}if(cM){if(cN==="fx"){cK.unshift("inprogress")}delete cJ.stop;cM.call(cO,cL,cJ)}if(!cP&&cJ){cJ.empty.fire()}},_queueHooks:function(cL,cK){var cJ=cK+"queueHooks";return cq._data(cL,cJ)||cq._data(cL,cJ,{empty:cq.Callbacks("once memory").add(function(){cq.removeData(cL,cK+"queue",true);cq.removeData(cL,cJ,true)})})}});cq.fn.extend({queue:function(cJ,cK){var cL=2;if(typeof cJ!=="string"){cK=cJ;cJ="fx";cL--}if(arguments.length<cL){return cq.queue(this[0],cJ)}return cK===bl?this:this.each(function(){var cM=cq.queue(this,cJ,cK);cq._queueHooks(this,cJ);if(cJ==="fx"&&cM[0]!=="inprogress"){cq.dequeue(this,cJ)}})},dequeue:function(cJ){return this.each(function(){cq.dequeue(this,cJ)})},delay:function(cK,cJ){cK=cq.fx?cq.fx.speeds[cK]||cK:cK;cJ=cJ||"fx";return this.queue(cJ,function(cM,cL){var cN=setTimeout(cM,cK);cL.stop=function(){clearTimeout(cN)}})},clearQueue:function(cJ){return this.queue(cJ||"fx",[])},promise:function(cL,cP){var cK,cM=1,cQ=cq.Deferred(),cO=this,cJ=this.length,cN=function(){if(!(--cM)){cQ.resolveWith(cO,[cO])}};if(typeof cL!=="string"){cP=cL;cL=bl}cL=cL||"fx";while(cJ--){cK=cq._data(cO[cJ],cL+"queueHooks");if(cK&&cK.empty){cM++;cK.empty.add(cN)}}cN();return cQ.promise(cP)}});var bR,cF,ah,ct=/[\t\r\n]/g,a3=/\r/g,ad=/^(?:button|input)$/i,bk=/^(?:button|input|object|select|textarea)$/i,ay=/^a(?:rea|)$/i,aH=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,cv=cq.support.getSetAttribute;cq.fn.extend({attr:function(cJ,cK){return cq.access(this,cq.attr,cJ,cK,arguments.length>1)},removeAttr:function(cJ){return this.each(function(){cq.removeAttr(this,cJ)})},prop:function(cJ,cK){return cq.access(this,cq.prop,cJ,cK,arguments.length>1)},removeProp:function(cJ){cJ=cq.propFix[cJ]||cJ;return this.each(function(){try{this[cJ]=bl;delete this[cJ]}catch(cK){}})},addClass:function(cN){var cP,cL,cK,cM,cO,cQ,cJ;if(cq.isFunction(cN)){return this.each(function(cR){cq(this).addClass(cN.call(this,cR,this.className))})}if(cN&&typeof cN==="string"){cP=cN.split(bF);for(cL=0,cK=this.length;cL<cK;cL++){cM=this[cL];if(cM.nodeType===1){if(!cM.className&&cP.length===1){cM.className=cN}else{cO=" "+cM.className+" ";for(cQ=0,cJ=cP.length;cQ<cJ;cQ++){if(!~cO.indexOf(" "+cP[cQ]+" ")){cO+=cP[cQ]+" "}}cM.className=cq.trim(cO)}}}}return this},removeClass:function(cP){var cM,cN,cO,cQ,cK,cL,cJ;if(cq.isFunction(cP)){return this.each(function(cR){cq(this).removeClass(cP.call(this,cR,this.className))})}if((cP&&typeof cP==="string")||cP===bl){cM=(cP||"").split(bF);for(cL=0,cJ=this.length;cL<cJ;cL++){cO=this[cL];if(cO.nodeType===1&&cO.className){cN=(" "+cO.className+" ").replace(ct," ");for(cQ=0,cK=cM.length;cQ<cK;cQ++){while(cN.indexOf(" "+cM[cQ]+" ")>-1){cN=cN.replace(" "+cM[cQ]+" "," ")}}cO.className=cP?cq.trim(cN):""}}}return this},toggleClass:function(cM,cK){var cL=typeof cM,cJ=typeof cK==="boolean";if(cq.isFunction(cM)){return this.each(function(cN){cq(this).toggleClass(cM.call(this,cN,this.className,cK),cK)})}return this.each(function(){if(cL==="string"){var cP,cO=0,cN=cq(this),cQ=cK,cR=cM.split(bF);while((cP=cR[cO++])){cQ=cJ?cQ:!cN.hasClass(cP);cN[cQ?"addClass":"removeClass"](cP)}}else{if(cL==="undefined"||cL==="boolean"){if(this.className){cq._data(this,"__className__",this.className)}this.className=this.className||cM===false?"":cq._data(this,"__className__")||""}}})},hasClass:function(cJ){var cM=" "+cJ+" ",cL=0,cK=this.length;for(;cL<cK;cL++){if(this[cL].nodeType===1&&(" "+this[cL].className+" ").replace(ct," ").indexOf(cM)>-1){return true}}return false},val:function(cM){var cJ,cK,cN,cL=this[0];if(!arguments.length){if(cL){cJ=cq.valHooks[cL.type]||cq.valHooks[cL.nodeName.toLowerCase()];if(cJ&&"get" in cJ&&(cK=cJ.get(cL,"value"))!==bl){return cK}cK=cL.value;return typeof cK==="string"?cK.replace(a3,""):cK==null?"":cK}return}cN=cq.isFunction(cM);return this.each(function(cP){var cQ,cO=cq(this);if(this.nodeType!==1){return}if(cN){cQ=cM.call(this,cP,cO.val())}else{cQ=cM}if(cQ==null){cQ=""}else{if(typeof cQ==="number"){cQ+=""}else{if(cq.isArray(cQ)){cQ=cq.map(cQ,function(cR){return cR==null?"":cR+""})}}}cJ=cq.valHooks[this.type]||cq.valHooks[this.nodeName.toLowerCase()];if(!cJ||!("set" in cJ)||cJ.set(this,cQ,"value")===bl){this.value=cQ}})}});cq.extend({valHooks:{option:{get:function(cJ){var cK=cJ.attributes.value;return !cK||cK.specified?cJ.value:cJ.text}},select:{get:function(cJ){var cP,cK,cO,cM,cN=cJ.selectedIndex,cQ=[],cR=cJ.options,cL=cJ.type==="select-one";if(cN<0){return null}cK=cL?cN:0;cO=cL?cN+1:cR.length;for(;cK<cO;cK++){cM=cR[cK];if(cM.selected&&(cq.support.optDisabled?!cM.disabled:cM.getAttribute("disabled")===null)&&(!cM.parentNode.disabled||!cq.nodeName(cM.parentNode,"optgroup"))){cP=cq(cM).val();if(cL){return cP}cQ.push(cP)}}if(cL&&!cQ.length&&cR.length){return cq(cR[cN]).val()}return cQ},set:function(cK,cL){var cJ=cq.makeArray(cL);cq(cK).find("option").each(function(){this.selected=cq.inArray(cq(this).val(),cJ)>=0});if(!cJ.length){cK.selectedIndex=-1}return cJ}}},attrFn:{},attr:function(cP,cM,cQ,cO){var cL,cJ,cN,cK=cP.nodeType;if(!cP||cK===3||cK===8||cK===2){return}if(cO&&cq.isFunction(cq.fn[cM])){return cq(cP)[cM](cQ)}if(typeof cP.getAttribute==="undefined"){return cq.prop(cP,cM,cQ)}cN=cK!==1||!cq.isXMLDoc(cP);if(cN){cM=cM.toLowerCase();cJ=cq.attrHooks[cM]||(aH.test(cM)?cF:bR)}if(cQ!==bl){if(cQ===null){cq.removeAttr(cP,cM);return}else{if(cJ&&"set" in cJ&&cN&&(cL=cJ.set(cP,cQ,cM))!==bl){return cL}else{cP.setAttribute(cM,""+cQ);return cQ}}}else{if(cJ&&"get" in cJ&&cN&&(cL=cJ.get(cP,cM))!==null){return cL}else{cL=cP.getAttribute(cM);return cL===null?bl:cL}}},removeAttr:function(cM,cO){var cN,cP,cK,cJ,cL=0;if(cO&&cM.nodeType===1){cP=cO.split(bF);for(;cL<cP.length;cL++){cK=cP[cL];if(cK){cN=cq.propFix[cK]||cK;cJ=aH.test(cK);if(!cJ){cq.attr(cM,cK,"")}cM.removeAttribute(cv?cK:cN);if(cJ&&cN in cM){cM[cN]=false}}}}},attrHooks:{type:{set:function(cJ,cK){if(ad.test(cJ.nodeName)&&cJ.parentNode){cq.error("type property can't be changed")}else{if(!cq.support.radioValue&&cK==="radio"&&cq.nodeName(cJ,"input")){var cL=cJ.value;cJ.setAttribute("type",cK);if(cL){cJ.value=cL}return cK}}}},value:{get:function(cK,cJ){if(bR&&cq.nodeName(cK,"button")){return bR.get(cK,cJ)}return cJ in cK?cK.value:null},set:function(cK,cL,cJ){if(bR&&cq.nodeName(cK,"button")){return bR.set(cK,cL,cJ)}cK.value=cL}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(cO,cM,cP){var cL,cJ,cN,cK=cO.nodeType;if(!cO||cK===3||cK===8||cK===2){return}cN=cK!==1||!cq.isXMLDoc(cO);if(cN){cM=cq.propFix[cM]||cM;cJ=cq.propHooks[cM]}if(cP!==bl){if(cJ&&"set" in cJ&&(cL=cJ.set(cO,cP,cM))!==bl){return cL}else{return(cO[cM]=cP)}}else{if(cJ&&"get" in cJ&&(cL=cJ.get(cO,cM))!==null){return cL}else{return cO[cM]}}},propHooks:{tabIndex:{get:function(cK){var cJ=cK.getAttributeNode("tabindex");return cJ&&cJ.specified?parseInt(cJ.value,10):bk.test(cK.nodeName)||ay.test(cK.nodeName)&&cK.href?0:bl}}}});cF={get:function(cK,cJ){var cM,cL=cq.prop(cK,cJ);return cL===true||typeof cL!=="boolean"&&(cM=cK.getAttributeNode(cJ))&&cM.nodeValue!==false?cJ.toLowerCase():bl},set:function(cK,cM,cJ){var cL;if(cM===false){cq.removeAttr(cK,cJ)}else{cL=cq.propFix[cJ]||cJ;if(cL in cK){cK[cL]=true}cK.setAttribute(cJ,cJ.toLowerCase())}return cJ}};if(!cv){ah={name:true,id:true,coords:true};bR=cq.valHooks.button={get:function(cL,cK){var cJ;cJ=cL.getAttributeNode(cK);return cJ&&(ah[cK]?cJ.value!=="":cJ.specified)?cJ.value:bl},set:function(cL,cM,cK){var cJ=cL.getAttributeNode(cK);if(!cJ){cJ=ai.createAttribute(cK);cL.setAttributeNode(cJ)}return(cJ.value=cM+"")}};cq.each(["width","height"],function(cK,cJ){cq.attrHooks[cJ]=cq.extend(cq.attrHooks[cJ],{set:function(cL,cM){if(cM===""){cL.setAttribute(cJ,"auto");return cM}}})});cq.attrHooks.contenteditable={get:bR.get,set:function(cK,cL,cJ){if(cL===""){cL="false"}bR.set(cK,cL,cJ)}}}if(!cq.support.hrefNormalized){cq.each(["href","src","width","height"],function(cK,cJ){cq.attrHooks[cJ]=cq.extend(cq.attrHooks[cJ],{get:function(cM){var cL=cM.getAttribute(cJ,2);return cL===null?bl:cL}})})}if(!cq.support.style){cq.attrHooks.style={get:function(cJ){return cJ.style.cssText.toLowerCase()||bl},set:function(cJ,cK){return(cJ.style.cssText=""+cK)}}}if(!cq.support.optSelected){cq.propHooks.selected=cq.extend(cq.propHooks.selected,{get:function(cK){var cJ=cK.parentNode;if(cJ){cJ.selectedIndex;if(cJ.parentNode){cJ.parentNode.selectedIndex}}return null}})}if(!cq.support.enctype){cq.propFix.enctype="encoding"}if(!cq.support.checkOn){cq.each(["radio","checkbox"],function(){cq.valHooks[this]={get:function(cJ){return cJ.getAttribute("value")===null?"on":cJ.value}}})}cq.each(["radio","checkbox"],function(){cq.valHooks[this]=cq.extend(cq.valHooks[this],{set:function(cJ,cK){if(cq.isArray(cK)){return(cJ.checked=cq.inArray(cq(cJ).val(),cK)>=0)}}})});var co=/^(?:textarea|input|select)$/i,cb=/^([^\.]*|)(?:\.(.+)|)$/,bU=/(?:^|\s)hover(\.\S+|)\b/,bN=/^key/,cu=/^(?:mouse|contextmenu)|click/,ci=/^(?:focusinfocus|focusoutblur)$/,bb=function(cJ){return cq.event.special.hover?cJ:cJ.replace(bU,"mouseenter$1 mouseleave$1")};cq.event={add:function(cM,cQ,cX,cO,cN){var cR,cP,cY,cW,cV,cT,cJ,cU,cK,cL,cS;if(cM.nodeType===3||cM.nodeType===8||!cQ||!cX||!(cR=cq._data(cM))){return}if(cX.handler){cK=cX;cX=cK.handler;cN=cK.selector}if(!cX.guid){cX.guid=cq.guid++}cY=cR.events;if(!cY){cR.events=cY={}}cP=cR.handle;if(!cP){cR.handle=cP=function(cZ){return typeof cq!=="undefined"&&(!cZ||cq.event.triggered!==cZ.type)?cq.event.dispatch.apply(cP.elem,arguments):bl};cP.elem=cM}cQ=cq.trim(bb(cQ)).split(" ");for(cW=0;cW<cQ.length;cW++){cV=cb.exec(cQ[cW])||[];cT=cV[1];cJ=(cV[2]||"").split(".").sort();cS=cq.event.special[cT]||{};cT=(cN?cS.delegateType:cS.bindType)||cT;cS=cq.event.special[cT]||{};cU=cq.extend({type:cT,origType:cV[1],data:cO,handler:cX,guid:cX.guid,selector:cN,namespace:cJ.join(".")},cK);cL=cY[cT];if(!cL){cL=cY[cT]=[];cL.delegateCount=0;if(!cS.setup||cS.setup.call(cM,cO,cJ,cP)===false){if(cM.addEventListener){cM.addEventListener(cT,cP,false)}else{if(cM.attachEvent){cM.attachEvent("on"+cT,cP)}}}}if(cS.add){cS.add.call(cM,cU);if(!cU.handler.guid){cU.handler.guid=cX.guid}}if(cN){cL.splice(cL.delegateCount++,0,cU)}else{cL.push(cU)}cq.event.global[cT]=true}cM=null},global:{},remove:function(cM,cR,cX,cN,cQ){var cY,cZ,cU,cL,cK,cO,cP,cW,cT,cJ,cV,cS=cq.hasData(cM)&&cq._data(cM);if(!cS||!(cW=cS.events)){return}cR=cq.trim(bb(cR||"")).split(" ");for(cY=0;cY<cR.length;cY++){cZ=cb.exec(cR[cY])||[];cU=cL=cZ[1];cK=cZ[2];if(!cU){for(cU in cW){cq.event.remove(cM,cU+cR[cY],cX,cN,true)}continue}cT=cq.event.special[cU]||{};cU=(cN?cT.delegateType:cT.bindType)||cU;cJ=cW[cU]||[];cO=cJ.length;cK=cK?new RegExp("(^|\\.)"+cK.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(cP=0;cP<cJ.length;cP++){cV=cJ[cP];if((cQ||cL===cV.origType)&&(!cX||cX.guid===cV.guid)&&(!cK||cK.test(cV.namespace))&&(!cN||cN===cV.selector||cN==="**"&&cV.selector)){cJ.splice(cP--,1);if(cV.selector){cJ.delegateCount--}if(cT.remove){cT.remove.call(cM,cV)}}}if(cJ.length===0&&cO!==cJ.length){if(!cT.teardown||cT.teardown.call(cM,cK,cS.handle)===false){cq.removeEvent(cM,cU,cS.handle)}delete cW[cU]}}if(cq.isEmptyObject(cW)){delete cS.handle;cq.removeData(cM,"events",true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(cK,cR,cP,cY){if(cP&&(cP.nodeType===3||cP.nodeType===8)){return}var cJ,cM,cS,cW,cO,cN,cU,cT,cQ,cX,cV=cK.type||cK,cL=[];if(ci.test(cV+cq.event.triggered)){return}if(cV.indexOf("!")>=0){cV=cV.slice(0,-1);cM=true}if(cV.indexOf(".")>=0){cL=cV.split(".");cV=cL.shift();cL.sort()}if((!cP||cq.event.customEvent[cV])&&!cq.event.global[cV]){return}cK=typeof cK==="object"?cK[cq.expando]?cK:new cq.Event(cV,cK):new cq.Event(cV);cK.type=cV;cK.isTrigger=true;cK.exclusive=cM;cK.namespace=cL.join(".");cK.namespace_re=cK.namespace?new RegExp("(^|\\.)"+cL.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;cN=cV.indexOf(":")<0?"on"+cV:"";if(!cP){cJ=cq.cache;for(cS in cJ){if(cJ[cS].events&&cJ[cS].events[cV]){cq.event.trigger(cK,cR,cJ[cS].handle.elem,true)}}return}cK.result=bl;if(!cK.target){cK.target=cP}cR=cR!=null?cq.makeArray(cR):[];cR.unshift(cK);cU=cq.event.special[cV]||{};if(cU.trigger&&cU.trigger.apply(cP,cR)===false){return}cQ=[[cP,cU.bindType||cV]];if(!cY&&!cU.noBubble&&!cq.isWindow(cP)){cX=cU.delegateType||cV;cW=ci.test(cX+cV)?cP:cP.parentNode;for(cO=cP;cW;cW=cW.parentNode){cQ.push([cW,cX]);cO=cW}if(cO===(cP.ownerDocument||ai)){cQ.push([cO.defaultView||cO.parentWindow||bM,cX])}}for(cS=0;cS<cQ.length&&!cK.isPropagationStopped();cS++){cW=cQ[cS][0];cK.type=cQ[cS][1];cT=(cq._data(cW,"events")||{})[cK.type]&&cq._data(cW,"handle");if(cT){cT.apply(cW,cR)}cT=cN&&cW[cN];if(cT&&cq.acceptData(cW)&&cT.apply(cW,cR)===false){cK.preventDefault()}}cK.type=cV;if(!cY&&!cK.isDefaultPrevented()){if((!cU._default||cU._default.apply(cP.ownerDocument,cR)===false)&&!(cV==="click"&&cq.nodeName(cP,"a"))&&cq.acceptData(cP)){if(cN&&cP[cV]&&((cV!=="focus"&&cV!=="blur")||cK.target.offsetWidth!==0)&&!cq.isWindow(cP)){cO=cP[cN];if(cO){cP[cN]=null}cq.event.triggered=cV;cP[cV]();cq.event.triggered=bl;if(cO){cP[cN]=cO}}}}return cK.result},dispatch:function(cJ){cJ=cq.event.fix(cJ||bM.event);var cQ,cP,cZ,cT,cS,cK,cR,cX,cM,cY,cN=((cq._data(this,"events")||{})[cJ.type]||[]),cO=cN.delegateCount,cV=[].slice.call(arguments),cL=!cJ.exclusive&&!cJ.namespace,cU=cq.event.special[cJ.type]||{},cW=[];cV[0]=cJ;cJ.delegateTarget=this;if(cU.preDispatch&&cU.preDispatch.call(this,cJ)===false){return}if(cO&&!(cJ.button&&cJ.type==="click")){for(cZ=cJ.target;cZ!=this;cZ=cZ.parentNode||this){if(cZ.disabled!==true||cJ.type!=="click"){cS={};cR=[];for(cQ=0;cQ<cO;cQ++){cX=cN[cQ];cM=cX.selector;if(cS[cM]===bl){cS[cM]=cq(cM,this).index(cZ)>=0}if(cS[cM]){cR.push(cX)}}if(cR.length){cW.push({elem:cZ,matches:cR})}}}}if(cN.length>cO){cW.push({elem:this,matches:cN.slice(cO)})}for(cQ=0;cQ<cW.length&&!cJ.isPropagationStopped();cQ++){cK=cW[cQ];cJ.currentTarget=cK.elem;for(cP=0;cP<cK.matches.length&&!cJ.isImmediatePropagationStopped();cP++){cX=cK.matches[cP];if(cL||(!cJ.namespace&&!cX.namespace)||cJ.namespace_re&&cJ.namespace_re.test(cX.namespace)){cJ.data=cX.data;cJ.handleObj=cX;cT=((cq.event.special[cX.origType]||{}).handle||cX.handler).apply(cK.elem,cV);if(cT!==bl){cJ.result=cT;if(cT===false){cJ.preventDefault();cJ.stopPropagation()}}}}}if(cU.postDispatch){cU.postDispatch.call(this,cJ)}return cJ.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(cK,cJ){if(cK.which==null){cK.which=cJ.charCode!=null?cJ.charCode:cJ.keyCode}return cK}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(cM,cL){var cN,cO,cJ,cK=cL.button,cP=cL.fromElement;if(cM.pageX==null&&cL.clientX!=null){cN=cM.target.ownerDocument||ai;cO=cN.documentElement;cJ=cN.body;cM.pageX=cL.clientX+(cO&&cO.scrollLeft||cJ&&cJ.scrollLeft||0)-(cO&&cO.clientLeft||cJ&&cJ.clientLeft||0);cM.pageY=cL.clientY+(cO&&cO.scrollTop||cJ&&cJ.scrollTop||0)-(cO&&cO.clientTop||cJ&&cJ.clientTop||0)}if(!cM.relatedTarget&&cP){cM.relatedTarget=cP===cM.target?cL.toElement:cP}if(!cM.which&&cK!==bl){cM.which=(cK&1?1:(cK&2?3:(cK&4?2:0)))}return cM}},fix:function(cL){if(cL[cq.expando]){return cL}var cK,cO,cJ=cL,cM=cq.event.fixHooks[cL.type]||{},cN=cM.props?this.props.concat(cM.props):this.props;cL=cq.Event(cJ);for(cK=cN.length;cK;){cO=cN[--cK];cL[cO]=cJ[cO]}if(!cL.target){cL.target=cJ.srcElement||ai}if(cL.target.nodeType===3){cL.target=cL.target.parentNode}cL.metaKey=!!cL.metaKey;return cM.filter?cM.filter(cL,cJ):cL},special:{load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(cL,cK,cJ){if(cq.isWindow(this)){this.onbeforeunload=cJ}},teardown:function(cK,cJ){if(this.onbeforeunload===cJ){this.onbeforeunload=null}}}},simulate:function(cK,cM,cL,cJ){var cN=cq.extend(new cq.Event(),cL,{type:cK,isSimulated:true,originalEvent:{}});if(cJ){cq.event.trigger(cN,null,cM)}else{cq.event.dispatch.call(cM,cN)}if(cN.isDefaultPrevented()){cL.preventDefault()}}};cq.event.handle=cq.event.dispatch;cq.removeEvent=ai.removeEventListener?function(cK,cJ,cL){if(cK.removeEventListener){cK.removeEventListener(cJ,cL,false)}}:function(cL,cK,cM){var cJ="on"+cK;if(cL.detachEvent){if(typeof cL[cJ]==="undefined"){cL[cJ]=null}cL.detachEvent(cJ,cM)}};cq.Event=function(cK,cJ){if(!(this instanceof cq.Event)){return new cq.Event(cK,cJ)}if(cK&&cK.type){this.originalEvent=cK;this.type=cK.type;this.isDefaultPrevented=(cK.defaultPrevented||cK.returnValue===false||cK.getPreventDefault&&cK.getPreventDefault())?aM:aS}else{this.type=cK}if(cJ){cq.extend(this,cJ)}this.timeStamp=cK&&cK.timeStamp||cq.now();this[cq.expando]=true};function aS(){return false}function aM(){return true}cq.Event.prototype={preventDefault:function(){this.isDefaultPrevented=aM;var cJ=this.originalEvent;if(!cJ){return}if(cJ.preventDefault){cJ.preventDefault()}else{cJ.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=aM;var cJ=this.originalEvent;if(!cJ){return}if(cJ.stopPropagation){cJ.stopPropagation()}cJ.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=aM;this.stopPropagation()},isDefaultPrevented:aS,isPropagationStopped:aS,isImmediatePropagationStopped:aS};cq.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(cK,cJ){cq.event.special[cK]={delegateType:cJ,bindType:cJ,handle:function(cO){var cM,cQ=this,cP=cO.relatedTarget,cN=cO.handleObj,cL=cN.selector;if(!cP||(cP!==cQ&&!cq.contains(cQ,cP))){cO.type=cN.origType;cM=cN.handler.apply(this,arguments);cO.type=cJ}return cM}}});if(!cq.support.submitBubbles){cq.event.special.submit={setup:function(){if(cq.nodeName(this,"form")){return false}cq.event.add(this,"click._submit keypress._submit",function(cL){var cK=cL.target,cJ=cq.nodeName(cK,"input")||cq.nodeName(cK,"button")?cK.form:bl;if(cJ&&!cq._data(cJ,"_submit_attached")){cq.event.add(cJ,"submit._submit",function(cM){cM._submit_bubble=true});cq._data(cJ,"_submit_attached",true)}})},postDispatch:function(cJ){if(cJ._submit_bubble){delete cJ._submit_bubble;if(this.parentNode&&!cJ.isTrigger){cq.event.simulate("submit",this.parentNode,cJ,true)}}},teardown:function(){if(cq.nodeName(this,"form")){return false}cq.event.remove(this,"._submit")}}}if(!cq.support.changeBubbles){cq.event.special.change={setup:function(){if(co.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){cq.event.add(this,"propertychange._change",function(cJ){if(cJ.originalEvent.propertyName==="checked"){this._just_changed=true}});cq.event.add(this,"click._change",function(cJ){if(this._just_changed&&!cJ.isTrigger){this._just_changed=false}cq.event.simulate("change",this,cJ,true)})}return false}cq.event.add(this,"beforeactivate._change",function(cK){var cJ=cK.target;if(co.test(cJ.nodeName)&&!cq._data(cJ,"_change_attached")){cq.event.add(cJ,"change._change",function(cL){if(this.parentNode&&!cL.isSimulated&&!cL.isTrigger){cq.event.simulate("change",this.parentNode,cL,true)}});cq._data(cJ,"_change_attached",true)}})},handle:function(cK){var cJ=cK.target;if(this!==cJ||cK.isSimulated||cK.isTrigger||(cJ.type!=="radio"&&cJ.type!=="checkbox")){return cK.handleObj.handler.apply(this,arguments)}},teardown:function(){cq.event.remove(this,"._change");return !co.test(this.nodeName)}}}if(!cq.support.focusinBubbles){cq.each({focus:"focusin",blur:"focusout"},function(cM,cJ){var cK=0,cL=function(cN){cq.event.simulate(cJ,cN.target,cq.event.fix(cN),true)};cq.event.special[cJ]={setup:function(){if(cK++===0){ai.addEventListener(cM,cL,true)}},teardown:function(){if(--cK===0){ai.removeEventListener(cM,cL,true)}}}})}cq.fn.extend({on:function(cL,cJ,cO,cN,cK){var cP,cM;if(typeof cL==="object"){if(typeof cJ!=="string"){cO=cO||cJ;cJ=bl}for(cM in cL){this.on(cM,cJ,cO,cL[cM],cK)}return this}if(cO==null&&cN==null){cN=cJ;cO=cJ=bl}else{if(cN==null){if(typeof cJ==="string"){cN=cO;cO=bl}else{cN=cO;cO=cJ;cJ=bl}}}if(cN===false){cN=aS}else{if(!cN){return this}}if(cK===1){cP=cN;cN=function(cQ){cq().off(cQ);return cP.apply(this,arguments)};cN.guid=cP.guid||(cP.guid=cq.guid++)}return this.each(function(){cq.event.add(this,cL,cN,cO,cJ)})},one:function(cK,cJ,cM,cL){return this.on(cK,cJ,cM,cL,1)},off:function(cL,cJ,cN){var cK,cM;if(cL&&cL.preventDefault&&cL.handleObj){cK=cL.handleObj;cq(cL.delegateTarget).off(cK.namespace?cK.origType+"."+cK.namespace:cK.origType,cK.selector,cK.handler);return this}if(typeof cL==="object"){for(cM in cL){this.off(cM,cJ,cL[cM])}return this}if(cJ===false||typeof cJ==="function"){cN=cJ;cJ=bl}if(cN===false){cN=aS}return this.each(function(){cq.event.remove(this,cL,cN,cJ)})},bind:function(cJ,cL,cK){return this.on(cJ,null,cL,cK)},unbind:function(cJ,cK){return this.off(cJ,null,cK)},live:function(cJ,cL,cK){cq(this.context).on(cJ,this.selector,cL,cK);return this},die:function(cJ,cK){cq(this.context).off(cJ,this.selector||"**",cK);return this},delegate:function(cJ,cK,cM,cL){return this.on(cK,cJ,cM,cL)},undelegate:function(cJ,cK,cL){return arguments.length==1?this.off(cJ,"**"):this.off(cK,cJ||"**",cL)},trigger:function(cJ,cK){return this.each(function(){cq.event.trigger(cJ,cK,this)})},triggerHandler:function(cJ,cK){if(this[0]){return cq.event.trigger(cJ,cK,this[0],true)}},toggle:function(cM){var cK=arguments,cJ=cM.guid||cq.guid++,cL=0,cN=function(cO){var cP=(cq._data(this,"lastToggle"+cM.guid)||0)%cL;cq._data(this,"lastToggle"+cM.guid,cP+1);cO.preventDefault();return cK[cP].apply(this,arguments)||false};cN.guid=cJ;while(cL<cK.length){cK[cL++].guid=cJ}return this.click(cN)},hover:function(cJ,cK){return this.mouseenter(cJ).mouseleave(cK||cJ)}});cq.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(cK,cJ){cq.fn[cJ]=function(cM,cL){if(cL==null){cL=cM;cM=null}return arguments.length>0?this.on(cJ,null,cM,cL):this.trigger(cJ)};if(bN.test(cJ)){cq.event.fixHooks[cJ]=cq.event.keyHooks}if(cu.test(cJ)){cq.event.fixHooks[cJ]=cq.event.mouseHooks}});
/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2012 jQuery Foundation and other contributors
 *  Released under the MIT license
 *  http://sizzlejs.com/
 */
(function(dx,cZ){var c7,dC,cT,dp,cK,c3,df,cW,cY,cV,cS=true,db="undefined",dF=("sizcache"+Math.random()).replace(".",""),cR=dx.document,cU=cR.documentElement,cX=0,c2=[].slice,dB=[].push,dH=function(dM,dN){dM[dF]=dN||true;return dM},dK=function(){var dM={},dN=[];return dH(function(dO,dP){if(dN.push(dO)>dp.cacheLength){delete dM[dN.shift()]}return(dM[dO]=dP)},dM)},dz=dK(),dA=dK(),c4=dK(),de="[\\x20\\t\\r\\n\\f]",c1="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",c0=c1.replace("w","w#"),dJ="([*^$|!~]?=)",du="\\["+de+"*("+c1+")"+de+"*(?:"+dJ+de+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+c0+")|)|)"+de+"*\\]",dL=":("+c1+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+du+")|[^:]|\\\\.)*|.*))\\)|)",dg=":(nth|eq|gt|lt|first|last|even|odd)(?:\\(((?:-\\d)?\\d*)\\)|)(?=[^-]|$)",dD=new RegExp("^"+de+"+|((?:^|[^\\\\])(?:\\\\.)*)"+de+"+$","g"),cO=new RegExp("^"+de+"*,"+de+"*"),dl=new RegExp("^"+de+"*([\\x20\\t\\r\\n\\f>+~])"+de+"*"),dr=new RegExp(dL),dt=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,dj=/^:not/,dw=/[\x20\t\r\n\f]*[+~]/,dG=/:not\($/,c8=/h\d/i,ds=/input|select|textarea|button/i,c9=/\\(?!\\)/g,dk={ID:new RegExp("^#("+c1+")"),CLASS:new RegExp("^\\.("+c1+")"),NAME:new RegExp("^\\[name=['\"]?("+c1+")['\"]?\\]"),TAG:new RegExp("^("+c1.replace("w","w*")+")"),ATTR:new RegExp("^"+du),PSEUDO:new RegExp("^"+dL),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+de+"*(even|odd|(([+-]|)(\\d*)n|)"+de+"*(?:([+-]|)"+de+"*(\\d+)|))"+de+"*\\)|)","i"),POS:new RegExp(dg,"ig"),needsContext:new RegExp("^"+de+"*[>+~]|"+dg,"i")},dn=function(dM){var dO=cR.createElement("div");try{return dM(dO)}catch(dN){return false}finally{dO=null}},cQ=dn(function(dM){dM.appendChild(cR.createComment(""));return !dM.getElementsByTagName("*").length}),di=dn(function(dM){dM.innerHTML="<a href='#'></a>";return dM.firstChild&&typeof dM.firstChild.getAttribute!==db&&dM.firstChild.getAttribute("href")==="#"}),c6=dn(function(dN){dN.innerHTML="<select></select>";var dM=typeof dN.lastChild.getAttribute("multiple");return dM!=="boolean"&&dM!=="string"}),dh=dn(function(dM){dM.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!dM.getElementsByClassName||!dM.getElementsByClassName("e").length){return false}dM.lastChild.className="e";return dM.getElementsByClassName("e").length===2}),cJ=dn(function(dN){dN.id=dF+0;dN.innerHTML="<a name='"+dF+"'></a><div name='"+dF+"'></div>";cU.insertBefore(dN,cU.firstChild);var dM=cR.getElementsByName&&cR.getElementsByName(dF).length===2+cR.getElementsByName(dF+0).length;cT=!cR.getElementById(dF);cU.removeChild(dN);return dM});try{c2.call(cU.childNodes,0)[0].nodeType}catch(dI){c2=function(dN){var dO,dM=[];for(;(dO=this[dN]);dN++){dM.push(dO)}return dM}}function dv(dP,dM,dR,dU){dR=dR||[];dM=dM||cR;var dS,dN,dT,dO,dQ=dM.nodeType;if(dQ!==1&&dQ!==9){return[]}if(!dP||typeof dP!=="string"){return dR}dT=c3(dM);if(!dT&&!dU){if((dS=dt.exec(dP))){if((dO=dS[1])){if(dQ===9){dN=dM.getElementById(dO);if(dN&&dN.parentNode){if(dN.id===dO){dR.push(dN);return dR}}else{return dR}}else{if(dM.ownerDocument&&(dN=dM.ownerDocument.getElementById(dO))&&df(dM,dN)&&dN.id===dO){dR.push(dN);return dR}}}else{if(dS[2]){dB.apply(dR,c2.call(dM.getElementsByTagName(dP),0));return dR}else{if((dO=dS[3])&&dh&&dM.getElementsByClassName){dB.apply(dR,c2.call(dM.getElementsByClassName(dO),0));return dR}}}}}return dE(dP,dM,dR,dU,dT)}dv.matches=function(dN,dM){return dv(dN,null,null,dM)};dv.matchesSelector=function(dM,dN){return dv(dN,null,null,[dM]).length>0};function dm(dM){return function(dO){var dN=dO.nodeName.toLowerCase();return dN==="input"&&dO.type===dM}}function cN(dM){return function(dO){var dN=dO.nodeName.toLowerCase();return(dN==="input"||dN==="button")&&dO.type===dM}}cK=dv.getText=function(dQ){var dP,dN="",dO=0,dM=dQ.nodeType;if(dM){if(dM===1||dM===9||dM===11){if(typeof dQ.textContent==="string"){return dQ.textContent}else{for(dQ=dQ.firstChild;dQ;dQ=dQ.nextSibling){dN+=cK(dQ)}}}else{if(dM===3||dM===4){return dQ.nodeValue}}}else{for(;(dP=dQ[dO]);dO++){dN+=cK(dP)}}return dN};c3=dv.isXML=function c3(dM){var dN=dM&&(dM.ownerDocument||dM).documentElement;return dN?dN.nodeName!=="HTML":false};df=dv.contains=cU.contains?function(dN,dM){var dP=dN.nodeType===9?dN.documentElement:dN,dO=dM&&dM.parentNode;return dN===dO||!!(dO&&dO.nodeType===1&&dP.contains&&dP.contains(dO))}:cU.compareDocumentPosition?function(dN,dM){return dM&&!!(dN.compareDocumentPosition(dM)&16)}:function(dN,dM){while((dM=dM.parentNode)){if(dM===dN){return true}}return false};dv.attr=function(dP,dO){var dM,dN=c3(dP);if(!dN){dO=dO.toLowerCase()}if(dp.attrHandle[dO]){return dp.attrHandle[dO](dP)}if(c6||dN){return dP.getAttribute(dO)}dM=dP.getAttributeNode(dO);return dM?typeof dP[dO]==="boolean"?dP[dO]?dO:null:dM.specified?dM.value:null:null};dp=dv.selectors={cacheLength:50,createPseudo:dH,match:dk,order:new RegExp("ID|TAG"+(cJ?"|NAME":"")+(dh?"|CLASS":"")),attrHandle:di?{}:{href:function(dM){return dM.getAttribute("href",2)},type:function(dM){return dM.getAttribute("type")}},find:{ID:cT?function(dP,dO,dN){if(typeof dO.getElementById!==db&&!dN){var dM=dO.getElementById(dP);return dM&&dM.parentNode?[dM]:[]}}:function(dP,dO,dN){if(typeof dO.getElementById!==db&&!dN){var dM=dO.getElementById(dP);return dM?dM.id===dP||typeof dM.getAttributeNode!==db&&dM.getAttributeNode("id").value===dP?[dM]:cZ:[]}},TAG:cQ?function(dM,dN){if(typeof dN.getElementsByTagName!==db){return dN.getElementsByTagName(dM)}}:function(dM,dQ){var dP=dQ.getElementsByTagName(dM);if(dM==="*"){var dR,dO=[],dN=0;for(;(dR=dP[dN]);dN++){if(dR.nodeType===1){dO.push(dR)}}return dO}return dP},NAME:function(dM,dN){if(typeof dN.getElementsByName!==db){return dN.getElementsByName(name)}},CLASS:function(dO,dN,dM){if(typeof dN.getElementsByClassName!==db&&!dM){return dN.getElementsByClassName(dO)}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(dM){dM[1]=dM[1].replace(c9,"");dM[3]=(dM[4]||dM[5]||"").replace(c9,"");if(dM[2]==="~="){dM[3]=" "+dM[3]+" "}return dM.slice(0,4)},CHILD:function(dM){dM[1]=dM[1].toLowerCase();if(dM[1]==="nth"){if(!dM[2]){dv.error(dM[0])}dM[3]=+(dM[3]?dM[4]+(dM[5]||1):2*(dM[2]==="even"||dM[2]==="odd"));dM[4]=+((dM[6]+dM[7])||dM[2]==="odd")}else{if(dM[2]){dv.error(dM[0])}}return dM},PSEUDO:function(dO,dP,dN){var dQ,dM;if(dk.CHILD.test(dO[0])){return null}if(dO[3]){dO[2]=dO[3]}else{if((dQ=dO[4])){if(dr.test(dQ)&&(dM=cL(dQ,dP,dN,true))&&(dM=dQ.indexOf(")",dQ.length-dM)-dQ.length)){dQ=dQ.slice(0,dM);dO[0]=dO[0].slice(0,dM)}dO[2]=dQ}}return dO.slice(0,3)}},filter:{ID:cT?function(dM){dM=dM.replace(c9,"");return function(dN){return dN.getAttribute("id")===dM}}:function(dM){dM=dM.replace(c9,"");return function(dO){var dN=typeof dO.getAttributeNode!==db&&dO.getAttributeNode("id");return dN&&dN.value===dM}},TAG:function(dM){if(dM==="*"){return function(){return true}}dM=dM.replace(c9,"").toLowerCase();return function(dN){return dN.nodeName&&dN.nodeName.toLowerCase()===dM}},CLASS:function(dM){var dN=dz[dF][dM];if(!dN){dN=dz(dM,new RegExp("(^|"+de+")"+dM+"("+de+"|$)"))}return function(dO){return dN.test(dO.className||(typeof dO.getAttribute!==db&&dO.getAttribute("class"))||"")}},ATTR:function(dO,dN,dM){if(!dN){return function(dP){return dv.attr(dP,dO)!=null}}return function(dQ){var dP=dv.attr(dQ,dO),dR=dP+"";if(dP==null){return dN==="!="}switch(dN){case"=":return dR===dM;case"!=":return dR!==dM;case"^=":return dM&&dR.indexOf(dM)===0;case"*=":return dM&&dR.indexOf(dM)>-1;case"$=":return dM&&dR.substr(dR.length-dM.length)===dM;case"~=":return(" "+dR+" ").indexOf(dM)>-1;case"|=":return dR===dM||dR.substr(0,dM.length+1)===dM+"-"}}},CHILD:function(dN,dP,dQ,dO){if(dN==="nth"){var dM=cX++;return function(dU){var dR,dV,dT=0,dS=dU;if(dQ===1&&dO===0){return true}dR=dU.parentNode;if(dR&&(dR[dF]!==dM||!dU.sizset)){for(dS=dR.firstChild;dS;dS=dS.nextSibling){if(dS.nodeType===1){dS.sizset=++dT;if(dS===dU){break}}}dR[dF]=dM}dV=dU.sizset-dO;if(dQ===0){return dV===0}else{return(dV%dQ===0&&dV/dQ>=0)}}}return function(dS){var dR=dS;switch(dN){case"only":case"first":while((dR=dR.previousSibling)){if(dR.nodeType===1){return false}}if(dN==="first"){return true}dR=dS;case"last":while((dR=dR.nextSibling)){if(dR.nodeType===1){return false}}return true}}},PSEUDO:function(dR,dQ,dO,dN){var dM,dP=dp.pseudos[dR]||dp.pseudos[dR.toLowerCase()];if(!dP){dv.error("unsupported pseudo: "+dR)}if(!dP[dF]){if(dP.length>1){dM=[dR,dR,"",dQ];return function(dS){return dP(dS,0,dM)}}return dP}return dP(dQ,dO,dN)}},pseudos:{not:dH(function(dM,dO,dN){var dP=cW(dM.replace(dD,"$1"),dO,dN);return function(dQ){return !dP(dQ)}}),enabled:function(dM){return dM.disabled===false},disabled:function(dM){return dM.disabled===true},checked:function(dM){var dN=dM.nodeName.toLowerCase();return(dN==="input"&&!!dM.checked)||(dN==="option"&&!!dM.selected)},selected:function(dM){if(dM.parentNode){dM.parentNode.selectedIndex}return dM.selected===true},parent:function(dM){return !dp.pseudos.empty(dM)},empty:function(dN){var dM;dN=dN.firstChild;while(dN){if(dN.nodeName>"@"||(dM=dN.nodeType)===3||dM===4){return false}dN=dN.nextSibling}return true},contains:dH(function(dM){return function(dN){return(dN.textContent||dN.innerText||cK(dN)).indexOf(dM)>-1}}),has:dH(function(dM){return function(dN){return dv(dM,dN).length>0}}),header:function(dM){return c8.test(dM.nodeName)},text:function(dO){var dN,dM;return dO.nodeName.toLowerCase()==="input"&&(dN=dO.type)==="text"&&((dM=dO.getAttribute("type"))==null||dM.toLowerCase()===dN)},radio:dm("radio"),checkbox:dm("checkbox"),file:dm("file"),password:dm("password"),image:dm("image"),submit:cN("submit"),reset:cN("reset"),button:function(dN){var dM=dN.nodeName.toLowerCase();return dM==="input"&&dN.type==="button"||dM==="button"},input:function(dM){return ds.test(dM.nodeName)},focus:function(dM){var dN=dM.ownerDocument;return dM===dN.activeElement&&(!dN.hasFocus||dN.hasFocus())&&!!(dM.type||dM.href)},active:function(dM){return dM===dM.ownerDocument.activeElement}},setFilters:{first:function(dO,dN,dM){return dM?dO.slice(1):[dO[0]]},last:function(dP,dO,dN){var dM=dP.pop();return dN?dP:[dM]},even:function(dR,dQ,dP){var dO=[],dN=dP?1:0,dM=dR.length;for(;dN<dM;dN=dN+2){dO.push(dR[dN])}return dO},odd:function(dR,dQ,dP){var dO=[],dN=dP?0:1,dM=dR.length;for(;dN<dM;dN=dN+2){dO.push(dR[dN])}return dO},lt:function(dO,dN,dM){return dM?dO.slice(+dN):dO.slice(0,+dN)},gt:function(dO,dN,dM){return dM?dO.slice(0,+dN+1):dO.slice(+dN+1)},eq:function(dP,dO,dN){var dM=dP.splice(+dO,1);return dN?dP:dM}}};function cM(dN,dM,dO){if(dN===dM){return dO}var dP=dN.nextSibling;while(dP){if(dP===dM){return -1}dP=dP.nextSibling}return 1}cY=cU.compareDocumentPosition?function(dN,dM){if(dN===dM){cV=true;return 0}return(!dN.compareDocumentPosition||!dM.compareDocumentPosition?dN.compareDocumentPosition:dN.compareDocumentPosition(dM)&4)?-1:1}:function(dU,dT){if(dU===dT){cV=true;return 0}else{if(dU.sourceIndex&&dT.sourceIndex){return dU.sourceIndex-dT.sourceIndex}}var dR,dN,dO=[],dM=[],dQ=dU.parentNode,dS=dT.parentNode,dV=dQ;if(dQ===dS){return cM(dU,dT)}else{if(!dQ){return -1}else{if(!dS){return 1}}}while(dV){dO.unshift(dV);dV=dV.parentNode}dV=dS;while(dV){dM.unshift(dV);dV=dV.parentNode}dR=dO.length;dN=dM.length;for(var dP=0;dP<dR&&dP<dN;dP++){if(dO[dP]!==dM[dP]){return cM(dO[dP],dM[dP])}}return dP===dR?cM(dU,dM[dP],-1):cM(dO[dP],dT,1)};[0,0].sort(cY);cS=!cV;dv.uniqueSort=function(dN){var dO,dM=1;cV=cS;dN.sort(cY);if(cV){for(;(dO=dN[dM]);dM++){if(dO===dN[dM-1]){dN.splice(dM--,1)}}}return dN};dv.error=function(dM){throw new Error("Syntax error, unrecognized expression: "+dM)};function cL(dT,dN,dV,d2){var dO,dW,dY,dZ,dX,dQ,d1,dU,dM,dP,dS=!dV&&dN!==cR,d0=(dS?"<s>":"")+dT.replace(dD,"$1<s>"),dR=dA[dF][d0];if(dR){return d2?0:c2.call(dR,0)}dX=dT;dQ=[];dU=0;dM=dp.preFilter;dP=dp.filter;while(dX){if(!dO||(dW=cO.exec(dX))){if(dW){dX=dX.slice(dW[0].length);dY.selector=d1}dQ.push(dY=[]);d1="";if(dS){dX=" "+dX}}dO=false;if((dW=dl.exec(dX))){d1+=dW[0];dX=dX.slice(dW[0].length);dO=dY.push({part:dW.pop().replace(dD," "),string:dW[0],captures:dW})}for(dZ in dP){if((dW=dk[dZ].exec(dX))&&(!dM[dZ]||(dW=dM[dZ](dW,dN,dV)))){d1+=dW[0];dX=dX.slice(dW[0].length);dO=dY.push({part:dZ,string:dW.shift(),captures:dW})}}if(!dO){break}}if(d1){dY.selector=d1}return d2?dX.length:dX?dv.error(dT):c2.call(dA(d0,dQ),0)}function dc(dR,dQ,dP,dN){var dM=dQ.dir,dO=cX++;if(!dR){dR=function(dS){return dS===dP}}return dQ.first?function(dS){while((dS=dS[dM])){if(dS.nodeType===1){return dR(dS)&&dS}}}:dN?function(dS){while((dS=dS[dM])){if(dS.nodeType===1){if(dR(dS)){return dS}}}}:function(dT){var dS,dU=dO+"."+c7,dV=dU+"."+dC;while((dT=dT[dM])){if(dT.nodeType===1){if((dS=dT[dF])===dV){return dT.sizset}else{if(typeof dS==="string"&&dS.indexOf(dU)===0){if(dT.sizset){return dT}}else{dT[dF]=dV;if(dR(dT)){dT.sizset=true;return dT}dT.sizset=false}}}}}}function da(dM,dN){return dM?function(dP){var dO=dN(dP);return dO&&dM(dO===true?dP:dO)}:dN}function dd(dR,dP,dM){var dO,dQ,dN=0;for(;(dO=dR[dN]);dN++){if(dp.relative[dO.part]){dQ=dc(dQ,dp.relative[dO.part],dP,dM)}else{dQ=da(dQ,dp.filter[dO.part].apply(null,dO.captures.concat(dP,dM)))}}return dQ}function cP(dM){return function(dO){var dP,dN=0;for(;(dP=dM[dN]);dN++){if(dP(dO)){return true}}return false}}cW=dv.compile=function(dN,dQ,dO){var dS,dP,dM,dR=c4[dF][dN];if(dR&&dR.context===dQ){return dR}dS=cL(dN,dQ,dO);for(dP=0,dM=dS.length;dP<dM;dP++){dS[dP]=dd(dS[dP],dQ,dO)}dR=c4(dN,cP(dS));dR.context=dQ;dR.runs=dR.dirruns=0;return dR};function c5(dN,dR,dQ,dO){var dP=0,dM=dR.length;for(;dP<dM;dP++){dv(dN,dR[dP],dQ,dO)}}function dq(dM,dO,dS,dT,dN,dR){var dP,dQ=dp.setFilters[dO.toLowerCase()];if(!dQ){dv.error(dO)}if(dM||!(dP=dN)){c5(dM||"*",dT,(dP=[]),dN)}return dP.length>0?dQ(dP,dS,dR):[]}function dy(d5,dM,dY,dO){var dU,dZ,d0,dX,dR,d1,dQ,dW,dS,dV,d4,d6,dN,d2=0,d3=d5.length,dP=dk.POS,dT=new RegExp("^"+dP.source+"(?!"+de+")","i"),d7=function(){var d9=1,d8=arguments.length-2;for(;d9<d8;d9++){if(arguments[d9]===cZ){dS[d9]=cZ}}};for(;d2<d3;d2++){dU=d5[d2];dZ="";dW=dO;for(d0=0,dX=dU.length;d0<dX;d0++){dR=dU[d0];d1=dR.string;if(dR.part==="PSEUDO"){dP.exec("");dQ=0;while((dS=dP.exec(d1))){dV=true;d4=dP.lastIndex=dS.index+dS[0].length;if(d4>dQ){dZ+=d1.slice(dQ,dS.index);dQ=d4;d6=[dM];if(dl.test(dZ)){if(dW){d6=dW}dW=dO}if((dN=dG.test(dZ))){dZ=dZ.slice(0,-5).replace(dl,"$&*");dQ++}if(dS.length>1){dS[0].replace(dT,d7)}dW=dq(dZ,dS[1],dS[2],d6,dW,dN)}dZ=""}}if(!dV){dZ+=d1}dV=false}if(dZ){if(dl.test(dZ)){c5(dZ,dW||[dM],dY,dO)}else{dv(dZ,dM,dY,dO?dO.concat(dW):dW)}}else{dB.apply(dY,dW)}}return d3===1?dY:dv.uniqueSort(dY)}function dE(dS,dN,dU,dX,dW){dS=dS.replace(dD,"$1");var dM,dY,dQ,dP,dT,d0,dR,dO,d1,dZ,dV=cL(dS,dN,dW),d2=dN.nodeType;if(dk.POS.test(dS)){return dy(dV,dN,dU,dX)}if(dX){dM=c2.call(dX,0)}else{if(dV.length===1){if((d0=c2.call(dV[0],0)).length>2&&(dR=d0[0]).part==="ID"&&d2===9&&!dW&&dp.relative[d0[1].part]){dN=dp.find.ID(dR.captures[0].replace(c9,""),dN,dW)[0];if(!dN){return dU}dS=dS.slice(d0.shift().string.length)}d1=((dV=dw.exec(d0[0].string))&&!dV.index&&dN.parentNode)||dN;dO="";for(dT=d0.length-1;dT>=0;dT--){dR=d0[dT];dZ=dR.part;dO=dR.string+dO;if(dp.relative[dZ]){break}if(dp.order.test(dZ)){dM=dp.find[dZ](dR.captures[0].replace(c9,""),d1,dW);if(dM==null){continue}else{dS=dS.slice(0,dS.length-dO.length)+dO.replace(dk[dZ],"");if(!dS){dB.apply(dU,c2.call(dM,0))}break}}}}}if(dS){dY=cW(dS,dN,dW);c7=dY.dirruns++;if(dM==null){dM=dp.find.TAG("*",(dw.test(dS)&&dN.parentNode)||dN)}for(dT=0;(dP=dM[dT]);dT++){dC=dY.runs++;if(dY(dP)){dU.push(dP)}}}return dU}if(cR.querySelectorAll){(function(){var dR,dS=dE,dQ=/'|\\/g,dO=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,dN=[],dM=[":active"],dP=cU.matchesSelector||cU.mozMatchesSelector||cU.webkitMatchesSelector||cU.oMatchesSelector||cU.msMatchesSelector;dn(function(dT){dT.innerHTML="<select><option selected=''></option></select>";if(!dT.querySelectorAll("[selected]").length){dN.push("\\["+de+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)")}if(!dT.querySelectorAll(":checked").length){dN.push(":checked")}});dn(function(dT){dT.innerHTML="<p test=''></p>";if(dT.querySelectorAll("[test^='']").length){dN.push("[*^$]="+de+"*(?:\"\"|'')")}dT.innerHTML="<input type='hidden'/>";if(!dT.querySelectorAll(":enabled").length){dN.push(":enabled",":disabled")}});dN=dN.length&&new RegExp(dN.join("|"));dE=function(dZ,dU,d0,d3,d2){if(!d3&&!d2&&(!dN||!dN.test(dZ))){if(dU.nodeType===9){try{dB.apply(d0,c2.call(dU.querySelectorAll(dZ),0));return d0}catch(dY){}}else{if(dU.nodeType===1&&dU.nodeName.toLowerCase()!=="object"){var dX,d1,d4,dW=dU.getAttribute("id"),dT=dW||dF,dV=dw.test(dZ)&&dU.parentNode||dU;if(dW){dT=dT.replace(dQ,"\\$&")}else{dU.setAttribute("id",dT)}dX=cL(dZ,dU,d2);dT="[id='"+dT+"']";for(d1=0,d4=dX.length;d1<d4;d1++){dX[d1]=dT+dX[d1].selector}try{dB.apply(d0,c2.call(dV.querySelectorAll(dX.join(",")),0));return d0}catch(dY){}finally{if(!dW){dU.removeAttribute("id")}}}}}return dS(dZ,dU,d0,d3,d2)};if(dP){dn(function(dU){dR=dP.call(dU,"div");try{dP.call(dU,"[test!='']:sizzle");dM.push(dk.PSEUDO.source,dk.POS.source,"!=")}catch(dT){}});dM=new RegExp(dM.join("|"));dv.matchesSelector=function(dU,dW){dW=dW.replace(dO,"='$1']");if(!c3(dU)&&!dM.test(dW)&&(!dN||!dN.test(dW))){try{var dT=dP.call(dU,dW);if(dT||dR||dU.document&&dU.document.nodeType!==11){return dT}}catch(dV){}}return dv(dW,null,null,[dU]).length>0}}})()}dp.setFilters.nth=dp.setFilters.eq;dp.filters=dp.pseudos;dv.attr=cq.attr;cq.find=dv;cq.expr=dv.selectors;cq.expr[":"]=cq.expr.pseudos;cq.unique=dv.uniqueSort;cq.text=dv.getText;cq.isXMLDoc=dv.isXML;cq.contains=dv.contains})(bM);var a1=/Until$/,ca=/^(?:parents|prev(?:Until|All))/,a6=/^.[^:#\[\.,]*$/,at=cq.expr.match.needsContext,ce={children:true,contents:true,next:true,prev:true};cq.fn.extend({find:function(cJ){var cN,cK,cP,cQ,cO,cM,cL=this;if(typeof cJ!=="string"){return cq(cJ).filter(function(){for(cN=0,cK=cL.length;cN<cK;cN++){if(cq.contains(cL[cN],this)){return true}}})}cM=this.pushStack("","find",cJ);for(cN=0,cK=this.length;cN<cK;cN++){cP=cM.length;cq.find(cJ,this[cN],cM);if(cN>0){for(cQ=cP;cQ<cM.length;cQ++){for(cO=0;cO<cP;cO++){if(cM[cO]===cM[cQ]){cM.splice(cQ--,1);break}}}}}return cM},has:function(cM){var cL,cK=cq(cM,this),cJ=cK.length;return this.filter(function(){for(cL=0;cL<cJ;cL++){if(cq.contains(this,cK[cL])){return true}}})},not:function(cJ){return this.pushStack(bw(this,cJ,false),"not",cJ)},filter:function(cJ){return this.pushStack(bw(this,cJ,true),"filter",cJ)},is:function(cJ){return !!cJ&&(typeof cJ==="string"?at.test(cJ)?cq(cJ,this.context).index(this[0])>=0:cq.filter(cJ,this).length>0:this.filter(cJ).length>0)},closest:function(cN,cM){var cO,cL=0,cJ=this.length,cK=[],cP=at.test(cN)||typeof cN!=="string"?cq(cN,cM||this.context):0;for(;cL<cJ;cL++){cO=this[cL];while(cO&&cO.ownerDocument&&cO!==cM&&cO.nodeType!==11){if(cP?cP.index(cO)>-1:cq.find.matchesSelector(cO,cN)){cK.push(cO);break}cO=cO.parentNode}}cK=cK.length>1?cq.unique(cK):cK;return this.pushStack(cK,"closest",cN)},index:function(cJ){if(!cJ){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1}if(typeof cJ==="string"){return cq.inArray(this[0],cq(cJ))}return cq.inArray(cJ.jquery?cJ[0]:cJ,this)},add:function(cJ,cK){var cM=typeof cJ==="string"?cq(cJ,cK):cq.makeArray(cJ&&cJ.nodeType?[cJ]:cJ),cL=cq.merge(this.get(),cM);return this.pushStack(bB(cM[0])||bB(cL[0])?cL:cq.unique(cL))},addBack:function(cJ){return this.add(cJ==null?this.prevObject:this.prevObject.filter(cJ))}});cq.fn.andSelf=cq.fn.addBack;function bB(cJ){return !cJ||!cJ.parentNode||cJ.parentNode.nodeType===11}function bI(cK,cJ){do{cK=cK[cJ]}while(cK&&cK.nodeType!==1);return cK}cq.each({parent:function(cK){var cJ=cK.parentNode;return cJ&&cJ.nodeType!==11?cJ:null},parents:function(cJ){return cq.dir(cJ,"parentNode")},parentsUntil:function(cK,cJ,cL){return cq.dir(cK,"parentNode",cL)},next:function(cJ){return bI(cJ,"nextSibling")},prev:function(cJ){return bI(cJ,"previousSibling")},nextAll:function(cJ){return cq.dir(cJ,"nextSibling")},prevAll:function(cJ){return cq.dir(cJ,"previousSibling")},nextUntil:function(cK,cJ,cL){return cq.dir(cK,"nextSibling",cL)},prevUntil:function(cK,cJ,cL){return cq.dir(cK,"previousSibling",cL)},siblings:function(cJ){return cq.sibling((cJ.parentNode||{}).firstChild,cJ)},children:function(cJ){return cq.sibling(cJ.firstChild)},contents:function(cJ){return cq.nodeName(cJ,"iframe")?cJ.contentDocument||cJ.contentWindow.document:cq.merge([],cJ.childNodes)}},function(cJ,cK){cq.fn[cJ]=function(cN,cL){var cM=cq.map(this,cK,cN);if(!a1.test(cJ)){cL=cN}if(cL&&typeof cL==="string"){cM=cq.filter(cL,cM)}cM=this.length>1&&!ce[cJ]?cq.unique(cM):cM;if(this.length>1&&ca.test(cJ)){cM=cM.reverse()}return this.pushStack(cM,cJ,bO.call(arguments).join(","))}});cq.extend({filter:function(cL,cJ,cK){if(cK){cL=":not("+cL+")"}return cJ.length===1?cq.find.matchesSelector(cJ[0],cL)?[cJ[0]]:[]:cq.find.matches(cL,cJ)},dir:function(cL,cK,cN){var cJ=[],cM=cL[cK];while(cM&&cM.nodeType!==9&&(cN===bl||cM.nodeType!==1||!cq(cM).is(cN))){if(cM.nodeType===1){cJ.push(cM)}cM=cM[cK]}return cJ},sibling:function(cL,cK){var cJ=[];for(;cL;cL=cL.nextSibling){if(cL.nodeType===1&&cL!==cK){cJ.push(cL)}}return cJ}});function bw(cM,cL,cJ){cL=cL||0;if(cq.isFunction(cL)){return cq.grep(cM,function(cO,cN){var cP=!!cL.call(cO,cN,cO);return cP===cJ})}else{if(cL.nodeType){return cq.grep(cM,function(cO,cN){return(cO===cL)===cJ})}else{if(typeof cL==="string"){var cK=cq.grep(cM,function(cN){return cN.nodeType===1});if(a6.test(cL)){return cq.filter(cL,cK,!cJ)}else{cL=cq.filter(cL,cK)}}}}return cq.grep(cM,function(cO,cN){return(cq.inArray(cO,cL)>=0)===cJ})}function av(cJ){var cL=X.split("|"),cK=cJ.createDocumentFragment();if(cK.createElement){while(cL.length){cK.createElement(cL.pop())}}return cK}var X="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bf=/ jQuery\d+="(?:null|\d+)"/g,cI=/^\s+/,bi=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,aj=/<([\w:]+)/,cD=/<tbody/i,aE=/<|&#?\w+;/,a4=/<(?:script|style|link)/i,ba=/<(?:script|object|embed|option|style)/i,aF=new RegExp("<(?:"+X+")[\\s/>]","i"),bo=/^(?:checkbox|radio)$/,cB=/checked\s*(?:[^=]|=\s*.checked.)/i,cg=/\/(java|ecma)script/i,br=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,aO={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bA=av(ai),af=bA.appendChild(ai.createElement("div"));aO.optgroup=aO.option;aO.tbody=aO.tfoot=aO.colgroup=aO.caption=aO.thead;aO.th=aO.td;if(!cq.support.htmlSerialize){aO._default=[1,"X<div>","</div>"]}cq.fn.extend({text:function(cJ){return cq.access(this,function(cK){return cK===bl?cq.text(this):this.empty().append((this[0]&&this[0].ownerDocument||ai).createTextNode(cK))},null,cJ,arguments.length)},wrapAll:function(cJ){if(cq.isFunction(cJ)){return this.each(function(cL){cq(this).wrapAll(cJ.call(this,cL))})}if(this[0]){var cK=cq(cJ,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){cK.insertBefore(this[0])}cK.map(function(){var cL=this;while(cL.firstChild&&cL.firstChild.nodeType===1){cL=cL.firstChild}return cL}).append(this)}return this},wrapInner:function(cJ){if(cq.isFunction(cJ)){return this.each(function(cK){cq(this).wrapInner(cJ.call(this,cK))})}return this.each(function(){var cK=cq(this),cL=cK.contents();if(cL.length){cL.wrapAll(cJ)}else{cK.append(cJ)}})},wrap:function(cJ){var cK=cq.isFunction(cJ);return this.each(function(cL){cq(this).wrapAll(cK?cJ.call(this,cL):cJ)})},unwrap:function(){return this.parent().each(function(){if(!cq.nodeName(this,"body")){cq(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(cJ){if(this.nodeType===1||this.nodeType===11){this.appendChild(cJ)}})},prepend:function(){return this.domManip(arguments,true,function(cJ){if(this.nodeType===1||this.nodeType===11){this.insertBefore(cJ,this.firstChild)}})},before:function(){if(!bB(this[0])){return this.domManip(arguments,false,function(cK){this.parentNode.insertBefore(cK,this)})}if(arguments.length){var cJ=cq.clean(arguments);return this.pushStack(cq.merge(cJ,this),"before",this.selector)}},after:function(){if(!bB(this[0])){return this.domManip(arguments,false,function(cK){this.parentNode.insertBefore(cK,this.nextSibling)})}if(arguments.length){var cJ=cq.clean(arguments);return this.pushStack(cq.merge(this,cJ),"after",this.selector)}},remove:function(cJ,cM){var cL,cK=0;for(;(cL=this[cK])!=null;cK++){if(!cJ||cq.filter(cJ,[cL]).length){if(!cM&&cL.nodeType===1){cq.cleanData(cL.getElementsByTagName("*"));cq.cleanData([cL])}if(cL.parentNode){cL.parentNode.removeChild(cL)}}}return this},empty:function(){var cK,cJ=0;for(;(cK=this[cJ])!=null;cJ++){if(cK.nodeType===1){cq.cleanData(cK.getElementsByTagName("*"))}while(cK.firstChild){cK.removeChild(cK.firstChild)}}return this},clone:function(cK,cJ){cK=cK==null?false:cK;cJ=cJ==null?cK:cJ;return this.map(function(){return cq.clone(this,cK,cJ)})},html:function(cJ){return cq.access(this,function(cN){var cM=this[0]||{},cL=0,cK=this.length;if(cN===bl){return cM.nodeType===1?cM.innerHTML.replace(bf,""):bl}if(typeof cN==="string"&&!a4.test(cN)&&(cq.support.htmlSerialize||!aF.test(cN))&&(cq.support.leadingWhitespace||!cI.test(cN))&&!aO[(aj.exec(cN)||["",""])[1].toLowerCase()]){cN=cN.replace(bi,"<$1></$2>");try{for(;cL<cK;cL++){cM=this[cL]||{};if(cM.nodeType===1){cq.cleanData(cM.getElementsByTagName("*"));cM.innerHTML=cN}}cM=0}catch(cO){}}if(cM){this.empty().append(cN)}},null,cJ,arguments.length)},replaceWith:function(cJ){if(!bB(this[0])){if(cq.isFunction(cJ)){return this.each(function(cM){var cL=cq(this),cK=cL.html();cL.replaceWith(cJ.call(this,cM,cK))})}if(typeof cJ!=="string"){cJ=cq(cJ).detach()}return this.each(function(){var cL=this.nextSibling,cK=this.parentNode;cq(this).remove();if(cL){cq(cL).before(cJ)}else{cq(cK).append(cJ)}})}return this.length?this.pushStack(cq(cq.isFunction(cJ)?cJ():cJ),"replaceWith",cJ):this},detach:function(cJ){return this.remove(cJ,true)},domManip:function(cP,cT,cS){cP=[].concat.apply([],cP);var cL,cN,cO,cR,cM=0,cQ=cP[0],cK=[],cJ=this.length;if(!cq.support.checkClone&&cJ>1&&typeof cQ==="string"&&cB.test(cQ)){return this.each(function(){cq(this).domManip(cP,cT,cS)})}if(cq.isFunction(cQ)){return this.each(function(cV){var cU=cq(this);cP[0]=cQ.call(this,cV,cT?cU.html():bl);cU.domManip(cP,cT,cS)})}if(this[0]){cL=cq.buildFragment(cP,this,cK);cO=cL.fragment;cN=cO.firstChild;if(cO.childNodes.length===1){cO=cN}if(cN){cT=cT&&cq.nodeName(cN,"tr");for(cR=cL.cacheable||cJ-1;cM<cJ;cM++){cS.call(cT&&cq.nodeName(this[cM],"table")?ar(this[cM],"tbody"):this[cM],cM===cR?cO:cq.clone(cO,true,true))}}cO=cN=null;if(cK.length){cq.each(cK,function(cU,cV){if(cV.src){if(cq.ajax){cq.ajax({url:cV.src,type:"GET",dataType:"script",async:false,global:false,"throws":true})}else{cq.error("no ajax")}}else{cq.globalEval((cV.text||cV.textContent||cV.innerHTML||"").replace(br,""))}if(cV.parentNode){cV.parentNode.removeChild(cV)}})}}return this}});function ar(cK,cJ){return cK.getElementsByTagName(cJ)[0]||cK.appendChild(cK.ownerDocument.createElement(cJ))}function a9(cQ,cK){if(cK.nodeType!==1||!cq.hasData(cQ)){return}var cN,cM,cJ,cP=cq._data(cQ),cO=cq._data(cK,cP),cL=cP.events;if(cL){delete cO.handle;cO.events={};for(cN in cL){for(cM=0,cJ=cL[cN].length;cM<cJ;cM++){cq.event.add(cK,cN,cL[cN][cM])}}}if(cO.data){cO.data=cq.extend({},cO.data)}}function aA(cK,cJ){var cL;if(cJ.nodeType!==1){return}if(cJ.clearAttributes){cJ.clearAttributes()}if(cJ.mergeAttributes){cJ.mergeAttributes(cK)}cL=cJ.nodeName.toLowerCase();if(cL==="object"){if(cJ.parentNode){cJ.outerHTML=cK.outerHTML}if(cq.support.html5Clone&&(cK.innerHTML&&!cq.trim(cJ.innerHTML))){cJ.innerHTML=cK.innerHTML}}else{if(cL==="input"&&bo.test(cK.type)){cJ.defaultChecked=cJ.checked=cK.checked;if(cJ.value!==cK.value){cJ.value=cK.value}}else{if(cL==="option"){cJ.selected=cK.defaultSelected}else{if(cL==="input"||cL==="textarea"){cJ.defaultValue=cK.defaultValue}else{if(cL==="script"&&cJ.text!==cK.text){cJ.text=cK.text}}}}}cJ.removeAttribute(cq.expando)}cq.buildFragment=function(cM,cN,cK){var cL,cJ,cO,cP=cM[0];cN=cN||ai;cN=!cN.nodeType&&cN[0]||cN;cN=cN.ownerDocument||cN;if(cM.length===1&&typeof cP==="string"&&cP.length<512&&cN===ai&&cP.charAt(0)==="<"&&!ba.test(cP)&&(cq.support.checkClone||!cB.test(cP))&&(cq.support.html5Clone||!aF.test(cP))){cJ=true;cL=cq.fragments[cP];cO=cL!==bl}if(!cL){cL=cN.createDocumentFragment();cq.clean(cM,cN,cL,cK);if(cJ){cq.fragments[cP]=cO&&cL}}return{fragment:cL,cacheable:cJ}};cq.fragments={};cq.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(cJ,cK){cq.fn[cJ]=function(cL){var cN,cP=0,cO=[],cR=cq(cL),cM=cR.length,cQ=this.length===1&&this[0].parentNode;if((cQ==null||cQ&&cQ.nodeType===11&&cQ.childNodes.length===1)&&cM===1){cR[cK](this[0]);return this}else{for(;cP<cM;cP++){cN=(cP>0?this.clone(true):this).get();cq(cR[cP])[cK](cN);cO=cO.concat(cN)}return this.pushStack(cO,cJ,cR.selector)}}});function ag(cJ){if(typeof cJ.getElementsByTagName!=="undefined"){return cJ.getElementsByTagName("*")}else{if(typeof cJ.querySelectorAll!=="undefined"){return cJ.querySelectorAll("*")}else{return[]}}}function cC(cJ){if(bo.test(cJ.type)){cJ.defaultChecked=cJ.checked}}cq.extend({clone:function(cN,cP,cL){var cJ,cK,cM,cO;if(cq.support.html5Clone||cq.isXMLDoc(cN)||!aF.test("<"+cN.nodeName+">")){cO=cN.cloneNode(true)}else{af.innerHTML=cN.outerHTML;af.removeChild(cO=af.firstChild)}if((!cq.support.noCloneEvent||!cq.support.noCloneChecked)&&(cN.nodeType===1||cN.nodeType===11)&&!cq.isXMLDoc(cN)){aA(cN,cO);cJ=ag(cN);cK=ag(cO);for(cM=0;cJ[cM];++cM){if(cK[cM]){aA(cJ[cM],cK[cM])}}}if(cP){a9(cN,cO);if(cL){cJ=ag(cN);cK=ag(cO);for(cM=0;cJ[cM];++cM){a9(cJ[cM],cK[cM])}}}cJ=cK=null;return cO},clean:function(cW,cL,cJ,cM){var cT,cS,cV,c0,cP,cZ,cQ,cN,cK,cU,cY,cR,cO=cL===ai&&bA,cX=[];if(!cL||typeof cL.createDocumentFragment==="undefined"){cL=ai}for(cT=0;(cV=cW[cT])!=null;cT++){if(typeof cV==="number"){cV+=""}if(!cV){continue}if(typeof cV==="string"){if(!aE.test(cV)){cV=cL.createTextNode(cV)}else{cO=cO||av(cL);cQ=cL.createElement("div");cO.appendChild(cQ);cV=cV.replace(bi,"<$1></$2>");c0=(aj.exec(cV)||["",""])[1].toLowerCase();cP=aO[c0]||aO._default;cZ=cP[0];cQ.innerHTML=cP[1]+cV+cP[2];while(cZ--){cQ=cQ.lastChild}if(!cq.support.tbody){cN=cD.test(cV);cK=c0==="table"&&!cN?cQ.firstChild&&cQ.firstChild.childNodes:cP[1]==="<table>"&&!cN?cQ.childNodes:[];for(cS=cK.length-1;cS>=0;--cS){if(cq.nodeName(cK[cS],"tbody")&&!cK[cS].childNodes.length){cK[cS].parentNode.removeChild(cK[cS])}}}if(!cq.support.leadingWhitespace&&cI.test(cV)){cQ.insertBefore(cL.createTextNode(cI.exec(cV)[0]),cQ.firstChild)}cV=cQ.childNodes;cQ.parentNode.removeChild(cQ)}}if(cV.nodeType){cX.push(cV)}else{cq.merge(cX,cV)}}if(cQ){cV=cQ=cO=null}if(!cq.support.appendChecked){for(cT=0;(cV=cX[cT])!=null;cT++){if(cq.nodeName(cV,"input")){cC(cV)}else{if(typeof cV.getElementsByTagName!=="undefined"){cq.grep(cV.getElementsByTagName("input"),cC)}}}}if(cJ){cY=function(c1){if(!c1.type||cg.test(c1.type)){return cM?cM.push(c1.parentNode?c1.parentNode.removeChild(c1):c1):cJ.appendChild(c1)}};for(cT=0;(cV=cX[cT])!=null;cT++){if(!(cq.nodeName(cV,"script")&&cY(cV))){cJ.appendChild(cV);if(typeof cV.getElementsByTagName!=="undefined"){cR=cq.grep(cq.merge([],cV.getElementsByTagName("script")),cY);cX.splice.apply(cX,[cT+1,0].concat(cR));cT+=cR.length}}}}return cX},cleanData:function(cK,cS){var cN,cL,cM,cR,cO=0,cT=cq.expando,cJ=cq.cache,cP=cq.support.deleteExpando,cQ=cq.event.special;for(;(cM=cK[cO])!=null;cO++){if(cS||cq.acceptData(cM)){cL=cM[cT];cN=cL&&cJ[cL];if(cN){if(cN.events){for(cR in cN.events){if(cQ[cR]){cq.event.remove(cM,cR)}else{cq.removeEvent(cM,cR,cN.handle)}}}if(cJ[cL]){delete cJ[cL];if(cP){delete cM[cT]}else{if(cM.removeAttribute){cM.removeAttribute(cT)}else{cM[cT]=null}}cq.deletedIds.push(cL)}}}}}});(function(){var cJ,cK;cq.uaMatch=function(cM){cM=cM.toLowerCase();var cL=/(chrome)[ \/]([\w.]+)/.exec(cM)||/(webkit)[ \/]([\w.]+)/.exec(cM)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(cM)||/(msie) ([\w.]+)/.exec(cM)||cM.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(cM)||[];return{browser:cL[1]||"",version:cL[2]||"0"}};cJ=cq.uaMatch(Y.userAgent);cK={};if(cJ.browser){cK[cJ.browser]=true;cK.version=cJ.version}if(cK.chrome){cK.webkit=true}else{if(cK.webkit){cK.safari=true}}cq.browser=cK;cq.sub=function(){function cL(cO,cP){return new cL.fn.init(cO,cP)}cq.extend(true,cL,this);cL.superclass=this;cL.fn=cL.prototype=this();cL.fn.constructor=cL;cL.sub=this.sub;cL.fn.init=function cN(cO,cP){if(cP&&cP instanceof cq&&!(cP instanceof cL)){cP=cL(cP)}return cq.fn.init.call(this,cO,cP,cM)};cL.fn.init.prototype=cL.fn;var cM=cL(ai);return cL}})();var az,bj,bG,bY=/alpha\([^)]*\)/i,bC=/opacity=([^)]*)/,b4=/^(top|right|bottom|left)$/,aB=/^(none|table(?!-c[ea]).+)/,bJ=/^margin/,bS=new RegExp("^("+ch+")(.*)$","i"),aR=new RegExp("^("+ch+")(?!px)[a-z%]+$","i"),aN=new RegExp("^([-+])=("+ch+")","i"),b1={},bT={position:"absolute",visibility:"hidden",display:"block"},ck={letterSpacing:0,fontWeight:400},cA=["Top","Right","Bottom","Left"],bc=["Webkit","O","Moz","ms"],bt=cq.fn.toggle;function W(cM,cK){if(cK in cM){return cK}var cN=cK.charAt(0).toUpperCase()+cK.slice(1),cJ=cK,cL=bc.length;while(cL--){cK=bc[cL]+cN;if(cK in cM){return cK}}return cJ}function aL(cK,cJ){cK=cJ||cK;return cq.css(cK,"display")==="none"||!cq.contains(cK.ownerDocument,cK)}function am(cO,cJ){var cN,cP,cK=[],cL=0,cM=cO.length;for(;cL<cM;cL++){cN=cO[cL];if(!cN.style){continue}cK[cL]=cq._data(cN,"olddisplay");if(cJ){if(!cK[cL]&&cN.style.display==="none"){cN.style.display=""}if(cN.style.display===""&&aL(cN)){cK[cL]=cq._data(cN,"olddisplay",cm(cN.nodeName))}}else{cP=az(cN,"display");if(!cK[cL]&&cP!=="none"){cq._data(cN,"olddisplay",cP)}}}for(cL=0;cL<cM;cL++){cN=cO[cL];if(!cN.style){continue}if(!cJ||cN.style.display==="none"||cN.style.display===""){cN.style.display=cJ?cK[cL]||"":"none"}}return cO}cq.fn.extend({css:function(cJ,cK){return cq.access(this,function(cM,cL,cN){return cN!==bl?cq.style(cM,cL,cN):cq.css(cM,cL)},cJ,cK,arguments.length>1)},show:function(){return am(this,true)},hide:function(){return am(this)},toggle:function(cL,cK){var cJ=typeof cL==="boolean";if(cq.isFunction(cL)&&cq.isFunction(cK)){return bt.apply(this,arguments)}return this.each(function(){if(cJ?cL:aL(this)){cq(this).show()}else{cq(this).hide()}})}});cq.extend({cssHooks:{opacity:{get:function(cL,cK){if(cK){var cJ=az(cL,"opacity");return cJ===""?"1":cJ}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":cq.support.cssFloat?"cssFloat":"styleFloat"},style:function(cL,cK,cR,cM){if(!cL||cL.nodeType===3||cL.nodeType===8||!cL.style){return}var cP,cQ,cS,cN=cq.camelCase(cK),cJ=cL.style;cK=cq.cssProps[cN]||(cq.cssProps[cN]=W(cJ,cN));cS=cq.cssHooks[cK]||cq.cssHooks[cN];if(cR!==bl){cQ=typeof cR;if(cQ==="string"&&(cP=aN.exec(cR))){cR=(cP[1]+1)*cP[2]+parseFloat(cq.css(cL,cK));cQ="number"}if(cR==null||cQ==="number"&&isNaN(cR)){return}if(cQ==="number"&&!cq.cssNumber[cN]){cR+="px"}if(!cS||!("set" in cS)||(cR=cS.set(cL,cR,cM))!==bl){try{cJ[cK]=cR}catch(cO){}}}else{if(cS&&"get" in cS&&(cP=cS.get(cL,false,cM))!==bl){return cP}return cJ[cK]}},css:function(cP,cN,cO,cK){var cQ,cM,cJ,cL=cq.camelCase(cN);cN=cq.cssProps[cL]||(cq.cssProps[cL]=W(cP.style,cL));cJ=cq.cssHooks[cN]||cq.cssHooks[cL];if(cJ&&"get" in cJ){cQ=cJ.get(cP,true,cK)}if(cQ===bl){cQ=az(cP,cN)}if(cQ==="normal"&&cN in ck){cQ=ck[cN]}if(cO||cK!==bl){cM=parseFloat(cQ);return cO||cq.isNumeric(cM)?cM||0:cQ}return cQ},swap:function(cN,cM,cO){var cL,cK,cJ={};for(cK in cM){cJ[cK]=cN.style[cK];cN.style[cK]=cM[cK]}cL=cO.call(cN);for(cK in cM){cN.style[cK]=cJ[cK]}return cL}});if(bM.getComputedStyle){az=function(cQ,cK){var cJ,cN,cM,cP,cO=bM.getComputedStyle(cQ,null),cL=cQ.style;if(cO){cJ=cO[cK];if(cJ===""&&!cq.contains(cQ.ownerDocument,cQ)){cJ=cq.style(cQ,cK)}if(aR.test(cJ)&&bJ.test(cK)){cN=cL.width;cM=cL.minWidth;cP=cL.maxWidth;cL.minWidth=cL.maxWidth=cL.width=cJ;cJ=cO.width;cL.width=cN;cL.minWidth=cM;cL.maxWidth=cP}}return cJ}}else{if(ai.documentElement.currentStyle){az=function(cN,cL){var cO,cJ,cK=cN.currentStyle&&cN.currentStyle[cL],cM=cN.style;if(cK==null&&cM&&cM[cL]){cK=cM[cL]}if(aR.test(cK)&&!b4.test(cL)){cO=cM.left;cJ=cN.runtimeStyle&&cN.runtimeStyle.left;if(cJ){cN.runtimeStyle.left=cN.currentStyle.left}cM.left=cL==="fontSize"?"1em":cK;cK=cM.pixelLeft+"px";cM.left=cO;if(cJ){cN.runtimeStyle.left=cJ}}return cK===""?"auto":cK}}}function bq(cJ,cL,cM){var cK=bS.exec(cL);return cK?Math.max(0,cK[1]-(cM||0))+(cK[2]||"px"):cL}function bd(cM,cK,cJ,cO){var cL=cJ===(cO?"border":"content")?4:cK==="width"?1:0,cN=0;for(;cL<4;cL+=2){if(cJ==="margin"){cN+=cq.css(cM,cJ+cA[cL],true)}if(cO){if(cJ==="content"){cN-=parseFloat(az(cM,"padding"+cA[cL]))||0}if(cJ!=="margin"){cN-=parseFloat(az(cM,"border"+cA[cL]+"Width"))||0}}else{cN+=parseFloat(az(cM,"padding"+cA[cL]))||0;if(cJ!=="padding"){cN+=parseFloat(az(cM,"border"+cA[cL]+"Width"))||0}}}return cN}function ao(cM,cK,cJ){var cN=cK==="width"?cM.offsetWidth:cM.offsetHeight,cL=true,cO=cq.support.boxSizing&&cq.css(cM,"boxSizing")==="border-box";if(cN<=0||cN==null){cN=az(cM,cK);if(cN<0||cN==null){cN=cM.style[cK]}if(aR.test(cN)){return cN}cL=cO&&(cq.support.boxSizingReliable||cN===cM.style[cK]);cN=parseFloat(cN)||0}return(cN+bd(cM,cK,cJ||(cO?"border":"content"),cL))+"px"}function cm(cL){if(b1[cL]){return b1[cL]}var cJ=cq("<"+cL+">").appendTo(ai.body),cK=cJ.css("display");cJ.remove();if(cK==="none"||cK===""){bj=ai.body.appendChild(bj||cq.extend(ai.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!bG||!bj.createElement){bG=(bj.contentWindow||bj.contentDocument).document;bG.write("<!doctype html><html><body>");bG.close()}cJ=bG.body.appendChild(bG.createElement(cL));cK=az(cJ,"display");ai.body.removeChild(bj)}b1[cL]=cK;return cK}cq.each(["height","width"],function(cK,cJ){cq.cssHooks[cJ]={get:function(cN,cM,cL){if(cM){if(cN.offsetWidth===0&&aB.test(az(cN,"display"))){return cq.swap(cN,bT,function(){return ao(cN,cJ,cL)})}else{return ao(cN,cJ,cL)}}},set:function(cM,cN,cL){return bq(cM,cN,cL?bd(cM,cJ,cL,cq.support.boxSizing&&cq.css(cM,"boxSizing")==="border-box"):0)}}});if(!cq.support.opacity){cq.cssHooks.opacity={get:function(cK,cJ){return bC.test((cJ&&cK.currentStyle?cK.currentStyle.filter:cK.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":cJ?"1":""},set:function(cN,cO){var cM=cN.style,cK=cN.currentStyle,cJ=cq.isNumeric(cO)?"alpha(opacity="+cO*100+")":"",cL=cK&&cK.filter||cM.filter||"";cM.zoom=1;if(cO>=1&&cq.trim(cL.replace(bY,""))===""&&cM.removeAttribute){cM.removeAttribute("filter");if(cK&&!cK.filter){return}}cM.filter=bY.test(cL)?cL.replace(bY,cJ):cL+" "+cJ}}}cq(function(){if(!cq.support.reliableMarginRight){cq.cssHooks.marginRight={get:function(cK,cJ){return cq.swap(cK,{display:"inline-block"},function(){if(cJ){return az(cK,"marginRight")}})}}}if(!cq.support.pixelPosition&&cq.fn.position){cq.each(["top","left"],function(cJ,cK){cq.cssHooks[cK]={get:function(cN,cM){if(cM){var cL=az(cN,cK);return aR.test(cL)?cq(cN).position()[cK]+"px":cL}}}})}});if(cq.expr&&cq.expr.filters){cq.expr.filters.hidden=function(cJ){return(cJ.offsetWidth===0&&cJ.offsetHeight===0)||(!cq.support.reliableHiddenOffsets&&((cJ.style&&cJ.style.display)||az(cJ,"display"))==="none")};cq.expr.filters.visible=function(cJ){return !cq.expr.filters.hidden(cJ)}}cq.each({margin:"",padding:"",border:"Width"},function(cJ,cK){cq.cssHooks[cJ+cK]={expand:function(cN){var cM,cO=typeof cN==="string"?cN.split(" "):[cN],cL={};for(cM=0;cM<4;cM++){cL[cJ+cA[cM]+cK]=cO[cM]||cO[cM-2]||cO[0]}return cL}};if(!bJ.test(cJ)){cq.cssHooks[cJ+cK].set=bq}});var cc=/%20/g,bz=/\[\]$/,aP=/\r?\n/g,cj=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bn=/^(?:select|textarea)/i;cq.fn.extend({serialize:function(){return cq.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?cq.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bn.test(this.nodeName)||cj.test(this.type))}).map(function(cJ,cK){var cL=cq(this).val();return cL==null?null:cq.isArray(cL)?cq.map(cL,function(cN,cM){return{name:cK.name,value:cN.replace(aP,"\r\n")}}):{name:cK.name,value:cL.replace(aP,"\r\n")}}).get()}});cq.param=function(cJ,cL){var cM,cK=[],cN=function(cO,cP){cP=cq.isFunction(cP)?cP():(cP==null?"":cP);cK[cK.length]=encodeURIComponent(cO)+"="+encodeURIComponent(cP)};if(cL===bl){cL=cq.ajaxSettings&&cq.ajaxSettings.traditional}if(cq.isArray(cJ)||(cJ.jquery&&!cq.isPlainObject(cJ))){cq.each(cJ,function(){cN(this.name,this.value)})}else{for(cM in cJ){ae(cM,cJ[cM],cL,cN)}}return cK.join("&").replace(cc,"+")};function ae(cL,cN,cK,cM){var cJ;if(cq.isArray(cN)){cq.each(cN,function(cP,cO){if(cK||bz.test(cL)){cM(cL,cO)}else{ae(cL+"["+(typeof cO==="object"?cP:"")+"]",cO,cK,cM)}})}else{if(!cK&&cq.type(cN)==="object"){for(cJ in cN){ae(cL+"["+cJ+"]",cN[cJ],cK,cM)}}else{cM(cL,cN)}}}var aT,cH,a8=/#.*$/,aY=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,aw=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,al=/^(?:GET|HEAD)$/,bm=/^\/\//,cx=/\?/,aa=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,aK=/([?&])_=[^&]*/,bD=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cG=cq.fn.load,ap={},bQ={},bH=["*/"]+["*"];try{aT=bs.href}catch(bX){aT=ai.createElement("a");aT.href="";aT=aT.href}cH=bD.exec(aT.toLowerCase())||[];function cs(cJ){return function(cN,cP){if(typeof cN!=="string"){cP=cN;cN="*"}var cK,cQ,cR,cM=cN.toLowerCase().split(bF),cL=0,cO=cM.length;if(cq.isFunction(cP)){for(;cL<cO;cL++){cK=cM[cL];cR=/^\+/.test(cK);if(cR){cK=cK.substr(1)||"*"}cQ=cJ[cK]=cJ[cK]||[];cQ[cR?"unshift":"push"](cP)}}}}function ak(cK,cT,cO,cR,cQ,cM){cQ=cQ||cT.dataTypes[0];cM=cM||{};cM[cQ]=true;var cS,cP=cK[cQ],cL=0,cJ=cP?cP.length:0,cN=(cK===ap);for(;cL<cJ&&(cN||!cS);cL++){cS=cP[cL](cT,cO,cR);if(typeof cS==="string"){if(!cN||cM[cS]){cS=bl}else{cT.dataTypes.unshift(cS);cS=ak(cK,cT,cO,cR,cS,cM)}}}if((cN||!cS)&&!cM["*"]){cS=ak(cK,cT,cO,cR,"*",cM)}return cS}function an(cL,cM){var cK,cJ,cN=cq.ajaxSettings.flatOptions||{};for(cK in cM){if(cM[cK]!==bl){(cN[cK]?cL:(cJ||(cJ={})))[cK]=cM[cK]}}if(cJ){cq.extend(true,cL,cJ)}}cq.fn.load=function(cM,cP,cQ){if(typeof cM!=="string"&&cG){return cG.apply(this,arguments)}if(!this.length){return this}var cJ,cN,cL,cK=this,cO=cM.indexOf(" ");if(cO>=0){cJ=cM.slice(cO,cM.length);cM=cM.slice(0,cO)}if(cq.isFunction(cP)){cQ=cP;cP=bl}else{if(cP&&typeof cP==="object"){cN="POST"}}cq.ajax({url:cM,type:cN,dataType:"html",data:cP,complete:function(cS,cR){if(cQ){cK.each(cQ,cL||[cS.responseText,cR,cS])}}}).done(function(cR){cL=arguments;cK.html(cJ?cq("<div>").append(cR.replace(aa,"")).find(cJ):cR)});return this};cq.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(cJ,cK){cq.fn[cK]=function(cL){return this.on(cK,cL)}});cq.each(["get","post"],function(cJ,cK){cq[cK]=function(cL,cN,cO,cM){if(cq.isFunction(cN)){cM=cM||cO;cO=cN;cN=bl}return cq.ajax({type:cK,url:cL,data:cN,success:cO,dataType:cM})}});cq.extend({getScript:function(cJ,cK){return cq.get(cJ,bl,cK,"script")},getJSON:function(cJ,cK,cL){return cq.get(cJ,cK,cL,"json")},ajaxSetup:function(cK,cJ){if(cJ){an(cK,cq.ajaxSettings)}else{cJ=cK;cK=cq.ajaxSettings}an(cK,cJ);return cK},ajaxSettings:{url:aT,isLocal:aw.test(cH[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bH},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":bM.String,"text html":true,"text json":cq.parseJSON,"text xml":cq.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:cs(ap),ajaxTransport:cs(bQ),ajax:function(cO,cL){if(typeof cO==="object"){cL=cO;cO=bl}cL=cL||{};var cR,c5,cM,c0,cT,cX,cK,cZ,cS=cq.ajaxSetup({},cL),c7=cS.context||cS,cV=c7!==cS&&(c7.nodeType||c7 instanceof cq)?cq(c7):cq.event,c6=cq.Deferred(),c2=cq.Callbacks("once memory"),cP=cS.statusCode||{},cW={},c3={},cN=0,cQ="canceled",cY={readyState:0,setRequestHeader:function(c9,da){if(!cN){var c8=c9.toLowerCase();c9=c3[c8]=c3[c8]||c9;cW[c9]=da}return this},getAllResponseHeaders:function(){return cN===2?c5:null},getResponseHeader:function(c9){var c8;if(cN===2){if(!cM){cM={};while((c8=aY.exec(c5))){cM[c8[1].toLowerCase()]=c8[2]}}c8=cM[c9.toLowerCase()]}return c8===bl?null:c8},overrideMimeType:function(c8){if(!cN){cS.mimeType=c8}return this},abort:function(c8){c8=c8||cQ;if(c0){c0.abort(c8)}cU(0,c8);return this}};function cU(dd,c9,de,db){var c8,dh,df,dc,dg,da=c9;if(cN===2){return}cN=2;if(cT){clearTimeout(cT)}c0=bl;c5=db||"";cY.readyState=dd>0?4:0;if(de){dc=ab(cS,cY,de)}if(dd>=200&&dd<300||dd===304){if(cS.ifModified){dg=cY.getResponseHeader("Last-Modified");if(dg){cq.lastModified[cR]=dg}dg=cY.getResponseHeader("Etag");if(dg){cq.etag[cR]=dg}}if(dd===304){da="notmodified";c8=true}else{c8=aZ(cS,dc);da=c8.state;dh=c8.data;df=c8.error;c8=!df}}else{df=da;if(!da||dd){da="error";if(dd<0){dd=0}}}cY.status=dd;cY.statusText=""+(c9||da);if(c8){c6.resolveWith(c7,[dh,da,cY])}else{c6.rejectWith(c7,[cY,da,df])}cY.statusCode(cP);cP=bl;if(cK){cV.trigger("ajax"+(c8?"Success":"Error"),[cY,cS,c8?dh:df])}c2.fireWith(c7,[cY,da]);if(cK){cV.trigger("ajaxComplete",[cY,cS]);if(!(--cq.active)){cq.event.trigger("ajaxStop")}}}c6.promise(cY);cY.success=cY.done;cY.error=cY.fail;cY.complete=c2.add;cY.statusCode=function(c9){if(c9){var c8;if(cN<2){for(c8 in c9){cP[c8]=[cP[c8],c9[c8]]}}else{c8=c9[cY.status];cY.always(c8)}}return this};cS.url=((cO||cS.url)+"").replace(a8,"").replace(bm,cH[1]+"//");cS.dataTypes=cq.trim(cS.dataType||"*").toLowerCase().split(bF);if(cS.crossDomain==null){cX=bD.exec(cS.url.toLowerCase());cS.crossDomain=!!(cX&&(cX[1]!=cH[1]||cX[2]!=cH[2]||(cX[3]||(cX[1]==="http:"?80:443))!=(cH[3]||(cH[1]==="http:"?80:443))))}if(cS.data&&cS.processData&&typeof cS.data!=="string"){cS.data=cq.param(cS.data,cS.traditional)}ak(ap,cS,cL,cY);if(cN===2){return cY}cK=cS.global;cS.type=cS.type.toUpperCase();cS.hasContent=!al.test(cS.type);if(cK&&cq.active++===0){cq.event.trigger("ajaxStart")}if(!cS.hasContent){if(cS.data){cS.url+=(cx.test(cS.url)?"&":"?")+cS.data;delete cS.data}cR=cS.url;if(cS.cache===false){var cJ=cq.now(),c4=cS.url.replace(aK,"$1_="+cJ);cS.url=c4+((c4===cS.url)?(cx.test(cS.url)?"&":"?")+"_="+cJ:"")}}if(cS.data&&cS.hasContent&&cS.contentType!==false||cL.contentType){cY.setRequestHeader("Content-Type",cS.contentType)}if(cS.ifModified){cR=cR||cS.url;if(cq.lastModified[cR]){cY.setRequestHeader("If-Modified-Since",cq.lastModified[cR])}if(cq.etag[cR]){cY.setRequestHeader("If-None-Match",cq.etag[cR])}}cY.setRequestHeader("Accept",cS.dataTypes[0]&&cS.accepts[cS.dataTypes[0]]?cS.accepts[cS.dataTypes[0]]+(cS.dataTypes[0]!=="*"?", "+bH+"; q=0.01":""):cS.accepts["*"]);for(cZ in cS.headers){cY.setRequestHeader(cZ,cS.headers[cZ])}if(cS.beforeSend&&(cS.beforeSend.call(c7,cY,cS)===false||cN===2)){return cY.abort()}cQ="abort";for(cZ in {success:1,error:1,complete:1}){cY[cZ](cS[cZ])}c0=ak(bQ,cS,cL,cY);if(!c0){cU(-1,"No Transport")}else{cY.readyState=1;if(cK){cV.trigger("ajaxSend",[cY,cS])}if(cS.async&&cS.timeout>0){cT=setTimeout(function(){cY.abort("timeout")},cS.timeout)}try{cN=1;c0.send(cW,cU)}catch(c1){if(cN<2){cU(-1,c1)}else{throw c1}}}return cY},active:0,lastModified:{},etag:{}});function ab(cS,cR,cO){var cN,cP,cM,cJ,cK=cS.contents,cQ=cS.dataTypes,cL=cS.responseFields;for(cP in cL){if(cP in cO){cR[cL[cP]]=cO[cP]}}while(cQ[0]==="*"){cQ.shift();if(cN===bl){cN=cS.mimeType||cR.getResponseHeader("content-type")}}if(cN){for(cP in cK){if(cK[cP]&&cK[cP].test(cN)){cQ.unshift(cP);break}}}if(cQ[0] in cO){cM=cQ[0]}else{for(cP in cO){if(!cQ[0]||cS.converters[cP+" "+cQ[0]]){cM=cP;break}if(!cJ){cJ=cP}}cM=cM||cJ}if(cM){if(cM!==cQ[0]){cQ.unshift(cM)}return cO[cM]}}function aZ(cT,cL){var cR,cJ,cP,cN,cQ=cT.dataTypes.slice(),cK=cQ[0],cS={},cM=0;if(cT.dataFilter){cL=cT.dataFilter(cL,cT.dataType)}if(cQ[1]){for(cR in cT.converters){cS[cR.toLowerCase()]=cT.converters[cR]}}for(;(cP=cQ[++cM]);){if(cP!=="*"){if(cK!=="*"&&cK!==cP){cR=cS[cK+" "+cP]||cS["* "+cP];if(!cR){for(cJ in cS){cN=cJ.split(" ");if(cN[1]===cP){cR=cS[cK+" "+cN[0]]||cS["* "+cN[0]];if(cR){if(cR===true){cR=cS[cJ]}else{if(cS[cJ]!==true){cP=cN[0];cQ.splice(cM--,0,cP)}}break}}}}if(cR!==true){if(cR&&cT["throws"]){cL=cR(cL)}else{try{cL=cR(cL)}catch(cO){return{state:"parsererror",error:cR?cO:"No conversion from "+cK+" to "+cP}}}}}cK=cP}}return{state:"success",data:cL}}var b9=[],bg=/\?/,bP=/(=)\?(?=&|$)|\?\?/,b5=cq.now();cq.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var cJ=b9.pop()||(cq.expando+"_"+(b5++));this[cJ]=true;return cJ}});cq.ajaxPrefilter("json jsonp",function(cT,cO,cS){var cR,cJ,cQ,cM=cT.data,cK=cT.url,cL=cT.jsonp!==false,cP=cL&&bP.test(cK),cN=cL&&!cP&&typeof cM==="string"&&!(cT.contentType||"").indexOf("application/x-www-form-urlencoded")&&bP.test(cM);if(cT.dataTypes[0]==="jsonp"||cP||cN){cR=cT.jsonpCallback=cq.isFunction(cT.jsonpCallback)?cT.jsonpCallback():cT.jsonpCallback;cJ=bM[cR];if(cP){cT.url=cK.replace(bP,"$1"+cR)}else{if(cN){cT.data=cM.replace(bP,"$1"+cR)}else{if(cL){cT.url+=(bg.test(cK)?"&":"?")+cT.jsonp+"="+cR}}}cT.converters["script json"]=function(){if(!cQ){cq.error(cR+" was not called")}return cQ[0]};cT.dataTypes[0]="json";bM[cR]=function(){cQ=arguments};cS.always(function(){bM[cR]=cJ;if(cT[cR]){cT.jsonpCallback=cO.jsonpCallback;b9.push(cR)}if(cQ&&cq.isFunction(cJ)){cJ(cQ[0])}cQ=cJ=bl});return"script"}});cq.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(cJ){cq.globalEval(cJ);return cJ}}});cq.ajaxPrefilter("script",function(cJ){if(cJ.cache===bl){cJ.cache=false}if(cJ.crossDomain){cJ.type="GET";cJ.global=false}});cq.ajaxTransport("script",function(cL){if(cL.crossDomain){var cJ,cK=ai.head||ai.getElementsByTagName("head")[0]||ai.documentElement;return{send:function(cM,cN){cJ=ai.createElement("script");cJ.async="async";if(cL.scriptCharset){cJ.charset=cL.scriptCharset}cJ.src=cL.url;cJ.onload=cJ.onreadystatechange=function(cP,cO){if(cO||!cJ.readyState||/loaded|complete/.test(cJ.readyState)){cJ.onload=cJ.onreadystatechange=null;if(cK&&cJ.parentNode){cK.removeChild(cJ)}cJ=bl;if(!cO){cN(200,"success")}}};cK.insertBefore(cJ,cK.firstChild)},abort:function(){if(cJ){cJ.onload(0,1)}}}}});var a2,bx=bM.ActiveXObject?function(){for(var cJ in a2){a2[cJ](0,1)}}:false,be=0;function cl(){try{return new bM.XMLHttpRequest()}catch(cJ){}}function bV(){try{return new bM.ActiveXObject("Microsoft.XMLHTTP")}catch(cJ){}}cq.ajaxSettings.xhr=bM.ActiveXObject?function(){return !this.isLocal&&cl()||bV()}:cl;(function(cJ){cq.extend(cq.support,{ajax:!!cJ,cors:!!cJ&&("withCredentials" in cJ)})})(cq.ajaxSettings.xhr());if(cq.support.ajax){cq.ajaxTransport(function(cJ){if(!cJ.crossDomain||cq.support.cors){var cK;return{send:function(cQ,cL){var cO,cN,cP=cJ.xhr();if(cJ.username){cP.open(cJ.type,cJ.url,cJ.async,cJ.username,cJ.password)}else{cP.open(cJ.type,cJ.url,cJ.async)}if(cJ.xhrFields){for(cN in cJ.xhrFields){cP[cN]=cJ.xhrFields[cN]}}if(cJ.mimeType&&cP.overrideMimeType){cP.overrideMimeType(cJ.mimeType)}if(!cJ.crossDomain&&!cQ["X-Requested-With"]){cQ["X-Requested-With"]="XMLHttpRequest"}try{for(cN in cQ){cP.setRequestHeader(cN,cQ[cN])}}catch(cM){}cP.send((cJ.hasContent&&cJ.data)||null);cK=function(cZ,cT){var cU,cS,cR,cX,cW;try{if(cK&&(cT||cP.readyState===4)){cK=bl;if(cO){cP.onreadystatechange=cq.noop;if(bx){delete a2[cO]}}if(cT){if(cP.readyState!==4){cP.abort()}}else{cU=cP.status;cR=cP.getAllResponseHeaders();cX={};cW=cP.responseXML;if(cW&&cW.documentElement){cX.xml=cW}try{cX.text=cP.responseText}catch(cZ){}try{cS=cP.statusText}catch(cY){cS=""}if(!cU&&cJ.isLocal&&!cJ.crossDomain){cU=cX.text?200:404}else{if(cU===1223){cU=204}}}}}catch(cV){if(!cT){cL(-1,cV)}}if(cX){cL(cU,cS,cX,cR)}};if(!cJ.async){cK()}else{if(cP.readyState===4){setTimeout(cK,0)}else{cO=++be;if(bx){if(!a2){a2={};cq(bM).unload(bx)}a2[cO]=cK}cP.onreadystatechange=cK}}},abort:function(){if(cK){cK(0,1)}}}}})}var aG,aW,cy=/^(?:toggle|show|hide)$/,cr=new RegExp("^(?:([-+])=|)("+ch+")([a-z%]*)$","i"),cw=/queueHooks$/,bh=[ac],bL={"*":[function(cK,cQ){var cN,cR,cJ,cS=this.createTween(cK,cQ),cO=cr.exec(cQ),cP=cS.cur(),cL=+cP||0,cM=1;if(cO){cN=+cO[2];cR=cO[3]||(cq.cssNumber[cK]?"":"px");if(cR!=="px"&&cL){cL=cq.css(cS.elem,cK,true)||cN||1;do{cJ=cM=cM||".5";cL=cL/cM;cq.style(cS.elem,cK,cL+cR);cM=cS.cur()/cP}while(cM!==1&&cM!==cJ)}cS.unit=cR;cS.start=cL;cS.end=cO[1]?cL+(cO[1]+1)*cN:cN}return cS}]};function b3(){setTimeout(function(){aG=bl},0);return(aG=cq.now())}function bW(cK,cJ){cq.each(cJ,function(cP,cN){var cO=(bL[cP]||[]).concat(bL["*"]),cL=0,cM=cO.length;for(;cL<cM;cL++){if(cO[cL].call(cK,cP,cN)){return}}})}function Z(cL,cP,cS){var cT,cO=0,cJ=0,cK=bh.length,cR=cq.Deferred().always(function(){delete cN.elem}),cN=function(){var cY=aG||b3(),cV=Math.max(0,cM.startTime+cM.duration-cY),cX=1-(cV/cM.duration||0),cU=0,cW=cM.tweens.length;for(;cU<cW;cU++){cM.tweens[cU].run(cX)}cR.notifyWith(cL,[cM,cX,cV]);if(cX<1&&cW){return cV}else{cR.resolveWith(cL,[cM]);return false}},cM=cR.promise({elem:cL,props:cq.extend({},cP),opts:cq.extend(true,{specialEasing:{}},cS),originalProperties:cP,originalOptions:cS,startTime:aG||b3(),duration:cS.duration,tweens:[],createTween:function(cX,cU,cW){var cV=cq.Tween(cL,cM.opts,cX,cU,cM.opts.specialEasing[cX]||cM.opts.easing);cM.tweens.push(cV);return cV},stop:function(cV){var cU=0,cW=cV?cM.tweens.length:0;for(;cU<cW;cU++){cM.tweens[cU].run(1)}if(cV){cR.resolveWith(cL,[cM,cV])}else{cR.rejectWith(cL,[cM,cV])}return this}}),cQ=cM.props;a5(cQ,cM.opts.specialEasing);for(;cO<cK;cO++){cT=bh[cO].call(cM,cL,cQ,cM.opts);if(cT){return cT}}bW(cM,cQ);if(cq.isFunction(cM.opts.start)){cM.opts.start.call(cL,cM)}cq.fx.timer(cq.extend(cN,{anim:cM,queue:cM.opts.queue,elem:cL}));return cM.progress(cM.opts.progress).done(cM.opts.done,cM.opts.complete).fail(cM.opts.fail).always(cM.opts.always)}function a5(cM,cO){var cL,cK,cP,cN,cJ;for(cL in cM){cK=cq.camelCase(cL);cP=cO[cK];cN=cM[cL];if(cq.isArray(cN)){cP=cN[1];cN=cM[cL]=cN[0]}if(cL!==cK){cM[cK]=cN;delete cM[cL]}cJ=cq.cssHooks[cK];if(cJ&&"expand" in cJ){cN=cJ.expand(cN);delete cM[cK];for(cL in cN){if(!(cL in cM)){cM[cL]=cN[cL];cO[cL]=cP}}}else{cO[cK]=cP}}}cq.Animation=cq.extend(Z,{tweener:function(cK,cN){if(cq.isFunction(cK)){cN=cK;cK=["*"]}else{cK=cK.split(" ")}var cM,cJ=0,cL=cK.length;for(;cJ<cL;cJ++){cM=cK[cJ];bL[cM]=bL[cM]||[];bL[cM].unshift(cN)}},prefilter:function(cK,cJ){if(cJ){bh.unshift(cK)}else{bh.push(cK)}}});function ac(cN,cS,cJ){var cR,cL,cU,cM,cY,cX,cW,cV,cO=this,cK=cN.style,cT={},cQ=[],cP=cN.nodeType&&aL(cN);if(!cJ.queue){cW=cq._queueHooks(cN,"fx");if(cW.unqueued==null){cW.unqueued=0;cV=cW.empty.fire;cW.empty.fire=function(){if(!cW.unqueued){cV()}}}cW.unqueued++;cO.always(function(){cO.always(function(){cW.unqueued--;if(!cq.queue(cN,"fx").length){cW.empty.fire()}})})}if(cN.nodeType===1&&("height" in cS||"width" in cS)){cJ.overflow=[cK.overflow,cK.overflowX,cK.overflowY];if(cq.css(cN,"display")==="inline"&&cq.css(cN,"float")==="none"){if(!cq.support.inlineBlockNeedsLayout||cm(cN.nodeName)==="inline"){cK.display="inline-block"}else{cK.zoom=1}}}if(cJ.overflow){cK.overflow="hidden";if(!cq.support.shrinkWrapBlocks){cO.done(function(){cK.overflow=cJ.overflow[0];cK.overflowX=cJ.overflow[1];cK.overflowY=cJ.overflow[2]})}}for(cR in cS){cU=cS[cR];if(cy.exec(cU)){delete cS[cR];if(cU===(cP?"hide":"show")){continue}cQ.push(cR)}}cM=cQ.length;if(cM){cY=cq._data(cN,"fxshow")||cq._data(cN,"fxshow",{});if(cP){cq(cN).show()}else{cO.done(function(){cq(cN).hide()})}cO.done(function(){var cZ;cq.removeData(cN,"fxshow",true);for(cZ in cT){cq.style(cN,cZ,cT[cZ])}});for(cR=0;cR<cM;cR++){cL=cQ[cR];cX=cO.createTween(cL,cP?cY[cL]:0);cT[cL]=cY[cL]||cq.style(cN,cL);if(!(cL in cY)){cY[cL]=cX.start;if(cP){cX.end=cX.start;cX.start=cL==="width"||cL==="height"?1:0}}}}}function aC(cL,cK,cN,cJ,cM){return new aC.prototype.init(cL,cK,cN,cJ,cM)}cq.Tween=aC;aC.prototype={constructor:aC,init:function(cM,cK,cO,cJ,cN,cL){this.elem=cM;this.prop=cO;this.easing=cN||"swing";this.options=cK;this.start=this.now=this.cur();this.end=cJ;this.unit=cL||(cq.cssNumber[cO]?"":"px")},cur:function(){var cJ=aC.propHooks[this.prop];return cJ&&cJ.get?cJ.get(this):aC.propHooks._default.get(this)},run:function(cL){var cK,cJ=aC.propHooks[this.prop];if(this.options.duration){this.pos=cK=cq.easing[this.easing](cL,this.options.duration*cL,0,1,this.options.duration)}else{this.pos=cK=cL}this.now=(this.end-this.start)*cK+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(cJ&&cJ.set){cJ.set(this)}else{aC.propHooks._default.set(this)}return this}};aC.prototype.init.prototype=aC.prototype;aC.propHooks={_default:{get:function(cK){var cJ;if(cK.elem[cK.prop]!=null&&(!cK.elem.style||cK.elem.style[cK.prop]==null)){return cK.elem[cK.prop]}cJ=cq.css(cK.elem,cK.prop,false,"");return !cJ||cJ==="auto"?0:cJ},set:function(cJ){if(cq.fx.step[cJ.prop]){cq.fx.step[cJ.prop](cJ)}else{if(cJ.elem.style&&(cJ.elem.style[cq.cssProps[cJ.prop]]!=null||cq.cssHooks[cJ.prop])){cq.style(cJ.elem,cJ.prop,cJ.now+cJ.unit)}else{cJ.elem[cJ.prop]=cJ.now}}}}};aC.propHooks.scrollTop=aC.propHooks.scrollLeft={set:function(cJ){if(cJ.elem.nodeType&&cJ.elem.parentNode){cJ.elem[cJ.prop]=cJ.now}}};cq.each(["toggle","show","hide"],function(cK,cJ){var cL=cq.fn[cJ];cq.fn[cJ]=function(cM,cO,cN){return cM==null||typeof cM==="boolean"||(!cK&&cq.isFunction(cM)&&cq.isFunction(cO))?cL.apply(this,arguments):this.animate(cp(cJ,true),cM,cO,cN)}});cq.fn.extend({fadeTo:function(cJ,cM,cL,cK){return this.filter(aL).css("opacity",0).show().end().animate({opacity:cM},cJ,cL,cK)},animate:function(cP,cM,cO,cN){var cL=cq.isEmptyObject(cP),cJ=cq.speed(cM,cO,cN),cK=function(){var cQ=Z(this,cq.extend({},cP),cJ);if(cL){cQ.stop(true)}};return cL||cJ.queue===false?this.each(cK):this.queue(cJ.queue,cK)},stop:function(cL,cK,cJ){var cM=function(cN){var cO=cN.stop;delete cN.stop;cO(cJ)};if(typeof cL!=="string"){cJ=cK;cK=cL;cL=bl}if(cK&&cL!==false){this.queue(cL||"fx",[])}return this.each(function(){var cQ=true,cN=cL!=null&&cL+"queueHooks",cP=cq.timers,cO=cq._data(this);if(cN){if(cO[cN]&&cO[cN].stop){cM(cO[cN])}}else{for(cN in cO){if(cO[cN]&&cO[cN].stop&&cw.test(cN)){cM(cO[cN])}}}for(cN=cP.length;cN--;){if(cP[cN].elem===this&&(cL==null||cP[cN].queue===cL)){cP[cN].anim.stop(cJ);cQ=false;cP.splice(cN,1)}}if(cQ||!cJ){cq.dequeue(this,cL)}})}});function cp(cL,cN){var cM,cJ={height:cL},cK=0;cN=cN?1:0;for(;cK<4;cK+=2-cN){cM=cA[cK];cJ["margin"+cM]=cJ["padding"+cM]=cL}if(cN){cJ.opacity=cJ.width=cL}return cJ}cq.each({slideDown:cp("show"),slideUp:cp("hide"),slideToggle:cp("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(cJ,cK){cq.fn[cJ]=function(cL,cN,cM){return this.animate(cK,cL,cN,cM)}});cq.speed=function(cL,cM,cK){var cJ=cL&&typeof cL==="object"?cq.extend({},cL):{complete:cK||!cK&&cM||cq.isFunction(cL)&&cL,duration:cL,easing:cK&&cM||cM&&!cq.isFunction(cM)&&cM};cJ.duration=cq.fx.off?0:typeof cJ.duration==="number"?cJ.duration:cJ.duration in cq.fx.speeds?cq.fx.speeds[cJ.duration]:cq.fx.speeds._default;if(cJ.queue==null||cJ.queue===true){cJ.queue="fx"}cJ.old=cJ.complete;cJ.complete=function(){if(cq.isFunction(cJ.old)){cJ.old.call(this)}if(cJ.queue){cq.dequeue(this,cJ.queue)}};return cJ};cq.easing={linear:function(cJ){return cJ},swing:function(cJ){return 0.5-Math.cos(cJ*Math.PI)/2}};cq.timers=[];cq.fx=aC.prototype.init;cq.fx.tick=function(){var cL,cK=cq.timers,cJ=0;for(;cJ<cK.length;cJ++){cL=cK[cJ];if(!cL()&&cK[cJ]===cL){cK.splice(cJ--,1)}}if(!cK.length){cq.fx.stop()}};cq.fx.timer=function(cJ){if(cJ()&&cq.timers.push(cJ)&&!aW){aW=setInterval(cq.fx.tick,cq.fx.interval)}};cq.fx.interval=13;cq.fx.stop=function(){clearInterval(aW);aW=null};cq.fx.speeds={slow:600,fast:200,_default:400};cq.fx.step={};if(cq.expr&&cq.expr.filters){cq.expr.filters.animated=function(cJ){return cq.grep(cq.timers,function(cK){return cJ===cK.elem}).length}}var b6=/^(?:body|html)$/i;cq.fn.offset=function(cV){if(arguments.length){return cV===bl?this:this.each(function(cW){cq.offset.setOffset(this,cV,cW)})}var cP,cK,cQ,cR,cO,cS,cJ,cN,cT,cM,cL=this[0],cU=cL&&cL.ownerDocument;if(!cU){return}if((cQ=cU.body)===cL){return cq.offset.bodyOffset(cL)}cK=cU.documentElement;if(!cq.contains(cK,cL)){return{top:0,left:0}}cP=cL.getBoundingClientRect();cR=b7(cU);cO=cK.clientTop||cQ.clientTop||0;cS=cK.clientLeft||cQ.clientLeft||0;cJ=cR.pageYOffset||cK.scrollTop;cN=cR.pageXOffset||cK.scrollLeft;cT=cP.top+cJ-cO;cM=cP.left+cN-cS;return{top:cT,left:cM}};cq.offset={bodyOffset:function(cJ){var cL=cJ.offsetTop,cK=cJ.offsetLeft;if(cq.support.doesNotIncludeMarginInBodyOffset){cL+=parseFloat(cq.css(cJ,"marginTop"))||0;cK+=parseFloat(cq.css(cJ,"marginLeft"))||0}return{top:cL,left:cK}},setOffset:function(cM,cV,cP){var cQ=cq.css(cM,"position");if(cQ==="static"){cM.style.position="relative"}var cO=cq(cM),cK=cO.offset(),cJ=cq.css(cM,"top"),cT=cq.css(cM,"left"),cU=(cQ==="absolute"||cQ==="fixed")&&cq.inArray("auto",[cJ,cT])>-1,cS={},cR={},cL,cN;if(cU){cR=cO.position();cL=cR.top;cN=cR.left}else{cL=parseFloat(cJ)||0;cN=parseFloat(cT)||0}if(cq.isFunction(cV)){cV=cV.call(cM,cP,cK)}if(cV.top!=null){cS.top=(cV.top-cK.top)+cL}if(cV.left!=null){cS.left=(cV.left-cK.left)+cN}if("using" in cV){cV.using.call(cM,cS)}else{cO.css(cS)}}};cq.fn.extend({position:function(){if(!this[0]){return}var cL=this[0],cK=this.offsetParent(),cM=this.offset(),cJ=b6.test(cK[0].nodeName)?{top:0,left:0}:cK.offset();cM.top-=parseFloat(cq.css(cL,"marginTop"))||0;cM.left-=parseFloat(cq.css(cL,"marginLeft"))||0;cJ.top+=parseFloat(cq.css(cK[0],"borderTopWidth"))||0;cJ.left+=parseFloat(cq.css(cK[0],"borderLeftWidth"))||0;return{top:cM.top-cJ.top,left:cM.left-cJ.left}},offsetParent:function(){return this.map(function(){var cJ=this.offsetParent||ai.body;while(cJ&&(!b6.test(cJ.nodeName)&&cq.css(cJ,"position")==="static")){cJ=cJ.offsetParent}return cJ||ai.body})}});cq.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(cL,cK){var cJ=/Y/.test(cK);cq.fn[cL]=function(cM){return cq.access(this,function(cN,cQ,cP){var cO=b7(cN);if(cP===bl){return cO?(cK in cO)?cO[cK]:cO.document.documentElement[cQ]:cN[cQ]}if(cO){cO.scrollTo(!cJ?cP:cq(cO).scrollLeft(),cJ?cP:cq(cO).scrollTop())}else{cN[cQ]=cP}},cL,cM,arguments.length,null)}});function b7(cJ){return cq.isWindow(cJ)?cJ:cJ.nodeType===9?cJ.defaultView||cJ.parentWindow:false}cq.each({Height:"height",Width:"width"},function(cJ,cK){cq.each({padding:"inner"+cJ,content:cK,"":"outer"+cJ},function(cL,cM){cq.fn[cM]=function(cQ,cP){var cO=arguments.length&&(cL||typeof cQ!=="boolean"),cN=cL||(cQ===true||cP===true?"margin":"border");return cq.access(this,function(cS,cR,cT){var cU;if(cq.isWindow(cS)){return cS.document.documentElement["client"+cJ]}if(cS.nodeType===9){cU=cS.documentElement;return Math.max(cS.body["scroll"+cJ],cU["scroll"+cJ],cS.body["offset"+cJ],cU["offset"+cJ],cU["client"+cJ])}return cT===bl?cq.css(cS,cR,cT,cN):cq.style(cS,cR,cT,cN)},cK,cO?cQ:bl,cO,null)}})});bM.jQuery=bM.$=cq;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return cq})}})(window);jQuery.fn.xml=function(W){var V="";if(this.length){(((typeof W!="undefined")&&W)?this:jQuery(this[0]).contents()).each(function(){V+=window.ActiveXObject&&!window.DOMParser?this.xml:(new XMLSerializer()).serializeToString(this)})}return V};jQuery.fn.findNS=function(X,W){var V=this.find(X);if(V.length){return V}return this.find(X.replace(/([\w]+)/,W+"\\:$1"))};jQuery.isDate=function(V){return typeof V==="object"&&typeof V.getDate==="function"};jQuery.dateToString=function(V){if(!M.jQuery.isDate(V)){return""}return $.leftPad(V.getDate(),2)+"/"+$.leftPad(V.getMonth()+1,2)+"/"+V.getFullYear()};jQuery.dateTimeToString=function(V){if(!M.jQuery.isDate(V)){return""}return M.jQuery.dateToString(V)+" "+$.leftPad(V.getHours(),2)+":"+$.leftPad(V.getMinutes(),2)};jQuery.leftPad=function(W,V){var X=""+W;while(X.length<V){X="0"+X}return X};var c={};var a=function(Y,X,V,W){this.op=Y;this.trans_id=X;this.data_id=V;this.data=W};(function(){var V;var W=new Array;var Y;c.ready=false;c.onready=null;c.initThreads=function(){Y=typeof Worker!="function"||(M.caps.isIE&&M.caps.browserVersion>=10);if(!Y){window.URL=window.URL||window.webkitURL;var ac="function sendMessage(msg) { self.postMessage(msg); }\nimportScripts('"+p.getScriptLocation()+"threads.xjs');\nfunction registerOnMessage(func) { self.onmessage = func; }";var Z;try{Z=new Blob([ac])}catch(ad){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;Z=new BlobBuilder();Z.append(ac);Z=Z.getBlob()}try{V=new Worker(URL.createObjectURL(Z))}catch(ad){V=new Worker("data:application/javascript,"+encodeURIComponent(ac))}V.onmessage=c.onMessage;X();return}else{Y=true;var aa=document.getElementsByTagName("head")[0];var ab=document.createElement("script");ab.setAttribute("type","text/javascript");ab.setAttribute("src",p.getScriptLocation()+"threads.xjs");if(M.caps.isIE7||M.caps.isIE8){ab.onreadystatechange=function(ae){if(this.readyState=="loaded"){X()}}}else{ab.onload=X}aa.appendChild(ab);V=new Object;M.respMessage=c.onMessage;V.onmessage=c.onMessage}};c.call=function(ae,Z,aa,ad){var ac=W.length;W.push(ad);var ab=new a(ae,ac,Z,aa);if(!Y){V.postMessage(ab)}else{setTimeout(function(){M.postMessage(ab)},0)}};c.onMessage=function(Z){if(typeof W[Z.data.id]=="function"){W[Z.data.id](Z.data.data)}};function X(){c.ready=true;if(typeof c.onready=="function"){c.onready()}}})();
/*!
 * JsUnzip 
 * http://cheeso.members.winisp.net/examples.aspx#jsunzip
 *
 * by Dino Chiesa
 *
 * Licensed under the Ms-PL
 *
 * Version: 1.3 2011May10
 */
var f;var b;(function(){if(typeof f=="object"){var V=new Error("JSIO is already defined");V.source="JSIO.core.js";throw V}f={};f.version="1.3 2011May10";f.decimalToHexString=function(X,Y){if(X<0){X=4294967295+X+1}var W=X.toString(16).toUpperCase();if(Y){W="00000000"+W;W=W.substring(W.length-Y)}return W};f.FileType={Text:0,Binary:1,XML:2,Unknown:3};f.guessFileType=function(W){if(W=="makefile"){return f.FileType.Text}var Y=W.lastIndexOf(".");if(Y<=0){return f.FileType.Unknown}var X=W.substring(Y);if(X==".zip"){return f.FileType.Binary}if(X==".xlsx"){return f.FileType.Binary}if(X==".docx"){return f.FileType.Binary}if(X==".dll"){return f.FileType.Binary}if(X==".obj"){return f.FileType.Binary}if(X==".pdb"){return f.FileType.Binary}if(X==".exe"){return f.FileType.Binary}if(X==".xml"){return f.FileType.XML}if(X==".xsl"){return f.FileType.XML}if(X==".csproj"){return f.FileType.XML}if(X==".vbproj"){return f.FileType.XML}if(X==".shfbproj"){return f.FileType.XML}if(X==".resx"){return f.FileType.XML}if(X==".xslt"){return f.FileType.XML}if(X==".sln"){return f.FileType.Text}if(X==".htm"){return f.FileType.Text}if(X==".html"){return f.FileType.Text}if(X==".js"){return f.FileType.Text}if(X==".vb"){return f.FileType.Text}if(X==".txt"){return f.FileType.Text}if(X==".rels"){return f.FileType.Text}if(X==".css"){return f.FileType.Text}if(X==".cs"){return f.FileType.Text}return f.FileType.Unknown};f.stringOfLength=function(W,Z){var X="";for(var Y=0;Y<Z;Y++){X+=String.fromCharCode(W)}return X};f.formatByteArray=function(W){var Z="0000  ";var X="";for(var Y=0;Y<W.length;Y++){if(Y!==0&&Y%16===0){Z+="    "+X+"\n"+f.decimalToHexString(Y,4)+"  ";X=""}Z+=f.decimalToHexString(W[Y],2)+" ";if(W[Y]>=32&&W[Y]<=126){X+=String.fromCharCode(W[Y])}else{X+="."}}if(X.length>0){Z+=f.stringOfLength(32,((Y%16>0)?((16-Y%16)*3):0)+4)+X}return Z};f.htmlEscape=function(W){return W.replace(new RegExp("&","g"),"&amp;").replace(new RegExp("<","g"),"&lt;").replace(new RegExp(">","g"),"&gt;").replace(new RegExp("\x13","g"),"<br/>").replace(new RegExp("\x10","g"),"<br/>")}})();(function(){var X="1.3 2011May10";if(typeof f!=="object"){f={}}if((typeof f.version!=="string")){f.version=X}else{if((f.version.length<3)||(f.version.substring(0,3)!=="1.3")){f.version+=" "+X}}var Z=function(){this.position=0};Z.prototype.readToEnd=function(){var ab=[];var aa=this.readByte();while(aa!==null){ab.push(aa);aa=this.readByte()}return ab};Z.prototype.beginReadToEnd=function(ad){var ab=[];var ac=this;var aa=function(){var af=0;var ae=ac.readByte();while(ae!==null){ab.push(ae);af++;if(af>=1024){break}ae=ac.readByte()}if(ae!==null){if(typeof(setTimeout)=="undefined"){aa()}else{setTimeout(aa,1)}}else{ad(ab)}};aa();return null};Z.prototype.readBytes=function(ac){var ab=[];for(var aa=0;aa<ac;++aa){ab.push(this.readByte())}return ab};Z.prototype.beginReadBytes=function(af,ae){var ac=[];var ad=this;var aa=af;var ab=function(){var ah=0;var ag=ad.readByte();while(aa>0&&ag!==null){ac.push(ag);ah++;aa--;if(ah>=1024){break}ag=ad.readByte()}if(aa>0&&ag!==null){setTimeout(ab,1)}else{ae(ac)}};ab();return null};f._ByteReaderBase=Z;var W=function(ab){if(!(this instanceof arguments.callee)){var aa=new Error("you must use new to instantiate this class");aa.source="JSIO.ArrayReader";throw aa}this.position=0;this.array=ab;this._typename="JSIO.ArrayReader";this._version=X;return this};W.prototype=new f._ByteReaderBase();W.prototype.readByte=function(){if(this.position>=this.array.length){return null}var aa=this.array[this.position];this.position++;return aa};var V=function(ac){if(!(this instanceof arguments.callee)){var aa=new Error("you must use new to instantiate this class");aa.source="JSIO.StreamReader";throw aa}if(ac){}else{var ab=new Error("you must pass a non-null stream.");ab.source="JSIO.StreamReader";throw ab}this.stream=ac;this.position=0;this._typeName="JSIO.StreamReader";this._version=X;this.length=ac.getLength();return this};V.prototype=new f._ByteReaderBase();V.prototype.readByte=function(){if(this.position>=this.length){return null}var aa=this.stream.readByteAt(this.position);this.position++;return aa};var Y=function(ae,ad,ab){if(!(this instanceof arguments.callee)){var aa=new Error("you must use new to instantiate this class");aa.source="JSIO.StreamSegmentReader";throw aa}if(ae){}else{var ac=new Error("you must pass a non-null stream.");ac.source="JSIO.StreamSegmentReader";throw ac}this.stream=ae;this.position=ad||0;this.limit=(ab)?ad+ab:0;this._typeName="JSIO.StreamSegmentReader";this._version=X;return this};Y.prototype=new f._ByteReaderBase();Y.prototype.readByte=function(){if((this.limit!==0)&&(this.position>=this.limit)){return null}var aa=this.stream.readByteAt(this.position);this.position++;return aa};f.ArrayReader=W;f.StreamReader=V;f.StreamSegmentReader=Y})();(function(){var X="1.3 2011May10";var Z="JSIO.BinaryUrlStream";if((typeof f!=="object")||(typeof f.version!=="string")||(f.version.length<3)||(f.version.substring(0,3)!=="1.3")){var ac=new Error("This extension requires JSIO.core.js v1.3");ac.source=Z+".js";throw ac}if(typeof f._ByteReaderBase!=="function"){var ab=new Error("This class requires JSIO.BasicByteReaders.js");ab.source=Z+".js";throw ab}var V={FileLoadFailed:1,EOFReached:2,NoXHR:3,BadSeek:4};if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var aa="<!-- IEBinaryToArray_ByteStr -->\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n           IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n           IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n<\/script>\r\n";document.write(aa)}var Y=function(af,ae,ag){var ad;switch(af){case V.FileLoadFailed:ad=new Error('Failed to load "'+ae+'"');break;case V.EOFReached:ad=new Error("Error: EOF reached");break;case V.NoXHR:ad=new Error("Error: cannot instantiate XMLHttpRequest");break;case V.BadSeek:ad=new Error("Error: cannot seek");break;default:ad=new Error("Unknown Error.");break}if(ag){ad.message=ag}ad.source=Z;throw ad};var W=function(ag,ai,af){if(!(this instanceof arguments.callee)){var ae=new Error("you must use new to instantiate this class");ae.source="JSIO.BinaryUrlStream.ctor";throw ae}this.callback=ai;this.readByteAt=null;this.fileSize=-1;this.filePointer=0;this.req=null;this._typename=Z;this._version=X;this.status="-none-";var ad=function(ak,am){var al=this;var aj=function(at){var an={};for(var ar=0;ar<256;ar++){for(var aq=0;aq<256;aq++){an[String.fromCharCode(ar+aq*256)]=String.fromCharCode(ar)+String.fromCharCode(aq)}}var ao=IEBinaryToArray_ByteStr(at);var ap=IEBinaryToArray_ByteStr_Last(at);return ao.replace(/[\s\S]/g,function(au){return an[au]})+ap};this.req=(function(){if(window.XMLHttpRequest){return new window.XMLHttpRequest()}else{try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(an){return null}}})();this.req.open("GET",ak,true);this.req.setRequestHeader("Accept-Charset","x-user-defined");this.req.onreadystatechange=function(ao){if(al.req.readyState==4){al.status="Status: "+al.req.status;if(al.req.status==200){var an=aj(al.req.responseBody);al.fileSize=an.length-1;if(al.fileSize<0){Y(V.FileLoadFailed,ak,"after converting")}al.readByteAt=function(ap){return an.charCodeAt(ap)&255};if(typeof al.callback=="function"){al.callback(al)}}else{if(typeof am=="function"){am(al.req)}else{Y(V.FileLoadFailed,ak,"http status code "+al.req.status)}}}};this.req.send()};var ah=function(aj,al){var ak=this;this.req=new XMLHttpRequest();this.req.open("GET",aj,true);this.req.onreadystatechange=function(am){if(ak.req.readyState==4){ak.status="Status: "+ak.req.status;if(ak.req.status==200){var an=ak.req.responseText;ak.fileSize=an.length;ak.readByteAt=function(ao){return an.charCodeAt(ao)&255};if(typeof ak.callback=="function"){ak.callback(ak)}}else{if(typeof al=="function"){al(ak.req)}else{Y(V.FileLoadFailed,aj)}}}};this.req.overrideMimeType("text/plain; charset=x-user-defined");this.req.send(null)};if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){ad.apply(this,[ag,af])}else{ah.apply(this,[ag,af])}};f.SeekOrigin={Current:1,Begin:2};W.prototype=new f._ByteReaderBase();W.prototype.getLength=function(){return this.fileSize};W.prototype.getPosition=function(){return this.filePointer};W.prototype.seek=function(af,ae,ad){if(typeof ad!="undefined"){if(ad.verbose>1){ad.status.push("INFO: Seek "+af+" bytes, origin("+ae+") start(0x"+f.decimalToHexString(this.filePointer)+"/"+this.filePointer+")")}}switch(ae){case f.SeekOrigin.Current:this.seek(this.filePointer+af,f.SeekOrigin.Begin);break;case f.SeekOrigin.Begin:if(af<0){this.filePointer=0}else{if(af>this.getLength()){Y(V.EOFReached)}else{this.filePointer=af}}break;default:Y(V.BadSeek);break}if(typeof ad!="undefined"){if(ad.verbose>1){ad.status.push("INFO: Seek end(0x"+f.decimalToHexString(this.filePointer)+"/"+this.filePointer+")")}}return this.filePointer};W.prototype.read=function(ah){if(ah===0){return[]}if(ah<0){var ad=new Error("invalid read length.");ad.source="BinaryUrlStream.read()";throw ad}var ag=this.filePointer;var af=[];for(var ae=ag;ae<ag+ah;ae++){af.push(this.readByteAt(ae))}this.filePointer+=ah;return af};W.prototype.readByte=function(){var ad=this.read(1);if(ad.length==1){return ad[0]}return null};W.prototype.beginRead=function(aj,ai){if(aj===0){ai(0)}if(aj<0){var ad=new Error("invalid read length.");ad.source="BinaryUrlStream.beginRead()";throw ad}var ah=[];var af=this;var ae=aj;var ag=function(){var al=0;var ak=af.filePointer;while(ae>0){ah.push(af.readByteAt(al+ak));al++;ae--;if(al>=1024){break}}af.filePointer+=al;if(ae>0){setTimeout(ag,1)}else{ai(ah)}};ag();return null};W.prototype.readNumber=function(ag,ae){var ah=ag||1;var ai=ae||this.filePointer;var ad=0;for(var af=ai+ah;af>ai;af--){ad=ad*256+this.readByteAt(af-1)}this.filePointer=ai+ah;return ad};W.prototype.readString=function(ah,af){var aj=ah||1;var ai=af||this.filePointer;var ad="";var ae=ai+aj;for(var ag=ai;ag<ae;ag++){ad+=String.fromCharCode(this.readByteAt(ag))}this.filePointer+=aj;return ad};W.prototype.readNullTerminatedString=function(ae){var ah=ae||this.filePointer;var ad="";var ag="";var ai=0;var af=String.fromCharCode(this.readByteAt(ah+ai));while(af!==null){ag+=af;ai++;if(ai>=1024){ad+=ag;ag="";ah+=ai;this.filePointer+=ai;ai=0}af=String.fromCharCode(this.readByteAt(ah+ai))}this.filePointer=ah+ai;return ad+ag};W.prototype.beginReadNullTerminatedString=function(aj,ae){var ai=ae||this.filePointer;var ad="";var ag="";var af=this;var ah=function(){var al=0;var ak=String.fromCharCode(af.readByteAt(ai+al));while(ak!==null){ag+=ak;al++;if(al>=1024){ad+=ag;ag="";ai+=al;af.filePointer+=al;al=0;break}ak=String.fromCharCodet(af.readByteAt(i))}af.filePointer=ai+al;if(ak!==null){setTimeout(ah,1)}else{aj(ad+ag)}};ah();return null};f.BinaryUrlStream=W})();(function(){var W="1.3 2011May10";var Z="JSIO.TextDecoder";if((typeof f!=="object")||(typeof f.version!=="string")){var ac=new Error("This extension requires JSIO.core.js v1.3");ac.source=Z+".js";throw ac}if((f.version.length<3)||(f.version.substring(0,3)!=="1.3")){var X=new Error("This extension requires JSIO.core.js v1.3");X.source=Z+".js";throw X}if(typeof f._ByteReaderBase!=="function"){var ab=new Error("This class requires JSIO.BasicByteReaders.js");ab.source=Z+".js";throw ab}var Y=function(ad){if(!(this instanceof arguments.callee)){var ae=new Error("you must use new to instantiate this class");ae.source="JSIO.TextDecoder.Default.ctor";throw ae}this.byteReader=ad;this._version=W;this._typename=Z+".Default";return this};Y.prototype.readChar=function(){var ad=this.byteReader.readByte();return(ad<0)?null:String.fromCharCode(ad)};var aa=function(ad){if(!(this instanceof arguments.callee)){var ae=new Error("you must use new to instantiate this class");ae.source="JSIO.TextDecoder.Utf16.ctor";throw ae}this.byteReader=ad;this.bomState=0;this._version=W;this._typename=Z+".Utf16";return this};aa.prototype.readChar=function(){var ae=this.byteReader.readByte();if(ae<0){return null}var ad=this.byteReader.readByte();if(ad<0){var ah=new Error("Incomplete UTF16 character");ah.source="JSIO.TextDecoder.Utf16.readChar()";throw ah}if((this.bomState===0)&&((ae+ad)==509)){this.bomState=(ad==254)?1:2;ae=this.byteReader.readByte();if(ae<0){return null}ad=this.byteReader.readByte();if(ad<0){var ag=new Error("Incomplete UTF16 character");ag.source="JSIO.TextDecoder.Utf16.readChar()";throw ag}}else{this.bomState=1}var af=this.bomState==1?(ad<<8|ae):(ae<<8|ad);return String.fromCharCode(af)};var V=function(ad){if(!(this instanceof arguments.callee)){var ae=new Error("you must use new to instantiate this class");ae.source="JSIO.TextDecoder.Utf8.ctor";throw ae}this.byteReader=ad;this.waitBom=true;this.strict=false;this.pendingChar=null;this._version=W;this._typename=Z+".Utf8";return this};V.prototype.readChar=function(){var ad=null;do{if(this.pendingChar!==null){ad=this.pendingChar;this.pendingChar=null}else{var am=this.byteReader.readByte();if(am===null){return null}if((am&128)===0){ad=String.fromCharCode(am)}else{var ae=192;var ao=5;do{var ap=ae>>1|128;if((am&ap)==ae){break}ae=ae>>1|128;--ao}while(ao>=0);if(ao>0){var af=(am&((1<<ao)-1));for(var ai=5;ai>=ao;--ai){var ag=this.byteReader.readByte();if((ag&192)!=128){var al=new Error("Invalid sequence character");al.source=this._typename+".readChar";throw al}af=(af<<6)|(ag&63)}if(af<=65535){if(af==65279&&this.waitBom){ad=null}else{ad=String.fromCharCode(af)}}else{var an=af-65536;var aj=55296|((an>>10)&1023);var ah=56320|(an&1023);this.pendingChar=String.fromCharCode(ah);ad=String.fromCharCode(aj)}}else{if(this.strict){var ak=new Error("Invalid character");ak.source=this._typename+".readChar";throw ak}else{ad=String.fromCharCode(am)}}}}this.waitBom=false}while(ad===null);return ad};f.TextDecoder={Default:Y,Utf16:aa,Utf8:V}})();(function(){var V="1.3 2011May10";var W="JSIO.TextReader";if(typeof f.TextDecoder.Utf8!=="function"){var Y=new Error("This class requires JSIO.TextDecoder.js");Y.source=W+".js";throw Y}var X=function(aa){if(!(this instanceof arguments.callee)){var Z=new Error("you must use new to instantiate this class");Z.source=W+".ctor";throw Z}this.decoder=aa;this._version=V;this._typename=W;this.unreads=[]};X.prototype.readChar=function(){if(this.unreads.length>0){return this.unreads.pop()}else{return this.decoder.readChar()}};X.prototype.read=function(ab){var aa="";for(vari=0;i<ab;i++){var Z=this.readChar();if(Z!==null){aa+=Z}else{i=ab}}return aa};X.prototype.unreadChar=function(Z){this.unreads.push(Z)};X.prototype.readToEnd=function(){var Z="";var ab="";var ac=0;var aa=this.readChar();while(aa!==null){ab+=aa;ac++;if(ac>=1024){Z+=ab;ab="";ac=0}aa=this.readChar()}return Z+ab};X.prototype.beginReadToEnd=function(ad){var Z="";var aa="";var ac=this;var ab=function(){var af=0;var ae=ac.readChar();while(ae!==null){aa+=ae;af++;if(af>=1024){Z+=aa;aa="";break}ae=ac.readChar()}if(ae!==null){setTimeout(ab,1)}else{ad(Z+aa)}};ab();return null};X.prototype.readLine=function(){var aa="";var Z=this.readChar();if(Z===null){return null}while(Z!="\r"&&Z!="\n"){aa+=Z;Z=this.readChar();if(Z===null){return aa}}if(Z=="\r"){Z=this.readChar();if(Z!==null&&Z!="\n"){this.unreadChar(Z)}}return aa};f.TextReader=X})();(function(){var W="1.3 2011May10";var Y="JSIO.Crc32";if(typeof f._ByteReaderBase!=="function"){var aa=new Error("This extension requires JSIO.BasicByteReaders.js");aa.source=Y+".js";throw aa}f.crc32Table=null;f.crc32Polynomial=3988292384;var Z=function(){if(f.crc32Table){return}f.crc32Table=new Array(256);for(var ac=0;ac<256;ac++){var ad=ac;for(var ab=0;ab<8;ab++){if(ad&1==1){ad=f.crc32Polynomial^(ad>>>1)}else{ad>>>=1}}f.crc32Table[ac]=ad}};f.computeCrc32=function(ad){Z();var af=4294967295;var ae=ad.length;if(typeof ad=="object"){for(var ac=0;ac<ae;ac++){af=f.crc32Table[(af&255)^ad[ac]]^(af>>>8)}}else{for(var ab=0;ab<ae;ab++){af=f.crc32Table[(af&255)^ad.charCodeAt(ab)]^(af>>>8)}}af^=4294967295;if(af<0){af+=4294967295+1}return af};var V=function(){if(!(this instanceof arguments.callee)){var ab=new Error("you must use new to instantiate this class");ab.source=Y+".ctor";throw ab}Z();this._typename=Y;this._version=W;this._runningCrc32=4294967295};V.prototype.slurpByte=function(ab){var ac=this._runningCrc32;this._runningCrc32=(ac>>>8)^f.crc32Table[ab^(ac&255)]};V.prototype.result=function(){var ab=this._runningCrc32^4294967295;if(ab<0){ab+=4294967295+1}return ab};var X=function(ab){if(!(this instanceof arguments.callee)){var ac=new Error("you must use new to instantiate this class");ac.source="JSIO.Crc32Reader.ctor";throw ac}this._byteReader=ab;this._typename="JSIO.Crc32Reader";this._version=W;this._crc32=new f.Crc32()};X.prototype=new f._ByteReaderBase();X.prototype.readByte=function(){var ab=this._byteReader.readByte();if(ab!==null){this._crc32.slurpByte(ab)}return ab};X.prototype.crc32=function(){return this._crc32.result()};f.Crc32=V;f.Crc32Reader=X})();(function(){var af="1.3 2011May10";var ab="JSIO.InflatingReader";if(typeof f._ByteReaderBase!=="function"){var ah=new Error("This class requires JSIO.BasicByteReaders.js");ah.source=ab+".js";throw ah}var ak=function(al){if(!(this instanceof arguments.callee)){var am=new Error("you must use new to instantiate this class");am.source="InflatingReader._InternalBitReader.ctor";throw am}this.bitsLength=0;this.bits=0;this.byteReader=al;this._typeName=ab+"._InternalBitReader";this._version=af};ak.prototype.readBit=function(){if(this.bitsLength===0){var am=this.byteReader.readByte();if(am===null){var al=new Error("Unexpected end of stream");al.source=this._typeName+".readBit";throw al}this.bits=am;this.bitsLength=8}var an=(this.bits&1)!==0;this.bits>>=1;--this.bitsLength;return an};ak.prototype.align=function(){this.bitsLength=0};ak.prototype.readLSB=function(am){var an=0;for(var al=0;al<am;++al){if(this.readBit()){an|=1<<al}}return an};ak.prototype.readMSB=function(am){var an=0;for(var al=0;al<am;++al){if(this.readBit()){an=(an<<1)|1}else{an<<=1}}return an};var ae=function(al){if(!(this instanceof arguments.callee)){var am=new Error("you must use new to instantiate this class");am.source="JSIO.InflatingReader.ctor";throw am}this._byteReader=al;this._bitReader=new ak(al);this._buffer=[];this._bufferPosition=0;this._state=0;this._blockFinal=false;this._typeName=ab;this._version=af;return this};var ai=null;var aa=null;var ac=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var V=function(ao){var ap=0;var al=new Array(ao.length);var ar=ao[0];for(ap=1;ap<ao.length;ap++){if(ar<ao[ap]){ar=ao[ap]}}var au=new Array(ar+1);for(ap=0;ap<=ar;ap++){au[ap]=0}for(ap=0;ap<ao.length;ap++){++au[ao[ap]]}var an=new Array(ar+1);var am=0;au[0]=0;for(var at=1;at<=ar;at++){am=(am+au[at-1])<<1;an[at]=am}for(ap=0;ap<al.length;ap++){var aq=ao[ap];if(aq!==0){al[ap]=an[aq];an[aq]++}}return al};var W=function(al,ap){var an=[];for(var am=0;am<al.length;++am){if(ap[am]>0){var ao={};ao.bits=al[am];ao.length=ap[am];ao.index=am;an.push(ao)}}return ag(an,0,0)};var ag=function(am,at,an){if(am.length===0){return null}var al=[];var ar=[];var aq={};aq.isLeaf=false;for(var ao=0;ao<am.length;++ao){if(am[ao].length==an&&am[ao].bits==at){aq.isLeaf=true;aq.index=am[ao].index;break}else{var ap=((am[ao].bits>>(am[ao].length-an-1))&1)>0;if(ap){ar.push(am[ao])}else{al.push(am[ao])}}}if(!aq.isLeaf){aq.zero=ag(al,(at<<1),an+1);aq.one=ag(ar,(at<<1)|1,an+1)}return aq};var Y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];var ad=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var aj=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];var X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var Z=function(aw){var au=aw.readLSB(5)+257;var aE=aw.readLSB(5)+1;var az=aw.readLSB(4)+4;var av=new Array(19);var aD=0;for(aD=0;aD<av.length;++aD){av[aD]=0}for(aD=0;aD<az;++aD){av[ac[aD]]=aw.readLSB(3)}var an=V(av);var at=W(an,av);var aA=[];while(aA.length<au+aE){var ay=at;while(!ay.isLeaf){ay=aw.readBit()?ay.one:ay.zero}var al=ay.index;if(al<=15){aA.push(al)}else{if(al==16){var ar=aw.readLSB(2)+3;for(var ax=0;ax<ar;++ax){aA.push(aA[aA.length-1])}}else{if(al==17){var aC=aw.readLSB(3)+3;for(var aq=0;aq<aC;++aq){aA.push(0)}}else{if(al==18){var aB=aw.readLSB(7)+11;for(var ap=0;ap<aB;++ap){aA.push(0)}}}}}}var aG=aA.slice(0,au);var aF=V(aG);var am=aA.slice(au,au+aE);var ao=V(am);return{codesTree:W(aF,aG),distancesTree:W(ao,am)}};ae.prototype=new f._ByteReaderBase();ae.prototype._decodeItem=function(){if(this._state==2){return null}var aB;if(this._state===0){this._blockFinal=this._bitReader.readBit();var aq=this._bitReader.readLSB(2);switch(aq){case 0:this._bitReader.align();var au=this._bitReader.readLSB(16);var aA=this._bitReader.readLSB(16);if((au&~aA)!=au){var ay=new Error("Invalid block type 0 length");ay.source="JSIO.InflatingReader._decodeItem";throw ay}aB={};aB.itemType=0;aB.array=new Array(au);for(var ar=0;ar<au;++ar){var am=this._byteReader.readByte();if(am<0){var ax=new Error("Incomplete block");ax.source="JSIO.InflatingReader._decodeItem";throw ax}aB.array[ar]=am}if(this._blockFinal){this._state=2}return aB;case 1:this._codesTree=ai;this._distancesTree=aa;this._state=1;break;case 2:var at=Z(this._bitReader);this._codesTree=at.codesTree;this._distancesTree=at.distancesTree;this._state=1;break;default:var aw=new Error("Invalid block type ("+aq+")");aw.source="JSIO.InflatingReader._decodeItem";throw aw}}aB={};var an=this._codesTree;while(!an.isLeaf){an=this._bitReader.readBit()?an.one:an.zero}if(an.index<256){aB.itemType=2;aB.symbol=an.index}else{if(an.index>256){var ap=an.index;if(ap>285){var av=new Error("Invalid length code");av.source="JSIO.InflatingReader._decodeItem";throw av}var ao=Y[ap-257];if(ad[ap-257]>0){ao+=this._bitReader.readLSB(ad[ap-257])}an=this._distancesTree;while(!an.isLeaf){an=this._bitReader.readBit()?an.one:an.zero}var az=an.index;var al=aj[az];if(X[az]>0){al+=this._bitReader.readLSB(X[az])}aB.itemType=3;aB.distance=al;aB.length=ao}else{aB.itemType=1;this._state=this._blockFinal?2:0}}return aB};ae.prototype.readByte=function(){while(this._bufferPosition>=this._buffer.length){var ao=this._decodeItem();if(ao===null){return null}switch(ao.itemType){case 0:this._buffer=this._buffer.concat(ao.array);break;case 2:this._buffer.push(ao.symbol);break;case 3:var am=this._buffer.length-ao.distance;for(var an=0;an<ao.length;an++){this._buffer.push(this._buffer[am++])}break}}var ap=this._buffer[this._bufferPosition++];if(this._bufferPosition>49152){var al=this._buffer.length-32768;if(al>this._bufferPosition){al=this._bufferPosition}this._buffer.splice(0,al);this._bufferPosition-=al}this.position++;return ap};(function(){var am=new Array(288);var ap=new Array(288);var an=0;for(an=0;an<=143;an++){am[an]=48+an;ap[an]=8}for(an=144;an<=255;an++){am[an]=400+an-144;ap[an]=9}for(an=256;an<=279;an++){am[an]=0+an-256;ap[an]=7}for(an=280;an<=287;an++){am[an]=192+an-280;ap[an]=8}ai=W(am,ap);var al=new Array(32);var ao=new Array(32);for(an=0;an<=31;an++){al[an]=an;ao[an]=5}aa=W(al,ao)})();f.InflatingReader=ae})();(function(){var V="1.26 2011Aug07";if(typeof f.BinaryUrlStream!="function"){var aa=new Error("This extension requires JSIO.BinaryUrlStream.js v1.3");aa.source="Zipfile.js";throw aa}if(typeof f.TextDecoder!=="object"){var Z=new Error("This extension requires JSIO.TextDecoder.js");Z.source="Zipfile.js";throw Z}if(typeof f.TextReader!=="function"){var Y=new Error("This extension requires JSIO.TextReader.js");Y.source="Zipfile.js";throw Y}if(typeof f.Crc32!=="function"){var X=new Error("This extension requires JSIO.Crc32.js");X.source="Zipfile.js";throw X}if(typeof f.InflatingReader!=="function"){var W=new Error("This extension requires JSIO.InflatingReader.js");W.source="Zipfile.js";throw W}function ab(ac){this.zipfile=ac;this._typename="ZipEntry";this._version=V;this._crcCalculator=null}ab.prototype.extract=function(ah,ag){this.contentType=f.guessFileType(this.name);ag=ag||(this.contentType==f.FileType.Text||this.contentType==f.FileType.XML);var ae=this;if(this.compressionMethod!==0&&this.compressionMethod!=8){var af=new Error("Unsupported compression method: "+this.compressionMethod);af.source="ZipEntry.extract()";throw af}var ad=(ag)?this.openTextReader():this.openBinaryReader();ad.zipEntryName=ae.name;if(typeof ah!="function"){var ac=ad.readToEnd();this.verifyCrc32();return ac}ad.beginReadToEnd(function(ai){try{ae.verifyCrc32();ah(ae,ai)}catch(aj){ah(ae,aj)}});return null};ab.prototype.openBinaryReader=function(){var ac=new f.StreamSegmentReader(this.zipfile.binaryStream,this.offset+this.lengthOfHeader,this.compressedSize);if(this.compressionMethod===0){this._crcCalculator=new f.Crc32Reader(ac)}else{var ad=new f.InflatingReader(ac);this._crcCalculator=new f.Crc32Reader(ad)}return this._crcCalculator};ab.prototype.openTextReader=function(af){var ac=this.openBinaryReader();af=af||f.TextDecoder.Utf8;var ae=new af();af.apply(ae,[ac]);var ad=new f.TextReader(ae);ae._parent=ad;return ad};ab.prototype.verifyCrc32=function(){var ac=this._crcCalculator.crc32();var ad=false;if(this.crc32!=ac){var ae="WARNING: CRC check failed: entry("+this.name+") computed("+f.decimalToHexString(ac,8)+") expected("+f.decimalToHexString(this.crc32,8)+") ";this.zipfile.status.push(ae)}else{ad=true;if(this.zipfile.verbose>2){this.zipfile.status.push("INFO: CRC check ok: 0x"+f.decimalToHexString(this.crc32,8))}}return ad};b=function(ak,ai,af,ag){if(!(this instanceof arguments.callee)){var ah=new Error("you must use new to instantiate this class");ah.source="ZipFile.ctor";throw ah}this.verbose=ag||0;this.entries=[];this.entryNames=[];this.status=[];this._version=V;this._typename="ZipFile";var ae=this;function ad(aB){if(aB==65535||aB===0){return new Date(1995,0,1,0,0,0,0)}var ar=aB&65535;var at=((aB&4294901760)>>16);var az=1980+((at&65024)>>9);var aw=((at&480)>>5)-1;var aA=at&31;var av=(ar&63488)>>11;var au=(ar&2016)>>5;var aq=(ar&31)*2;if(aq>=60){au++;aq=0}if(au>=60){av++;au=0}if(av>=24){aA++;av=0}var aC=false;var ax;try{ax=new Date(az,aw,aA,av,au,aq,0);aC=true}catch(ap){if(az==1980&&(aw===0||aA===0)){try{ax=new Date(1980,0,1,av,au,aq,0);aC=true}catch(ao){try{ax=new Date(1980,0,1,0,0,0,0);aC=true}catch(an){}}}else{try{while(az<1980){az++}while(az>2030){az--}while(aw<1){aw++}while(aw>12){aw--}while(aA<1){aA++}while(aA>28){aA--}while(au<0){au++}while(au>59){au--}while(aq<0){aq++}while(aq>59){aq--}ax=new Date(az,aw-1,aA,av,au,aq,0);aC=true}catch(am){}}}if(!aC){var ay=new Error("bad date/time value in this zip file.");ay.source="ZipFile.ReadZipEntry";throw ay}return ax}function aj(){if(ae.entryNames.length===0){var am;while((am=ac())!==null){ae.entries.push(am);ae.entryNames.push(am.name)}}}function ac(){var aq=ae.binaryStream.getPosition();var av=ae.binaryStream.readNumber(4);if(av==b.Signatures.DirEntry){if(ae.verbose>0){ae.status.push("INFO: at offset 0x"+f.decimalToHexString(aq)+", found start of Zip Directory.")}return null}if(av!=b.Signatures.Entry){ae.status.push("WARNING: at offset 0x"+f.decimalToHexString(aq)+", found unexpected signature: 0x"+f.decimalToHexString(av));return null}var at=new ab(ae);at.offset=aq;at.versionNeeded=ae.binaryStream.readNumber(2);at.bitField=ae.binaryStream.readNumber(2);at.compressionMethod=ae.binaryStream.readNumber(2);var ao=ae.binaryStream.readNumber(4);at.lastModified=ad(ao);if((at.bitField&1)==1){ae.status.push("This zipfile uses Encryption, which is not supported by ZipFile.js.");return null}at.utf8=((at.bitField&2048)==2048);if((at.bitField&8)==8){ae.status.push("This zipfile uses a bit 3 trailing data descriptor, which is not supported by ZipFile.js.");return null}at.crc32=ae.binaryStream.readNumber(4);at.compressedSize=ae.binaryStream.readNumber(4);at.uncompressedSize=ae.binaryStream.readNumber(4);if(at.compressedSize==4294967295||at.uncompressedSize==4294967295){ae.status.push("This zipfile uses ZIP64, which is not supported by ZipFile.js");return null}var aw=ae.binaryStream.readNumber(2);var ar=ae.binaryStream.readNumber(2);ae.status.push("INFO: filename length= "+aw);var an=30+aw+ar;if(at.utf8){ae.status.push("INFO: before filename, position= 0x"+f.decimalToHexString(ae.binaryStream.getPosition()));var au=new f.StreamSegmentReader(ae.binaryStream,ae.binaryStream.getPosition(),aw);var am=new f.TextDecoder.Utf8(au);var ap=new f.TextReader(am);at.name=ap.readToEnd();ae.binaryStream.seek(aw,f.SeekOrigin.Current,ae);ae.status.push("INFO: after filename, position= 0x"+f.decimalToHexString(ae.binaryStream.getPosition()))}else{at.name=ae.binaryStream.readString(aw)}at.extra=ae.binaryStream.read(ar);if(ae.verbose>1){ae.status.push("INFO: at offset 0x"+f.decimalToHexString(at.offset)+", found entry '"+at.name+"' fnl("+aw+") efl("+ar+")")}if(ar>0){if(ae.verbose>0){ae.status.push("INFO: entry "+at.name+" has "+ar+" bytes of extra metadata (ignored)")}}at.lengthOfHeader=an;at.totalEntrySize=at.lengthOfHeader+at.compressedSize;if(ae.verbose>1){ae.status.push("INFO: seek 0x"+f.decimalToHexString(at.compressedSize)+" ("+at.compressedSize+") bytes")}ae.binaryStream.seek(at.compressedSize,f.SeekOrigin.Current,ae);return at}var al=function(an){try{if(an.req.status==200){var ao=ae.binaryStream.readNumber(4);if(ao!=b.Signatures.Entry){ae.status.push("WARNING: this file does not appear to be a zip file")}else{ae.binaryStream.seek(0,f.SeekOrigin.Begin);aj();if(ae.verbose>0){ae.status.push("INFO: read "+ae.entries.length+" entries")}}}else{ae.status.push("ERROR: the URL could not be read ("+an.req.status+" "+an.req.statusText+")")}ai(ae)}catch(am){ae.status.push("Exception: "+am.message);ai(ae)}};this.binaryStream=new f.BinaryUrlStream(ak,al,af);return this};b.Signatures={Entry:67324752,EndOfCentralDirectory:101010256,DirEntry:33639248};b.Version=V;b.EncryptionAlgorithm={None:0,PkzipWeak:1,WinZipAes:2}})();B.DOTS_PER_INCH=96;B.ProxyHost="//data.bordeaux-metropole.fr/api/xml.ajax.php?url=";B.bases.FeatureVector=B.Feature.Vector;B.Feature.Vector=B.Class(B.Feature.Vector,{initialize:function(Y,W,X,V){B.bases.FeatureVector.prototype.initialize.apply(this,arguments);this.selected=false;this.CUB=V||new M.Entity(k,this,this.layer)},geometryType:function(){return this.geometry?this.geometry.getCUBType():null},transform:function(W,V){B.Projection.transform(this.geometry,W,V);this.geometry.calculateBounds()},isMulti:function(){return this.geometry&&this.geometry.isMulti()},toCUBGeometry:function(aa){aa=aa||M.projection();if(aa!=M.realProjection()){var Y=this.geometry.clone();Y.transform(p.CUBProjToOLProj(M.realProjection()),p.CUBProjToOLProj(aa))}else{var Y=this.geometry}switch(this.geometryType()){case M.Entity.geomType.POINT:if(Y.isMulti()){var ab=[];for(var X in Y.components){ab.push(new M.Geometry.Point(new M.Position(Y.components[X].x,Y.components[X].y)))}return ab}else{return new M.Geometry.Point(new M.Position(Y.x,Y.y))}break;case M.Entity.geomType.LINE:if(Y.isMulti()){var ab=[];for(var X in Y.components){var Z=[];for(var W in Y.components[X].components){Z.push(new M.Position(Y.components[X].components[W].x,Y.components[X].components[W].y))}ab.push(new M.Geometry.Line(Z))}return ab}else{var Z=[];for(var X in Y.components){Z.push(new M.Position(Y.components[X].x,Y.components[X].y))}return new M.Geometry.Line(Z)}break;case M.Entity.geomType.POLYGON:if(Y.isMulti()){var ab=[];for(var X in Y.components){var Z=[];var V=Y.components[X].components[0];for(var W=0;W<V.components.length-1;W++){Z.push(new M.Position(V.components[W].x,V.components[W].y))}ab.push(new M.Geometry.Polygon(Z))}return ab}else{var Z=[];for(var X=0;X<Y.components[0].components.length-1;X++){Z.push(new M.Position(Y.components[0].components[X].x,Y.components[0].components[X].y))}return new M.Geometry.Polygon(Z)}break}}});B.Feature.Vector.style=B.bases.FeatureVector.style;B.CUB.Google=B.Class(B.Layer.Google,{initialize:function(W){switch(W){case M.Layer.Background.layerType.GOOGLEHYBRID:W=google.maps.MapTypeId.HYBRID;break;case M.Layer.Background.layerType.GOOGLESATELLITE:W=google.maps.MapTypeId.SATELLITE;break;case M.Layer.Background.layerType.GOOGLETERRAIN:W=google.maps.MapTypeId.TERRAIN;break;case M.Layer.Background.layerType.GOOGLEROADMAP:default:W=google.maps.MapTypeId.ROADMAP;break}var V={isBaseLayer:true,type:W,animationEnabled:false,numZoomLevels:21,destroy:this.destroy};B.Layer.Google.prototype.initialize.apply(this,["",V])},setMap:function(){B.Layer.Google.prototype.setMap.apply(this,arguments);google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",p.createDelegate(function(){this.events.triggerEvent("loadend")},this))},destroy:function(){M.jQuery(this.pane).remove();if(B.Layer.Google.v3.destroy){B.Layer.Google.v3.destroy.apply(this)}}});B.CUB.SelectFeature=B.Class(B.Control.SelectFeature,{initialize:function(W,V){B.Control.SelectFeature.prototype.initialize.apply(this,arguments);this.handlers.feature.stopDown=false;this.selectStyle="over"},clickFeature:function(V){if(!V.layer.CUB.selectable){return}n=true;if(V.layer.CUB.singleSelect){V.layer.CUB.clearSelection()}this.hover=false;B.Control.SelectFeature.prototype.clickFeature.apply(this,arguments);this.hover=true},overFeature:function(V){if(!V.layer.CUB.selectable){return}if(!V.selected){B.Control.SelectFeature.prototype.overFeature.apply(this,arguments)}if(V.layer.CUB.cursorOver){document.body.style.cursor="pointer"}},outFeature:function(V){if(!V.layer.CUB.selectable){return}if(V.selected){this.hover=false}B.Control.SelectFeature.prototype.outFeature.apply(this,arguments);this.hover=true;if(V.layer.CUB.cursorOver){document.body.style.cursor="default"}},select:function(V){this.selectStyle="select";B.Control.SelectFeature.prototype.select.apply(this,arguments);this.selectStyle="over";if(!V.layer.CUB.simpleSelect){V.selected=true}},unselect:function(V){B.Control.SelectFeature.prototype.unselect.apply(this,arguments);V.selected=false},removeLayer:function(V){var X=M.jQuery.grep(this.layers,function(Y){return Y.CUB!=V});var W=this.active;this.deactivate();if(this.layers){this.layer.destroy();this.layers=null}this.initLayer(X);this.handlers.feature.layer=this.layer;if(W){this.activate()}}});B.Layer.SpitSet=B.Class(B.Layer.Vector,{spits:[],template:"",closable:true,sortByY:true,events:null,dragOffset:null,dragSpit:null,CUB:null,initialize:function(W,V){B.Layer.Vector.prototype.initialize.apply(this,arguments);if(p.getRenderer()=="SVG"){this.renderer.rendererRoot.style.display="none"}this.CUB=V.CUB;this.events=new B.Events(this,D.div,null,false)},addSpits:function(Y){if(!(B.Util.isArray(Y))){Y=[Y]}for(var X=0,V=Y.length;X<V;X++){var W=Y[X];this.spits.push(W);this.div.appendChild(W.div);this.drawSpit(W)}if(this.sortByY){this.reorderByY()}},removeSpit:function(W){for(var V=0;V<this.spits.length;++V){if(this.spits[V]===W){this.spits=this.spits.slice(0,V).concat(this.spits.slice(V+1,this.spits.length));W.destroy();return}}},removeAll:function(){for(var V in this.spits){this.spits[V].destroy()}this.spits=[]},moveTo:function(aa,W,ab){if(!ab){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var Z=this.map.getExtent();this.renderer.setExtent(Z,W);this.renderer.root.style.visibility="visible"}this.renderer.clear();if(this.sortByY){this.reorderByY()}for(var Y=0,V=this.spits.length;Y<V;Y++){this.renderer.locked=(Y!==(V-1));var X=this.spits[Y];this.drawSpit(X)}},onDragSpit:function(W,X){if(X.type=="touchstart"){return true}this.events.on({mousemove:this.onMoveSpit,mouseup:this.onDropSpit,scope:this});this.dragSpit=W;this.dragDone=false;var V=p.viewportPixelToMapPixel(X.clientX,X.clientY,false);this.dragOffset=this.dragSpit.offset;this.dragMouse=new B.Pixel(V.x,V.y)},onMoveSpit:function(W){if(this.dragSpit){this.dragDone=true;var V=p.viewportPixelToMapPixel(W.clientX,W.clientY,false);this.dragSpit.offset=new B.Pixel(this.dragOffset.x+(V.x-this.dragMouse.x),this.dragOffset.y+(V.y-this.dragMouse.y));this.dragSpit.draw()}},onDropSpit:function(V){if(this.dragDone){this.dragSpit.draw()}this.dragSpit=null;this.dragOffset=null;this.dragMouse=null;this.events.un({mousemove:this.onMoveSpit,mouseup:this.onDropSpit,scope:this})},onRotateMap:function(V){this.setAngle(-V.angle)},setAngle:function(W){for(var V in this.spits){this.spits[V].setAngle(W)}},drawSpit:function(V){if(!V.lonlat){return}V.draw()},reorderByY:function(){var V=[];for(var W in this.spits){var X=false;for(var Y in V){if(this.spits[W].lonlat.lat>V[Y].lonlat.lat){V=V.slice(0,Y).concat(this.spits[W],V.slice(Y,V.length));X=true;break}}if(!X){V.push(this.spits[W])}}for(var W in V){V[W].setZIndex(W)}},CLASS_NAME:"OpenLayers.Layer.SpitSet"});B.Spit=B.Class({lonlat:null,offset:new B.Pixel(0,-100),angle:0,div:null,layer:null,events:null,connector:null,connectorShadow:null,CUB:null,initialize:function(Z,X,Y){this.lonlat=Z;this.layer=X;this.CUB=Y;this.div=B.Util.createDiv(null,null,null,null,null);this.div.appendChild(B.Util.createDiv(null,null,null,null,"relative"));if(X.closable){var V=B.Util.createDiv(null,null,new B.Size(16,16));V.innerHTML="x";V.style.right="0px";V.style.top="0px";V.style.cursor="pointer";var W=new B.Events(this,V,null,false);W.on({mousedown:function(aa){W.destroy();this.CUB.destroy()},scope:this});this.div.appendChild(V)}this.events=new B.Events(this,this.div,null,false);this.events.on({touchstart:this.onMouseDown,mousedown:this.onMouseDown,scope:this});this.setAngle(-M.rotate())},onMouseDown:function(V){if(this.layer.CUB.draggable){this.layer.onDragSpit(this,V)}},drawText:function(){var V=this.layer.template;for(var W in this.CUB.attributes){if(this.CUB.attributes[W]&&M.jQuery.isDate(this.CUB.attributes[W])){V=V.replace(new RegExp("\\${"+W+"}","g"),M.jQuery.dateTimeToString(this.CUB.attributes[W]))}else{V=V.replace(new RegExp("\\${"+W+"}","g"),this.CUB.attributes[W])}}if(this.layer.CUB.draggable){this.div.style.cursor="move"}else{this.div.style.cursor=""}return this.div.childNodes[0].innerHTML=V},draw:function(){if(!this.lonlat){return}var W={strokeColor:"#BBBBBB",strokeWidth:4,strokeOpacity:0.8};if(!this.connector){this.connector=new B.Feature.Vector();this.connectorShadow=new B.Feature.Vector()}else{if(this.connector.geometry){this.layer.renderer.eraseFeatures([this.connector,this.connectorShadow])}}var X=this.offsetTop();var Y=this.layer.getLonLatFromViewPortPx(X);var V=new B.Geometry.LineString([new B.Geometry.Point(this.lonlat.lon,this.lonlat.lat),new B.Geometry.Point(Y.lon,Y.lat)]);if(this.connector.geometry){this.connector.geometry.destroy()}this.connector.geometry=V;this.layer.renderer.drawFeature(this.connector,W);W=B.Util.extend(W,{strokeColor:"#ffffff",strokeWidth:2});if(this.connectorShadow.geometry){this.connectorShadow.geometry.destroy()}this.connectorShadow.geometry=V.clone();this.layer.renderer.drawFeature(this.connectorShadow,W);this.drawText();var X=X.offset(this.calculateDivOffset());B.Util.modifyDOMElement(this.div,null,X)},setAngle:function(V){M.utils.rotateElement(this.div,V);this.angle=V;this.draw()},destroy:function(){if(this.connector){this.layer.renderer.eraseFeatures(this.connector);this.connector.destroy()}if(this.connectorShadow){this.layer.renderer.eraseFeatures(this.connectorShadow);this.connectorShadow.destroy()}this.events.destroy();this.div.parentNode.removeChild(this.div)},offsetTop:function(){var Y=this.layer.getViewPortPxFromLonLat(this.lonlat);var V=this.angle*Math.PI*2/360;var W=Math.cos(V);var X=Math.sin(V);return Y.add(this.offset.x*W-this.offset.y*X,this.offset.x*X+this.offset.y*W)},calculateDivOffset:function(){return new B.Pixel(-this.width()/2,-this.height()/2)},height:function(){return parseInt(this.div.offsetHeight)},width:function(){return parseInt(this.div.offsetWidth)},setZIndex:function(V){this.div.style.zIndex=V}});B.CUB.WPSExecuteResponse=B.Class(B.Format.WPSExecute,{defaultPrefix:"wps",write:function(X){X.format=X.format||"XML";if(X.format=="XML"){return B.Format.WPSExecute.prototype.write.apply(this,[X])}else{var W="service=WPS&version=1.0.0&request=Execute&Identifier="+X.identifier;var V=[];for(var Y in X.dataInputs){V.push(this.kvp_encode(Y,X.dataInputs[Y]))}W+="&DataInputs="+V.join(";");return W}},kvp_encode:function(V,X){if(M.jQuery.isArray(X)){var Y=[];for(var W in X){Y.push(encodeURIComponent(V+"="+X[W]))}return Y.join(";")}else{return encodeURIComponent(V+"="+X)}},read:function(V){if(typeof V=="string"){V=B.Format.XML.prototype.read.apply(this,[V])}if(V&&V.nodeType==9){V=V.documentElement}var W={};this.readNode(V,W);return W},readers:{wps:{ExecuteResponse:function(V,W){this.readChildNodes(V,W)},ProcessOutputs:function(V,W){this.readChildNodes(V,W)},Output:function(V,X){var W={identifier:null,values:null};this.readChildNodes(V,W);if(!X[W.identifier]){X[W.identifier]=[]}X[W.identifier]=X[W.identifier].concat(W.values)},Identifier:function(V,W){W.identifier=this.getChildValue(V)},Data:function(V,W){this.readChildNodes(V,W)},LiteralData:function(V,W){W.values=this.getChildValue(V)},ComplexData:function(V,W){W.values=(this.readChildNodes(V)).features},Reference:function(V,W){W.values=V.attributes.getNamedItem("href").value}},gml:{featureMember:function(V,W){W.features=(new B.Format.GML.v3()).read(V,W)}},ows:B.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.CUB.WPSExecuteResponse"});var F={};(function(){F.xmlToJs=function(V){var W={};V.children("*").each(function(X,Y){if(this.childNodes.length==0||(this.childNodes.length==1&&this.childNodes[0].nodeType==3)){W[this.nodeName]=M.jQuery(this).text()}else{W[this.nodeName]=F.xmlToJs(M.jQuery(this))}});return W}})();var M={version:"1.1.8",type:"CUB",IPM:39.3700787,DPI:96,proxy:null};var D;var k=Date();var d="//data.bordeaux-metropole.fr/api/";var K=0;var E=null;var w=null;var G=null;var J;var s;var h=false;var I=[];var C=-1;var r=false;var Q=false;var o=false;var z=new Array;function t(X,V){var W=[J=new B.Control.Navigation({dragPanOptions:{stopDown:false}})];if(
/*!_windowed &&*/
!M.caps.isMobile&&!M.caps.isTablet){W.push(s=new B.Control.KeyboardDefaults({autoActivate:true}))}if((o&&M.caps.isFireFox)||M.caps.isOpera){M.caps.canMiddleClick=false}D=new B.Map({div:X,units:"m",maxExtent:new B.Bounds(1390500,4175000,1431300,4213500),projection:p.CUBProjToOLProj(V),displayProjection:p.CUBProjToOLProj(V),theme:p.getScriptLocation()+"cub.css?version=1383669498",controls:W});M.resize();G=p.viewportToRealExtent(new M.Extent(1390500,4175000,1431300,4213500))}function U(){if(!r){return}if(I.length>C+1){I=I.slice(0,C+1)}I.push(D.getExtent());C++}function q(){r=false}function O(){r=true}function v(ag,af,Y){var ae=new B.Geometry.Point(ag,af);var aj=D.getSize();var X=new B.Geometry.Point(aj.w/2,aj.h/2);ae.rotate(360-M.rotate(),X);var ah=D.getZoom();var ac=D.getZoom()+Y;ac=Math.max(ac,0);ac=Math.min(ac,D.getNumZoomLevels());if(ac===ah){return}var aa=aj.w/2-ae.x;var Z=ae.y-aj.h/2;var ad=D.baseLayer.getResolutionForZoom(ac);var V=D.getLonLatFromPixel(ae);var W=new B.LonLat(V.lon+aa*ad,V.lat+Z*ad);var ai=M.maxExtent();ai.projection(M.realProjection());W.lon=Math.min(Math.max(ai.xmin,W.lon),ai.xmax);W.lat=Math.min(Math.max(ai.ymin,W.lat),ai.ymax);var ab=p.realExtentToViewport(M.getExtent());if(Y<0){if(ab.width()<M.maxExtent().width()||ab.height()<M.maxExtent().height()){D.setCenter(W,ac)}}else{D.setCenter(W,ac)}}function S(V){if(M.jQuery.inArray(V,z)==-1){z.push(V)}if(z.length==1){M.events.fire("onLayersLoadStart")}if(typeof M.events.onLayersLoadStart==="function"){M.events.onLayersLoadStart.apply()}}function H(W){var V=M.jQuery.inArray(W,z);if(V>-1){z.splice(V,1)}if(z.length==0){M.events.fire("onLayersLoadEnd")}if(typeof M.events.onLayersLoadEnd==="function"){M.events.onLayersLoadEnd.apply()}}M.enableAllScalesZoom=function(){if(M.layersManager.backgroundLayers.length&&M.jQuery.inArray(M.layersManager.backgroundLayers[0].layerType,[M.Layer.Background.layerType.GOOGLEROADMAP,M.Layer.Background.layerType.GOOGLEHYBRID,M.Layer.Background.layerType.GOOGLESATELLITE,M.Layer.Background.layerType.GOOGLETERRAIN]==-1)){D.setOptions({fractionalZoom:true})}Q=true};M.disableAllScalesZoom=function(){D.setOptions({fractionalZoom:false});Q=false};M.tint=function(V){if(p.assert(V,M.Color)){M.jQuery(w).css("background-color",V.toString())}return new M.Color(M.jQuery(w).css("background-color"))};M.resize=function(){var W,V;if(M.caps.canRotate){W=V=Math.sqrt(M.jQuery(w).width()*M.jQuery(w).width()+M.jQuery(w).height()*M.jQuery(w).height())}else{W=M.jQuery(w).width();V=M.jQuery(w).height()}D.div.style.width=W+"px";D.div.style.height=V+"px";D.div.style.top=-(V-M.jQuery(w).height())/2+"px";D.div.style.left=-(W-M.jQuery(w).width())/2+"px";D.size.w=W;D.size.h=V;D.updateSize();M.events.fire("onResize",M,[M.jQuery(w).width(),M.jQuery(w).height()])};M.disable=function(){for(var V in D.controls){D.controls[V].deactivate()}};M.enable=function(){for(var V in D.controls){D.controls[V].activate()}};M.enableRotation=function(){K=0};M.disableRotation=function(){M.rotate(0);K=null};M.enablePan=function(){J.dragPan.activate()};M.disablePan=function(){J.dragPan.deactivate()};M.enableWheel=function(){J.enableZoomWheel()};M.disableGesture=function(){J.disableZoomWheel()};M.enableWheel=function(){J.enableZoomWheel()};M.disableWheel=function(){J.disableZoomWheel()};M.enableDoubleClick=function(){J.handlers.click.activate()};M.disableDoubleClick=function(){J.handlers.click.deactivate()};M.getExtent=function(){return p.realExtentToViewport(p.boundsToExtent(D.getExtent(),M.realProjection()))};M.getScaledenom=function(){return Math.round(D.getScale())};M.getWidth=function(){return w.width()};M.getHeight=function(){return w.height()};M.moveToExtent=function(V){if(typeof V==="undefined"||!V||!V.type||V.type!="CUB.Extent"){M.moveToWhole();return}if(!M.maxExtent().containsPoint(V.centerPoint())){p.errorLog("Étendue en dehors de l'étendue maximale de la carte",p.errorLevel.WARNING);return}V=p.viewportToRealExtent(V);D.zoomToExtent(V.internal(k,"toOLBounds"),true)};M.moveToPoint=function(V,W){if(D.panTween){D.panTween.stop()}if(typeof V==="undefined"||!V||!V.type||V.type!="CUB.Position"){M.moveToWhole();return}if(!M.maxExtent().containsPoint(V)){p.errorLog("Position en dehors de l'étendue maximale de la carte",p.errorLevel.WARNING);return}if(typeof W==="undefined"||!W||M.getScaledenom()==W){D.panTo(V.internal(k,"toOLLonLat"))}else{D.zoomToExtent(M.Extent.fromScale(V,W).internal(k,"toOLBounds"),true)}};M.moveToWhole=function(){M.moveToExtent(M.maxExtent())};M.zoomPlus=function(V){if(p.assert(V,M.Position)){V=V.toPixel();v(V.x,V.y,1)}else{D.zoomIn()}};M.zoomMinus=function(V){if(p.assert(V,M.Position)){V=V.toPixel();v(V.x,V.y,-1)}else{D.zoomOut()}};M.historyPrev=function(){if(C>0){q();D.zoomToExtent(I[--C],true);O()}};M.historyNext=function(){if(C+1<I.length){q();D.zoomToExtent(I[++C],true);O()}};var R=null;M.rotate=function(V){if(K===null){return null}if(typeof(V)=="number"){K=V;M.utils.rotateElement(D.div,K);if(R){clearTimeout(R)}else{D.events.triggerEvent("startRotation",{angle:V})}R=setTimeout(function(){R=null;D.events.triggerEvent("endRotation",{angle:V})},100);if(typeof(M.events.onRotate)=="function"){M.events.onRotate.apply(M,[V])}D.events.triggerEvent("rotation",{angle:V})}return K};M.projection=function(V){if(p.assert(V)){if(!p.checkEnum(V,M.projections)){p.errorLog("La projection demandée n'est pas supportée",p.errorLevel.WARNING);return}D.setOptions({displayProjection:p.CUBProjToOLProj(V)});G.projection(V)}return p.OLProjToCUBProj(D.displayProjection)};M.realProjection=function(V){if(p.assert(V)){if(!p.checkEnum(V,M.projections)){p.errorLog("La projection demandée n'est pas supportée",p.errorLevel.WARNING);return}if(M.Layer.Background.layers&&!p.checkEnum(V,M.Layer.Background.layers.projections)){p.errorLog("La projection demandée n'est pas supportée par la couche d'arrière plan",p.errorLevel.WARNING);return}var W=p.CUBProjToOLProj(V);var Y;if(D.getExtent()){Y=D.getExtent().transform(D.projection,W)}q();for(var X in I){I[X].transform(D.projection,W)}D.setOptions({projection:W,maxExtent:D.maxExtent.transform(D.projection,W)});for(var X=0;X<M.Layer.Dynamic.layers.length;X++){M.Layer.Dynamic.layers[X].redraw()}for(var X=0;X<M.Layer.SpitSet.layers.length;X++){M.Layer.SpitSet.layers[X].redraw()}if(Y){D.zoomToExtent(Y,true)}O()}return p.OLProjToCUBProj(D.projection)};M.maxExtent=function(V){if(p.assert(V,M.Extent)){G=p.viewportToRealExtent(V)}return p.realExtentToViewport(G)};M.center=function(V){if(p.assert(V,M.Position)){D.setCenter(V.internal(k,"toOLLonLat"))}return p.lonLatToPosition(D.getCenter())};M.getResolution=function(){return D.resolution};M.saveAs=function(Z,W){var V;if(typeof Z==="string"){V=new Blob([Z])}else{V=Z}var X=URL.createObjectURL(V);var Y=document.createElement("a");mimeType="data:attachment/shp,";if(M.caps.isIE10||M.caps.isIE11||M.caps.isEDGE){Y.addEventListener("click",$.delegateFn(function(aa){navigator.msSaveBlob(V,W)},this))}else{if(typeof Y.download!="undefined"){Y.setAttribute("href",X);Y.setAttribute("download",W)}else{throw"Votre navigateur ne supporte pas l'enregistrement de fichier à la volée"}}Y.target="_blank";document.body.appendChild(Y);Y.click()};M.ready=function(W){c.initThreads();if(typeof(W)=="function"){function V(){h=true;W()}M.jQuery(document).ready(function(){l();window.CUB=M;if(c.ready){V()}else{c.onready=V}})}};M.init=function(Z,W){if(!h){p.errorLog("La fonction d'initialisation doit être appelée une fois le navigateur prêt. Utiliser CUB.ready().",p.errorLevel.ERROR);return false}W=W||{};o=true;if(typeof Z=="undefined"||Z===null){o=false;M.jQuery("body").append('<div id="API_CUB"></div>');M.jQuery("body").css("margin",0);if(!(Z=document.getElementById("API_CUB"))){p.errorLog("Impossible de créer une carte",p.errorLevel.ERROR);return}M.jQuery(Z).css("overflow","hidden");M.jQuery(Z).css("left","0");M.jQuery(Z).css("top","0");M.jQuery(Z).css("position","absolute");M.jQuery(Z).width("100%");M.jQuery(Z).height("100%");if(M.caps.isMobile||M.caps.isTablet){if(M.caps.isAndroid){M.jQuery("head").append('<meta name="viewport" content="width=device-width, height=device-height, maximum-scale=1.0, initial-scale=1.0, user-scalable=no"/>')}else{if(M.caps.isMobile){M.jQuery("head").append('<meta name="viewport" content="initial-scale=0.8, user-scalable=no"/>')}}}}else{if(typeof Z==="string"&&!document.getElementById(Z)){p.errorLog("L'objet passé en paramètre n'est pas un bloc valide du document",p.errorLevel.ERROR);return}else{if(typeof Z==="object"&&typeof Z.tagName==="string"&&Z.tagName==="DIV"){}else{Z=document.getElementById(Z)}}}w=M.jQuery('<div id="CUB_root" class="CUB_API"></div>');M.jQuery(Z).append(w);M.jQuery(w).css("overflow","hidden");M.jQuery(w).css("width","100%");M.jQuery(w).css("height","100%");E=M.jQuery('<div class="CUB_HUD"></div>');M.jQuery(w).append(E);var Y=M.jQuery('<div id="CUB_map_container"></div>');M.jQuery(w).append(Y);var X=Math.sqrt(M.jQuery(w).width()*M.jQuery(w).width()+M.jQuery(w).height()*M.jQuery(w).height());Y.css("width",X);Y.css("height",X);Y.css("top",-(X-M.jQuery(w).height())/2+"px");Y.css("left",-(X-M.jQuery(w).width())/2+"px");Y.css("position","relative");if(!W.hidejQuery){$=M.jQuery}B.ImgPath="//data.bordeaux-metropole.fr/api/images/";t(Y[0],M.projections.RGF93CC45);M.jQuery(Z).append('<div class="CUB_copyright"></div>');if(!W.backgroundType||!p.checkEnum(W.backgroundType,M.Layer.Background.layerType)){W.backgroundType=M.Layer.Background.layerType.CUB}var V=M.jQuery.extend({extent:W.extent},W.backgroundOptions);_backLayer=new M.Layer.Background("Arrière-plan",W.backgroundType,V);B.Lang.setCode("fr-fr");if(!W.extent){M.moveToWhole()}D.events.register("moveend",D,U);O();U();g();M.jQuery(window).resize(M.resize);M.jQuery(window).trigger("resize")};function l(){M.tints={LIGHT:new M.Color(M.Color.colors.WHITE),DARK:new M.Color("#313A27")}}M.jQuery=jQuery.noConflict(true);M.chrono=(function(){var V=new Array();return{start:function(W){if(typeof W!="number"||W>=V.length){W=V.length;V.push({sum:0,start:new Date()})}else{if(V[W].start==null){V[W].start=new Date()}else{p.errorLog("Chronomètre "+W+" déjà en marche")}}return W},pause:function(W){if(typeof W!="number"||W>=V.length){return p.errorLog("Chronomètre "+W+" inexistant",p.errorLevel.WARNING)}V[W].sum+=(new Date())-V[W].start;V[W].start=null;return this.value(W)},reset:function(X){if(typeof X!="number"||X>=V.length){return p.errorLog("Chronomètre "+X+" inexistant",p.errorLevel.WARNING)}var W=this.value(X);V[X].sum=0;if(V[X].start){V[X].start=new Date()}return W},stop:function(W){this.pause(W);return this.reset(W)},value:function(W){if(typeof W!="number"||W>=V.length){return p.errorLog("Chronomètre "+W+" inexistant",p.errorLevel.WARNING)}if(V[W].start){return V[W].sum+((new Date())-V[W].start)}else{return V[W].sum}},isRunning:function(W){if(typeof W!="number"||W>=V.length){return p.errorLog("Chronomètre "+W+" inexistant",p.errorLevel.WARNING)}return V[W].start!=null}}})();M.utils={};M.utils.reproject=function(W,V,X){p.assert([W,W.length],null,"Tableau de coordonnées incorrect");if(!p.checkEnum(V,M.projections)&&projection!=M.projections.UNKNOWN){throw new Error("[CUB] Projection incorrecte")}X=X||M.projection();return p.reproject(W,V,X)};M.utils.iso8601ToDate=function(W,X){if(!M.caps.isIE6&&!M.caps.isIE7&&!M.caps.isIE8){return new Date(W)}var V=/^(\d{4})-(\d{2})-(\d{2})((T)(\d{2}):(\d{2})(:(\d{2})(\.\d*)?)?)?([zZ]|([+\-])(\d\d):(\d\d))?$/;m=typeof W==="string"&&W.match(V);if(m){if(m[13]){X=+m[12]=="+"?+m[13]:-m[13]}else{if(typeof X!="number"){X=(new Date()).getTimezoneOffset()/60}else{X=-X}}return new Date(Date.UTC(+m[1],+m[2]-1,+m[3],+m[6]+X||0,+m[7]||0,+m[9]||0,parseInt((+m[10])*1000)||0))}else{return null}};M.utils.stringToDate=function(V){var W=/^(\d{4})(\d{2})(\d{2})$/;m=typeof V==="string"&&V.match(W);if(m){return new Date(Date.UTC(m[1],m[2]-1,m[3]))}else{return null}};M.utils.rotateElement=function(W,V){if(M.caps.canRotate){W=M.jQuery(W);W.css("-moz-transform","rotate("+V+"deg)");W.css("-webkit-transform","rotate("+V+"deg)");W.css("-o-transform","rotate("+V+"deg)");W.css("transform","rotate("+V+"deg)");W.css({msTransform:"rotate("+V+"deg)"})}else{if(V!=0){throw new Error("[CUB] Rotation indisponible pour le navigateur")}}};M.utils.loadXML=function(W,Y,V,X){return T.loadXML(W,Y,V,X)};M.utils.distanceToPixels=function(V){return V/D.resolution};M.utils.pixelsToDistance=function(V){return D.resolution*V};M.caps={};(function(){var ac=[{property:"platform",regex:/iPhone/i,identity:"iPhone"},{property:"platform",regex:/iPod/i,identity:"iPod"},{property:"userAgent",regex:/iPad/i,identity:"iPad"},{property:"userAgent",regex:/Blackberry/i,identity:"Blackberry"},{property:"userAgent",regex:/Android/i,identity:"Android"},{property:"platform",regex:/Mac/i,identity:"Mac"},{property:"platform",regex:/Win/i,identity:"Windows"},{property:"platform",regex:/Linux/i,identity:"Linux"}];var ah=ac.length,ab,Z;var ai=window.navigator;for(ab=0;ab<ah;ab++){Z=ac[ab];M.caps["is"+Z.identity]=Z.regex.test(ai[Z.property])}M.caps.isComputer=M.caps.isMac||M.caps.isWindows||(M.caps.isLinux&&!M.caps.isAndroid);M.caps.isTablet=M.caps.isiPad||(M.caps.isMobile&&Math.max(screen.width,screen.height)>1000);M.caps.isMobile=!M.caps.isComputer&&!M.caps.isTablet;M.caps.isiOS=M.caps.isiPhone||M.caps.isiPad||M.caps.isiPod;var Y=function(aj){return aj.test(ai.userAgent.toLowerCase())};var ae=document.documentMode;M.caps.isOpera=Y(/opera/);M.caps.isChrome=Y(/\bchrome\b/);var ad=Y(/webkit/);M.caps.isSafari=!M.caps.isChrome&&Y(/safari/);M.caps.isSafari2=M.caps.isSafari&&Y(/applewebkit\/4/);M.caps.isSafari3=M.caps.isSafari&&Y(/safari\/3/i);M.caps.isSafari4=M.caps.isSafari&&Y(/safari\/4/i);M.caps.isSafari5=M.caps.isSafari&&Y(/safari\/5/i);M.caps.isIE=!M.caps.isOpera&&Y(/msie/);M.caps.isIE7=M.caps.isIE&&(Y(/msie 7/)||ae==7);M.caps.isIE8=M.caps.isIE&&(Y(/msie 8/)&&ae!=7&&ae!=9||ae==8);M.caps.isIE9=M.caps.isIE&&(Y(/msie 9/)&&ae!=7&&ae!=8||ae==9);M.caps.isIE10=M.caps.isIE&&(Y(/msie 10/));M.caps.isIE11=Y(/rv:11.0/);if(M.caps.isIE11){M.caps.isIE=true}M.caps.isEDGE=Y(/edge/);M.caps.isIE6=M.caps.isIE&&Y(/msie 6/);var X=!ad&&Y(/gecko/);var V=X&&Y(/rv:1\.9/);M.caps.isFireFox=V||Y(/firefox\/\d/);M.caps.isFireFox3_0=V&&Y(/rv:1\.9\.0/);M.caps.isFireFox3_5=V&&Y(/rv:1\.9\.1/);M.caps.isFireFox3_6=V&&Y(/rv:1\.9\.2/);M.caps.isFireFox1x=Y(/firefox\/1\d/);if(ae){M.caps.browserVersion=ae}else{var W=ai.userAgent,af=ai.appName,aa,ag=W.match(/(version|opera|chrome|safari|firefox|msie|trident)\/?\s*([\d\.]+)/i)||[];ag=ag[2]?[ag[1],ag[2]]:[af,ai.appVersion,"-?"];M.caps.browserVersion=parseInt(ag[1])}M.caps.canTouch=("ontouchstart" in window);M.caps.canGesture=("ongesturestart" in window);M.caps.canOrientate=((typeof window.orientation!="undefined")&&("onorientationchange" in window));M.caps.canMotion=("ondevicemotion" in window);M.caps.canGeolocalize=(typeof ai!="undefined"&&typeof ai.geolocation!="undefined");M.caps.canRotate=p.getRenderer()=="SVG";M.caps.canMiddleClick=true;M.caps.renderer=p.getRenderer();M.caps.canLinearLabel=M.caps.renderer!="VML";M.caps.canRotateLabel=M.caps.renderer!="VML"})();var T={};(function(){var Z={javascriptCache:[],xmlCache:[]};T.loadJavaScript=function(ac,af){ac=p.formatURL(ac);var ae=W(ac,Z.javascriptCache);if(ae){if(ae.pending){if(typeof af=="function"){ae.callbacks.push(af)}return}af();return}var ab=[];if(typeof af=="function"){ab.push(af)}Z.javascriptCache.push({url:ac,content:null,pending:true,callbacks:ab});var ad=ac;M.jQuery.ajax({url:ad,dataType:"script",success:function(ai,aj){var ah=W(ac,Z.javascriptCache);for(var ag in ah.callbacks){ah.callbacks[ag].apply()}ah.pending=false}})};T.isSameDomain=function(ab){return document.domain==p.getDomain(ab)};T.hasBeenLoaded=function(ab,ac){var ad=W(ab,ac);if(!ad){return null}else{return ad}};T.loadXML=function(ad,af,ac,ae){ae=ae||false;var ab=T.hasBeenLoaded(ad,Z.xmlCache);if(ab&&!ae&&!ab.pending){af(ab.content);return}if(!ab||ae){Z.xmlCache.push(ab={url:ad,content:"",pending:true,callbacks:[{success:af,failure:ac}]});return T.load(ad,function(ai){ai=ai.replace(/<!DOCTYPE[\s\S]*?end of DOCTYPE declaration -->/,"");var ag=M.jQuery.parseXML(ai);for(var ah in ab.callbacks){ab.callbacks[ah].success(ag)}ab.content=ag;ab.pending=false;ab.callbacks=[];if(ae){Z.xmlCache.splice(M.jQuery.inArray(ab,Z.xmlCache),1)}},function(ag){for(var ah in ab.callbacks){if(ab.callbacks[ah].failure){ab.callbacks[ah].failure(ag)}}for(var ah=0;ah<Z.xmlCache.length;++ah){if(Z.xmlCache[ah]==ab){Z.xmlCache=Z.xmlCache.slice(0,ah).concat(Z.xmlCache.slice(ah+1));break}}},ae)}else{ab.callbacks.push({success:af,failure:ac})}};T.load=function(ac,ae,ab,ad){ad=ad||false;if(T.isSameDomain(ac)){return Y(ac,ae,ab,ad)}else{return aa(ac,ae,ab)}};if(M.caps.isIE&&M.caps.browserVersion>=9){var X="<!-- IEBinaryToArray_ByteStr -->\r\n<script type='text/vbscript'>\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n           IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n           IEBinaryToArray_ByteStr_Last = \"\"\r\n   End If\r\nEnd Function\r\n<\/script>\r\n";document.write(X)}T.loadBinary=function(ac,ah){var ab=function(an){var ai={};for(var am=0;am<256;am++){for(var al=0;al<256;al++){ai[String.fromCharCode(am+al*256)]=String.fromCharCode(am)+String.fromCharCode(al)}}var aj=IEBinaryToArray_ByteStr(an);var ak=IEBinaryToArray_ByteStr_Last(an);return aj.replace(/[\s\S]/g,function(ao){return ai[ao]})+ak};var ag=function(ak){var ai="";for(var aj in ak){ai+=String.fromCharCode(ak[aj])}return ai};var ad=null;var af=function(){if(ad.readyState==4){var ai={};if(ad.status=="304"||ad.status=="200"||ad.status=="206"||ad.status=="0"){if(M.caps.isIE&&M.caps.browserVersion>=9){ai.content=ag(new VBArray(ad.responseBody).toArray())}else{if(M.caps.isIE){ai.content=ab(ad.responseBody)}else{ai.content=typeof ad.responseBody=="unknown"?ad.responseBody:ad.responseText}}ai.HTTPStatus=ad.status;ai.contentLength=ad.getResponseHeader("content-Length");ai.contentType=ad.getResponseHeader("content-Type");ai.url=ac;ai.extension=p.getExtension(ac).toLowerCase()}ad=null;ah(ai)}};if(window.XMLHttpRequest){ad=new XMLHttpRequest()}else{if(window.ActiveXObject){try{ad=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(ae){ad=null}}}if(ad){if(ah){if(typeof(ad.onload)!="undefined"){ad.onload=af}else{ad.onreadystatechange=af}}ad.open("GET",ac,true);if(ad.overrideMimeType){ad.overrideMimeType("text/plain; charset=x-user-defined")}if(M.caps.isIE){ad.setRequestHeader("Accept-Charset","x-user-defined")}ad.send(null)}else{if(ah){ah()}}};T.isSameDomain=function(ab){return/data.bordeaux-metropole.fr/.test(ab)||document.domain==p.getDomain(ab)};function Y(ac,ae,ab,ad){return M.jQuery.ajax({url:ac,cache:!ad,dataType:"text",success:function(af){ae(af)},error:function(af){if(af.status==404){af.error={error:"INVALIDURL",errorText:af.statusText}}ab(af)}})}function aa(ac,ad,ab){return M.jQuery.ajax({url:(M.proxy?M.proxy:p.getScriptLocation()+"xml.ajax.php")+"?url="+encodeURIComponent(ac),dataType:"jsonp",crossDomain:true,success:function(ae){if(typeof ae.error!="undefined"){ab(ae)}else{ad(ae)}},failure:function(ae){ab(ae)}})}function V(ac,ad,ab){}function W(ab,ac){for(var ad in ac){if(ac[ad].url==ab){return ac[ad]}}return null}})();M.geolocation=navigator.geolocation?(function(){var Y;var X=null;var Z=null;function V(aa){M.geolocation.position=new M.Position(aa.coords.longitude,aa.coords.latitude,M.projections.WGS84,M.projection());if(M.geolocation.followPosition){M.moveToPoint(M.geolocation.position)}if(!isNaN(aa.coords.heading)){M.geolocation.rotation=aa.coords.heading;if(M.geolocation.followNorth){M.rotate(M.geolocation.rotation)}}Z=new Date();Y.ready=true}function W(aa){Y.error=aa;Y.ready=false;switch(aa.code){case aa.PERMISSION_DENIED:p.errorLog("L'utilisateur n'a pas accepté la géolocalisation.",p.errorLevel.WARNING);break;case aa.POSITION_UNAVAILABLE:p.errorLog("Le système ne supporte pas la géolocalisation.",p.errorLevel.WARNING);break;case aa.TIMEOUT:p.errorLog("La demande de géolocalisation n'a pas abouti.",p.errorLevel.WARNING);break;case aa.UNKNOWN_ERROR:p.errorLog("La demande de géolocalisation s'est terminée sur une erreur inconnue.",p.errorLevel.WARNING);break}}Y={position:null,followPosition:false,rotation:null,followNorth:false,ready:false,lastMeasure:function(){if(Z){return(new Date())-Z}else{return null}},enable:function(){if(navigator.geolocation){X=navigator.geolocation.watchPosition(V,W,{enableHighAccuracy:true,maximumAge:10000})}else{p.errorLog("Le navigateur ne supporte pas la géolocalisation.",p.errorLevel.WARNING)}},disable:function(){if(X){navigator.geolocation.clearWatch(X);X=null}}};return Y})():null;var g=null;var n=false;M.events=(function(){var Y={x:0,y:0};var ac=new Array;function ad(am){Y.x=am.pageX;Y.y=am.clientY;if(typeof(M.events.onTouchStart)=="function"){M.events.fire("onTouchStart",M,[M.Position.fromPixels(am.pageX,am.clientY),am.originalEvent])}}function W(am){Y.x=am.pageX;Y.y=am.clientY;if(typeof(M.events.onTouchMove)=="function"){M.events.fire("onTouchMove",M,[M.Position.fromPixels(am.pageX,am.clientY),am.originalEvent])}}function ai(am){if(typeof(M.events.onTouchEnd)=="function"){M.events.fire("onTouchEnd",M,[M.Position.fromPixels(Y.x,Y.y),am.originalEvent])}}function ab(am){if(typeof(M.events.onGestureStart)=="function"){M.events.fire("onGestureStart",M,[am.scale,am.rotation])}}function ag(an,am){if(typeof(M.events.onGestureMove)=="function"){M.events.fire("onGestureMove",M,[an.scale,an.rotation])}}function aj(am){if(typeof(M.events.onGestureEnd)=="function"){M.events.fire("onGestureEnd",M,[am.scale,am.rotation])}}function aa(am){M.resize();M.events.fire("onOrientate",M,[am])}function X(am){if(am.object.dragging){n=true;M.events.fire("onPan",M)}else{M.events.fire("onZoom",M)}}function af(am){if(!n){M.events.fire("onGroundClick",M,[M.Position.fromPixels(am.pageX-w.offset().left,am.clientY-w.offset().top),am.originalEvent])}n=false;M.events.fire("onClick",M,[M.Position.fromPixels(am.pageX-w.offset().left,am.pageY-w.offset().top),am.originalEvent])}function V(am){M.events.fire("onDblClick",M,[M.Position.fromPixels(am.pageX-w.offset().left,am.clientY-w.offset().top),am.originalEvent])}function ah(am){M.events.fire("onMouseDown",M,[M.Position.fromPixels(am.pageX-w.offset().left,am.clientY-w.offset().top),am.originalEvent])}function Z(am){M.events.fire("onMouseMove",M,[M.Position.fromPixels(am.pageX-w.offset().left,am.clientY-w.offset().top),am.originalEvent])}function ae(am){M.events.fire("onMouseUp",M,[M.Position.fromPixels(am.pageX-w.offset().left,am.clientY-w.offset().top),am.originalEvent])}function ak(am){if(s){s.activate()}}function al(am){if(s){s.deactivate()}}g=function(){if(M.caps.canTouch){J.dragPan.handler.register("touchstart",ad);J.dragPan.handler.register("touchmove",W);J.dragPan.handler.register("touchend",ai)}if(M.caps.canGesture){window.ongesturestart=ab;window.ongesturechange=ag;window.ongestureend=aj}if(M.caps.canOrientate){window.onorientationchange=aa}D.events.register("move",null,X);M.jQuery(D.div).bind("click",af);J.handlers.click.register("dblclick",V);J.dragPan.handler.register("mousedown",ah);J.dragPan.handler.register("mousemove",Z);J.dragPan.handler.register("mouseup",ae);M.jQuery("#CUB_map_container").on("mouseout",al);M.jQuery("#CUB_map_container").on("mouseover",ak)};return{onClick:null,onDblClick:null,onGroundClick:null,onMouseDown:null,onMouseMove:null,onMouseUp:null,onTouchStart:null,onTouchMove:null,onTouchEnd:null,onGestureStart:null,onGestureMove:null,onGestureEnd:null,onPan:null,onZoom:null,onRotate:null,onOrientate:null,onResize:null,onLayersLoadStart:null,onLayersLoadEnd:null,attach:function(am,an){if(!/^on/.test(am)||typeof M.events[am]==="undefined"){p.error("L'événement "+am+" n'existe pas");return false}if(typeof ac[am]==="undefined"){ac[am]=new Array}ac[am].push(an)},detach:function(an,ao){if(!ac[an]||!ac[an].length){return}var am=M.jQuery.inArray(ao,ac[an]);if(am>-1){ac[an].splice(am,1)}},fire:function(am,ao,ap){ao=ao||this;ap=ap||[];if(typeof ac[am]!=="undefined"){for(var an=0;an<ac[am].length;++an){ac[am][an].apply(ao,ap)}}if(typeof M.events[am]==="function"){M.events[am].apply(ao,ap)}}}})();M.projections={UNKNOWN:0,WGS84:4326,GOOGLEMERCATOR:900913,RGF93CC42:3942,RGF93CC43:3943,RGF93CC44:3944,RGF93CC45:3945,RGF93CC46:3946,RGF93CC47:3947,RGF93CC48:3948,RGF93CC49:3949,RGF93CC50:3950,RGF93:4171,RGF93LAMBERT93:2154,LAMBERT3SUD:27563,LAMBERT2ETENDU:27572};M.Class={};M.Class=function(X,V,Y,W){if(!X||!X.secret||X.secret!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}X.v.isDestroyed=false;this.type=V||"CUB.Class";this.namespace=M.Class;this.isSingleton=Y||false;this.isAbstract=W||false;this.isDestroyed=function(){return X.v.isDestroyed};this.destroy=function(){X.v.isDestroyed=true};this.internal=function(){if(arguments[0]!=k){p.errorLog("Cette fonction ne doit pas être utilisée",p.errorLevel.WARNING);return null}if(typeof(X.f[arguments[1]])=="function"){return X.f[arguments[1]].apply(this,Array().slice.call(arguments,2))}else{p.errorLog("Méthode interne inexistante",p.errorLevel.WARNING)}};this.toString=function(){return this.type+(X.v.isDestroyed?" [Objet supprimé]":"")};return this};M.Color=function(W){if(!p.isScopeValid(this)){return null}var aa=p.createShared();var Z=new M.Class(aa,"CUB.Color",false,false);Z.namespace=M.Color;if(!p.assert(W)||!(Z.color=M.Color.isValid(W))){var Y=0,V=parseInt(Math.random()*M.Color.colors.length);for(var X in M.Color.colors){if(Y++==V){break}}Z.color=M.Color.colors[X]}else{Z.color=W.toUpperCase()}Z.toRGB=function(){var ab=Z.color.substring(1,7);return{r:parseInt(ab.substring(0,2),16),g:parseInt(ab.substring(2,4),16),b:parseInt(ab.substring(4,6),16)}};Z.toString=function(){return Z.color};return Z};M.Color.fromRGB=function(Y,X,V){p.assert([Y,X,V],null,"Valeurs incorrectes");Y=Math.min(255,Math.max(0,Y));X=Math.min(255,Math.max(0,X));V=Math.min(255,Math.max(0,V));var W="0123456789ABCDEF";return new M.Color("#"+W.charAt(Math.floor(Y/16))+W.charAt(Y%16)+W.charAt(Math.floor(X/16))+W.charAt(X%16)+W.charAt(Math.floor(V/16))+W.charAt(V%16))};M.Color.isValid=function(V){if(typeof V!="string"){return false}V=V.toUpperCase();if(/^\s*#([0-9a-f]{1,2}){3,3}\s*$/i.test(V)){if(V.length==4){return"#"+V.substring(1,2)+V.substring(1,2)+V.substring(2,3)+V.substring(2,3)+V.substring(3,4)+V.substring(3,4)}else{return V}}else{if(V!="length"&&M.Color.colors[V]){return M.Color.colors[V]}else{return null}}};M.Color.colors={ALICEBLUE:"#F0F8FF",ANTIQUEWHITE:"#FAEBD7",AQUA:"#00FFFF",AQUAMARINE:"#7FFFD4",AZURE:"#F0FFFF",BEIGE:"#F5F5DC",BISQUE:"#FFE4C4",BLACK:"#000000",BLANCHEDALMOND:"#FFEBCD",BLUE:"#0000FF",BLUEVIOLET:"#8A2BE2",BROWN:"#A52A2A",BURLYWOOD:"#DEB887",CADETBLUE:"#5F9EA0",CHARTREUSE:"#7FFF00",CHOCOLATE:"#D2691E",CORAL:"#FF7F50",CORNFLOWERBLUE:"#6495ED",CORNSILK:"#FFF8DC",CRIMSON:"#DC143C",CYAN:"#00FFFF",DARKBLUE:"#00008B",DARKCYAN:"#008B8B",DARKGOLDENROD:"#B8860B",DARKGRAY:"#A9A9A9",DARKGREY:"#A9A9A9",DARKGREEN:"#006400",DARKKHAKI:"#BDB76B",DARKMAGENTA:"#8B008B",DARKOLIVEGREEN:"#556B2F",DARKORANGE:"#FF8C00",DARKORCHID:"#9932CC",DARKRED:"#8B0000",DARKSALMON:"#E9967A",DARKSEAGREEN:"#8FBC8F",DARKSLATEBLUE:"#483D8B",DARKSLATEGRAY:"#2F4F4F",DARKSLATEGREY:"#2F4F4F",DARKTURQUOISE:"#00CED1",DARKVIOLET:"#9400D3",DEEPPINK:"#FF1493",DEEPSKYBLUE:"#00BFFF",DIMGRAY:"#696969",DIMGREY:"#696969",DODGERBLUE:"#1E90FF",FIREBRICK:"#B22222",FLORALWHITE:"#FFFAF0",FORESTGREEN:"#228B22",FUCHSIA:"#FF00FF",GAINSBORO:"#DCDCDC",GHOSTWHITE:"#F8F8FF",GOLD:"#FFD700",GOLDENROD:"#DAA520",GRAY:"#808080",GREY:"#808080",GREEN:"#008000",GREENYELLOW:"#ADFF2F",HONEYDEW:"#F0FFF0",HOTPINK:"#FF69B4",INDIANRED:"#CD5C5C",INDIGO:"#4B0082",IVORY:"#FFFFF0",KHAKI:"#F0E68C",LAVENDER:"#E6E6FA",LAVENDERBLUSH:"#FFF0F5",LAWNGREEN:"#7CFC00",LEMONCHIFFON:"#FFFACD",LIGHTBLUE:"#ADD8E6",LIGHTCORAL:"#F08080",LIGHTCYAN:"#E0FFFF",LIGHTGOLDENRODYELLOW:"#FAFAD2",LIGHTGRAY:"#D3D3D3",LIGHTGREY:"#D3D3D3",LIGHTGREEN:"#90EE90",LIGHTPINK:"#FFB6C1",LIGHTSALMON:"#FFA07A",LIGHTSEAGREEN:"#20B2AA",LIGHTSKYBLUE:"#87CEFA",LIGHTSLATEGRAY:"#778899",LIGHTSLATEGREY:"#778899",LIGHTSTEELBLUE:"#B0C4DE",LIGHTYELLOW:"#FFFFE0",LIME:"#00FF00",LIMEGREEN:"#32CD32",LINEN:"#FAF0E6",MAGENTA:"#FF00FF",MAROON:"#800000",MEDIUMAQUAMARINE:"#66CDAA",MEDIUMBLUE:"#0000CD",MEDIUMORCHID:"#BA55D3",MEDIUMPURPLE:"#9370D8",MEDIUMSEAGREEN:"#3CB371",MEDIUMSLATEBLUE:"#7B68EE",MEDIUMSPRINGGREEN:"#00FA9A",MEDIUMTURQUOISE:"#48D1CC",MEDIUMVIOLETRED:"#C71585",MIDNIGHTBLUE:"#191970",MINTCREAM:"#F5FFFA",MISTYROSE:"#FFE4E1",MOCCASIN:"#FFE4B5",NAVAJOWHITE:"#FFDEAD",NAVY:"#000080",OLDLACE:"#FDF5E6",OLIVE:"#808000",OLIVEDRAB:"#6B8E23",ORANGE:"#FFA500",ORANGERED:"#FF4500",ORCHID:"#DA70D6",PALEGOLDENROD:"#EEE8AA",PALEGREEN:"#98FB98",PALETURQUOISE:"#AFEEEE",PALEVIOLETRED:"#D87093",PAPAYAWHIP:"#FFEFD5",PEACHPUFF:"#FFDAB9",PERU:"#CD853F",PINK:"#FFC0CB",PLUM:"#DDA0DD",POWDERBLUE:"#B0E0E6",PURPLE:"#800080",RED:"#FF0000",ROSYBROWN:"#BC8F8F",ROYALBLUE:"#4169E1",SADDLEBROWN:"#8B4513",SALMON:"#FA8072",SANDYBROWN:"#F4A460",SEAGREEN:"#2E8B57",SEASHELL:"#FFF5EE",SIENNA:"#A0522D",SILVER:"#C0C0C0",SKYBLUE:"#87CEEB",SLATEBLUE:"#6A5ACD",SLATEGRAY:"#708090",SLATEGREY:"#708090",SNOW:"#FFFAFA",SPRINGGREEN:"#00FF7F",STEELBLUE:"#4682B4",TAN:"#D2B48C",TEAL:"#008080",THISTLE:"#D8BFD8",TOMATO:"#FF6347",TURQUOISE:"#40E0D0",VIOLET:"#EE82EE",WHEAT:"#F5DEB3",WHITE:"#FFFFFF",WHITESMOKE:"#F5F5F5",YELLOW:"#FFFF00",YELLOWGREEN:"#9ACD32",length:147};M.Style={};M.Style=function(V){if(!p.isScopeValid(this)){return null}var W={};var X=p.createShared();W=M.jQuery.extend(this,new M.Class(X,"CUB.Style",false,false));W.namespace=M.Style;V=V||{};W.color=p.assert(V.color,M.Color)?V.color:(M.Color.isValid(V.color)?new M.Color(V.color):new M.Color());W.outlineColor=p.assert(V.outlineColor,M.Color)?V.outlineColor:(M.Color.isValid(V.color)?new M.Color(V.color):W.color);W.outlineWidth=V.outlineWidth||2;W.underOutlineOpacity=typeof V.outlineOpacity!="undefined"?V.outlineOpacity:100;W.underOutlineColor=p.assert(V.underOutlineColor,M.Color)?V.underOutlineColor:(M.Color.isValid(V.color)?new M.Color(V.color):W.color);W.underOutlineWidth=V.underOutlineWidth||0;W.outlineOpacity=typeof V.outlineOpacity!="undefined"?V.outlineOpacity:100;W.symbol=V.symbol||null;W.symbolRotation=!isNaN(parseInt(V.symbolRotation))?V.symbolRotation:(typeof V.symbolRotation==="string"?V.symbolRotation:null);W.symbolRotationIsGeo=typeof V.symbolRotationIsGeo==="boolean"?V.symbolRotationIsGeo:false;W.symbolGroup=V.symbolGroup||W.symbol;W.symbolWidth=V.symbolWidth?V.symbolWidth:null;W.symbolHeight=V.symbolHeight?V.symbolHeight:null;W.offsetX=V.offsetX?V.offsetX:null;W.offsetY=V.offsetY?V.offsetY:null;W.opacity=typeof V.opacity!="undefined"?V.opacity:40;W.size=V.size||5;W.pattern=V.pattern||"solid";W.label=typeof V.label!="undefined"?V.label:null;W.labelMinScaledenom=typeof V.labelMinScaledenom==="number"&&V.labelMinScaledenom>0?V.labelMinScaledenom:1;W.labelMaxScaledenom=typeof V.labelMaxScaledenom==="number"?V.labelMaxScaledenom:9999999999999;W.labelXOffset=typeof V.labelXOffset==="number"?V.labelXOffset:null;W.labelYOffset=typeof V.labelYOffset==="number"?V.labelYOffset:null;W.labelOutlineColor=p.assert(V.labelOutlineColor,M.Color)?V.labelOutlineColor:(M.Color.isValid(V.labelOutlineColor)?new M.Color(V.labelOutlineColor):new M.Color(M.Color.colors.WHITE));W.labelOutlineWidth=typeof V.labelOutlineWidth==="number"||typeof V.labelOutlineWidth==="string"?V.labelOutlineWidth:null;W.labelRotation=typeof V.labelRotation==="number"||typeof V.labelRotation==="string"?V.labelRotation:null;W.labelRotationIsGeo=typeof V.labelRotationIsGeo==="boolean"?V.labelRotationIsGeo:false;W.labelColor=p.assert(V.labelColor,M.Color)?V.labelColor:(M.Color.isValid(V.labelColor)?new M.Color(V.labelColor):new M.Color(M.Color.colors.BLACK));W.labelSize=typeof V.labelSize==="number"?V.labelSize:10;W.labelBold=typeof V.labelBold==="boolean"?V.labelBold:false;W.validate=function(){W.opacity=Math.min(100,Math.max(0,W.opacity));W.outlineOpacity=Math.min(100,Math.max(0,W.outlineOpacity));if(!p.assert(W.outlineColor,M.Color)){W.outlineColor=new M.Color()}if(!p.assert(W.color,M.Color)){W.color=new M.Color()}return this};W.clone=function(Y){if(Y){return M.jQuery.extend({},W,Y)}else{return new M.Style(W)}};X.f.toOLStyle=function(){var Y={fillColor:W.color.color,fillOpacity:W.opacity/100,pointRadius:W.size,strokeColor:W.outlineColor.color,strokeWidth:W.outlineWidth,strokeOpacity:W.outlineOpacity/100,underStrokeColor:W.underOutlineColor.color,underStrokeWidth:W.underOutlineWidth,underStrokeOpacity:W.underOutlineOpacity/100,strokeDashstyle:W.pattern,externalGraphic:W.symbol,rotation:W.symbolRotation,symbolRotationIsGeo:W.symbolRotationIsGeo,externalGraphicGroup:W.symbolGroup,label:W.label,labelMinScaledenom:W.labelMinScaledenom,labelMaxScaledenom:W.labelMaxScaledenom,labelXOffset:W.labelXOffset,labelYOffset:W.labelYOffset,labelOutlineColor:W.labelOutlineColor.color,labelOutlineWidth:W.labelOutlineWidth,labelRotation:W.labelRotation,labelRotationIsGeo:W.labelRotationIsGeo,fontColor:W.labelColor?W.labelColor.color:null,fontSize:W.labelSize,fontWeight:W.labelBold?"bold":"normal"};if(W.offsetX||W.offsetY){Y.graphicXOffset=W.offsetX;Y.graphicYOffset=W.offsetY}if(W.symbolWidth||W.symbolHeight){Y.graphicWidth=W.symbolWidth;Y.graphicHeight=W.symbolHeight}return new B.Style(Y)};X.f.fromOLStyle=function(Y){W.color=new M.Color(Y.fillColor);W.opacity=Y.fillOpacity*100;W.size=Y.pointRadius;W.outlineColor=new M.Color(Y.strokeColor);W.outlineWidth=M.caps.isIE?Y.strokeWidth-1:Y.strokeWidth;W.outlineOpacity=Y.strokeOpacity*100;W.underOutlineColor=new M.Color(Y.underStrokeColor);W.underOutlineWidth=M.caps.isIE?Y.underStrokeWidth-1:Y.underStrokeWidth;W.underOutlineOpacity=Y.underStrokeOpacity*100;W.pattern=Y.strokeDashstyle;W.symbol=Y.externalGraphic;W.symbolRotation=Y.rotation;W.symbolRotationIsGeo=Y.symbolRotationIsGeo;W.symbolGroup=Y.externalGraphicGroup;W.offsetX=Y.graphicXOffset;W.offsetY=Y.graphicYOffset;W.label=Y.label;W.labelMinScaledenom=Y.labelMinScaledenom;W.labelMaxScaledenom=Y.labelMaxScaledenom;W.labelXOffset=Y.labelXOffset;W.labelYOffset=Y.labelYOffset;W.labelOutlineColor=new M.Color(Y.labelOutlineColor);W.labelOutlineWidth=Y.labelOutlineWidth;W.labelRotation=Y.labelRotation;W.labelRotationIsGeo=Y.labelRotationIsGeo;W.labelColor=new M.Color(Y.fontColor);W.labelSize=Y.fontSize;W.labelBold=Y.fontWeight==="bold"?true:false;return W}};M.Style.patternType={SOLID:"solid",SHORTDASH:"shortdash",SHORTDOT:"shortdot",SHORTDASHDOT:"shortdashdot",SHORTDASHDOTDOT:"shortdashdotdot",DOT:"dot",DASH:"dash",LONGDASH:"longdash",DASHDOT:"dashdot",LONGDASHDOT:"longdashdot",LONGDASHDOTDOT:"longdashdotdot"};M.Position=function(V,ab,W,aa){if(!p.isScopeValid(this)){return null}var Z=p.createShared();var X=M.jQuery.extend(this,new M.Class(Z,"CUB.Position",false,false));X.namespace=M.Position;var Y=W||M.projection();p.assert([V,ab],null,"CUB.Position : valeurs incorrectes");X.x=V;X.y=ab;Z.f.toOLLonLat=function(){var ac=X.clone();ac.projection(M.realProjection());return new B.LonLat(ac.x,ac.y)};Z.f.toOLPoint=function(){var ac=X.clone();ac.projection(M.realProjection());return new B.Geometry.Point(ac.x,ac.y)};X.translateByPixels=function(ac,af){p.assert([ac,af],null,"Valeurs incorrectes");var ad=D.getPixelFromLonLat(Z.f.toOLLonLat());ad.x+=ac;ad.y+=af;var ae=p.lonLatToPosition(D.getLonLatFromPixel(ad));X.x=ae.x;X.y=ae.y;return this};X.clone=function(){return new M.Position(X.x,X.y,Y,Y)};X.projection=function(ac){if(ac&&ac!=Y){if(!p.checkEnum(ac,M.projections)&&projection!=M.projections.UNKNOWN){p.errorLog("Projection incorrecte",p.errorLevel.WARNING);return null}var ad=p.reproject([{x:X.x,y:X.y}],Y,ac);X.x=ad[0].x;X.y=ad[0].y;Y=ac}return Y};X.toPixel=function(){var ad=X.clone();ad.projection(M.realProjection());var ac=D.getPixelFromLonLat(ad.internal(k,"toOLLonLat"));return p.mapPixelToViewportPixel(ac.x,ac.y)};X.distanceTo=function(ad,ac){ac=ac&&!M.jQuery.inArray(ac,[M.projections.RGF93,M.projections.WGS84])?ac:M.projections.RGF93LAMBERT93;var af=X.clone();var ae=ad.clone();af.projection(ac);ae.projection(ac);return p.precision(Math.sqrt((ae.x-af.x)*(ae.x-af.x)+(ae.y-af.y)*(ae.y-af.y)),2)};X.toString=function(){if(X.projection()!=M.projections.WGS84&&X.projection()!=M.projections.RGF93){return"{x: "+(Math.round(X.x*100)/100)+", y:"+(Math.round(X.y*100)/100)+"}"}else{return"{x: "+(Math.round(X.x*10000)/10000)+", y:"+(Math.round(X.y*10000)/10000)+"}"}};if(W){X.projection(aa||M.projection())}return X};M.Position.fromPixels=function(V,Z,Y){p.assert([V,Z],null,"Paramètres manquants");var X=p.viewportPixelToMapPixel(V,Z);var W=D.getLonLatFromPixel(new B.Pixel(X.x,X.y));return new M.Position(W.lon,W.lat,M.realProjection(),Y||M.projection())};M.Geometry={};M.Geometry=function(X,V){if(!p.isScopeValid(this)){return null}if(!X||!X.secret||X.secret!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var W=[];W=M.jQuery.extend(this,new M.Class(X,V||"CUB.Geometry",false,true));W.namespace=M.Geometry;W.getExtent=function(){if(!X.f.toOLGeometry().getBounds()){return null}return p.boundsToExtent(X.f.toOLGeometry().getBounds(),M.projection(),M.projection())};W.getVertices=function(){return X.v._geometry};W.getBarycenter=function(){return p.OLPointToPosition(X.f.toOLGeometry().getCentroid(),M.projection(),M.projection())};W.getLength=function(Y){};W.getArea=function(){};W.getPositionFromDistance=function(Y){};W.count=function(){return X.v._geometry.length};W.addVertices=function(Y){if(Y&&!M.jQuery.isArray(Y)){Y=[Y]}p.assert(Y,M.Position,"Les points de la géométrie sont invalides");if(W.namespace==M.Geometry.Point){p.errorLog("Impossible d'ajouter des points à un une géométrie de type CUB.Geometry.Point",p.errorLevel.WARNING)}X.v._geometry=X.v._geometry.concat(Y);return this};W.removeVertices=function(Z,Y){return X.v._geometry.splice(Z,Y)};W.push=function(Y){p.assert(Y,M.Position,"Point invalide");if(W.namespace==M.Geometry.Point){p.errorLog("Impossible d'ajouter des points à un une géométrie de type CUB.Geometry.Point",p.errorLevel.WARNING)}X.v._geometry.push(Y);return this};W.pop=function(){X.v._geometry.pop();return this};W.shift=function(){X.v._geometry.shift();return this};W.unshift=function(Y){p.assert(Y,M.Position,"Point invalide");if(W.namespace==M.Geometry.Point){p.errorLog("Impossible d'ajouter des points à un une géométrie de type CUB.Geometry.Point",p.errorLevel.WARNING)}X.v._geometry.unshift(Y);return this};W.toString=function(){var Z=[];for(var Y in X.v._geometry){Z.push(X.v._geometry[Y].toString())}return"("+Z.join(" ")+")"};return W};M.Geometry.isValidGeometry=function(W){if(M.jQuery.isArray(W)){for(var V in W){if(M.jQuery.isArray(W[V])){if(!p.assert(W[V],M.Position)){return false}}}return true}else{return p.assert(W,M.Position)}};M.Geometry.Point=function(Y){if(!p.isScopeValid(this)){return null}if(!M.Geometry.isValidGeometry(Y)){p.errorLog("Les points de la géométrie sont invalides",p.errorLevel.WARNING);return null}var V={};var X=p.createShared();var W=new M.Geometry(X,"CUB.Geometry.Point",false,false);V=M.jQuery.extend(this,W);V.namespace=M.Geometry.Point;X.v._geometry=Y||[];V.namespace=M.Geometry.Point;V.toPosition=function(){return new M.Position(X.v._geometry.x,X.v._geometry.y)};V.toString=function(){return"POINT "+X.v._geometry.toString()};X.f.toOLGeometry=function(Z){if(Z&&M.projection()!=Z){return new B.Geometry.Point(X.v._geometry.x,X.v._geometry.y).transform(p.CUBProjToOLProj(M.projection()),p.CUBProjToOLProj(Z))}else{return new B.Geometry.Point(X.v._geometry.x,X.v._geometry.y)}};return V};M.Geometry.Line=function(Y){if(!p.isScopeValid(this)){return null}if(!M.Geometry.isValidGeometry(Y)){p.errorLog("Les points de la géométrie sont invalides",p.errorLevel.WARNING);return null}var V={};var X=p.createShared();var W=new M.Geometry(X,"CUB.Geometry.Line",false,false);V=M.jQuery.extend(this,W);X.v._geometry=Y||[];V.namespace=M.Geometry.Line;V.toString=function(){return"LINE "+W.toString.apply(this)};V.getBarycenter=function(){var Z=y=0;var ab=X.v._geometry;for(var aa in ab){Z+=ab[aa].x;y+=ab[aa].y}return new M.Position(Z/ab.length,y/ab.length)};V.getLength=function(Z){Z=Z&&!M.jQuery.inArray(Z,[M.projections.RGF93,M.projections.WGS84])?Z:M.projections.RGF93LAMBERT93;return p.precision(X.f.toOLGeometry(Z).getLength(),2)};V.getPositionFromDistance=function(af){var Z=V.getVertices();var ac=0;var ad;for(var aa=1;aa<Z.length;++aa){ad=Z[aa-1].distanceTo(Z[aa]);if(ac+ad>af){af-=ac;var ab=af/ad;var ae=new M.Position(Z[aa-1].x+(Z[aa].x-Z[aa-1].x)*ab,Z[aa-1].y+(Z[aa].y-Z[aa-1].y)*ab);ae.projection(M.projection());return ae}ac+=ad}return null};X.f.toOLGeometry=function(ab){var aa=[];for(var Z in X.v._geometry){aa.push(new B.Geometry.Point(X.v._geometry[Z].x,X.v._geometry[Z].y))}if(ab&&M.projection()!=ab){return new B.Geometry.LineString(aa).transform(p.CUBProjToOLProj(M.projection()),p.CUBProjToOLProj(ab))}else{return new B.Geometry.LineString(aa)}};return V};M.Geometry.Polygon=function(Y){if(!p.isScopeValid(this)){return null}if(!M.Geometry.isValidGeometry(Y)){p.errorLog("Les points de la géométrie sont invalides",p.errorLevel.WARNING);return null}var V={};var X=p.createShared();var W=new M.Geometry(X,"CUB.Geometry.Polygon",false,false);V=M.jQuery.extend(this,W);V.namespace=M.Geometry.Polygon;X.v._geometry=Y||[];V.getArea=function(Z){Z=Z&&!M.jQuery.inArray(Z,[M.projections.RGF93,M.projections.WGS84])?Z:M.projections.RGF93LAMBERT93;return p.precision(X.f.toOLGeometry(Z).getArea(),2)};V.getLength=function(Z){Z=Z&&!M.jQuery.inArray(Z,[M.projections.RGF93,M.projections.WGS84])?Z:M.projections.RGF93LAMBERT93;return p.precision(X.f.toOLGeometry(Z).getLength(),2)};V.toString=function(){return"POLYGON "+W.toString.apply(this)};X.f.toOLGeometry=function(ab){var aa=[];for(var Z in X.v._geometry){aa.push(new B.Geometry.Point(X.v._geometry[Z].x,X.v._geometry[Z].y))}if(ab&&M.projection()!=ab){return new B.Geometry.Polygon(new B.Geometry.LinearRing(aa)).transform(p.CUBProjToOLProj(M.projection()),p.CUBProjToOLProj(ab))}else{return new B.Geometry.Polygon(new B.Geometry.LinearRing(aa))}};return V};M.Extent=function(V,ad,Z,W,Y,ac){if(!p.isScopeValid(this)){return null}var X=p.createShared();var ab=new M.Class(X,"CUB.Extent",false,false);ab.namespace=M.Extent;var aa=Y||M.projection();p.assert([V,ad,Z,W],null,"Valeurs d'étendue incorrectes");ab.xmin=Math.min(V,Z);ab.ymin=Math.min(ad,W);ab.xmax=Math.max(V,Z);ab.ymax=Math.max(ad,W);X.f.toOLBounds=function(){var ae=ab.clone();ae.projection(M.realProjection());return new B.Bounds(ae.xmin,ae.ymin,ae.xmax,ae.ymax)};ab.clone=function(){return new M.Extent(ab.xmin,ab.ymin,ab.xmax,ab.ymax,aa,aa)};ab.add=function(ae){if(!p.assert(ae,M.Extent)){p.errorLog("Étendue invalide",p.errorLevel.WARNING);return}ab.xmin=Math.min(ab.xmin,ae.xmin);ab.ymin=Math.min(ab.ymin,ae.ymin);ab.xmax=Math.max(ab.xmax,ae.xmax);ab.ymax=Math.max(ab.ymax,ae.ymax);return ab};ab.toPolygon=function(){return new M.Geometry.Polygon([new M.Position(ab.xmin,ab.ymin),new M.Position(ab.xmin,ab.ymax),new M.Position(ab.xmax,ab.ymax),new M.Position(ab.xmax,ab.ymin)])};ab.projection=function(ae){if(ae&&ae!=aa){if(!p.checkEnum(ae,M.projections)){p.errorLog("La projection demandée n'est pas supportée",p.errorLevel.WARNING);return}var af=p.reproject([{x:ab.xmin,y:ab.ymin},{x:ab.xmax,y:ab.ymax}],aa,ae);ab.xmin=af[0].x;ab.ymin=af[0].y;ab.xmax=af[1].x;ab.ymax=af[1].y;aa=ae}return aa};ab.containsPoint=function(ae){p.assert(ae,M.Position);return ae.x>=ab.xmin&&ae.x<=ab.xmax&&ae.y>=ab.ymin&&ae.y<=ab.ymax};ab.centerPoint=function(){return new M.Position(ab.xmin+(ab.xmax-ab.xmin)/2,ab.ymin+(ab.ymax-ab.ymin)/2)};ab.width=function(){return ab.xmax-ab.xmin};ab.height=function(){return ab.ymax-ab.ymin};ab.toString=function(){return(Math.round(ab.xmin*100)/100)+", "+(Math.round(ab.ymin*100)/100)+", "+(Math.round(ab.xmax*100)/100)+", "+(Math.round(ab.ymax*100)/100)+" - EPSG:"+aa};if(Y){ab.projection(ac||M.projection())}return ab};M.Extent.fromScale=function(V,ac){p.assert(V,M.Position);p.assert(ac);var Z=B.Util.getResolutionFromScale(ac,D.units);var Y=D.getSize();var ab=Y.w*Z;var X=Y.h*Z;var W=V.clone();W.projection(M.realProjection());var aa=new M.Extent(W.x-ab/2,W.y-X/2,W.x+ab/2,W.y+X/2,M.realProjection());return aa};var A;(function(){A=function(V){var W=this;W.xml=V;V=M.jQuery(V);if(V.find("ServiceExceptionReport").length){W.errorCode=V.find("ServiceExceptionReport > ServiceException").attr("code");W.errorText=V.find("ServiceExceptionReport > ServiceException").text()}else{if(V.findNS("ExceptionReport","ows").length){W.errorCode=V.findNS("ExceptionReport > Exception","ows").attr("exceptionCode");W.errorText=V.findNS("ExceptionReport ExceptionText","ows").text()}else{W.errorCode=null;W.errorText=null}}return W};A.getFormat=function(W){var V={mimeType:W.find("> MimeType").text(),encoding:W.find("> Encoding").text(),schema:W.find("> Schema").text(),title:""};if(match=V.schema.match(/gml\/(\d+(?:\.\d+)+)\//)){V.title="CUB.Entity (GML "+match[1]+")"}return V}})();M.OGCWS={};M.OGCWS=function(X,V){if(!X||!X.secret||X.secret!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var W=new M.Class(X,"CUB.OGCWS",false,false);W.namespace=M.OGCWS;W.url=V;W.version="";W.service="";W.toString=function(){return W.type+" - "+W.service+" "+W.version};return W};(function(){var W=[];M.OGCWS.WPSServer=function(){if(arguments[0]!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var ab=p.createShared();var aa=new M.OGCWS(ab,arguments[1]);aa.type="CUB.OGCWS.WPSServer";var Z=new B.Format.WPSCapabilities();var Y=Z.read(arguments[2]);aa.version=Y.version;aa.service="WPS";aa.serviceProvider=Y.serviceProvider;aa.processes=[];for(var X in Y.processOfferings){aa.processes.push(new M.OGCWS.WPSProcess(k,Y.processOfferings[X]))}return aa};M.OGCWS.WPSServer.create=function(Y,aa){p.assert([Y,aa],null,"Paramètres incorrects");var X=V(Y);if(X){aa(X);return}var Z=p.addParametersToUrl(Y,"&request=GetCapabilities&service=WPS&version=1.0.0");T.loadXML(Z,function(ab){var ad=new A(ab);if(!ad.errorCode){var ac=new M.OGCWS.WPSServer(k,Y,ab);W.push(ac)}if(typeof(aa)=="function"){aa(ac?ac:null,ad)}},function(ab){p.errorLog("Serveur WPS : URL invalide",p.errorLevel.WARNING);if(typeof(aa)=="function"){aa(null,ab.errorText)}})};function V(X){X=X.toLowerCase();for(var Y=0;Y<W.length;++Y){if(W[Y].url.toLowerCase()==X){return W[Y]}}return null}})();(function(){M.OGCWS.WPSProcess=function(){if(arguments[0]!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var X=p.createShared();var W=M.jQuery.extend(this,new M.Class(X,"CUB.OGCWS.WPSProcess",false,true));var V=arguments[1];W.identifier=V.identifier;W.title=V.title;W.abstractText=V.abstractText;W.version=V.processVersion;W.toString=function(){return this.identifier+" - "+W.type};W.toProcessLayer=function(){};return W}})();M.Layer={};M.Layer=function(Y,V){if(!Y||!Y.secret||Y.secret!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var W={};var X=new M.Class(Y,"CUB.Layer",false,true);W=M.jQuery.extend(this,X);W.namespace=M.Layer;Y.v._minScale=-1;Y.v._maxScale=-1;W.name=V||"";W.state=M.Layer.layerState.INITIALIZING;W.error=M.Layer.layerError.NONE;W.errorText="";W.onLoadStart=Y.v.options.onLoadStart||null;W.onLoadEnd=Y.v.options.onLoadEnd||null;W.onDestroy=Y.v.options.onDestroy||null;W.projections=null;Y.f.getLayer=function(){return Y.v._olLayer};W.minScaledenom=function(Z){if(p.assert(Z)){if(Z<0){Y.v._olLayer.minResolution=null;Y.v._minScale=-1;if(Y.v._maxScale==-1){Y.v._olLayer.alwaysInRange=true}}else{if(Y.v._maxScale>-1&&Z>Y.v._maxScale){Y.v._minScale=Y.v._maxScale}else{Y.v._minScale=Math.max(0,Z)}Y.v._olLayer.alwaysInRange=false;Y.v._olLayer.minResolution=B.Util.getResolutionFromScale(Z,"Meter")}W.redraw()}return Y.v._minScale};W.maxScaledenom=function(Z){if(p.assert(Z)){if(Z<0){Y.v._olLayer.maxResolution=null;Y.v._maxScale=-1;if(Y.v._minScale==-1){Y.v._olLayer.alwaysInRange=true}}else{if(Y.v._minScale>-1&&Z<Y.v._minScale){Y.v._maxScale=Y.v._minScale}else{Y.v._maxScale=Math.max(0,Z)}Y.v._olLayer.alwaysInRange=false;Y.v._olLayer.maxResolution=B.Util.getResolutionFromScale(Z,"Meter")}W.redraw()}return Y.v._maxScale};W.redraw=function(Z){var aa=Y.v._olLayer.calculateInRange();if(Y.v._olLayer.inRange!=aa){Y.v._olLayer.inRange=aa;if(!aa){Y.v._olLayer.display(false)}}if(aa&&Y.v._olLayer.visibility){Y.v._olLayer.redraw(Z)}};W.enable=function(){Y.v._olLayer.setVisibility(true)};W.disable=function(){Y.v._olLayer.setVisibility(false)};W.isEnabled=function(){return Y.v._olLayer.getVisibility()};W.toggle=function(){Y.v._olLayer.setVisibility(!Y.v._olLayer.getVisibility())};W.destroy=function(){if(typeof(this.onDestroy)=="function"){this.onDestroy()}if(this.namespace.layers){p.removeElementFromArray(this.namespace.layers,this)}M.layersManager.internal(k,"removeLayer",this);if(Y.v._olLayer){Y.v._olLayer.destroy()}delete Y.v._olLayer;for(var Z in this){delete this[Z]}if(Y.v.refreshIntervalObject){clearInterval(Y.v.refreshIntervalObject)}X.destroy.apply(this)};W.zOrder=function(Z){var ad=M.layersManager.getLayerLevel(this);var ac=M.layersManager.internal(k,"getBaseIndex",this);var ab=Y.v._olLayer.getZIndex()-ac;if(!p.assert(Z,"number")){return ab}Z=Math.min(ad.length-1,Math.max(0,Z));if(ab==Z){return ab}if(!ad[Z]){ad[Z]=this;ad[ab]=null}else{ad[ab]=null;if(ab>Z){for(var aa=ab-1;aa>=Z;aa--){ad[aa].zOrder(aa+1)}}else{for(var aa=ab+1;aa<=Z;aa++){ad[aa].zOrder(aa-1)}}ad[Z]=this;if(this.namespace==M.Layer.Dynamic&&this.selectable){M.layersManager.internal(k,"reorderLayers")}}Y.v._olLayer.setZIndex(ac+Z);return Z};W.bringToFront=function(){this.zOrder(this.namespace.layers.length-1)};W.bringToBack=function(){this.zOrder(0)};W.isProjSupported=function(Z){return true};W.setRefreshInterval=function(Z){if(!p.assert(Z,"number")){Z=0}W.refreshInterval=Z;if(Y.v.refreshIntervalObject){window.clearInterval(Y.v.refreshIntervalObject)}if(Z>0){Y.v.refreshIntervalObject=window.setInterval(function(){if(typeof Y.f.getLayer().refresh==="function"){Y.f.getLayer().refresh({force:true})}else{W.redraw(true)}},Z)}};W.getRefreshInterval=function(){return W.refreshInterval};W.toString=function(){return W.name};if(Y.v.options.refreshInterval){W.setRefreshInterval(Y.v.options.refreshInterval)}return W};M.Layer.layerState={INITIALIZING:1,UNCOMPRESSING:2,LOADING:3,READY:4,ERROR:-1};M.Layer.layerError={NONE:0,INVALIDURL:1,UNSUPPORTEDPROJ:2,NOPROJ:3,WFSEXCEPTION:4,WPSEXCEPTION:5,INVALIDDATA:6,UNKNOWN:99};M.Layer.getLayerByName=function(V,W){if(!W||!W.layers||!W.layers.length){return null}return p.findByAttribute(W.layers,"name",V)};M.Layer.Static=function(W,X,ag){var Z=p.createShared();Z.v._olLayer=null;p.assert(ag,null,"Nom serveur de la couche ou options de création attendues");Z.v.options=ag=ag||{};if(typeof(ag)=="string"||M.jQuery.isArray(ag)){ag={layerName:ag}}if(!ag.layerName){p.errorLog("Nom serveur de la couche non renseigné",p.errorLevel.WARNING);return null}var Y=new M.Layer(Z,W);var ad=M.jQuery.extend(this,Y);var ac;ad.layerName=ag.layerName;ad.type="CUB.Layer.Static";ad.isAbstract=false;ad.namespace=M.Layer.Static;ad.url=X||"";ad.format=ag.format||"image/png";ad.transparent=true;if(ag.transparent===false){ad.transparent=false}ad.destroy=function(){Y.destroy.apply(this)};if(W!=""&&M.Layer.Static.getLayerByName(W)){p.errorLog('Une couche statique "'+ad.name+'" existe déjà',p.errorLevel.WARNING);return null}T.loadXML(p.addParametersToUrl(X,"&request=GetCapabilities&service=wms&version=1.0.0"),ae,function(ah){ad.state=M.Layer.layerState.ERROR;if(ah.error&&ah.error.error&&ah.error.error=="INVALIDURL"){ad.error=M.Layer.layerError.INVALIDURL;ad.errorText=ah.error.errorText}else{ad.error=M.Layer.layerError.UNKNOWN;ad.errorText=""}});Z.v._olLayer=new B.Layer.WMS(ad.name,ad.url,{layers:M.jQuery.isArray(ad.layerName)?ad.layerName.join(","):ad.layerName,format:ad.format,transparent:ad.transparent},{isActive:true,singleTile:true,isBaseLayer:false,ratio:1,transitionEffect:"resize"});Z.v._olLayer.CUB=ad;Z.v._olLayer.events.register("loadend",Z.v._olLayer,ab);Z.v._olLayer.events.register("loadstart",Z.v._olLayer,aa);if(ag.disabled){ad.disable()}D.addLayer(Z.v._olLayer);M.Layer.Static.layers.push(ad);var V=M.layersManager.internal(k,"addLayer",ad);Z.v._olLayer.setZIndex(M.layersManager.internal(k,"getBaseIndex",ad)+V.length-1);B.Event.observe(Z.v._olLayer.grid[0][0].getImage(),"error",af);Z.v._olLayer.CUB=this;function aa(ah){Z.v.startTime=new Date();ad.state=M.Layer.layerState.LOADING;ad.error=M.Layer.layerError.NONE;if(typeof(ad.onLoadStart)=="function"){ad.onLoadStart.apply(this)}S(ad)}function ab(ah){ad.state=M.Layer.layerState.READY;if(typeof(ad.onLoadEnd)=="function"){ad.onLoadEnd.apply(this,[(new Date())-Z.v.startTime])}H(ad)}function af(ah){ad.state=M.Layer.layerState.ERROR;ad.error=M.Layer.layerError.INVALIDURL}function ae(ai){var ak=M.jQuery(ai).find("Capability Layer SRS:first");if(ak.length>0){var al=ak.text().split(/\s+/);for(var ah in al){for(var aj in M.projections){if(new RegExp(":"+M.projections[aj]+"$").test(al[ah])){ad.projections=ad.projections||{};ad.projections[aj]=M.projections[aj];break}}}}if(!ad.projections){ad.state=M.Layer.layerState.ERROR;ad.error=M.Layer.layerError.NOPROJ}}ad.isProjSupported=function(ah){for(var ai in ad.projections){if(ad.projections[ai]==ah){return true}}return false};if(ag.minScaledenom){ad.minScaledenom(ag.minScaledenom)}if(ag.maxScaledenom){ad.maxScaledenom(ag.maxScaledenom)}return ad};M.Layer.Static.getAllLayers=function(V,W){if(typeof(V)=="undefined"){p.errorLog("url est indéfini",p.errorLevel.ERROR);return}V=p.addParametersToUrl(V,"&request=GetCapabilities&service=wms&version=1.0.0");T.loadXML(V,function(X){var Y=[];M.jQuery(X).find("Layer Layer").each(function(){var Z={};Z.name=M.jQuery(this).find("Name:first").text();Z.title=M.jQuery(this).find("Title:first").text();M.jQuery(this).find("Layer").each(function(){var aa={};aa.name=M.jQuery(this).find("Name").text();aa.title=M.jQuery(this).find("Title").text();aa.group=Z;Y.push(aa)})});W(Y)})};M.Layer.Static.getLayerByName=function(V){return M.Layer.getLayerByName(V,M.Layer.Static)};M.Layer.Static.layers=[];(function(){M.Layer.Dynamic=function(ar,aa,X){var ak=X&&X._secret&&X._secret==k;var W=ak?X.shared:p.createShared();W.v._olLayer=null;W.v.options=X=X||{};var ac=new M.Layer(W,ar);var af=M.jQuery.extend(this,ac);var aj;var ag,ao,ai;var ap;if(X.projection&&p.checkEnum(X.projection,M.projections)){ap=X.projection}else{X.projection=null;ap=M.realProjection()}if(p.assert(X.style,M.Style)){ag=X.style}else{ag=new M.Style()}if(p.assert(X.styleSelected,M.Style)){ai=X.styleSelected}else{ai=X.style?ag.clone():new M.Style()}if(p.assert(X.styleOver,M.Style)){ao=X.styleOver}else{ao=X.style?ag.clone():new M.Style()}X.loadGeometry=typeof(X.loadGeometry)=="boolean"?X.loadGeometry:true;af.type="CUB.Layer.Dynamic";af.isAbstract=false;af.url=aa||null;af.layerName=typeof(X)=="string"?X:X.layerName||"";af.layerType=af.url?X.layerType||ah(aa):M.Layer.Dynamic.layerType.RAW;af.namespace=M.Layer.Dynamic;af.selectable=typeof(X.selectable)!="undefined"?X.selectable:false;af.labelForce=typeof(X.labelForce)!="undefined"?X.labelForce:false;af.simpleSelect=typeof(X.simpleSelect)!="undefined"?X.simpleSelect:false;af.singleSelect=typeof(X.singleSelect)!="undefined"?X.singleSelect:false;af.cursorOver=typeof(X.cursorOver)!="undefined"?X.cursorOver:"pointer";W.f.onSelect=function(au){if(typeof(af.onSelect)=="function"){if(au.isGroupFeature){var av=new Array();for(var at=0;at<au.features.length;++at){av.push(au.features[at].CUB)}af.onSelect.apply(this,[av])}else{af.onSelect.apply(this,[au.CUB])}}};W.f.onUnselect=function(au){if(typeof(af.onUnselect)=="function"){if(au.isGroupFeature){var av=new Array();for(var at=0;at<au.features.length;++at){av.push(au.features[at].CUB)}af.onUnselect.apply(this,[av])}else{af.onUnselect.apply(this,[au.CUB])}}};W.f.getSelectControl=function(){return M.layersManager.internal(k,"getSelectControl",this)};af.onSelect=af.selectable?X.onSelect||null:null;af.onUnselect=af.selectable?X.onUnselect||null:null;af.onEntityRender=X.onEntityRender||null;af.onEntityRenderDefault=X.onEntityRenderDefault||null;af.onEntityRenderOver=X.onEntityRenderOver||null;af.onEntityRenderSelect=X.onEntityRenderSelect||null;af.symbolGrid=X.symbolGrid>0?Math.round(X.symbolGrid):0;af.groupLabel=typeof X.symbolGrid=="boolean"?X.symbolGrid:true;af.getExtent=function(){if(!W.v._olLayer.features.length){return null}var au=W.v._olLayer.features[0].CUB.getExtent();for(var at in W.v._olLayer.features){au.add(W.v._olLayer.features[at].CUB.getExtent())}return au};af.moveToWhole=function(at){var au=af.getExtent();if(!au){return}if(at){au.xmin-=at;au.ymin-=at;au.xmax+=at;au.ymax+=at}M.moveToExtent(au)};af.style=function(at){if(p.assert(at)){ag=at;af.updateStyles()}return ag};af.styleOver=function(at){if(p.assert(at)){ao=at;af.updateStyles()}return ag};af.styleSelected=function(at){if(p.assert(at)){ai=at;af.updateStyles()}return ai};af.createEntity=function(at){return new M.Entity(k,null,W.v._olLayer,at)};af.opacity=function(at){if(p.assert(at)){}return _opacity};af.geometryType=function(){return W.v._olLayer.featuresType};af.getEntities=function(){var au=[];for(var at in W.v._olLayer.features){au.push(W.v._olLayer.features[at].CUB)}return au};af.getEntitiesCount=function(){return W.v._olLayer.features.length};af.updateStyles=function(){W.v._olLayer.styleMap.styles=an();af.redraw()};af.redraw=function(){if(M.realProjection()!=ap){ap=M.realProjection();if(af.layerType==M.Layer.Dynamic.layerType.WFS){W.v._olLayer.srsName=p.CUBProjToOLProj(ap)}else{W.v._olLayer.reprojectFeatures(p.CUBProjToOLProj(ap))}}ac.redraw.apply(this)};af.getSelection=function(){var au=[];for(var at in W.v._olLayer.selectedFeatures){au.push(W.v._olLayer.selectedFeatures[at].CUB)}return au};af.clearSelection=function(aw){if(aw){if(!M.jQuery.isArray(aw)){aw=[aw]}var av;for(var au=W.v._olLayer.selectedFeatures.length-1;au>=0;--au){av=false;for(var at in aw){if(aw[at]==W.v._olLayer.selectedFeatures[au].CUB){av=true}}if(!av){W.f.getSelectControl().unselect(W.v._olLayer.selectedFeatures[au])}}}else{for(var au=W.v._olLayer.selectedFeatures.length-1;au>=0;--au){W.f.getSelectControl().unselect(W.v._olLayer.selectedFeatures[au])}}};af.removeAll=function(){W.v._olLayer.removeAllFeatures()};af.findCircle=function(at,ax){var aw=new B.Geometry.Point(at.x,at.y);var av=[];for(var au in W.v._olLayer.features){if(W.v._olLayer.features[au].geometry.distanceTo(aw)<ax){av.push(W.v._olLayer.features[au].CUB)}}return av};af.exportAll=function(at){return al(W.v._olLayer.features,at)};function Z(at){W.v.startTime=new Date();if(af.state!=M.Layer.layerState.UNCOMPRESSING){af.state=M.Layer.layerState.LOADING}af.error=M.Layer.layerError.NONE;if(typeof(af.onLoadStart)=="function"){af.onLoadStart.apply(af)}S(af)}function ad(at){if(typeof(af.onLoadEnd)=="function"){af.onLoadEnd.apply(af,[(new Date())-W.v.startTime])}H(af)}function ae(au){var av=null;if(typeof(af.onEntityRenderDefault)=="function"&&(!au.style_type||au.style_type=="default")){av=af.onEntityRenderDefault}else{if(typeof(af.onEntityRenderOver)=="function"&&au.style_type=="over"){av=af.onEntityRenderOver}else{if(typeof(af.onEntityRenderSelect)=="function"&&au.style_type=="select"){av=af.onEntityRenderSelect}}}if(av||typeof(af.onEntityRender)=="function"){var at=new M.Style().internal(k,"fromOLStyle",au.style);if(av){av.apply(af,[au.feature.CUB,at])}if(af.onEntityRender){af.onEntityRender.apply(af,[au.feature.CUB,at,au.style_type||"default"])}au.style=at.internal(k,"toOLStyle").defaultStyle}}function an(){return new B.StyleMap({"default":ag.validate().internal(k,"toOLStyle"),select:ai.validate().internal(k,"toOLStyle"),over:ao.validate().internal(k,"toOLStyle")})}function al(at,au){switch(au){case M.Layer.Dynamic.layerType.SHP:return(new B.Format.ShapeFile()).write(at);break;case M.Layer.Dynamic.layerType.KML:return(new B.Format.KML()).write(at);break;default:throw ("Format d'export non supporté")}}function ah(at){switch(p.getExtension(at)){case"kmz":return M.Layer.Dynamic.layerType.KMZ;break;case"kml":return M.Layer.Dynamic.layerType.KML;break;case"gml":return M.Layer.Dynamic.layerType.GML;break;case"shp":return M.Layer.Dynamic.layerType.SHP;break;case"dxf":return M.Layer.Dynamic.layerType.DXF;break;case null:return M.Layer.Dynamic.layerType.WFS;break;default:return M.Layer.Dynamic.layerType.RAW}}if(ar!=""&&M.Layer.Dynamic.getLayerByName(ar)){p.errorLog('Une couche dynamique "'+af.name+'" existe déjà',p.errorLevel.WARNING);return null}switch(af.layerType){case M.Layer.Dynamic.layerType.WFS:if(!af.layerName){p.errorLog("Une couche WFS doit impérativement avoir options.layerName de défini",p.errorLevel.WARNING);return null}var am=af.url;if(M.jQuery.isArray(X.attributes)){if(X.loadGeometry){am+="&PropertyName="+X.attributes.concat(["geometry"]).join(",")}else{am+="&PropertyName="+X.attributes.join(",")}}W.v._olLayer=new B.Layer.Vector(af.name,{filter:X.wfsFilter?new B.Filter.WKT({value:X.wfsFilter}):null,strategies:X.loadAllAtOnce?[new B.Strategy.Fixed()]:[new B.Strategy.BBOX({ratio:1.1})],protocol:new B.Protocol.WFS({url:am,formatOptions:{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",ows:"http://www.opengis.net/ows/2.0"}},featureType:af.layerName,srsName:p.CUBProjToOLProj(X.projection?X.projection:M.realProjection()),version:"1.1.0"}),visibility:false,projection:p.CUBProjToOLProj(X.projection?X.projection:M.realProjection()),styleMap:an()});W.v._olLayer.events.register("loadstart",W.v._olLayer,Z);W.v._olLayer.events.register("loaderror",W.v._olLayer,function(at){af.state=M.Layer.layerState.ERROR;if(at.error&&at.error.error&&at.error.error=="INVALIDURL"){af.error=M.Layer.layerError.INVALIDURL;af.errorText=at.error.errorText}else{af.error=M.Layer.layerError.UNKNOWN;af.errorText=""}});W.v._olLayer.events.register("loadend",W.v._olLayer,function(){af.state=M.Layer.layerState.READY;af.error=M.Layer.layerError.NONE;af.errorText="";ad()});break;case M.Layer.Dynamic.layerType.KML:W.v._olLayer=new B.Layer.Vector(af.name,{strategies:[new B.Strategy.Fixed()],protocol:new B.Protocol.HTTP({url:af.url,format:new B.Format.KML({extractStyles:false,extractAttributes:true,maxDepth:2,internalProjection:p.CUBProjToOLProj(M.realProjection())}),requestFailure:function(at){af.state=M.Layer.layerState.ERROR;af.error=M.Layer.layerError.INVALIDURL}}),styleMap:an()});W.v._olLayer.events.register("loadstart",W.v._olLayer,Z);W.v._olLayer.events.register("loaderror",W.v._olLayer,function(at){af.state=M.Layer.layerState.ERROR;if(at.error&&at.error.error&&at.error.error=="INVALIDURL"){af.error=M.Layer.layerError.INVALIDURL;af.errorText=at.error.errorText}else{af.error=M.Layer.layerError.UNKNOWN;af.errorText=""}});W.v._olLayer.events.register("loadend",W.v._olLayer,function(){af.state=M.Layer.layerState.READY;af.error=M.Layer.layerError.NONE;af.errorText="";ad()});break;case M.Layer.Dynamic.layerType.KMZ:af.state=M.Layer.layerState.UNCOMPRESSING;W.v._olLayer=new B.Layer.Vector(af.name,{styleMap:an()});var Y=new b(af.url,function(au){af.state=M.Layer.layerState.LOADING;if(au.entries.length==0){af.state=M.Layer.layerState.ERROR;af.error=M.Layer.layerError.INVALIDDATA;af.errorText="Le fichier KMZ ne contient pas de KML";return}var av=au.entries[0];var at=av.openTextReader();at.beginReadToEnd(function(ax,ay){var aw=new B.Format.KML({extractStyles:false,extractAttributes:true,maxDepth:2,internalProjection:p.CUBProjToOLProj(M.realProjection())});W.v._olLayer.addFeatures(aw.read(ax));af.state=M.Layer.layerState.READY;af.error=M.Layer.layerError.NONE;af.errorText="";W.v._olLayer.events.triggerEvent("loadend")})},function(at){af.state=M.Layer.layerState.ERROR;af.error=M.Layer.layerError.INVALIDURL;af.errorText="Le fichier spécifié est introuvable";W.v._olLayer.events.triggerEvent("loadend")});W.v._olLayer.events.register("loadstart",W.v._olLayer,Z);W.v._olLayer.events.register("loadend",W.v._olLayer,ad);W.v._olLayer.events.triggerEvent("loadstart");break;case M.Layer.Dynamic.layerType.SHP:var aq=p.getBasename(af.url);var ab=[aq+".shp",aq+".dbf"];if(!X.projection){ab.push(aq+".prj")}W.v._olLayer=new B.Layer.Vector(af.name,{strategies:[new B.Strategy.Fixed()],protocol:new B.Protocol.BinaryHTTP({url:ab,format:new B.Format.ShapeFile({internalProjection:p.CUBProjToOLProj(X.projection?X.projection:M.realProjection())})}),styleMap:an()});W.v._olLayer.events.register("loadstart",W.v._olLayer,Z);W.v._olLayer.events.register("loadend",W.v._olLayer,function(){af.state=M.Layer.layerState.READY;af.error=M.Layer.layerError.NONE;af.errorText="";ad()});W.v._olLayer.events.triggerEvent("loadstart");break;case M.Layer.Dynamic.layerType.DXF:W.v._olLayer=new B.Layer.Vector(af.name,{strategies:[new B.Strategy.Fixed()],protocol:new B.Protocol.BinaryHTTP({url:af.url,format:new B.Format.DXF({internalProjection:p.CUBProjToOLProj(X.projection?X.projection:M.realProjection())})}),styleMap:an()});W.v._olLayer.events.register("loadstart",W.v._olLayer,Z);W.v._olLayer.events.register("loadend",W.v._olLayer,function(){af.state=M.Layer.layerState.READY;af.error=M.Layer.layerError.NONE;af.errorText="";ad()});W.v._olLayer.events.triggerEvent("loadstart");break;case M.Layer.Dynamic.layerType.RAW:W.v._olLayer=new B.Layer.Vector(af.name,{styleMap:an()});break;default:p.errorLog('Type de la couche "'+af.name+'" incorrect',p.errorLevel.WARNING);return null}W.v._olLayer.CUB=this;D.addLayer(W.v._olLayer);M.Layer.Dynamic.layers.push(af);var V=M.layersManager.internal(k,"addLayer",af);W.v._olLayer.setZIndex(M.layersManager.internal(k,"getBaseIndex",af)+V.length-1);W.v._olLayer.events.register("beforefeaturerender",W.v._olLayer,ae);if(X.minScaledenom){af.minScaledenom(X.minScaledenom)}else{af.minScaledenom(-1)}if(X.maxScaledenom){af.maxScaledenom(X.maxScaledenom)}else{af.maxScaledenom(-1)}if(!X.disabled){af.enable()}return af};M.Layer.Dynamic.getLayerByName=function(V){return M.Layer.getLayerByName(V,M.Layer.Dynamic)};M.Layer.Dynamic.layers=[];M.Layer.Dynamic.layerType={WFS:0,KML:1,KMZ:2,SHP:3,DXF:4,RAW:99}})();(function(){var V=new B.CUB.WPSExecuteResponse();M.Layer.Processing=function(X,Y,ah){if(!p.isScopeValid(this)){return null}var aa=p.createShared();aa.v._olLayer=null;var Z=ah&&typeof ah=="string"?ah:ah.process;if(!Z){p.errorLog("Nom du processus WPS manquant",p.errorLevel.WARNING);return null}ah=ah&&typeof ah=="object"?ah:{};var ae=new M.Layer.Dynamic(X,"",M.jQuery.extend({layerType:M.Layer.Dynamic.layerType.RAW,_secret:k,shared:aa},ah));var ad;var ag;var ac;var af=null;var ab=typeof(ah.loadGeometry)=="boolean"?ah.loadGeometry:true;ae.type="CUB.Layer.Processing";ae.url=Y||"";ae.server=null;ae.identifier=Z;ae.title=null;ae.abstractText=null;ae.output=null;ae.input=null;ae.execute=function(ai,al,ak){if(ae.state==M.Layer.layerState.LOADING){p.errorLog("Un traitement est déjà en cours d'exécution",p.errorLevel.WARNING);return}var aj={identifier:ae.identifier,dataInputs:ai,responseForm:{storeExecuteResponse:false,lineage:false,status:false},format:"KVP"};ae.error=M.Layer.layerError.NONE;ae.state=M.Layer.layerState.LOADING;ae.errorText="";af=T.loadXML(Y+"&"+V.write(aj),function(am){af=null;var aq=new A(am);if(aq.errorCode){ae.error=M.Layer.layerError.WPSEXCEPTION;ae.state=M.Layer.layerState.ERROR;ae.errorText=aq.errorCode+" - "+aq.errorText;if(typeof(ak)=="function"){ak.apply(ae,[aq.errorCode,aq.errorText])}}else{ae.state=M.Layer.layerState.READY;ae.error=M.Layer.layerError.NONE;ae.errorText="";var ao=V.read(am);ae.removeAll();for(var ap in ao){for(var an in ao[ap]){if(ao[ap][an].CLASS_NAME){if(ao[ap][an].CLASS_NAME=="OpenLayers.Feature.Vector"){if(ab===false){delete ao[ap][an].geometry}aa.v._olLayer.addFeatures([ao[ap][an]])}ao[ap][an]=ao[ap][an].CUB}}}if(typeof(al)=="function"){al.apply(ae,[ao])}if(typeof(ae.onLoadEnd)=="function"){ae.onLoadEnd.apply(ae,[(new Date())-ad])}H(ae,[(new Date())-ad])}},function(am){ae.error=M.Layer.layerError.WPSEXCEPTION;ae.state=M.Layer.layerState.ERROR;ae.errorText=am.error+" - "+am.errorText},true);if(typeof(ae.onLoadStart)=="function"){ae.onLoadStart.apply(ae)}S(ae)};ae.abort=function(){if(!af){return}af.abort();ae.error=M.Layer.layerError.NONE;ae.state=M.Layer.layerState.NONE};function W(aj){var ai=[];for(var ak in aj){ai.push({identifier:ak,data:{literalData:{value:encodeURIComponent(aj[ak])}}})}return ai}M.OGCWS.WPSServer.create(Y,function(ak,aj){if(!ak||(aj&&aj.errorCode)){ae.state=M.Layer.layerState.ERROR;ae.error=M.Layer.layerError.INVALIDURL;if(typeof aj=="object"){ae.errorText="WPS - "+aj.errorCode+(aj.errorText?" : "+aj.errorText:"")}else{ae.errorText="WPS - "+aj}return}ae.server=ak;var ai=p.addParametersToUrl(Y,"&request=DescribeProcess&service=WPS&version=1.0.0&Identifier="+Z);T.loadXML(ai,function(an,am){if(am){p.errorLog("Serveur WPS : URL invalide",p.errorLevel.WARNING);return}var aq=new A(an);if(!aq.errorCode){var al=new B.Format.WPSDescribeProcess();var ap=al.read(aq.xml);ae.abstractText=ap.abstractText;ae.version=ap.processVersion;ag=ap.statusSupported;ac=ap.storeSupported;ae.input=[];for(var ao in ap.dataInputs){input={abstractText:ap.dataInputs[ao].abstractText,identifier:ap.dataInputs[ao].identifier,title:ap.dataInputs[ao].title};ae.input.push(input)}}})});return ae}})();M.Layer.Geocoder=function(W,V){if(!p.isScopeValid(this)){return null}var Y=p.createShared();Y.v._olLayer=null;V=V&&typeof V=="object"?V:{};var X=new M.Layer.Dynamic(W,"",M.jQuery.extend({layerType:M.Layer.Dynamic.layerType.RAW,_secret:k,shared:Y},V));X.type="CUB.Layer.Geocoder";X.onReady=V.onReady||null;X.discard=V.discard||true;X.way=function(aa,Z,ae,ad,ab){ad=typeof(ad)=="boolean"?ad:true;if(!p.checkEnum(ab,M.Layer.Geocoder.wayMode)){ab=M.Layer.Geocoder.wayMode.DRIVING}if(X.discard){X.removeAll()}aa=aa.clone();Z=Z.clone();aa.projection(M.projections.WGS84);Z.projection(M.projections.WGS84);var ac=new google.maps.DirectionsService();ac.route({origin:new google.maps.LatLng(aa.y,aa.x),destination:new google.maps.LatLng(Z.y,Z.x),travelMode:ab},function(ao,ak){var ag=false;if(ak!="OK"){ag=true}var am=[];var af,ai;if(!ao||!ao.routes.length||!ao.routes[0].legs.length){ag=true}if(!ag){var an=ao.routes[0].legs[0];af=an.distance.value;ai=an.duration.value;for(var aj in an.steps){var al=[];for(var ah in an.steps[aj].lat_lngs){al.push(new M.Position(an.steps[aj].lat_lngs[ah].lng(),an.steps[aj].lat_lngs[ah].lat(),M.projections.WGS84))}am.push(X.createEntity({geometry:new M.Geometry.Line(al),attributes:{instructions:an.steps[aj].instructions,distance:an.steps[aj].distance.value,duration:an.steps[aj].duration.value},visible:ad}))}}if(typeof(ae)=="function"){if(!ag){ae.apply(X,[am,af,ai])}else{ae.apply(X,[null])}}})};X.geocode=function(Z,af,ad){ad=typeof(ad)=="boolean"?ad:true;var ac=new M.Position(M.maxExtent().xmin,M.maxExtent().ymin);ac.projection(M.projections.WGS84);var ae=new M.Position(M.maxExtent().xmax,M.maxExtent().ymax);ae.projection(M.projections.WGS84);var aa=new google.maps.LatLngBounds(new google.maps.LatLng(ac.y,ac.x),new google.maps.LatLng(ae.y,ae.x));var ab=new google.maps.Geocoder();ab.geocode({address:Z,bounds:aa},function(aj,ag){var ah=false;if(ag!="OK"||!aj.length){ah=true}if(!ah){var ak=[];for(var ai in aj){var al=new M.Position(aj[ai].geometry.location.lng(),aj[ai].geometry.location.lat(),M.projections.WGS84);if(!M.maxExtent().containsPoint(al)){continue}ak.push(X.createEntity({geometry:new M.Geometry.Point(al),attributes:{address:aj[ai].formatted_address},visible:ad}))}}if(typeof(af)=="function"){if(!ah){af.apply(X,[ak])}else{af.apply(X,[null])}}})};L.load(function(){if(typeof(X.onReady)=="function"){X.onReady.apply(this)}});return X};M.Layer.Geocoder.wayMode={DRIVING:"DRIVING",TRANSIT:"TRANSIT",WALKING:"WALKING"};M.Layer.Background=function(X,Z,ai){if(!p.isScopeValid(this)){return null}var aa=p.createShared();aa.v._olLayer=null;aa.v.options=ai=ai||{};var Y=new M.Layer(aa,X);var ah=M.jQuery.extend(this,Y);ai.enableOblique=typeof ai.enableOblique=="boolean"?ai.enableOblique:false;ah.type="CUB.Layer.Background";ah.isAbstract=false;ah.layerType=Z||M.Layer.Background.layerType.CUB;ah.namespace=M.Layer.Background;ah.enableOblique=function(aj){if(typeof aj!="undefined"){if(this.layerType==M.Layer.Background.layerType.GOOGLEHYBRID||this.layerType==M.Layer.Background.layerType.GOOGLESATELLITE){D.baseLayer.mapObject.setTilt(aj?45:0)}}if(this.layerType==M.Layer.Background.layerType.GOOGLEHYBRID||this.layerType==M.Layer.Background.layerType.GOOGLESATELLITE){return(D.baseLayer.mapObject.getTilt()==45)}return false};ah.isGoogleLayer=function(){return $.inArray(this.layerType,[M.Layer.Background.layerType.GOOGLEROADMAP,M.Layer.Background.layerType.GOOGLEHYBRID,M.Layer.Background.layerType.GOOGLESATELLITE,M.Layer.Background.layerType.GOOGLETERRAIN,])!=-1};var ad;if(D.getExtent()){ad=p.boundsToExtent(D.getExtent())}function ac(aj){aa.v.startTime=new Date();ah.state=M.Layer.layerState.LOADING;if(typeof(ah.onLoadStart)=="function"){ah.onLoadStart.apply(this)}}function ae(aj){ah.state=M.Layer.layerState.READY;if(typeof(ah.onLoadEnd)=="function"){ah.onLoadEnd.apply(this,[(new Date())-aa.v.startTime])}}function ag(){var al=new google.maps.LatLng(0,0);if(aa.v._olLayer){ad=p.boundsToExtent(D.getExtent());D.removeLayer(aa.v._olLayer)}aa.v._olLayer=new B.CUB.Google(ah.layerType);if(aa.v.options.minScaledenom){ah.minScaledenom(aa.v.options.minScaledenom)}if(aa.v.options.maxScaledenom){ah.maxScaledenom(aa.v.options.maxScaledenom)}if(aa.v.options.disabled){ah.disable()}D.addLayer(aa.v._olLayer);q();if(M.Layer.Background.layers){M.Layer.Background.layers.destroy()}ah.enableOblique(ai.enableOblique);ah.projections=[M.projections.GOOGLEMERCATOR];M.Layer.Background.layers=ah;if(M.realProjection()!=M.projections.GOOGLEMERCATOR){M.realProjection(M.projections.GOOGLEMERCATOR)}var ak=0;var aj=setInterval(function(){var an=M.jQuery(".olLayerGoogleCopyright");if(an.length){M.jQuery(".CUB_copyright").append(an);clearInterval(aj)}if(++ak>40){clearInterval(aj)}},250);aa.v._olLayer.setZIndex(100);aa.v._olLayer.CUB=this;aa.v._olLayer.events.register("loadstart",aa.v._olLayer,ac);aa.v._olLayer.events.register("loadend",aa.v._olLayer,ae);aa.v._olLayer.events.triggerEvent("loadstart");var am=M.layersManager.internal(k,"addLayer",ah);aa.v._olLayer.setZIndex(M.layersManager.internal(k,"getBaseIndex",ah)+am.length-1);q();if(ad){M.moveToExtent(ad)}else{M.moveToWhole()}O()}aa.f.setExtent=function(aj){p.assert(aj,M.Extent,"Étendue incorrecte");aa.v._olLayer.maxExtent=p.extentToBounds(aj)};M.jQuery(".CUB_copyright").html("");M.tint(M.tints.LIGHT);switch(Z){case M.Layer.Background.layerType.GOOGLEROADMAP:case M.Layer.Background.layerType.GOOGLEHYBRID:case M.Layer.Background.layerType.GOOGLESATELLITE:case M.Layer.Background.layerType.GOOGLETERRAIN:p.errorLog("L'API Google Maps n'est plus supportée",p.errorLevel.WARNING);return;case M.Layer.Background.layerType.OPENSTREETMAP:aa.v._olLayer=new B.Layer.OSM(null,["//a.tile.openstreetmap.org/${z}/${x}/${y}.png","//b.tile.openstreetmap.org/${z}/${x}/${y}.png","//c.tile.openstreetmap.org/${z}/${x}/${y}.png"],{gutter:0.5,tileLoadingDelay:0});aa.v._olLayer.CUB=ah;aa.v._olLayer.setZIndex(100);if(ai.minScaledenom){ah.minScaledenom(ai.minScaledenom)}if(ai.maxScaledenom){ah.maxScaledenom(ai.maxScaledenom)}if(ai.disabled){ah.disable()}D.addLayer(aa.v._olLayer);aa.v._olLayer.serverResolutions=aa.v._olLayer.resolutions;D.setOptions({fractionnalZoom:Q});q();if(M.Layer.Background.layers){M.Layer.Background.layers.destroy()}ah.projections=[M.projections.GOOGLEMERCATOR];M.Layer.Background.layers=ah;if(M.realProjection()!=M.projections.GOOGLEMERCATOR){M.realProjection(M.projections.GOOGLEMERCATOR)}M.jQuery(".CUB_copyright").html("© les contributeurs d'OpenStreetMap");break;case M.Layer.Background.layerType.BINGROAD:case M.Layer.Background.layerType.BINGHYBRID:case M.Layer.Background.layerType.BINGAERIAL:p.errorLog("L'API Bing n'est plus supportée",p.errorLevel.WARNING);return;break;case M.Layer.Background.layerType.TILECACHE:M.tint(M.tints.LIGHT);if(!p.assert(ai.extent,M.Extent)||!p.assert(ai.url)||!p.assert(ai.resolutions)){p.errorLog("Paramètres manquants ou invalides pour une couche TileCache",p.errorLevel.ERROR);O();return}ah.url=ai.url;ah.layerName=ai.layerName||X;ah.format=ai.format||"image/jpeg";if(M.realProjection()!=M.projections.RGF93CC45){M.realProjection(M.projections.RGF93CC45)}q();if(M.Layer.Background.layers){M.Layer.Background.layers.destroy()}aa.v._olLayer=new B.Layer.TileCache(X,ah.url,ah.layerName,{format:ah.format,transitionEffect:"resize",buffer:0,gutter:0.5,tileLoadingDelay:0,resolutions:ai.resolutions,serverResolutions:ai.resolutions});aa.v._olLayer.CUB=ah;aa.v._olLayer.setZIndex(100);if(ai.minScaledenom){ah.minScaledenom(ai.minScaledenom)}if(ai.maxScaledenom){ah.maxScaledenom(ai.maxScaledenom)}if(ai.disabled){ah.disable()}ai.resolutions.sort();D.setOptions({maxResolution:ai.resolutions[0],minResolution:ai.resolutions[ai.resolutions.length-1],maxExtent:ai.extent.internal(k,"toOLBounds"),fractionnalZoom:Q});D.addLayer(aa.v._olLayer);ah.projections=[M.projections.RGF93CC45];M.Layer.Background.layers=ah;break;default:p.errorLog("Type de couche d'arrière plan invalide",p.errorLevel.WARNING);case M.Layer.Background.layerType.CUB:var ab=[66.1457976146026,46.30205833022182,26.458319045841,13.2291595229205,6.61457976146026,2.6458319045841,1.32291595229205,0.661457976146026,0.26458319045841];var af="fdp";var V="image/png";case M.Layer.Background.layerType.CUBORTHO2012:if(!ab){ab=[66.1457976146026,46.30205833022182,26.458319045841,13.2291595229205,6.61457976146026,2.6458319045841,1.32291595229205,0.661457976146026,0.26458319045841];af="ortho2012ete";V="image/jpeg"}case M.Layer.Background.layerType.CUBHYBRID:if(!ab){ab=[66.1457976146026,46.30205833022182,26.458319045841,13.2291595229205,6.61457976146026,2.6458319045841,1.32291595229205,0.661457976146026,0.26458319045841];af="fdp_hybride";V="image/jpeg"}if(M.Layer.Background.layers){M.Layer.Background.layers.projections=[M.projections.RGF93CC45]}if(M.realProjection()!=M.projections.RGF93CC45){M.realProjection(M.projections.RGF93CC45)}q();if(M.Layer.Background.layers){M.Layer.Background.layers.destroy()}aa.v._olLayer=new B.Layer.TileCache(X,"//data.bordeaux-metropole.fr/tiles/",af,{format:V,transitionEffect:"resize",buffer:0,tileLoadingDelay:0,zoomOffset:1,serverResolutions:ab,resolutions:ab});aa.v._olLayer.CUB=ah;aa.v._olLayer.setZIndex(100);if(ai.minScaledenom){ah.minScaledenom(ai.minScaledenom)}if(ai.maxScaledenom){ah.maxScaledenom(ai.maxScaledenom)}if(ai.disabled){ah.disable()}D.setOptions({fractionalZoom:Q,maxResolution:ab[0],minResolution:ab[ab.length-1],maxExtent:new B.Bounds(1390500,4174000,1431300,4214500)});D.addLayer(aa.v._olLayer);ah.projections=[M.projections.RGF93CC45];M.Layer.Background.layers=ah;M.jQuery(".CUB_copyright").html("© Bordeaux Métropole");break}aa.v._olLayer.events.register("loadstart",aa.v._olLayer,ac);aa.v._olLayer.events.register("loadend",aa.v._olLayer,ae);var W=M.layersManager.internal(k,"addLayer",ah);aa.v._olLayer.setZIndex(M.layersManager.internal(k,"getBaseIndex",ah)+W.length-1);q();if(ai.extent){M.moveToExtent(new M.Extent(ai.extent[0],ai.extent[1],ai.extent[2],ai.extent[3]))}else{if(ad){M.moveToExtent(ad)}else{M.moveToWhole()}}O();return ah};M.Layer.Background.layerType={CUB:0,CUBHYBRID:10,CUBORTHO2012:11,TILECACHE:1,OPENSTREETMAP:2,GOOGLEROADMAP:3,GOOGLEHYBRID:4,GOOGLESATELLITE:5,GOOGLETERRAIN:6,BINGROAD:7,BINGHYBRID:8,BINGAERIAL:9};M.Layer.Background.layers=null;M.Layer.SpitSet=function(W,V){if(!p.isScopeValid(this)){return null}var aa=p.createShared();aa.v._olLayer=null;aa.v.options=V=V||{};var Z=new M.Layer(aa,W);var X=M.jQuery.extend(this,Z);var Y=M.realProjection();X.namespace=M.Layer.SpitSet;X.type="CUB.Layer.SpitSet";X.isAbstract=false;X.align=V.align||M.Layer.SpitSet.align.CENTER;X.draggable=typeof V.draggable==="boolean"?V.draggable:true;X.valign=V.valign||M.Layer.SpitSet.valign.BOTTOM;X.spitDistance=typeof(V.spitDistance)=="number"?V.spitDistance:100;X.redraw=function(){Z.redraw.apply(this)};X.template=function(ac){if(p.assert(ac)){aa.v._olLayer.template=ac}return aa.v._olLayer.template};X.createSpit=function(ac,ae,ad){if(ac){p.assert(ac,M.Position,"Position invalide")}var ag=ac?ac.internal(k,"toOLLonLat"):null;var af;if(p.assert(ae)&&(af=X.getSpitByName(ae))){af.destroy()}var af=new M.Spit(k,ag,ae,aa.v._olLayer,ad);return af};X.count=function(){return aa.v._olLayer.spits.length};X.removeAll=function(){aa.v._olLayer.removeAll()};X.getSpitByName=function(ac){p.assert(ac,null,"Le nom ne peut pas être vide");for(var ad in aa.v._olLayer.spits){if(aa.v._olLayer.spits[ad].CUB.name==ac){return aa.v._olLayer.spits[ad].CUB}}return null};X.getAllSpits=function(){var ad=[];for(var ac in aa.v._olLayer.spits){ad.push(aa.v._olLayer.spits[ac].CUB)}return ad};aa.v._olLayer=new B.Layer.SpitSet(X.name,{template:'<div class="CUB_Spit"><div style="font-size: 14px; font-weight: bold">${title}</div><p>${content}</p></div>',CUB:X});M.Layer.SpitSet.layers.push(X);if(V.disabled){X.disable()}D.addLayer(aa.v._olLayer);var ab=M.layersManager.internal(k,"addLayer",X);aa.v._olLayer.setZIndex(M.layersManager.internal(k,"getBaseIndex",X)+ab.length-1);if(V.template){X.template(V.template)}if(V.minScaledenom){X.minScaledenom(V.minScaledenom)}if(V.maxScaledenom){X.maxScaledenom(V.maxScaledenom)}if(V.template){X.template(V.template)}return X};M.Layer.SpitSet.layers=[];M.Layer.SpitSet.align={LEFT:0,CENTER:1,RIGHT:2};M.Layer.SpitSet.valign={TOP:0,MIDDLE:1,BOTTOM:2};(function(){var Y=p.createShared();var V;M.layersManager=M.jQuery.extend(new M.Class(Y,"CUB.layersManager",true,false),{annotationLayers:[],vectorLayers:[],fixedLayers:[],backgroundLayers:[],getLayerLevel:function(Z){switch(Z.namespace){case M.Layer.Background:return M.layersManager.backgroundLayers;break;case M.Layer.Static:return M.layersManager.fixedLayers;case M.Layer.Processing:return M.layersManager.vectorLayers;break;case M.Layer.Dynamic:return M.layersManager.vectorLayers;break;case M.Layer.SpitSet:return M.layersManager.annotationLayers;break;default:return M.layersManager.vectorLayers}},getAllLayers:function(){return M.layersManager.backgroundLayers.concat(M.layersManager.fixedLayers.concat(M.layersManager.vectorLayers.concat(M.layersManager.annotationLayers)))}});function X(Z){if(!V){W(Z.internal(k,"getLayer"))}else{V.setLayer(V.layers.concat([Z.internal(k,"getLayer")]))}}function W(Z){V=new B.CUB.SelectFeature([Z],{clickout:true,hover:true,toggle:true,multiple:true,highlightOnly:true,onSelect:function(aa){if(!aa.layer.CUB.selectable){return}aa.layer.CUB.internal(k,"onSelect",aa)},onUnselect:function(aa){if(!aa.layer.CUB.selectable){return}aa.layer.CUB.internal(k,"onUnselect",aa)}});D.addControl(V);V.activate()}Y.f.getSelectControl=function(){return V};Y.f.getBaseIndex=function(Z){var aa=M.layersManager.getLayerLevel(Z);switch(aa){case M.layersManager.annotationLayers:return 800;break;case M.layersManager.vectorLayers:return 400;break;case M.layersManager.fixedLayers:return 200;break;case M.layersManager.backgroundLayers:return 100;break}};Y.f.addLayer=function(Z){var aa=M.layersManager.getLayerLevel(Z);aa.push(Z);if(aa==M.layersManager.vectorLayers||aa==M.layersManager.annotationLayers){X(Z);Y.f.reorderLayers()}return aa};Y.f.removeLayer=function(ab){var ac=M.layersManager.getLayerLevel(ab);var Z;for(Z=0;Z<ac.length;++Z){if(ac[Z]==ab){ac[Z]=null;break}}for(var aa=Z+1;aa<ac.length;++aa){ac[aa].zOrder(aa-1)}ac.pop();if(ac==M.layersManager.vectorLayers){V.removeLayer(ab)}};Y.f.reorderLayers=function(){var ad;var ae=false;switch(p.getRenderer()){case"SVG":ad=M.jQuery(V.layer.div).children("svg");break;case"VML":ad=M.jQuery(V.layer.div).children("div");ae=true;break;case"Canvas":ad=M.jQuery(V.layer.div).children("canvas");break;default:p.errorLog("Réorganisation des couches impossible : le renderer n'est pas supporté");break}var ac=ad.children();var aa=[];for(var ab=1;ab<ac.length;++ab){aa.push(M.jQuery(ac[ab]).remove())}Z(M.layersManager.vectorLayers);Z(M.layersManager.annotationLayers);function Z(aj){for(var ai=0;ai<aj.length;ai++){var ah=aj[ai].internal(k,"getLayer");var ag=M.jQuery(ah.div).children()[0].id.replace(/^(.*)_[a-z]+$/i,"$1");for(var af=0;af<aa.length;++af){if(aa[af][0].id.replace(/^(.*)_[a-z]+$/i,"$1")==ag){ad.append(aa[af]);break}}if(ae){ah.redraw()}}}}})();(function(){M.Entity=function(){if(!p.isScopeValid(this)){return null}if(!arguments[0]||arguments[0]!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var ab=p.createShared();ab.v._olFeature=arguments[1];ab.v._olLayer=arguments[2];options=arguments[3]||{};if(arguments[1]&&arguments[1].attributes){options.attributes=arguments[1].attributes}var aa=new M.Class(ab);var Z=M.jQuery.extend(this,aa);var X=ab.v._olFeature?ab.v._olFeature.geometryType():M.Entity.geomType.POINT;Z.type="CUB.Entity";Z.namespace=M.Entity;Z.attributes=options.attributes&&typeof options.attributes=="object"?options.attributes:new Object();if(arguments[1]&&typeof Z.attributes=="object"){for(var Y in Z.attributes){var W=Z.attributes[Y];if(typeof W.value!="undefined"){Z.attributes[Y]=W.value;delete W}}}Z.visible=typeof(options.visible)=="boolean"?options.visible:true;Z.geometry=function(ac){if(p.assert(ac)&&p.assert(ac,[M.Geometry.Point,M.Geometry.Line,M.Geometry.Polygon],"Type de géométrie invalide")){if(ab.v._olFeature){ab.v._olLayer.removeFeatures([ab.v._olFeature])}var ad=V(ac,X);ab.v._olFeature=new B.Feature.Vector(ad,this.attributes,null,this);ab.v._olLayer.addFeatures([ab.v._olFeature],{silent:true});return ac}else{return ab.v._olFeature?ab.v._olFeature.toCUBGeometry():null}};Z.getExtent=function(){if(!ab.v._olFeature){p.errorLog("Impossible de calculer l'étendue de l'entité : la géométrie est vide",p.errorLevel.WARNING);return null}var ad=ab.v._olFeature.toCUBGeometry();if(!ad){return null}else{if(Z.isMulti()){var ae=ad[0].getExtent();for(var ac=1;ac<ad.length;ac++){ae.add(ad[ac].getExtent())}return ae}else{return ad.getExtent()}}};Z.getBarycenter=function(){var ae=ab.v._olFeature.toCUBGeometry();if(Z.isMulti()){var af=ae[0].getBarycenter();for(var ad=1;ad<ae.length;ad++){var ac=ae[ad].getBarycenter();af.x+=ac.x;af.y+=ac.y}af.x/=ae.length;af.y/=ae.length;return af}else{return ae.getBarycenter()}};Z.getLength=function(){var ad=Z.geometry();if(Z.isMulti()){var ae=0;for(var ac=0;ac<ad.length;ac++){ae+=ad[ac].getLength()}return ae}else{return ad.getLength()}};Z.getPositionFromDistance=function(ag){var ad=Z.geometry();if(Z.isMulti()){var ae=0;for(var ac=0;ac<ad.length;ac++){var af=ad[ac].getPositionFromDistance(ag);if(af){return af}ag-=ad[ac].getLength()}return null}else{return ad.getPositionFromDistance(ag)}};Z.isMulti=function(){return ab.v._olFeature.isMulti()};Z.getGeomType=function(){return X};Z.getLayer=function(){if(!ab.v._olLayer){ab.v._olLayer=ab.v._olFeature.layer}return ab.v._olLayer.CUB};Z.isValidGeomType=function(ac){return X==ac.getGeomType()};Z.destroy=function(){if(ab.v._olFeature){ab.v._olFeature.destroy()}aa.destroy.apply(this)};Z.select=function(){if(Z.isSelected()){return}M.layersManager.internal(k,"getSelectControl").select(ab.v._olFeature)};Z.unSelect=function(){if(ab.v._olFeature.layer){M.layersManager.internal(k,"getSelectControl").unselect(ab.v._olFeature)}};Z.isSelected=function(){return ab.v._olFeature.selected};Z.hide=function(){if(this.visible!==false){this.visible=false;ab.v._olLayer.eraseFeatures(ab.v._olFeature)}};Z.show=function(){if(this.visible!==true){this.visible=true;ab.v._olLayer.drawFeature(ab.v._olFeature)}};Z.zoomTo=function(ac){if(typeof(ac)!="boolean"){ac=false}var ad=Z.getExtent();if(ac){M.moveToPoint(ad.centerPoint())}else{M.moveToExtent(ad)}};Z.toString=function(){return Z.geometry()};if(options.geometry){Z.geometry(options.geometry)}return Z};function V(X,Y){if(M.jQuery.isArray(X)){var Z=[];for(var W in X){Z.push(X[W].internal(k,"toOLGeometry",[M.realProjection()]))}return new B.Geometry.Collection(Z)}else{return X.internal(k,"toOLGeometry",[M.realProjection()])}}M.Entity.geomType={MIXED:0,POINT:1,LINE:2,POLYGON:3}})();(function(){M.Spit=function(){if(!p.isScopeValid(this)){return null}if(!arguments[0]||arguments[0]!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var aa=p.createShared();var Z=new M.Class(aa);var X=M.jQuery.extend(this,Z);X.type="CUB.Spit";X.namespace=M.Spit;var Y=arguments[1];var W=arguments[3];var V=arguments[4]||{};X.attributes=V.attributes||{};X.name=arguments[2]||null;X.draggable=W.CUB.draggable;aa.v._olSpit=new B.Spit(Y,W,X);aa.v._olSpit.offset=new B.Pixel(0,-W.CUB.spitDistance),W.addSpits(aa.v._olSpit);X.getWidth=function(){return aa.v._olSpit.width()};X.getHeight=function(){return aa.v._olSpit.height()};X.getExtent=function(){var ab=aa.v._olSpit.layer.getLonLatFromViewPortPx(aa.v._olSpit.offsetTop());var ad=p.lonLatToPosition(ab);var ac=ad.clone().translateByPixels(X.getWidth()/2,X.getHeight()/2);ad.translateByPixels(-X.getWidth()/2,-X.getHeight()/2);var ae=new M.Extent(ad.x,ad.y,ac.x,ac.y);ae.add(p.boundsToExtent(aa.v._olSpit.connector.geometry.bounds));return ae};X.zoomTo=function(){var ab=X.getExtent();M.moveToPoint(ab.centerPoint())};X.getLayer=function(){return aa.v._olSpit.layer.CUB};X.position=function(ab){if(p.assert(ab,M.Position)){var ac=ab.clone();ac.projection(M.realProjection());aa.v._olSpit.lonlat=ac.internal(k,"toOLLonLat");aa.v._olSpit.layer.CUB.redraw()}return aa.v._olSpit.lonlat?p.lonLatToPosition(aa.v._olSpit.lonlat):null};X.offset=function(ab,ac){if(p.assert([ab,ac])){aa.v._olSpit.offset.x=ab;aa.v._olSpit.offset.y=ac;aa.v._olSpit.layer.CUB.redraw()}return{x:aa.v._olSpit.offset.x,y:aa.v._olSpit.offset.y}};X.toString=function(){return(X.name?X.name+" - ":"")+X.position()};X.destroy=function(){W.removeSpit(aa.v._olSpit);Z.destroy.apply(this)};return X}})();M.Panel=function(V){if(!p.isScopeValid(this)){return null}var Z;if(V&&V.secret&&V.secret==k){Z=V;V=arguments[1]}else{Z=p.createShared()}var Y=new M.Class(Z);var X=M.jQuery.extend(this,Y);var W=null;V=V||{};X.type="CUB.Panel";X.isAbstract=false;Z.v.div=M.jQuery('<div class="CUB_Panel_block"></div>');if(V.background){Z.v.div.addClass("CUB_Panel")}X.allowOverflow=typeof V.allowOverflow=="boolean"?V.allowOverflow:true;if(!X.allowOverflow){Z.v.div.css("overflow","hidden")}E.append(Z.v.div);X.opacity=function(aa){if(p.assert(aa)){Z.v.div.css("opacity",Math.min(100,Math.max(0,aa))/100)}return Z.v.div.css("opacity")*100};X.width=function(aa){if(p.assert(aa)){Z.v.div.width(aa)}return Z.v.div.width()};X.height=function(aa){if(p.assert(aa)){Z.v.div.height(aa)}return Z.v.div.height()};X.left=function(aa){if(p.assert(aa)){Z.v.div[0].style.left=aa+"px";Z.v.div[0].style.right=""}return Z.v.div[0].style.left?parseInt(Z.v.div[0].style.left):null};X.right=function(aa){if(p.assert(aa)){Z.v.div[0].style.right=aa+"px";Z.v.div[0].style.left=""}return Z.v.div[0].style.right?parseInt(Z.v.div[0].style.right):null};X.top=function(aa){if(p.assert(aa)){Z.v.div[0].style.top=aa+"px";Z.v.div[0].style.bottom=""}return Z.v.div[0].style.top?parseInt(Z.v.div[0].style.top):null};X.bottom=function(aa){if(p.assert(aa)){Z.v.div[0].style.bottom=aa+"px";Z.v.div[0].style.top=""}return Z.v.div[0].style.bottom?parseInt(Z.v.div[0].style.bottom):null};X.disable=function(aa){if(aa){Z.v.div.fadeOut(aa)}else{Z.v.div.hide()}};X.enable=function(aa){if(aa){Z.v.div.fadeIn(aa)}else{Z.v.div.show()}};X.destroy=function(){Z.v.div.remove();Y.destroy.apply(this)};X.backgroundColor=function(aa){if(p.assert(aa,M.Color)){W=aa;Z.v.div[0].style.backgroundColor=aa.color}else{if(aa===null){W=aa;Z.v.div[0].style.backgroundColor=""}}return W};X.content=function(aa){if(p.assert(aa)){Z.v.div.html(aa)}return Z.v.div.html()};X.zorder=function(aa){if(p.assert(aa)){Z.v.div.css("z-index",1400+Math.min(100,Math.max(0,aa)))}return Z.v.div.css("z-index")-1400};if(V.content){X.content(V.content)}if(typeof V.left=="number"){X.left(V.left)}else{X.left(0)}if(typeof V.top=="number"){X.top(V.top)}else{X.top(0)}if(typeof V.right=="number"){X.right(V.right)}if(typeof V.bottom=="number"){X.bottom(V.bottom)}if(V.width){X.width(V.width)}if(V.height){X.height(V.height)}if(V.backgroundColor){X.backgroundColor(V.backgroundColor)}if(V.opacity){X.opacity(V.opacity)}if(V.disabled&&V.disabled===true){X.disable()}};M.Panel.Zoom=function(ak){if(!p.isScopeValid(this)){return null}var Z=p.createShared();ak=ak||{};var W=new M.Panel(Z,M.jQuery.extend({},{allowOverflow:false},ak));var ac=M.jQuery.extend(this,W);var ad=M.jQuery('<div class="CUB_Panel_ZoomPlus">+</div>');var ai=M.jQuery('<div class="CUB_Panel_ZoomMinus">-</div>');ac.type="CUB.Panel.Zoom";ac.namespace=M.Panel.Zoom;ac.width(32);ac.height(70);if(!ak.right&&!ak.left){ac.left(8)}if(!ak.top&&!ak.bottom){ac.top(8)}Z.v.div.addClass("CUB_Default_Block CUB_Panel_Zoom");Z.v.div.append(ad);ad.click(ae);if(ak.zoomBar){Z.v.zoomBarHeight=ak.zoomBarHeight?ak.zoomBarHeight:150;Z.v.zoombarCursorHeight=9;Z.v.div_bar=M.jQuery('<div class="CUB_Panel_ZoomBar"></div>');Z.v.div_bar[0].style.height=Z.v.zoomBarHeight+"px";Z.v.div.append(Z.v.div_bar);ac.height(ac.height()+Z.v.zoomBarHeight);Z.v.div_cursor=M.jQuery('<div class="CUB_Panel_ZoomBarCursor"></div>');Z.v.div_bar.append(Z.v.div_cursor);Z.v.div_bar.mousedown(aj);Z.v.div_cursor.mousedown(ah);D.events.register("move",null,Y);Y()}if(ak.zoomGlobal){var X=M.jQuery('<div class="CUB_Panel_ZoomGlobal"></div>');Z.v.div.append(X);X.click(V);ac.height(ac.height()+30)}Z.v.div.append(ai);ai.click(af);function ae(al){M.zoomPlus()}function Y(al){if(!al||!al.object.dragging){Z.v.div_cursor[0].style.top=((D.getNumZoomLevels()-1)-D.zoom)*(Z.v.zoomBarHeight-Z.v.zoombarCursorHeight)/(D.getNumZoomLevels()-1)+"px"}}function ah(al){Z.v.divBarStartY=Z.v.div_cursor.position().top;Z.v.cursorDownY=al.clientY;Z.v.div_bar.mousemove(aa);Z.v.div_bar.mouseup(ag);Z.v.div_bar.mouseout(ag);al.stopPropagation()}function aa(al){Z.v.div_cursor[0].style.top=Math.max(0,Math.min(Z.v.zoomBarHeight-Z.v.zoombarCursorHeight,(Z.v.divBarStartY+(al.clientY-Z.v.cursorDownY))))+"px"}function aj(al){D.zoomTo(ab(al.pageY-Z.v.div_bar.offset().top))}function ag(al){Z.v.div_bar.unbind("mousemove",aa);Z.v.div_bar.unbind("mouseup",ag);Z.v.div_bar.unbind("mouseout",ag);D.zoomTo(ab(Z.v.div_cursor.position().top))}function V(al){M.moveToWhole()}function af(al){M.zoomMinus()}function ab(al){return(-al*(D.getNumZoomLevels()-1)/Z.v.zoomBarHeight)+(D.getNumZoomLevels()-1)}ac.content=null;ac.width=null;ac.height=null};M.Panel.GoogleStreetView=function(W){if(!p.isScopeValid(this)){return null}var Z=p.createShared();W=W||{};var Y=new M.Panel(Z,M.jQuery.extend({},{allowOverflow:false},W));var X=M.jQuery.extend(this,Y);X.type="CUB.Panel.GoogleStreetView";X.namespace=M.Panel.GoogleStreetView;if(!W.height&&!W.width){X.width(400)}if(!W.height&&!W.width){X.height(200)}if(!W.right&&!W.left){X.left(8)}if(!W.top&&!W.bottom){X.top(8)}Z.v.position=W.position?W.position:M.center();Z.v.angle=W.angle?W.angle:0;L.load(V);function V(){var ab=Z.v.position.clone();ab.projection(M.projections.WGS84);var aa={position:new google.maps.LatLng(ab.y,ab.x),pov:{heading:Z.v.angle,pitch:0,zoom:1}};Z.v.streetView=new google.maps.StreetViewPanorama(Z.v.div[0],aa);Z.v.streetView.setVisible(true)}X.position=function(aa){if(p.assert(aa)){Z.v.position=aa;if(!Z.v.streetView){return}var ab=Z.v.position.clone();ab.projection(M.projections.WGS84);Z.v.streetView.setPosition(new google.maps.LatLng(ab.y,ab.x))}var ab=Z.v.streetView.getPosition();return p.lonLatToPosition({lon:ab.lng(),lat:ab.lat()},M.projections.WGS84)};X.angle=function(ab){if(p.assert(position)){Z.v.angle=ab;if(!Z.v.streetView){return}Z.v.streetView.setPov({heading:Z.v.angle,pitch:0,zoom:1})}var aa=Z.v.streetView.getPov();return aa.heading}};M.Panel.North=function(ag){if(!p.isScopeValid(this)){return null}var X=p.createShared();var V=new M.Panel(X,ag);var ad=M.jQuery.extend(this,V);var Z=M.jQuery('<div class="CUB_Panel_North"></div>');var aa=null;var ac=null;ag=ag||{};ad.type="CUB.Panel.North";ad.namespace=M.Panel.North;ad.width(64);ad.height(64);if(!ag.right&&!ag.left){ad.right(8)}if(!ag.top&&!ag.bottom){ad.top(8)}X.v.div.append(Z);if(!M.caps.canRotate){Z.hide()}D.events.register("rotation",this,Y);X.v.div.dblclick(function(){M.rotate(0)});X.v.div.mousedown(ae);ad.content=null;ad.width=null;ad.height=null;function Y(ah){M.utils.rotateElement(Z,ah.angle)}function ae(ah){aa=af(ah);ac=M.rotate();X.v.div.mousemove(W);X.v.div.mouseup(ab);X.v.div.mouseout(ab);return false}function W(ah){var ai=af(ah);M.rotate(ac+(ai-aa));if(M.caps.isFireFox||M.caps.isIE||M.caps.isOpera){ac=M.rotate()}}function ab(ah){X.v.div.unbind("mousemove",W);X.v.div.unbind("mouseup",ab);X.v.div.unbind("mouseout",ab);aa=null;ac=null}function af(am){var al,ak;if(M.caps.isIE||M.caps.isOpera){al=am.offsetX;ak=am.offsetY}else{al=am.originalEvent.layerX;ak=am.originalEvent.layerY}var ai=(al-Z.width()/2);var an=(Z.height()/2-ak);var aj=new B.Geometry.Point(al,ak);var ah=new B.Geometry.Point(Z.width()/2,Z.height()/2);return Math.acos(an/aj.distanceTo(ah))*180/Math.PI*(ai>=0?1:-1)}};M.Panel.Loading=function(W){if(!p.isScopeValid(this)){return null}var ab=p.createShared();W=W||{};if(typeof W.disabled==="undefined"){W.disabled=true}var aa=new M.Panel(ab,W);var Z=M.jQuery.extend(this,aa);var V=M.jQuery('<div class="CUB_Panel_Loader"></div><div class="CUB_Panel_Loader_text"></div>');Z.type="CUB.Panel.Loading";Z.namespace=M.Panel.Loading;ab.v.div.css("width","auto");ab.v.div.css("height","auto");ab.v.div.css("min-width","64px");ab.v.div.css("min-height","50px");ab.v.div.addClass("CUB_Default_Block");ab.v.div.append(V);M.events.attach("onLayersLoadStart",X);M.events.attach("onLayersLoadEnd",ac);if(!W.right&&!W.left&&!W.top&&!W.bottom){M.events.attach("onResize",Y)}Z.content=null;Z.autoShow=typeof W.autoShow==="boolean"?W.autoShow:true;Z.setText=function(ad){ab.v.div.find('div[class="CUB_Panel_Loader_text"]').html(ad)};function Y(ae,ad){Z.left((ae-Math.min(100,Z.width()))/2);Z.top((ad-Math.min(100,Z.height()))/2)}function X(){if(Z.autoShow){Z.enable(500)}}function ac(){if(Z.autoShow){Z.disable(500)}}if(W.text){Z.setText(W.text)}Y(M.getWidth(),M.getHeight())};M.Data={};M.Data=function(Y,V){if(!Y||!Y.secret||Y.secret!=k){p.errorLog("Cette classe n'est pas instanciable directement",p.errorLevel.WARNING);return null}var W={};var X=new M.Class(Y,"CUB.Data",false,true);W=M.jQuery.extend(this,X);W.namespace=M.Data;W.type="CUB.Data";W.name=V||"";W.state=M.Data.dataState.INITIALIZING;W.error=M.Data.dataError.NONE;W.onLoadStart=Y.v.options.onLoadStart||null;W.onLoadEnd=Y.v.options.onLoadEnd||null;W.onStateChange=Y.v.options.onStateChange||null;Y.f.updateState=function(Z){W.state=Z;if(typeof W.onStateChange=="function"){W.onStateChange.apply(W)}};W.destroy=function(){X.destroy.apply(this)};return W};M.Data.dataState={INITIALIZING:1,UNCOMPRESSING:10,LOADING:20,READY:40,LOADINGSTOPS:21,LOADINGLINES:22,LOADINGSERVICES:23,LOADINGTRIPS:24,LOADINGSTOPSTIMES:25,ERROR:-1};M.Data.dataError={NONE:0,INVALIDURL:1,INVALIDDATA:2,UNKNOWN:99};(function(){M.Data.Alphanumeric=function(V,W,aj){var ad=aj&&aj._secret&&aj._secret==k;var Z=ad?aj.shared:p.createShared();Z.v.options=aj=aj||{};var X=new M.Data(Z,V);var ae=M.jQuery.extend(this,X);var Y=null;aj.attributes=M.jQuery.isArray(aj.attributes)?aj.attributes:null;Z.v.chrono=M.chrono.start();ae.namespace=M.Data.Alphanumeric;ae.type="CUB.Data.Alphanumeric";ae.isAbstract=false;if(!aj.data&&!p.assert(W)){return p.errorLog("L'url ne peut pas être vide ou options.data doit être renseigné ("+this.type+")",p.errorLevel.ERROR)}ae.url=aj.data?null:W;ae.fileType=ae.url?aj.fileType||ag(W):M.Data.Alphanumeric.fileType.CSV;ae.castData=aj.castData||false;ae.headers=[];ae.separator=aj.separator?aj.separator:null;ae.each=function(ao,an){if(an==undefined){an=false}if(typeof ao!=="function"){return p.assert("callback n'est pas une fonction ("+ae.type+")",p.errorLevel.ERROR)}var am;for(i in Y){if(an){var ak=[];for(var al in ae.headers){ak[ae.headers[al]]=Y[i][al]}am=ao.apply(this,[ak])}else{am=ao.apply(this,[Y[i]])}if(am===false){break}}};ae.addRecord=function(am){var ao=0;for(var an in am){ao++}if(ao!=ae.headers.length){throw"Taille de l'enregistrement différente du nombre de champs de la couche"}var al=[];var ak=0;for(var an in am){if((ak=ae.headers.indexOf(an))==-1){throw"L'indice "+an+" n'est pas un champ de la couche alphanumérique"}if(typeof am==="array"){al.push(am[an])}else{al[ak]=am[an]}}Y.push(al)};ae.destroy=function(){if(Y){delete Y}X.destroy.apply(this)};ae.exportAll=function(ao){var al="";al=ae.headers.join(",")+"\n";for(var an in Y){var ak=[];for(var am in Y[an]){if(typeof Y[an][am]=="string"){ak.push('"'+Y[an][am]+'"')}else{ak.push(Y[an][am])}}al+=ak.join(",")+"\n"}return al};function ag(ak){switch(p.getExtension(ak)){case"csv":return M.Data.Alphanumeric.fileType.CSV;break}}function ac(ak,an){var aq=/.*/.exec(ak)[0];ae.separator=af(aq);ae.headers=aq.split(ae.separator);$(ae.headers).each(function(ar,at){ae.headers[ar]=at.replace(/^"|"$/g,"")});var ap=false;if(/\r\n/.test(ak)){ap=true}ak=ak.substr(aq.length+(ap?2:1));var am=ah();var ao;Y=new Array;var al=function(){var at=0;while(ao=am.exec(ak)){var au=new Array;for(var ar=1;ar<ao.length;ar++){au.push(ao[ar])}Y.push(au);++at;if(at>1000){if(!an){setTimeout(al,20)}return true}}delete ak;if(ae.castData){ai()}ab();return false};if(an){while(al()){}}else{al()}}function ai(){var ak=new RegExp("^-?[0-9]+(?:.[0-9]+)?$");for(var am in Y){var an=Y[am];for(var al in an){if(ak.test(an[al])){an[al]=parseFloat(an[al])}}}}function ah(){if(!aj.attributes){aj.attributes=ae.headers}var an=new Array;for(var ao in aj.attributes){var am=M.jQuery.inArray(aj.attributes[ao],ae.headers);if(am>-1){an.push(am)}else{p.errorLog("L'attribute "+aj.attributes[ao]+"n'existe pas dans le fichier de données ("+ae.name+")");array.splice(ao,1)}}an.sort(function(at,ar){return(at-ar)});var al=new Array;for(var ao=0;ao<an.length;++ao){al.push(ae.headers[an[ao]])}var ap=new Array;var aq=1;var ak=1;for(var ao in ae.headers){if(M.jQuery.inArray(ae.headers[ao],al)!=-1){ap.push('"?((?:(?:"")|[^"])*?)"?(?!")')}else{ap.push('(?:"?)(?:(?:"")|[^"])*?"?(?!")')}}ap=new RegExp("^\\n?"+ap.join(ae.separator)+"\\r?$","gm");ae.headers=al;return ap}function af(ap){var am=null;if(aj&&typeof aj.separator==="string"){am=aj.separator}else{var ak=-1;var ao=[",",";","\t",":"];for(var an=0;an<ao.length;++an){var al=ap.match(new RegExp(ao[an],"g"));if(al&&al.length>ak){am=ao[an];ak=al.length}}if(am==null){return p.errorLog("Détection du séparateur ")}}return am}function aa(ak){if(typeof(ae.onLoadStart)=="function"){ae.onLoadStart.apply(ae)}}function ab(){if(typeof(ae.onLoadEnd)=="function"){ae.onLoadEnd.apply(ae,[M.chrono.stop(Z.v.chrono)])}}aa();switch(ae.fileType){case M.Data.Alphanumeric.fileType.CSV:if(aj.data){ac(aj.data,false)}else{T.load(ae.url,ac,function(ak){if(ak.error=="INVALIDURL"){ae.error=M.Layer.layerError.INVALIDURL;ae.errorText=ak.errorText}else{ae.error=M.Layer.layerError.UNKNOWN;ae.errorText=ak.errorText?ak.errorText:""}})}break;default:p.errorLog("Type de donnée incorrect",p.errorLevel.WARNING);return null}return ae};M.Data.Alphanumeric.fileType={CSV:1}})();(function(){M.Data.Transport=function(ax,Z,X){var ak=X&&X._secret&&X._secret==k;var V=ak?X.shared:p.createShared();V.v.options=X=X||{};var ab=new M.Data(V,ax);var ae=M.jQuery.extend(this,ab);var am;var at=new Array;var an;var aq;var ar;var ah=new Array;V.f.updateState(M.Data.dataState.INITIALIZING);V.v.chrono=M.chrono.start();ae.type="CUB.Data.Transport";ae.isAbstract=false;if(!p.assert(Z)){return p.errorLog("L'url ne peut pas être vide ("+this.type+")",p.errorLevel.ERROR)}ae.url=Z||null;ae.transportType=X.transportType||M.Data.Transport.transportType.GTFS;ae.findStops=function(aA){var aB=new RegExp(aA,"i");var az=new Array;for(var ay in at){if(aB.test(at[ay].name)){az.push(at[ay])}}return az};ae.findAtDate=function(aA,aF,ay){ay=ay||30;var aD=ae.getStopsTimesOfStop(aF);var aE=new Array;var aH=aA.getHours()*60+aA.getMinutes();var aG=/^(\d\d):(\d\d)/;for(var aB in aD){var aC=aD[aB].time.match(aG);var az=parseInt(aC[1])*60+parseInt(aC[2]);if(aH+ay>=az&&aH-ay<=az&&ae.isDateInService(aA,aD[aB].trip.service)){aE.push(aD[aB])}}return aE};ae.isDateInService=function(az,ay){if(az<ay.start_date||az>ay.end_date){return false}switch(az.getDay()){case 1:return ay.monday;case 2:return ay.tuesday;case 3:return ay.wednesday;case 4:return ay.thursday;case 5:return ay.friday;case 6:return ay.saturday;case 0:return ay.sunday}};ae.getAllStops=function(aA){if(aA){if(!p.checkEnum(aA,M.Data.Transport.stopType)){return p.errorLog("Type d'arrêt invalide ("+ae.name+")",p.errorLevel.WARNING)}var ay=new Array;for(var az in at){if(at[az].type==aA){ay.push(at[az])}}return ay}else{return at}};ae.getStopOfStation=function(aA){var ay=new Array;for(var az in at){if(at[az].parent==aA){ay.push(at[az])}}return ay};ae.getStopById=function(ay){return ap(at,ay)};ae.getStopsTimesOfStop=function(aA){var ay=new Array;for(var az in ah){if(ah[az].stop==aA){ay.push(ah[az])}}return ay};ae.getStopsOfLine=function(ay){var aA=new Array;for(var az in ah){if(ah[az].trip.line==ay&&M.jQuery.inArray(ah[az].stop,aA)==-1){aA.push(ah[az].stop)}}return aA};ae.getAllLines=function(){return an};ae.getLineById=function(ay){return ap(an,ay)};ae.getAllTrips=function(){return ar};function ap(aA,az){for(var ay in aA){if(aA[ay].id==az){return aA[ay]}}return null}function ai(ay){V.f.updateState(M.Data.dataState.UNCOMPRESSING);aa()}function aa(){V.f.updateState(M.Data.dataState.LOADINGSTOPS);_to_load=[{data:null,csv:null,file:"stops.txt",name:"Arrêts",fn:av,data_unzipped:false,data_parsing:false,attributes:["stop_id","stop_name","stop_lat","stop_lon","parent_station"]},{data:null,csv:null,file:"routes.txt",name:"Lignes",fn:ao,data_unzipped:false,data_parsing:false},{data:null,csv:null,file:"calendar.txt",name:"Service",fn:ad,data_unzipped:false,data_parsing:false},{data:null,csv:null,file:"trips.txt",name:"Voyages",fn:au,data_unzipped:false,data_parsing:false},{data:null,csv:null,file:"stop_times.txt",name:"Horaires",fn:ag,data_unzipped:false,data_parsing:false,attributes:["trip_id","arrival_time","departure_time","stop_id"]}];aj()}function aj(){for(var ay in _to_load){if(!_to_load[ay].data_unzipped){am.readFiles(_to_load[ay].file,aw);af();return}}af()}function al(){_to_load[0].csv.destroy();delete _to_load[0].csv;_to_load.shift();af()}function af(){if(_to_load.length){var ay=_to_load[0];if(!ay.data_unzipped||ay.data_parsing){return}W(ay)}else{delete _to_load;V.f.updateState(M.Data.dataState.READY);ac()}}function W(ay){ay.data_parsing=true;setTimeout(function(){ay.csv=new M.Data.Alphanumeric(ae.name+" - "+ay.name,null,{data:ay.data,onLoadEnd:ay.fn,attributes:ay.attributes})},16)}function aw(ay,aA){for(var az in _to_load){if(_to_load[az].file==aA[0]){_to_load[az].data_unzipped=true;_to_load[az].data=ay[aA[0]];aj()}}}function av(aA){this.each(function(aB){at[aB.stop_id+""]=new M.Data.Transport.Stop(aB.stop_id,new M.Position(aB.stop_lon,aB.stop_lat,M.projections.WGS84),aB.stop_name,aB.location_type||0,aB.parent_station)},true);for(var az in at){var ay=at[az];if(ay.type==M.Data.Transport.stopType.STOP&&ay.parent){if(at[ay.parent]){ay.parent=at[ay.parent]}else{p.errorLog("L'arrêt "+ay.id+" pointe vers un parent inexistant ("+ay.parent+")",p.errorLevel.INFO)}}}V.f.updateState(M.Data.dataState.LOADINGLINES);al()}function ao(ay){an=new Array;this.each(function(az){an[az.route_id]=new M.Data.Transport.Line(az.route_id,az.route_long_name,az.route_type)},true);V.f.updateState(M.Data.dataState.LOADINGSERVICES);al()}function ad(ay){aq=new Array;this.each(function(az){aq[az.service_id]=new M.Data.Transport.Service(az.service_id,M.utils.stringToDate(az.start_date+""),M.utils.stringToDate(az.end_date+""),az.monday?true:false,az.tuesday?true:false,az.wednesday?true:false,az.thursday?true:false,az.friday?true:false,az.saturday?true:false,az.sunday?true:false)},true);V.f.updateState(M.Data.dataState.LOADINGTRIPS);al()}function au(ay){ar=new Array;this.each(function(az){var aA=new M.Data.Transport.Trip(az.trip_id,an[az.route_id]?an[az.route_id]:az.route_id,aq[az.service_id]?aq[az.service_id]:az.service_id,az.trip_headsign);ar[az.trip_id]=aA},true);V.f.updateState(M.Data.dataState.LOADINGSTOPSTIMES);al()}function ag(ay){this.each(function(aA){var aB,az;aB=ar[aA.trip_id]||aA.trip_id;az=at[aA.stop_id]||aA.stop_id;ah.push(new M.Data.Transport.StopTime(aB,az,aA.arrival_time))},true);al()}function Y(ay){if(typeof(ae.onLoadStart)=="function"){ae.onLoadStart.apply(ae)}}function ac(){am.destroy();if(typeof(ae.onLoadEnd)=="function"){ae.onLoadEnd.apply(ae,[M.chrono.stop(V.v.chrono)])}}switch(ae.transportType){case M.Data.Transport.transportType.GTFS:V.f.updateState(M.Data.dataState.LOADING);am=new M.Data.ZipFile("",ae.url,{onLoadEnd:ai});break;default:V.f.updateState(M.Data.dataState.ERROR);p.errorLog("Type de service incorrect",p.errorLevel.WARNING);return null}return ae};M.Data.Transport.transportType={GTFS:1};M.Data.Transport.stopType={STOP:0,STATION:1};M.Data.Transport.lineType={TRAMWAY:0,METRO:1,RAIL:2,BUS:3};M.Data.Transport.Stop=function(){return{id:arguments[0],pos:arguments[1],name:arguments[2],type:arguments[3],parent:arguments[4]}};M.Data.Transport.Line=function(){return{id:arguments[0],name:arguments[1],type:arguments[2]}};M.Data.Transport.Service=function(){return{id:arguments[0],start_date:arguments[1],end_date:arguments[2],monday:arguments[3],tuesday:arguments[4],wednesday:arguments[5],thursday:arguments[6],friday:arguments[7],saturday:arguments[8],sunday:arguments[9]}};M.Data.Transport.Trip=function(){return{id:arguments[0],line:arguments[1],service:arguments[2],name:arguments[3]}};M.Data.Transport.StopTime=function(){return{trip:arguments[0],stop:arguments[1],time:arguments[2]}}})();M.Data.ZipFile=function(V,W,ad){var Y=p.createShared();Y.v.options=ad=ad||{};var X=new M.Data(Y,V);var ac=M.jQuery.extend(this,X);var ab;ac.namespace=M.Data.ZipFile;ac.type="CUB.Data.ZipFile";ac.isAbstract=false;if(!p.assert(W)){return p.errorLog("L'url ne peut pas être vide ("+this.type+")",p.errorLevel.ERROR)}ac.url=W;ac.files=null;ac.readFiles=function(ae,af){if(typeof ae=="string"){ae=[ae]}else{if(!M.jQuery.isArray(ae)){return p.errorLog("Le ou les noms de fichier à lire sont incorrects ("+this.type+")",p.errorLevel.ERROR)}}M.chrono.reset(Y.v.chrono);M.chrono.start(Y.v.chrono);c.call("read_files_in_zip",ac.url,ae,function(ag){af.apply(ac,[ag,ae])})};ac.destroy=function(){if(ac.files){delete ac.files}c.call("destroy_zip",ac.url);X.destroy.apply(this)};function aa(ae){ac.files=ae;if(typeof(ac.onLoadEnd)=="function"){ac.onLoadEnd.apply(ac,[ae])}}function Z(ae){if(typeof(ac.onLoadStart)=="function"){ac.onLoadStart.apply(ac)}}Z();c.call("load_zip",ac.url,ac.url,aa)};return{ready:M.ready,init:M.init,events:M.events,caps:M.caps};function j(V){alert("Utilisation d'un eval dans le code. Modifier la structure afin de ne pas en utiliser")}}();

