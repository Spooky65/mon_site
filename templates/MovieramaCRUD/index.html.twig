{% set page = "movierama_crud" %}
{% block header %}
    {% include 'header.html.twig' %}
{% endblock %}
{% block stylesheets %}
{# <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.css"/> #}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap5.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}
{% block javascripts %}
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.11.3/datatables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap5.min.js"></script>
<script>
$(document).ready(function() {
  $('#datatable').DataTable( {
      "language": {
          "lengthMenu": "Affiche _MENU_ entrée par page",
          "zeroRecords": "Aucune entrée - sorry",
          "search": "Rechercher",
          "previous": "Précédent",
          "next": "Suivant",
          "info": "Affiche page _PAGE_ à _PAGES_",
          "infoEmpty": "Aucun enregistrement disponible",
          "infoFiltered": "(filtered from _MAX_ total records)"
      }
  } );
  var myModal = document.getElementById('myModal')
  var myInput = document.getElementById('myInput')

  myModal.addEventListener('shown.bs.modal', function () {
    myInput.focus()
  })

} );
function loadInfo(title) {
  const xhttp = new XMLHttpRequest();
  xhttp.onload = function() {
    var myObject = eval('(' + this.responseText + ')');
    console.log(myObject);
    document.getElementById("infoMovie").innerHTML = "<div class='row'><div class='col-3' style='max-width : 200px;'>"+
            "{% if movie.Poster == 'N/A' %}"+
            "  <img src='/images/No-Image-Placeholder.svg' class='mw-50 img-thumbnail' alt='...'>"+
            "{% else %}"+
            "  <a href="+myObject.Poster+"><img src="+myObject.Poster+" class='img img-thumbnail' alt='...'></a>"+
            "{% endif %}"+
            "  <p class='text-center m-3'>"+
            "    <button class='btn btn-dark' type='button' data-bs-toggle='collapse' data-bs-target='#collapseExample"+myObject.imdbID+"' aria-expanded='false' aria-controls='collapseExample'>"+
            "      Plus"+
            "    </button>"+
            "  </p>"+
            "</div><div class='text-center col-9'>"+
            "  <h4 class='mb-3'>"+myObject.Title+"</h4>"+
              "<b>Date de sortie : </b>"+myObject.Released+
              "<br>"+
              "<b>Durée : </b>"+myObject.Runtime+
              "<br>"+
              "<b>Genre : </b>"+myObject.Genre+
              "<br>"+
              "<b>Synopsis EN : </b>"+myObject.Plot+
              "<br>"+
            //  "<b>Synopsis FR : </b>"+myObject.SynopsisFR+
            //  "<br>"+
              "<b>Note : </b>"+myObject.imdbRating+"/10 pour "+myObject.imdbVotes+" vote(s) sur Imdb"+
              "<br>"+
              "<div class='collapse' id='collapseExample"+myObject.imdbID+"'>"+
              "  <b>Classification : </b>"+myObject.Rated+
              "  <br>"+
              "  <b>Producteur : </b>"+myObject.Director+
              "  <br>"+
              "  <b>Scénariste : </b>"+myObject.Writer+
              "  <br>"+
              "  <b>Acteurs : </b>"+myObject.Actors+
            "    <br>"+
            "    <b>Language : </b>"+myObject.Language+
            "    <br>"+
            "    <b>Pays : </b>"+myObject.Country+
            "    <br>"+
            "    <b>Awards : </b>"+myObject.Awards+
            "    <br>"+
            "    <b>Sortie DVD : </b>"+myObject.DVD+
            "    <br>"+
            "    <b>BoxOffice : </b>"+myObject.BoxOffice+
            "    <br>"+
            "  </div>"+
            "  </div>"+
            "</div>";
  }
  xhttp.open("GET", "https://www.omdbapi.com/?t="+title+"&type=movie&apikey=16218600&r=json");
  xhttp.send();
}
</script>
{% endblock %}

{% block body %}
<body>
  <div class="container text-center">
    <div class="m-3 p-3">
      <h1>Movierama DataTable</h1>
    </div>
    <div class="mx-3 m-3 p-3">
        <text>
          (Les entrées sont limité à 1000 pour l'instant)
        </text>
    </div>
    <div class="container m-3">
      <div class="row">
    <table id="datatable" class="table table-striped table-dark" style="width:100%">
  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Titre original</th>
      <th scope="col">Infos</th>
      <th scope="col">Note</th>
    </tr>
  </thead>
  <tbody>
  {% set i = 0 %}
    {% for movie in movies %}
        {% if movie.adult == 0 and i < 1000 %}

  {% set i = i + 1 %}
    <tr>
      <td>{{ movie.id }}</td>
      <td><h4>{{ movie.original_title }}</h4></td>
      <td>
        <button type="button" class="btn btn-light"  onclick="loadInfo('{{ movie.original_title }}')" data-bs-toggle="modal" data-bs-target="#exampleModal">
          <i class="fas fa-list"></i><span class="glyphicon glyphicon-list" aria-hidden="true"></span>
        </button>
      </td>
      <td>{{ movie.popularity }}</td>
    </tr>
        {% endif %}
      {% endfor %}
    </tbody>
  </table>
    </div>
  </div>
  </div>
  <!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Informations du film</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div id="infoMovie" class="modal-body">
        A venir ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        {# <button type="button" class="btn btn-primary">Save changes</button> #}
      </div>
    </div>
  </div>
</div>
</body>
{% endblock %}

{% block footer %}
    {% include 'footer.html.twig' %}
{% endblock %}
